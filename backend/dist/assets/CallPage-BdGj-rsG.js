const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/latency-chart-Bj5OSYzg.es-CmGwxH8B.js","assets/index-BhatfHIB.js","assets/index-D0OoSQN7.css"])))=>i.map(i=>d[i]);
import{k as ud,m as dd,j as b,r as y,R as Sc,_ as hd,n as fd,o as pd,a as md,P as gd,V as bd,p as vd,q as yd}from"./index-BhatfHIB.js";import{_ as Fs,a as Tn,b as sn,c as kt,d as Sd,e as Cc,f as Wi,g as Cd,h as Td,r as Tc,i as Oe}from"./clsx-DpJhvpMA.js";function wd(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in t)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}let wc=!0,kc=!0;function Ln(t,e,n){const s=t.match(e);return s&&s.length>=n&&parseFloat(s[n],10)}function an(t,e,n){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,i=s.addEventListener;s.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const l=u=>{const d=n(u);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),i.apply(this,[o,l])};const r=s.removeEventListener;s.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(a))return r.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,l])},Object.defineProperty(s,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function kd(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(wc=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Rd(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(kc=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Rc(){if(typeof window=="object"){if(wc)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Kr(t,e){kc&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Ed(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ln(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ln(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ln(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Ln(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Uo(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ec(t){return Uo(t)?Object.keys(t).reduce(function(e,n){const s=Uo(t[n]),i=s?Ec(t[n]):t[n],r=s&&!Object.keys(i).length;return i===void 0||r?e:Object.assign(e,{[n]:i})},{}):t}function vr(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(s=>{s.endsWith("Id")?vr(t,t.get(e[s]),n):s.endsWith("Ids")&&e[s].forEach(i=>{vr(t,t.get(i),n)})}))}function $o(t,e,n){const s=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const r=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&r.push(o)}),r.forEach(o=>{t.forEach(a=>{a.type===s&&a.trackId===o.id&&vr(t,a,i)})}),i}const Vo=Rc;function Ic(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const s=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const d=typeof a[u]=="object"?a[u]:{ideal:a[u]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const f=function(c,h){return c?c+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(d.ideal!==void 0){l.optional=l.optional||[];let c={};typeof d.ideal=="number"?(c[f("min",u)]=d.ideal,l.optional.push(c),c={},c[f("max",u)]=d.ideal,l.optional.push(c)):(c[f("",u)]=d.ideal,l.optional.push(c))}d.exact!==void 0&&typeof d.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",u)]=d.exact):["min","max"].forEach(c=>{d[c]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(c,u)]=d[c])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},i=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const u=function(d,f,c){f in d&&!(c in d)&&(d[c]=d[f],delete d[f])};a=JSON.parse(JSON.stringify(a)),u(a.audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=s(a.audio)}if(a&&typeof a.video=="object"){let u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const d=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(c=>{c=c.filter(m=>m.kind==="videoinput");let h=c.find(m=>f.some(p=>m.label.toLowerCase().includes(p)));return!h&&c.length&&f.includes("back")&&(h=c[c.length-1]),h&&(a.video.deviceId=u.exact?{exact:h.deviceId}:{ideal:h.deviceId}),a.video=s(a.video),Vo("chrome: "+JSON.stringify(a)),l(a)})}a.video=s(a.video)}return Vo("chrome: "+JSON.stringify(a)),l(a)},r=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,u){i(a,d=>{n.webkitGetUserMedia(d,l,f=>{u&&u(r(f))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return i(l,u=>a(u).then(d=>{if(u.audio&&!d.getAudioTracks().length||u.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(r(d))))}}}function Id(t,e){if(!(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices)&&t.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}t.navigator.mediaDevices.getDisplayMedia=function(s){return e(s).then(i=>{const r=s.video&&s.video.width,o=s.video&&s.video.height,a=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:a||3}},r&&(s.video.mandatory.maxWidth=r),o&&(s.video.mandatory.maxHeight=o),t.navigator.mediaDevices.getUserMedia(s)})}}}function _c(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function xc(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",i=>{let r;t.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):r={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[s.stream],this.dispatchEvent(o)}),s.stream.getTracks().forEach(i=>{let r;t.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===i.id):r={track:i};const o=new Event("track");o.track=i,o.receiver=r,o.transceiver={receiver:r},o.streams=[s.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else an(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Pc(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=i.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){let u=i.apply(this,arguments);return u||(u=e(this,a),this._senders.push(u)),u};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],s.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Oc(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,i,r]=arguments;if(arguments.length>0&&typeof s=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof s!="function"))return e.apply(this,[]);const o=function(l){const u={};return l.result().forEach(f=>{const c={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(h=>{c[h]=f.stat(h)}),u[c.id]=c}),u},a=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};if(arguments.length>=2){const l=function(u){i(a(o(u)))};return e.apply(this,[l,s])}return new Promise((l,u)=>{e.apply(this,[function(d){l(a(o(d)))},u])}).then(i,r)}}function Nc(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=s.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>$o(o,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),an(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>$o(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let i,r,o;return this.getSenders().forEach(a=>{a.track===s&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===s&&(r?o=!0:r=a),a.track===s)),o||i&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Ac(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(u=>a.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],s.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function Dc(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Ac(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(f=>this._reverseStreams[f.id])};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(f=>{if(this.getSenders().find(h=>h.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const f=new t.MediaStream(d.getTracks());this._streams[d.id]=f,this._reverseStreams[f.id]=d,d=f}s.apply(this,[d])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const c=[].slice.call(arguments,1);if(c.length!==1||!c[0].getTracks().find(p=>p===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[f.id];if(m)m.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([d]);this._streams[f.id]=p,this._reverseStreams[p.id]=f,this.addStream(p)}return this.getSenders().find(p=>p.track===d)};function r(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(c=>{const h=u._reverseStreams[c],m=u._streams[h.id];f=f.replace(new RegExp(m.id,"g"),h.id)}),new RTCSessionDescription({type:d.type,sdp:f})}function o(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(c=>{const h=u._reverseStreams[c],m=u._streams[h.id];f=f.replace(new RegExp(h.id,"g"),m.id)}),new RTCSessionDescription({type:d.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const d=t.RTCPeerConnection.prototype[u],f={[u](){const c=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[m=>{const p=r(this,m);c[0].apply(null,[p])},m=>{c[1]&&c[1].apply(null,m)},arguments[2]]):d.apply(this,arguments).then(m=>r(this,m))}};t.RTCPeerConnection.prototype[u]=f[u]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return u.type===""?u:r(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let c;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(p=>d.track===p)&&(c=this._streams[h])}),c&&(c.getTracks().length===1?this.removeStream(this._reverseStreams[c.id]):c.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function yr(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function Lc(t,e){an(t,"negotiationneeded",n=>{const s=n.target;if(!((e.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return n})}const Bo=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Lc,shimAddTrackRemoveTrack:Dc,shimAddTrackRemoveTrackWithNative:Ac,shimGetDisplayMedia:Id,shimGetSendersWithDtmf:Pc,shimGetStats:Oc,shimGetUserMedia:Ic,shimMediaStream:_c,shimOnTrack:xc,shimPeerConnection:yr,shimSenderReceiverGetStats:Nc},Symbol.toStringTag,{value:"Module"}));function Mc(t,e){const n=t&&t.navigator,s=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,r,o){Kr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(r,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},r=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},s&&s.prototype.getSettings){const o=s.prototype.getSettings;s.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(s&&s.prototype.applyConstraints){const o=s.prototype.applyConstraints;s.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function _d(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!(s&&s.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return s.video===!0?s.video={mediaSource:e}:s.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(s)})}function jc(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Sr(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const r=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return s.apply(this,[r||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((d,f)=>{l.set(f,Object.assign({},d,{type:n[d.type]||d.type}))})}return l}).then(o,a)}}function Fc(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Uc(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s}),an(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $c(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Kr("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&n.getTracks().includes(s.track)&&this.removeTrack(s)})})}function Vc(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Bc(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const i=s.length>0;i&&s.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=s,o.sendEncodings=s,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function Hc(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const s=e.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function qc(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Wc(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const Ho=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Bc,shimCreateAnswer:Wc,shimCreateOffer:qc,shimGetDisplayMedia:_d,shimGetParameters:Hc,shimGetUserMedia:Mc,shimOnTrack:jc,shimPeerConnection:Sr,shimRTCDataChannel:Vc,shimReceiverGetStats:Uc,shimRemoveStream:$c,shimSenderGetStats:Fc},Symbol.toStringTag,{value:"Module"}));function Gc(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(i=>e.call(this,i,s)),s.getVideoTracks().forEach(i=>e.call(this,i,s))},t.RTCPeerConnection.prototype.addTrack=function(s,...i){return i&&i.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(n);if(s===-1)return;this._localStreams.splice(s,1);const i=n.getTracks();this.getSenders().forEach(r=>{i.includes(r.track)&&this.removeTrack(r)})})}}function Kc(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const r=new Event("addstream");r.stream=i,this.dispatchEvent(r)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(r)>=0)return;s._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,s.dispatchEvent(o)})}),e.apply(s,arguments)}}}function Jc(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,s=e.createAnswer,i=e.setLocalDescription,r=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],c=n.apply(this,[f]);return d?(c.then(u,d),Promise.resolve()):c},e.createAnswer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],c=s.apply(this,[f]);return d?(c.then(u,d),Promise.resolve()):c};let a=function(l,u,d){const f=i.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f};e.setLocalDescription=a,a=function(l,u,d){const f=r.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f},e.setRemoteDescription=a,a=function(l,u,d){const f=o.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f},e.addIceCandidate=a}function zc(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,s=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>s(Yc(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(s,i,r){e.mediaDevices.getUserMedia(s).then(i,r)}).bind(e))}function Yc(t){return t&&t.video!==void 0?Object.assign({},t,{video:Ec(t.video)}):t}function Xc(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(s,i){if(s&&s.iceServers){const r=[];for(let o=0;o<s.iceServers.length;o++){let a=s.iceServers[o];a.urls===void 0&&a.url?(Kr("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(s.iceServers[o])}s.iceServers=r}return new e(s,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Zc(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qc(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):s.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):s.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function el(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const qo=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:el,shimCallbacksAPI:Jc,shimConstraints:Yc,shimCreateOfferLegacy:Qc,shimGetUserMedia:zc,shimLocalStreamsAPI:Gc,shimRTCIceServerUrls:Xc,shimRemoteStreamsAPI:Kc,shimTrackEventTransceiver:Zc},Symbol.toStringTag,{value:"Module"}));var Gi={exports:{}},Wo;function xd(){return Wo||(Wo=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(s=>s.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const s=e.splitSections(n);return s&&s[0]},e.getMediaSections=function(n){const s=e.splitSections(n);return s.shift(),s},e.matchPrefix=function(n,s){return e.splitLines(n).filter(i=>i.indexOf(s)===0)},e.parseCandidate=function(n){let s;n.indexOf("a=candidate:")===0?s=n.substring(12).split(" "):s=n.substring(10).split(" ");const i={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let r=8;r<s.length;r+=2)switch(s[r]){case"raddr":i.relatedAddress=s[r+1];break;case"rport":i.relatedPort=parseInt(s[r+1],10);break;case"tcptype":i.tcpType=s[r+1];break;case"ufrag":i.ufrag=s[r+1],i.usernameFragment=s[r+1];break;default:i[s[r]]===void 0&&(i[s[r]]=s[r+1]);break}return i},e.writeCandidate=function(n){const s=[];s.push(n.foundation);const i=n.component;i==="rtp"?s.push(1):i==="rtcp"?s.push(2):s.push(i),s.push(n.protocol.toUpperCase()),s.push(n.priority),s.push(n.address||n.ip),s.push(n.port);const r=n.type;return s.push("typ"),s.push(r),r!=="host"&&n.relatedAddress&&n.relatedPort&&(s.push("raddr"),s.push(n.relatedAddress),s.push("rport"),s.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(s.push("ufrag"),s.push(n.usernameFragment||n.ufrag)),"candidate:"+s.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let s=n.substring(9).split(" ");const i={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),i.name=s[0],i.clockRate=parseInt(s[1],10),i.channels=s.length===3?parseInt(s[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let s=n.payloadType;n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+s+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const s=n.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const s={};let i;const r=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<r.length;o++)i=r[o].trim().split("="),s[i[0].trim()]=i[1];return s},e.writeFmtp=function(n){let s="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const r=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?r.push(o+"="+n.parameters[o]):r.push(o)}),s+="a=fmtp:"+i+" "+r.join(";")+`\r
`}return s},e.parseRtcpFb=function(n){const s=n.substring(n.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},e.writeRtcpFb=function(n){let s="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(r=>{s+="a=rtcp-fb:"+i+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),s},e.parseSsrcMedia=function(n){const s=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,s),10)},r=n.indexOf(":",s);return r>-1?(i.attribute=n.substring(s+1,r),i.value=n.substring(r+1)):i.attribute=n.substring(s+1),i},e.parseSsrcGroup=function(n){const s=n.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(i=>parseInt(i,10))}},e.getMid=function(n){const s=e.matchPrefix(n,"a=mid:")[0];if(s)return s.substring(6)},e.parseFingerprint=function(n){const s=n.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},e.getDtlsParameters=function(n,s){return{role:"auto",fingerprints:e.matchPrefix(n+s,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,s){let i="a=setup:"+s+`\r
`;return n.fingerprints.forEach(r=>{i+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),i},e.parseCryptoLine=function(n){const s=n.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const s=n.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,s){return e.matchPrefix(n+s,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,s){const i=e.matchPrefix(n+s,"a=ice-ufrag:")[0],r=e.matchPrefix(n+s,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},e.writeIceParameters=function(n){let s="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(s+=`a=ice-lite\r
`),s},e.parseRtpParameters=function(n){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");s.profile=r[2];for(let a=3;a<r.length;a++){const l=r[a],u=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(u){const d=e.parseRtpMap(u),f=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(d.parameters=f.length?e.parseFmtp(f[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),s.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{s.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return s.codecs.forEach(a=>{o.forEach(l=>{a.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||a.rtcpFeedback.push(l)})}),s},e.writeRtpDescription=function(n,s){let i="";i+="m="+n+" ",i+=s.codecs.length>0?"9":"0",i+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=s.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let r=0;return s.codecs.forEach(o=>{o.maxptime>r&&(r=o.maxptime)}),r>0&&(i+="a=maxptime:"+r+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const s=[],i=e.parseRtpParameters(n),r=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="cname"),l=a.length>0&&a[0].ssrc;let u;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(c=>c.substring(17).split(" ").map(m=>parseInt(m,10)));d.length>0&&d[0].length>1&&d[0][0]===l&&(u=d[0][1]),i.codecs.forEach(c=>{if(c.name.toUpperCase()==="RTX"&&c.parameters.apt){let h={ssrc:l,codecPayloadType:parseInt(c.parameters.apt,10)};l&&u&&(h.rtx={ssrc:u}),s.push(h),r&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},s.push(h))}}),s.length===0&&l&&s.push({ssrc:l});let f=e.matchPrefix(n,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,s.forEach(c=>{c.maxBitrate=f})),s},e.parseRtcpParameters=function(n){const s={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(s.cname=i.value,s.ssrc=i.ssrc);const r=e.matchPrefix(n,"a=rtcp-rsize");s.reducedSize=r.length>0,s.compound=r.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return s.mux=o.length>0,s},e.writeRtcpParameters=function(n){let s="";return n.reducedSize&&(s+=`a=rtcp-rsize\r
`),n.mux&&(s+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(s+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),s},e.parseMsid=function(n){let s;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return s=i[0].substring(7).split(" "),{stream:s[0],track:s[1]};const r=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(r.length>0)return s=r[0].value.split(" "),{stream:s[0],track:s[1]}},e.parseSctpDescription=function(n){const s=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:s.fmt,maxMessageSize:r};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const l=a[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},e.writeSctpDescription=function(n,s){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&i.push("a=max-message-size:"+s.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,s,i){let r;const o=s!==void 0?s:2;return n?r=n:r=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,s){const i=e.splitLines(n);for(let r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substring(2)}return s?e.getDirection(s):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const s=e.splitLines(n);for(let i=0;i<s.length;i++)if(s[i].length<2||s[i].charAt(1)!=="=")return!1;return!0},t.exports=e}(Gi)),Gi.exports}var tl=xd();const bn=ud(tl),Pd=wd({__proto__:null,default:bn},[tl]);function Es(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&(s=JSON.parse(JSON.stringify(s)),s.candidate=s.candidate.substring(2)),s.candidate&&s.candidate.length){const i=new e(s),r=bn.parseCandidate(s.candidate);for(const o in r)o in i||Object.defineProperty(i,o,{value:r[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(s)},t.RTCIceCandidate.prototype=e.prototype,an(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Cr(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||an(t,"icecandidate",e=>{if(e.candidate){const n=bn.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Is(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const l=bn.splitSections(a.sdp);return l.shift(),l.some(u=>{const d=bn.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},s=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const u=parseInt(l[1],10);return u!==u?-1:u},i=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},r=function(a,l){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const d=bn.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(u=2147483637),u},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=s(arguments[0]),u=i(l),d=r(arguments[0],l);let f;u===0&&d===0?f=Number.POSITIVE_INFINITY:u===0||d===0?f=Math.max(u,d):f=Math.min(u,d);const c={};Object.defineProperty(c,"maxMessageSize",{get(){return f}}),this._sctp=c}return o.apply(this,arguments)}}function _s(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(s,i){const r=s.send;s.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(s.readyState==="open"&&i.sctp&&l>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return r.apply(s,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},an(t,"datachannel",s=>(e(s.channel,s.target),s))}function Tr(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const s=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const r=i.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",i);r.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function wr(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function xs(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ps(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const Od=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:wr,shimAddIceCandidateNullOrEmpty:xs,shimConnectionState:Tr,shimMaxMessageSize:Is,shimParameterlessSetLocalDescription:Ps,shimRTCIceCandidate:Es,shimRTCIceCandidateRelayProtocol:Cr,shimSendThrowTypeError:_s},Symbol.toStringTag,{value:"Module"}));function Nd({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=Rc,s=Ed(t),i={browserDetails:s,commonShim:Od,extractVersion:Ln,disableLog:kd,disableWarnings:Rd,sdp:Pd};switch(s.browser){case"chrome":if(!Bo||!yr||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(s.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Bo,xs(t,s),Ps(t),Ic(t,s),_c(t),yr(t,s),xc(t),Dc(t,s),Pc(t),Oc(t),Nc(t),Lc(t,s),Es(t),Cr(t),Tr(t),Is(t,s),_s(t),wr(t,s);break;case"firefox":if(!Ho||!Sr||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Ho,xs(t,s),Ps(t),Mc(t,s),Sr(t,s),jc(t),$c(t),Fc(t),Uc(t),Vc(t),Bc(t),Hc(t),qc(t),Wc(t),Es(t),Tr(t),Is(t,s),_s(t);break;case"safari":if(!qo||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=qo,xs(t,s),Ps(t),Xc(t),Qc(t),Jc(t),Gc(t),Kc(t),Zc(t),zc(t),el(t),Es(t),Cr(t),Is(t,s),_s(t),wr(t,s);break;default:n("Unsupported browser!");break}return i}Nd({window:typeof window>"u"?void 0:window});function _n(t){let e=typeof t;if(e=="object"){if(Array.isArray(t))return"array";if(t===null)return"null"}return e}function Us(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}let Ot="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),bi=[];for(let t=0;t<Ot.length;t++)bi[Ot[t].charCodeAt(0)]=t;bi[45]=Ot.indexOf("+");bi[95]=Ot.indexOf("/");function Ad(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),s=0,i=0,r,o=0;for(let a=0;a<t.length;a++){if(r=bi[t.charCodeAt(a)],r===void 0)switch(t[a]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:o=r,i=1;break;case 1:n[s++]=o<<2|(r&48)>>4,o=r,i=2;break;case 2:n[s++]=(o&15)<<4|(r&60)>>2,o=r,i=3;break;case 3:n[s++]=(o&3)<<6|r,i=0;break}}if(i==1)throw Error("invalid base64 string.");return n.subarray(0,s)}function Dd(t){let e="",n=0,s,i=0;for(let r=0;r<t.length;r++)switch(s=t[r],n){case 0:e+=Ot[s>>2],i=(s&3)<<4,n=1;break;case 1:e+=Ot[i|s>>4],i=(s&15)<<2,n=2;break;case 2:e+=Ot[i|s>>6],e+=Ot[s&63],n=0;break}return n&&(e+=Ot[i],e+="=",n==1&&(e+="=")),e}var $s;(function(t){t.symbol=Symbol.for("protobuf-ts/unknown"),t.onRead=(n,s,i,r,o)=>{(e(s)?s[t.symbol]:s[t.symbol]=[]).push({no:i,wireType:r,data:o})},t.onWrite=(n,s,i)=>{for(let{no:r,wireType:o,data:a}of t.list(s))i.tag(r,o).raw(a)},t.list=(n,s)=>{if(e(n)){let i=n[t.symbol];return s?i.filter(r=>r.no==s):i}return[]},t.last=(n,s)=>t.list(n,s).slice(-1)[0];const e=n=>n&&Array.isArray(n[t.symbol])})($s||($s={}));function Ld(t,e){return Object.assign(Object.assign({},t),e)}var Ee;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Ee||(Ee={}));function Md(){let t=0,e=0;for(let s=0;s<28;s+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<s,(i&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let s=3;s<=31;s+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<s,(i&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Ki(t,e,n){for(let r=0;r<28;r=r+7){const o=t>>>r,a=!(!(o>>>7)&&e==0),l=(a?o|128:o)&255;if(n.push(l),!a)return}const s=t>>>28&15|(e&7)<<4,i=e>>3!=0;if(n.push((i?s|128:s)&255),!!i){for(let r=3;r<31;r=r+7){const o=e>>>r,a=!!(o>>>7),l=(a?o|128:o)&255;if(n.push(l),!a)return}n.push(e>>>31&1)}}const Os=65536*65536;function nl(t){let e=t[0]=="-";e&&(t=t.slice(1));const n=1e6;let s=0,i=0;function r(o,a){const l=Number(t.slice(o,a));i*=n,s=s*n+l,s>=Os&&(i=i+(s/Os|0),s=s%Os)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),[e,s,i]}function kr(t,e){if(e>>>0<=2097151)return""+(Os*e+(t>>>0));let n=t&16777215,s=(t>>>24|e<<8)>>>0&16777215,i=e>>16&65535,r=n+s*6777216+i*6710656,o=s+i*8147497,a=i*2,l=1e7;r>=l&&(o+=Math.floor(r/l),r%=l),o>=l&&(a+=Math.floor(o/l),o%=l);function u(d,f){let c=d?String(d):"";return f?"0000000".slice(c.length)+c:c}return u(a,0)+u(o,a)+u(r,1)}function Go(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function jd(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}let me;function Fd(){const t=new DataView(new ArrayBuffer(8));me=globalThis.BigInt!==void 0&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:t}:void 0}Fd();function sl(t){if(!t)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}const il=/^-?[0-9]+$/,Vs=4294967296,hs=2147483648;class rl{constructor(e,n){this.lo=e|0,this.hi=n|0}isZero(){return this.lo==0&&this.hi==0}toNumber(){let e=this.hi*Vs+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class qe extends rl{static from(e){if(me)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=me.C(e);case"number":if(e===0)return this.ZERO;e=me.C(e);case"bigint":if(!e)return this.ZERO;if(e<me.UMIN)throw new Error("signed value for ulong");if(e>me.UMAX)throw new Error("ulong too large");return me.V.setBigUint64(0,e,!0),new qe(me.V.getInt32(0,!0),me.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!il.test(e))throw new Error("string is no integer");let[n,s,i]=nl(e);if(n)throw new Error("signed value for ulong");return new qe(s,i);case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new qe(e,e/Vs)}throw new Error("unknown value "+typeof e)}toString(){return me?this.toBigInt().toString():kr(this.lo,this.hi)}toBigInt(){return sl(me),me.V.setInt32(0,this.lo,!0),me.V.setInt32(4,this.hi,!0),me.V.getBigUint64(0,!0)}}qe.ZERO=new qe(0,0);class ge extends rl{static from(e){if(me)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=me.C(e);case"number":if(e===0)return this.ZERO;e=me.C(e);case"bigint":if(!e)return this.ZERO;if(e<me.MIN)throw new Error("signed long too small");if(e>me.MAX)throw new Error("signed long too large");return me.V.setBigInt64(0,e,!0),new ge(me.V.getInt32(0,!0),me.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!il.test(e))throw new Error("string is no integer");let[n,s,i]=nl(e);if(n){if(i>hs||i==hs&&s!=0)throw new Error("signed long too small")}else if(i>=hs)throw new Error("signed long too large");let r=new ge(s,i);return n?r.negate():r;case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new ge(e,e/Vs):new ge(-e,-e/Vs).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return(this.hi&hs)!==0}negate(){let e=~this.hi,n=this.lo;return n?n=~n+1:e+=1,new ge(n,e)}toString(){if(me)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+kr(e.lo,e.hi)}return kr(this.lo,this.hi)}toBigInt(){return sl(me),me.V.setInt32(0,this.lo,!0),me.V.setInt32(4,this.hi,!0),me.V.getBigInt64(0,!0)}}ge.ZERO=new ge(0,0);const Ko={readUnknownField:!0,readerFactory:t=>new $d(t)};function Ud(t){return t?Object.assign(Object.assign({},Ko),t):Ko}class $d{constructor(e,n){this.varint64=Md,this.uint32=jd,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),n=e>>>3,s=e&7;if(n<=0||s<0||s>5)throw new Error("illegal tag: field no "+n+" wire type "+s);return[n,s]}skip(e){let n=this.pos;switch(e){case Ee.Varint:for(;this.buf[this.pos++]&128;);break;case Ee.Bit64:this.pos+=4;case Ee.Bit32:this.pos+=4;break;case Ee.LengthDelimited:let s=this.uint32();this.pos+=s;break;case Ee.StartGroup:let i;for(;(i=this.tag()[1])!==Ee.EndGroup;)this.skip(i);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return new ge(...this.varint64())}uint64(){return new qe(...this.varint64())}sint64(){let[e,n]=this.varint64(),s=-(e&1);return e=(e>>>1|(n&1)<<31)^s,n=n>>>1^s,new ge(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new qe(this.sfixed32(),this.sfixed32())}sfixed64(){return new ge(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function de(t,e){if(!t)throw new Error(e)}const Vd=34028234663852886e22,Bd=-34028234663852886e22,Hd=4294967295,qd=2147483647,Wd=-2147483648;function Un(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>qd||t<Wd)throw new Error("invalid int 32: "+t)}function Bs(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>Hd||t<0)throw new Error("invalid uint 32: "+t)}function Jr(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>Vd||t<Bd))throw new Error("invalid float 32: "+t)}const Jo={writeUnknownFields:!0,writerFactory:()=>new Kd};function Gd(t){return t?Object.assign(Object.assign({},Jo),t):Jo}class Kd{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let n=new Uint8Array(e),s=0;for(let i=0;i<this.chunks.length;i++)n.set(this.chunks[i],s),s+=this.chunks[i].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Bs(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Un(e),Go(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Jr(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Bs(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Un(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Un(e),e=(e<<1^e>>31)>>>0,Go(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),s=new DataView(n.buffer),i=ge.from(e);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),s=new DataView(n.buffer),i=qe.from(e);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(n)}int64(e){let n=ge.from(e);return Ki(n.lo,n.hi,this.buf),this}sint64(e){let n=ge.from(e),s=n.hi>>31,i=n.lo<<1^s,r=(n.hi<<1|n.lo>>>31)^s;return Ki(i,r,this.buf),this}uint64(e){let n=qe.from(e);return Ki(n.lo,n.hi,this.buf),this}}const zo={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},Yo={ignoreUnknownFields:!1};function Jd(t){return t?Object.assign(Object.assign({},Yo),t):Yo}function zd(t){return t?Object.assign(Object.assign({},zo),t):zo}function Yd(t,e){var n,s;let i=Object.assign(Object.assign({},t),e);return i.typeRegistry=[...(n=t==null?void 0:t.typeRegistry)!==null&&n!==void 0?n:[],...(s=e==null?void 0:e.typeRegistry)!==null&&s!==void 0?s:[]],i}const ol=Symbol.for("protobuf-ts/message-type");function Hs(t){let e=!1;const n=[];for(let s=0;s<t.length;s++){let i=t.charAt(s);i=="_"?e=!0:/\d/.test(i)?(n.push(i),e=!0):e?(n.push(i.toUpperCase()),e=!1):s==0?n.push(i.toLowerCase()):n.push(i)}return n.join("")}var I;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(I||(I={}));var Ct;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING",t[t.NUMBER=2]="NUMBER"})(Ct||(Ct={}));var qs;(function(t){t[t.NO=0]="NO",t[t.PACKED=1]="PACKED",t[t.UNPACKED=2]="UNPACKED"})(qs||(qs={}));function Xd(t){var e,n,s,i;return t.localName=(e=t.localName)!==null&&e!==void 0?e:Hs(t.name),t.jsonName=(n=t.jsonName)!==null&&n!==void 0?n:Hs(t.name),t.repeat=(s=t.repeat)!==null&&s!==void 0?s:qs.NO,t.opt=(i=t.opt)!==null&&i!==void 0?i:t.repeat||t.oneof?!1:t.kind=="message",t}function Zd(t){if(typeof t!="object"||t===null||!t.hasOwnProperty("oneofKind"))return!1;switch(typeof t.oneofKind){case"string":return t[t.oneofKind]===void 0?!1:Object.keys(t).length==2;case"undefined":return Object.keys(t).length==1;default:return!1}}class Qd{constructor(e){var n;this.fields=(n=e.fields)!==null&&n!==void 0?n:[]}prepare(){if(this.data)return;const e=[],n=[],s=[];for(let i of this.fields)if(i.oneof)s.includes(i.oneof)||(s.push(i.oneof),e.push(i.oneof),n.push(i.oneof));else switch(n.push(i.localName),i.kind){case"scalar":case"enum":(!i.opt||i.repeat)&&e.push(i.localName);break;case"message":i.repeat&&e.push(i.localName);break;case"map":e.push(i.localName);break}this.data={req:e,known:n,oneofs:Object.values(s)}}is(e,n,s=!1){if(n<0)return!0;if(e==null||typeof e!="object")return!1;this.prepare();let i=Object.keys(e),r=this.data;if(i.length<r.req.length||r.req.some(o=>!i.includes(o))||!s&&i.some(o=>!r.known.includes(o)))return!1;if(n<1)return!0;for(const o of r.oneofs){const a=e[o];if(!Zd(a))return!1;if(a.oneofKind===void 0)continue;const l=this.fields.find(u=>u.localName===a.oneofKind);if(!l||!this.field(a[a.oneofKind],l,s,n))return!1}for(const o of this.fields)if(o.oneof===void 0&&!this.field(e[o.localName],o,s,n))return!1;return!0}field(e,n,s,i){let r=n.repeat;switch(n.kind){case"scalar":return e===void 0?n.opt:r?this.scalars(e,n.T,i,n.L):this.scalar(e,n.T,n.L);case"enum":return e===void 0?n.opt:r?this.scalars(e,I.INT32,i):this.scalar(e,I.INT32);case"message":return e===void 0?!0:r?this.messages(e,n.T(),s,i):this.message(e,n.T(),s,i);case"map":if(typeof e!="object"||e===null)return!1;if(i<2)return!0;if(!this.mapKeys(e,n.K,i))return!1;switch(n.V.kind){case"scalar":return this.scalars(Object.values(e),n.V.T,i,n.V.L);case"enum":return this.scalars(Object.values(e),I.INT32,i);case"message":return this.messages(Object.values(e),n.V.T(),s,i)}break}return!0}message(e,n,s,i){return s?n.isAssignable(e,i):n.is(e,i)}messages(e,n,s,i){if(!Array.isArray(e))return!1;if(i<2)return!0;if(s){for(let r=0;r<e.length&&r<i;r++)if(!n.isAssignable(e[r],i-1))return!1}else for(let r=0;r<e.length&&r<i;r++)if(!n.is(e[r],i-1))return!1;return!0}scalar(e,n,s){let i=typeof e;switch(n){case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:switch(s){case Ct.BIGINT:return i=="bigint";case Ct.NUMBER:return i=="number"&&!isNaN(e);default:return i=="string"}case I.BOOL:return i=="boolean";case I.STRING:return i=="string";case I.BYTES:return e instanceof Uint8Array;case I.DOUBLE:case I.FLOAT:return i=="number"&&!isNaN(e);default:return i=="number"&&Number.isInteger(e)}}scalars(e,n,s,i){if(!Array.isArray(e))return!1;if(s<2)return!0;if(Array.isArray(e)){for(let r=0;r<e.length&&r<s;r++)if(!this.scalar(e[r],n,i))return!1}return!0}mapKeys(e,n,s){let i=Object.keys(e);switch(n){case I.INT32:case I.FIXED32:case I.SFIXED32:case I.SINT32:case I.UINT32:return this.scalars(i.slice(0,s).map(r=>parseInt(r)),n,s);case I.BOOL:return this.scalars(i.slice(0,s).map(r=>r=="true"?!0:r=="false"?!1:r),n,s);default:return this.scalars(i,n,s,Ct.STRING)}}}function ft(t,e){switch(e){case Ct.BIGINT:return t.toBigInt();case Ct.NUMBER:return t.toNumber();default:return t.toString()}}class eh{constructor(e){this.info=e}prepare(){var e;if(this.fMap===void 0){this.fMap={};const n=(e=this.info.fields)!==null&&e!==void 0?e:[];for(const s of n)this.fMap[s.name]=s,this.fMap[s.jsonName]=s,this.fMap[s.localName]=s}}assert(e,n,s){if(!e){let i=_n(s);throw(i=="number"||i=="boolean")&&(i=s.toString()),new Error(`Cannot parse JSON ${i} for ${this.info.typeName}#${n}`)}}read(e,n,s){this.prepare();const i=[];for(const[r,o]of Object.entries(e)){const a=this.fMap[r];if(!a){if(!s.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${r}`);continue}const l=a.localName;let u;if(a.oneof){if(o===null&&(a.kind!=="enum"||a.T()[0]!=="google.protobuf.NullValue"))continue;if(i.includes(a.oneof))throw new Error(`Multiple members of the oneof group "${a.oneof}" of ${this.info.typeName} are present in JSON.`);i.push(a.oneof),u=n[a.oneof]={oneofKind:l}}else u=n;if(a.kind=="map"){if(o===null)continue;this.assert(Us(o),a.name,o);const d=u[l];for(const[f,c]of Object.entries(o)){this.assert(c!==null,a.name+" map value",null);let h;switch(a.V.kind){case"message":h=a.V.T().internalJsonRead(c,s);break;case"enum":if(h=this.enum(a.V.T(),c,a.name,s.ignoreUnknownFields),h===!1)continue;break;case"scalar":h=this.scalar(c,a.V.T,a.V.L,a.name);break}this.assert(h!==void 0,a.name+" map value",c);let m=f;a.K==I.BOOL&&(m=m=="true"?!0:m=="false"?!1:m),m=this.scalar(m,a.K,Ct.STRING,a.name).toString(),d[m]=h}}else if(a.repeat){if(o===null)continue;this.assert(Array.isArray(o),a.name,o);const d=u[l];for(const f of o){this.assert(f!==null,a.name,null);let c;switch(a.kind){case"message":c=a.T().internalJsonRead(f,s);break;case"enum":if(c=this.enum(a.T(),f,a.name,s.ignoreUnknownFields),c===!1)continue;break;case"scalar":c=this.scalar(f,a.T,a.L,a.name);break}this.assert(c!==void 0,a.name,o),d.push(c)}}else switch(a.kind){case"message":if(o===null&&a.T().typeName!="google.protobuf.Value"){this.assert(a.oneof===void 0,a.name+" (oneof member)",null);continue}u[l]=a.T().internalJsonRead(o,s,u[l]);break;case"enum":if(o===null)continue;let d=this.enum(a.T(),o,a.name,s.ignoreUnknownFields);if(d===!1)continue;u[l]=d;break;case"scalar":if(o===null)continue;u[l]=this.scalar(o,a.T,a.L,a.name);break}}}enum(e,n,s,i){if(e[0]=="google.protobuf.NullValue"&&de(n===null||n==="NULL_VALUE",`Unable to parse field ${this.info.typeName}#${s}, enum ${e[0]} only accepts null.`),n===null)return 0;switch(typeof n){case"number":return de(Number.isInteger(n),`Unable to parse field ${this.info.typeName}#${s}, enum can only be integral number, got ${n}.`),n;case"string":let r=n;e[2]&&n.substring(0,e[2].length)===e[2]&&(r=n.substring(e[2].length));let o=e[1][r];return typeof o>"u"&&i?!1:(de(typeof o=="number",`Unable to parse field ${this.info.typeName}#${s}, enum ${e[0]} has no value for "${n}".`),o)}de(!1,`Unable to parse field ${this.info.typeName}#${s}, cannot parse enum value from ${typeof n}".`)}scalar(e,n,s,i){let r;try{switch(n){case I.DOUBLE:case I.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""){r="empty string";break}if(typeof e=="string"&&e.trim().length!==e.length){r="extra whitespace";break}if(typeof e!="string"&&typeof e!="number")break;let o=Number(e);if(Number.isNaN(o)){r="not a number";break}if(!Number.isFinite(o)){r="too large or small";break}return n==I.FLOAT&&Jr(o),o;case I.INT32:case I.FIXED32:case I.SFIXED32:case I.SINT32:case I.UINT32:if(e===null)return 0;let a;if(typeof e=="number"?a=e:e===""?r="empty string":typeof e=="string"&&(e.trim().length!==e.length?r="extra whitespace":a=Number(e)),a===void 0)break;return n==I.UINT32?Bs(a):Un(a),a;case I.INT64:case I.SFIXED64:case I.SINT64:if(e===null)return ft(ge.ZERO,s);if(typeof e!="number"&&typeof e!="string")break;return ft(ge.from(e),s);case I.FIXED64:case I.UINT64:if(e===null)return ft(qe.ZERO,s);if(typeof e!="number"&&typeof e!="string")break;return ft(qe.from(e),s);case I.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case I.STRING:if(e===null)return"";if(typeof e!="string"){r="extra whitespace";break}try{encodeURIComponent(e)}catch(l){l="invalid UTF8";break}return e;case I.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return Ad(e)}}catch(o){r=o.message}this.assert(!1,i+(r?" - "+r:""),e)}}class th{constructor(e){var n;this.fields=(n=e.fields)!==null&&n!==void 0?n:[]}write(e,n){const s={},i=e;for(const r of this.fields){if(!r.oneof){let u=this.field(r,i[r.localName],n);u!==void 0&&(s[n.useProtoFieldName?r.name:r.jsonName]=u);continue}const o=i[r.oneof];if(o.oneofKind!==r.localName)continue;const a=r.kind=="scalar"||r.kind=="enum"?Object.assign(Object.assign({},n),{emitDefaultValues:!0}):n;let l=this.field(r,o[r.localName],a);de(l!==void 0),s[n.useProtoFieldName?r.name:r.jsonName]=l}return s}field(e,n,s){let i;if(e.kind=="map"){de(typeof n=="object"&&n!==null);const r={};switch(e.V.kind){case"scalar":for(const[l,u]of Object.entries(n)){const d=this.scalar(e.V.T,u,e.name,!1,!0);de(d!==void 0),r[l.toString()]=d}break;case"message":const o=e.V.T();for(const[l,u]of Object.entries(n)){const d=this.message(o,u,e.name,s);de(d!==void 0),r[l.toString()]=d}break;case"enum":const a=e.V.T();for(const[l,u]of Object.entries(n)){de(u===void 0||typeof u=="number");const d=this.enum(a,u,e.name,!1,!0,s.enumAsInteger);de(d!==void 0),r[l.toString()]=d}break}(s.emitDefaultValues||Object.keys(r).length>0)&&(i=r)}else if(e.repeat){de(Array.isArray(n));const r=[];switch(e.kind){case"scalar":for(let l=0;l<n.length;l++){const u=this.scalar(e.T,n[l],e.name,e.opt,!0);de(u!==void 0),r.push(u)}break;case"enum":const o=e.T();for(let l=0;l<n.length;l++){de(n[l]===void 0||typeof n[l]=="number");const u=this.enum(o,n[l],e.name,e.opt,!0,s.enumAsInteger);de(u!==void 0),r.push(u)}break;case"message":const a=e.T();for(let l=0;l<n.length;l++){const u=this.message(a,n[l],e.name,s);de(u!==void 0),r.push(u)}break}(s.emitDefaultValues||r.length>0||s.emitDefaultValues)&&(i=r)}else switch(e.kind){case"scalar":i=this.scalar(e.T,n,e.name,e.opt,s.emitDefaultValues);break;case"enum":i=this.enum(e.T(),n,e.name,e.opt,s.emitDefaultValues,s.enumAsInteger);break;case"message":i=this.message(e.T(),n,e.name,s);break}return i}enum(e,n,s,i,r,o){if(e[0]=="google.protobuf.NullValue")return!r&&!i?void 0:null;if(n===void 0){de(i);return}if(!(n===0&&!r&&!i))return de(typeof n=="number"),de(Number.isInteger(n)),o||!e[1].hasOwnProperty(n)?n:e[2]?e[2]+e[1][n]:e[1][n]}message(e,n,s,i){return n===void 0?i.emitDefaultValues?null:void 0:e.internalJsonWrite(n,i)}scalar(e,n,s,i,r){if(n===void 0){de(i);return}const o=r||i;switch(e){case I.INT32:case I.SFIXED32:case I.SINT32:return n===0?o?0:void 0:(Un(n),n);case I.FIXED32:case I.UINT32:return n===0?o?0:void 0:(Bs(n),n);case I.FLOAT:Jr(n);case I.DOUBLE:return n===0?o?0:void 0:(de(typeof n=="number"),Number.isNaN(n)?"NaN":n===Number.POSITIVE_INFINITY?"Infinity":n===Number.NEGATIVE_INFINITY?"-Infinity":n);case I.STRING:return n===""?o?"":void 0:(de(typeof n=="string"),n);case I.BOOL:return n===!1?o?!1:void 0:(de(typeof n=="boolean"),n);case I.UINT64:case I.FIXED64:de(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let a=qe.from(n);return a.isZero()&&!o?void 0:a.toString();case I.INT64:case I.SFIXED64:case I.SINT64:de(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let l=ge.from(n);return l.isZero()&&!o?void 0:l.toString();case I.BYTES:return de(n instanceof Uint8Array),n.byteLength?Dd(n):o?"":void 0}}}function Rr(t,e=Ct.STRING){switch(t){case I.BOOL:return!1;case I.UINT64:case I.FIXED64:return ft(qe.ZERO,e);case I.INT64:case I.SFIXED64:case I.SINT64:return ft(ge.ZERO,e);case I.DOUBLE:case I.FLOAT:return 0;case I.BYTES:return new Uint8Array(0);case I.STRING:return"";default:return 0}}class nh{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const n=(e=this.info.fields)!==null&&e!==void 0?e:[];this.fieldNoToField=new Map(n.map(s=>[s.no,s]))}}read(e,n,s,i){this.prepare();const r=i===void 0?e.len:e.pos+i;for(;e.pos<r;){const[o,a]=e.tag(),l=this.fieldNoToField.get(o);if(!l){let c=s.readUnknownField;if(c=="throw")throw new Error(`Unknown field ${o} (wire type ${a}) for ${this.info.typeName}`);let h=e.skip(a);c!==!1&&(c===!0?$s.onRead:c)(this.info.typeName,n,o,a,h);continue}let u=n,d=l.repeat,f=l.localName;switch(l.oneof&&(u=u[l.oneof],u.oneofKind!==f&&(u=n[l.oneof]={oneofKind:f})),l.kind){case"scalar":case"enum":let c=l.kind=="enum"?I.INT32:l.T,h=l.kind=="scalar"?l.L:void 0;if(d){let g=u[f];if(a==Ee.LengthDelimited&&c!=I.STRING&&c!=I.BYTES){let v=e.uint32()+e.pos;for(;e.pos<v;)g.push(this.scalar(e,c,h))}else g.push(this.scalar(e,c,h))}else u[f]=this.scalar(e,c,h);break;case"message":if(d){let g=u[f],v=l.T().internalBinaryRead(e,e.uint32(),s);g.push(v)}else u[f]=l.T().internalBinaryRead(e,e.uint32(),s,u[f]);break;case"map":let[m,p]=this.mapEntry(l,e,s);u[f][m]=p;break}}}mapEntry(e,n,s){let i=n.uint32(),r=n.pos+i,o,a;for(;n.pos<r;){let[l,u]=n.tag();switch(l){case 1:e.K==I.BOOL?o=n.bool().toString():o=this.scalar(n,e.K,Ct.STRING);break;case 2:switch(e.V.kind){case"scalar":a=this.scalar(n,e.V.T,e.V.L);break;case"enum":a=n.int32();break;case"message":a=e.V.T().internalBinaryRead(n,n.uint32(),s);break}break;default:throw new Error(`Unknown field ${l} (wire type ${u}) in map entry for ${this.info.typeName}#${e.name}`)}}if(o===void 0){let l=Rr(e.K);o=e.K==I.BOOL?l.toString():l}if(a===void 0)switch(e.V.kind){case"scalar":a=Rr(e.V.T,e.V.L);break;case"enum":a=0;break;case"message":a=e.V.T().create();break}return[o,a]}scalar(e,n,s){switch(n){case I.INT32:return e.int32();case I.STRING:return e.string();case I.BOOL:return e.bool();case I.DOUBLE:return e.double();case I.FLOAT:return e.float();case I.INT64:return ft(e.int64(),s);case I.UINT64:return ft(e.uint64(),s);case I.FIXED64:return ft(e.fixed64(),s);case I.FIXED32:return e.fixed32();case I.BYTES:return e.bytes();case I.UINT32:return e.uint32();case I.SFIXED32:return e.sfixed32();case I.SFIXED64:return ft(e.sfixed64(),s);case I.SINT32:return e.sint32();case I.SINT64:return ft(e.sint64(),s)}}}class sh{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort((n,s)=>n.no-s.no)}}write(e,n,s){this.prepare();for(const r of this.fields){let o,a,l=r.repeat,u=r.localName;if(r.oneof){const d=e[r.oneof];if(d.oneofKind!==u)continue;o=d[u],a=!0}else o=e[u],a=!1;switch(r.kind){case"scalar":case"enum":let d=r.kind=="enum"?I.INT32:r.T;if(l)if(de(Array.isArray(o)),l==qs.PACKED)this.packed(n,d,r.no,o);else for(const f of o)this.scalar(n,d,r.no,f,!0);else o===void 0?de(r.opt):this.scalar(n,d,r.no,o,a||r.opt);break;case"message":if(l){de(Array.isArray(o));for(const f of o)this.message(n,s,r.T(),r.no,f)}else this.message(n,s,r.T(),r.no,o);break;case"map":de(typeof o=="object"&&o!==null);for(const[f,c]of Object.entries(o))this.mapEntry(n,s,r,f,c);break}}let i=s.writeUnknownFields;i!==!1&&(i===!0?$s.onWrite:i)(this.info.typeName,e,n)}mapEntry(e,n,s,i,r){e.tag(s.no,Ee.LengthDelimited),e.fork();let o=i;switch(s.K){case I.INT32:case I.FIXED32:case I.UINT32:case I.SFIXED32:case I.SINT32:o=Number.parseInt(i);break;case I.BOOL:de(i=="true"||i=="false"),o=i=="true";break}switch(this.scalar(e,s.K,1,o,!0),s.V.kind){case"scalar":this.scalar(e,s.V.T,2,r,!0);break;case"enum":this.scalar(e,I.INT32,2,r,!0);break;case"message":this.message(e,n,s.V.T(),2,r);break}e.join()}message(e,n,s,i,r){r!==void 0&&(s.internalBinaryWrite(r,e.tag(i,Ee.LengthDelimited).fork(),n),e.join())}scalar(e,n,s,i,r){let[o,a,l]=this.scalarInfo(n,i);(!l||r)&&(e.tag(s,o),e[a](i))}packed(e,n,s,i){if(!i.length)return;de(n!==I.BYTES&&n!==I.STRING),e.tag(s,Ee.LengthDelimited),e.fork();let[,r]=this.scalarInfo(n);for(let o=0;o<i.length;o++)e[r](i[o]);e.join()}scalarInfo(e,n){let s=Ee.Varint,i,r=n===void 0,o=n===0;switch(e){case I.INT32:i="int32";break;case I.STRING:o=r||!n.length,s=Ee.LengthDelimited,i="string";break;case I.BOOL:o=n===!1,i="bool";break;case I.UINT32:i="uint32";break;case I.DOUBLE:s=Ee.Bit64,i="double";break;case I.FLOAT:s=Ee.Bit32,i="float";break;case I.INT64:o=r||ge.from(n).isZero(),i="int64";break;case I.UINT64:o=r||qe.from(n).isZero(),i="uint64";break;case I.FIXED64:o=r||qe.from(n).isZero(),s=Ee.Bit64,i="fixed64";break;case I.BYTES:o=r||!n.byteLength,s=Ee.LengthDelimited,i="bytes";break;case I.FIXED32:s=Ee.Bit32,i="fixed32";break;case I.SFIXED32:s=Ee.Bit32,i="sfixed32";break;case I.SFIXED64:o=r||ge.from(n).isZero(),s=Ee.Bit64,i="sfixed64";break;case I.SINT32:i="sint32";break;case I.SINT64:o=r||ge.from(n).isZero(),i="sint64";break}return[s,i,r||o]}}function ih(t){const e=t.messagePrototype?Object.create(t.messagePrototype):Object.defineProperty({},ol,{value:t});for(let n of t.fields){let s=n.localName;if(!n.opt)if(n.oneof)e[n.oneof]={oneofKind:void 0};else if(n.repeat)e[s]=[];else switch(n.kind){case"scalar":e[s]=Rr(n.T,n.L);break;case"enum":e[s]=0;break;case"map":e[s]={};break}}return e}function Ji(t,e,n){let s,i=n,r;for(let o of t.fields){let a=o.localName;if(o.oneof){const l=i[o.oneof];if((l==null?void 0:l.oneofKind)==null)continue;if(s=l[a],r=e[o.oneof],r.oneofKind=l.oneofKind,s==null){delete r[a];continue}}else if(s=i[a],r=e,s==null)continue;switch(o.repeat&&(r[a].length=s.length),o.kind){case"scalar":case"enum":if(o.repeat)for(let u=0;u<s.length;u++)r[a][u]=s[u];else r[a]=s;break;case"message":let l=o.T();if(o.repeat)for(let u=0;u<s.length;u++)r[a][u]=l.create(s[u]);else r[a]===void 0?r[a]=l.create(s):l.mergePartial(r[a],s);break;case"map":switch(o.V.kind){case"scalar":case"enum":Object.assign(r[a],s);break;case"message":let u=o.V.T();for(let d of Object.keys(s))r[a][d]=u.create(s[d]);break}break}}}function rh(t,e,n){if(e===n)return!0;if(!e||!n)return!1;for(let s of t.fields){let i=s.localName,r=s.oneof?e[s.oneof][i]:e[i],o=s.oneof?n[s.oneof][i]:n[i];switch(s.kind){case"enum":case"scalar":let a=s.kind=="enum"?I.INT32:s.T;if(!(s.repeat?Xo(a,r,o):al(a,r,o)))return!1;break;case"map":if(!(s.V.kind=="message"?Zo(s.V.T(),fs(r),fs(o)):Xo(s.V.kind=="enum"?I.INT32:s.V.T,fs(r),fs(o))))return!1;break;case"message":let l=s.T();if(!(s.repeat?Zo(l,r,o):l.equals(r,o)))return!1;break}}return!0}const fs=Object.values;function al(t,e,n){if(e===n)return!0;if(t!==I.BYTES)return!1;let s=e,i=n;if(s.length!==i.length)return!1;for(let r=0;r<s.length;r++)if(s[r]!=i[r])return!1;return!0}function Xo(t,e,n){if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(!al(t,e[s],n[s]))return!1;return!0}function Zo(t,e,n){if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(!t.equals(e[s],n[s]))return!1;return!0}const oh=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class P{constructor(e,n,s){this.defaultCheckDepth=16,this.typeName=e,this.fields=n.map(Xd),this.options=s??{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},oh),{[ol]:{value:this}})),this.refTypeCheck=new Qd(this),this.refJsonReader=new eh(this),this.refJsonWriter=new th(this),this.refBinReader=new nh(this),this.refBinWriter=new sh(this)}create(e){let n=ih(this);return e!==void 0&&Ji(this,n,e),n}clone(e){let n=this.create();return Ji(this,n,e),n}equals(e,n){return rh(this,e,n)}is(e,n=this.defaultCheckDepth){return this.refTypeCheck.is(e,n,!1)}isAssignable(e,n=this.defaultCheckDepth){return this.refTypeCheck.is(e,n,!0)}mergePartial(e,n){Ji(this,e,n)}fromBinary(e,n){let s=Ud(n);return this.internalBinaryRead(s.readerFactory(e),e.byteLength,s)}fromJson(e,n){return this.internalJsonRead(e,Jd(n))}fromJsonString(e,n){let s=JSON.parse(e);return this.fromJson(s,n)}toJson(e,n){return this.internalJsonWrite(e,zd(n))}toJsonString(e,n){var s;let i=this.toJson(e,n);return JSON.stringify(i,null,(s=n==null?void 0:n.prettySpaces)!==null&&s!==void 0?s:0)}toBinary(e,n){let s=Gd(n);return this.internalBinaryWrite(e,s.writerFactory(),s).finish()}internalJsonRead(e,n,s){if(e!==null&&typeof e=="object"&&!Array.isArray(e)){let i=s??this.create();return this.refJsonReader.read(e,i,n),i}throw new Error(`Unable to parse message ${this.typeName} from JSON ${_n(e)}.`)}internalJsonWrite(e,n){return this.refJsonWriter.write(e,n)}internalBinaryWrite(e,n,s){return this.refBinWriter.write(e,n,s),n}internalBinaryRead(e,n,s,i){let r=i??this.create();return this.refBinReader.read(e,r,s,n),r}}function ah(t,e){var n,s,i;let r=t;return r.service=e,r.localName=(n=r.localName)!==null&&n!==void 0?n:Hs(r.name),r.serverStreaming=!!r.serverStreaming,r.clientStreaming=!!r.clientStreaming,r.options=(s=r.options)!==null&&s!==void 0?s:{},r.idempotency=(i=r.idempotency)!==null&&i!==void 0?i:void 0,r}class ch{constructor(e,n,s){this.typeName=e,this.methods=n.map(i=>ah(i,this)),this.options=s??{}}}class Ye extends Error{constructor(e,n="UNKNOWN",s){super(e),this.name="RpcError",Object.setPrototypeOf(this,new.target.prototype),this.code=n,this.meta=s??{}}toString(){const e=[this.name+": "+this.message];this.code&&(e.push(""),e.push("Code: "+this.code)),this.serviceName&&this.methodName&&e.push("Method: "+this.serviceName+"/"+this.methodName);let n=Object.entries(this.meta);if(n.length){e.push(""),e.push("Meta:");for(let[s,i]of n)e.push(`  ${s}: ${i}`)}return e.join(`
`)}}function lh(t,e){if(!e)return t;let n={};ps(t,n),ps(e,n);for(let s of Object.keys(e)){let i=e[s];switch(s){case"jsonOptions":n.jsonOptions=Yd(t.jsonOptions,n.jsonOptions);break;case"binaryOptions":n.binaryOptions=Ld(t.binaryOptions,n.binaryOptions);break;case"meta":n.meta={},ps(t.meta,n.meta),ps(e.meta,n.meta);break;case"interceptors":n.interceptors=t.interceptors?t.interceptors.concat(i):i.concat();break}}return n}function ps(t,e){if(!t)return;let n=e;for(let[s,i]of Object.entries(t))i instanceof Date?n[s]=new Date(i.getTime()):Array.isArray(i)?n[s]=i.concat():n[s]=i}var ht;(function(t){t[t.PENDING=0]="PENDING",t[t.REJECTED=1]="REJECTED",t[t.RESOLVED=2]="RESOLVED"})(ht||(ht={}));class ms{constructor(e=!0){this._state=ht.PENDING,this._promise=new Promise((n,s)=>{this._resolve=n,this._reject=s}),e&&this._promise.catch(n=>{})}get state(){return this._state}get promise(){return this._promise}resolve(e){if(this.state!==ht.PENDING)throw new Error(`cannot resolve ${ht[this.state].toLowerCase()}`);this._resolve(e),this._state=ht.RESOLVED}reject(e){if(this.state!==ht.PENDING)throw new Error(`cannot reject ${ht[this.state].toLowerCase()}`);this._reject(e),this._state=ht.REJECTED}resolvePending(e){this._state===ht.PENDING&&this.resolve(e)}rejectPending(e){this._state===ht.PENDING&&this.reject(e)}}var uh=function(t,e,n,s){function i(r){return r instanceof n?r:new n(function(o){o(r)})}return new(n||(n=Promise))(function(r,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?r(d.value):i(d.value).then(a,l)}u((s=s.apply(t,e||[])).next())})};class dh{constructor(e,n,s,i,r,o,a){this.method=e,this.requestHeaders=n,this.request=s,this.headers=i,this.response=r,this.status=o,this.trailers=a}then(e,n){return this.promiseFinished().then(s=>e?Promise.resolve(e(s)):s,s=>n?Promise.resolve(n(s)):Promise.reject(s))}promiseFinished(){return uh(this,void 0,void 0,function*(){let[e,n,s,i]=yield Promise.all([this.headers,this.response,this.status,this.trailers]);return{method:this.method,requestHeaders:this.requestHeaders,request:this.request,headers:e,response:n,status:s,trailers:i}})}}function xt(t,e,n,s,i){var r;{let o=(a,l,u)=>e.unary(a,l,u);for(const a of((r=s.interceptors)!==null&&r!==void 0?r:[]).filter(l=>l.interceptUnary).reverse()){const l=o;o=(u,d,f)=>a.interceptUnary(l,u,d,f)}return o(n,i,s)}}var ve;(function(t){t[t.cancelled=0]="cancelled",t[t.unknown=1]="unknown",t[t.invalid_argument=2]="invalid_argument",t[t.malformed=3]="malformed",t[t.deadline_exceeded=4]="deadline_exceeded",t[t.not_found=5]="not_found",t[t.bad_route=6]="bad_route",t[t.already_exists=7]="already_exists",t[t.permission_denied=8]="permission_denied",t[t.unauthenticated=9]="unauthenticated",t[t.resource_exhausted=10]="resource_exhausted",t[t.failed_precondition=11]="failed_precondition",t[t.aborted=12]="aborted",t[t.out_of_range=13]="out_of_range",t[t.unimplemented=14]="unimplemented",t[t.internal=15]="internal",t[t.unavailable=16]="unavailable",t[t.dataloss=17]="dataloss"})(ve||(ve={}));function hh(t,e,n){if(n)for(let[s,i]of Object.entries(n))if(typeof i=="string")t.append(s,i);else for(let r of i)t.append(s,r);return t.set("Content-Type",e?"application/json":"application/protobuf"),t.set("Accept",e?"application/json":"application/protobuf, application/json"),t}function fh(t){if(!Us(t)||typeof t.code!="string"||typeof t.msg!="string")return new Ye("cannot read twirp error response",ve[ve.internal]);let e={};if(Us(t.meta))for(let[n,s]of Object.entries(t.meta))typeof s=="string"&&(e[n]=s);return new Ye(t.msg,t.code,e)}function ph(t){let e={};return t.forEach((n,s)=>{s.toLowerCase()!=="content-type"&&s.toLowerCase()!=="content-length"&&(e.hasOwnProperty(s)?e[s].push(n):e[s]=n)}),e}class mh{constructor(e){this.defaultOptions=e}mergeOptions(e){return lh(this.defaultOptions,e)}unary(e,n,s){var i,r,o;let a=s,l=this.makeUrl(e,a),u=(i=a.fetchInit)!==null&&i!==void 0?i:{},d=a.sendJson?e.I.toJsonString(n,a.jsonOptions):e.I.toBinary(n,a.binaryOptions),f=new ms,c=new ms,h=new ms,m=new ms;return globalThis.fetch(l,Object.assign(Object.assign({},u),{method:"POST",headers:hh(new globalThis.Headers,!!a.sendJson,a.meta),body:d,signal:(r=s.abort)!==null&&r!==void 0?r:null})).then(p=>{f.resolve(ph(p.headers));let g;try{g=p.type}catch{}switch(g){case"error":case"opaque":case"opaqueredirect":throw new Ye(`fetch response type ${p.type}`,ve[ve.unknown])}return p.ok?a.sendJson?p.json().then(v=>e.O.fromJson(v,a.jsonOptions),()=>{throw new Ye("unable to read response body as json",ve[ve.dataloss])}):p.arrayBuffer().then(v=>e.O.fromBinary(new Uint8Array(v),a.binaryOptions),()=>{throw new Ye("unable to read response body",ve[ve.dataloss])}):p.json().then(v=>{throw fh(v)},()=>{throw new Ye("received HTTP "+p.status+", unable to read response body as json",ve[ve.internal])})},p=>{throw p instanceof Error&&p.name==="AbortError"?new Ye(p.message,ve[ve.cancelled]):new Ye(p instanceof Error?p.message:p)}).then(p=>{c.resolve(p),h.resolve({code:"OK",detail:""}),m.resolve({})}).catch(p=>{let g=p instanceof Ye?p:new Ye(p instanceof Error?p.message:p,ve[ve.internal]);g.methodName=e.name,g.serviceName=e.service.typeName,f.rejectPending(g),c.rejectPending(g),h.rejectPending(g),m.rejectPending(g)}),new dh(e,(o=a.meta)!==null&&o!==void 0?o:{},n,f.promise,c.promise,h.promise,m.promise)}makeUrl(e,n){let s=n.baseUrl;s.endsWith("/")&&(s=s.substring(0,s.length-1));let i=e.name;return n.useProtoMethodName!==!0&&(i=Hs(i),i=i.substring(0,1).toUpperCase()+i.substring(1)),`${s}/${e.service.typeName}/${i}`}clientStreaming(e){const n=new Ye("Client streaming is not supported by Twirp",ve[ve.unimplemented]);throw n.methodName=e.name,n.serviceName=e.service.typeName,n}duplex(e){const n=new Ye("Duplex streaming is not supported by Twirp",ve[ve.unimplemented]);throw n.methodName=e.name,n.serviceName=e.service.typeName,n}serverStreaming(e){const n=new Ye("Server streaming is not supported by Twirp",ve[ve.unimplemented]);throw n.methodName=e.name,n.serviceName=e.service.typeName,n}}function pe(t){return typeof t=="function"}function cl(t){var e=function(s){Error.call(s),s.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var zi=cl(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(s,i){return i+1+") "+s.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Ws(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var ns=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,s,i,r;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Fs(o),l=a.next();!l.done;l=a.next()){var u=l.value;u.remove(this)}}catch(p){e={error:p}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var d=this.initialTeardown;if(pe(d))try{d()}catch(p){r=p instanceof zi?p.errors:[p]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var c=Fs(f),h=c.next();!h.done;h=c.next()){var m=h.value;try{Qo(m)}catch(p){r=r??[],p instanceof zi?r=Tn(Tn([],sn(r)),sn(p.errors)):r.push(p)}}}catch(p){s={error:p}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(s)throw s.error}}}if(r)throw new zi(r)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Qo(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Ws(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Ws(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),ll=ns.EMPTY;function ul(t){return t instanceof ns||t&&"closed"in t&&pe(t.remove)&&pe(t.add)&&pe(t.unsubscribe)}function Qo(t){pe(t)?t():t.unsubscribe()}var gh={Promise:void 0},bh={setTimeout:function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return setTimeout.apply(void 0,Tn([t,e],sn(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function dl(t){bh.setTimeout(function(){throw t})}function ea(){}function Ns(t){t()}var zr=function(t){kt(e,t);function e(n){var s=t.call(this)||this;return s.isStopped=!1,n?(s.destination=n,ul(n)&&n.add(s)):s.destination=Sh,s}return e.create=function(n,s,i){return new Hn(n,s,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ns),vh=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(s){gs(s)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(s){gs(s)}else gs(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){gs(n)}},t}(),Hn=function(t){kt(e,t);function e(n,s,i){var r=t.call(this)||this,o;return pe(n)||!n?o={next:n??void 0,error:s??void 0,complete:i??void 0}:o=n,r.destination=new vh(o),r}return e}(zr);function gs(t){dl(t)}function yh(t){throw t}var Sh={closed:!0,next:ea,error:yh,complete:ea},Yr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ss(t){return t}function Ch(t){return t.length===0?ss:t.length===1?t[0]:function(n){return t.reduce(function(s,i){return i(s)},n)}}var ze=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,s){var i=this,r=wh(e)?e:new Hn(e,n,s);return Ns(function(){var o=i,a=o.operator,l=o.source;r.add(a?a.call(r,l):l?i._subscribe(r):i._trySubscribe(r))}),r},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var s=this;return n=ta(n),new n(function(i,r){var o=new Hn({next:function(a){try{e(a)}catch(l){r(l),o.unsubscribe()}},error:r,complete:i});s.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Yr]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Ch(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=ta(e),new e(function(s,i){var r;n.subscribe(function(o){return r=o},function(o){return i(o)},function(){return s(r)})})},t.create=function(e){return new t(e)},t}();function ta(t){var e;return(e=t??gh.Promise)!==null&&e!==void 0?e:Promise}function Th(t){return t&&pe(t.next)&&pe(t.error)&&pe(t.complete)}function wh(t){return t&&t instanceof zr||Th(t)&&ul(t)}function kh(t){return pe(t==null?void 0:t.lift)}function Rt(t){return function(e){if(kh(e))return e.lift(function(n){try{return t(n,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function Lt(t,e,n,s,i){return new Rh(t,e,n,s,i)}var Rh=function(t){kt(e,t);function e(n,s,i,r,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=s?function(u){try{s(u)}catch(d){n.error(d)}}:t.prototype._next,l._error=r?function(u){try{r(u)}catch(d){n.error(d)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var s=this.closed;t.prototype.unsubscribe.call(this),!s&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(zr),Eh=cl(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),vi=function(t){kt(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var s=new na(this,this);return s.operator=n,s},e.prototype._throwIfClosed=function(){if(this.closed)throw new Eh},e.prototype.next=function(n){var s=this;Ns(function(){var i,r;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var o=Fs(s.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var s=this;Ns(function(){if(s._throwIfClosed(),!s.isStopped){s.hasError=s.isStopped=!0,s.thrownError=n;for(var i=s.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;Ns(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var s=n.observers;s.length;)s.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var s=this,i=this,r=i.hasError,o=i.isStopped,a=i.observers;return r||o?ll:(this.currentObservers=null,a.push(n),new ns(function(){s.currentObservers=null,Ws(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var s=this,i=s.hasError,r=s.thrownError,o=s.isStopped;i?n.error(r):o&&n.complete()},e.prototype.asObservable=function(){var n=new ze;return n.source=this,n},e.create=function(n,s){return new na(n,s)},e}(ze),na=function(t){kt(e,t);function e(n,s){var i=t.call(this)||this;return i.destination=n,i.source=s,i}return e.prototype.next=function(n){var s,i;(i=(s=this.destination)===null||s===void 0?void 0:s.next)===null||i===void 0||i.call(s,n)},e.prototype.error=function(n){var s,i;(i=(s=this.destination)===null||s===void 0?void 0:s.error)===null||i===void 0||i.call(s,n)},e.prototype.complete=function(){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||s===void 0||s.call(n)},e.prototype._subscribe=function(n){var s,i;return(i=(s=this.source)===null||s===void 0?void 0:s.subscribe(n))!==null&&i!==void 0?i:ll},e}(vi),te=function(t){kt(e,t);function e(n){var s=t.call(this)||this;return s._value=n,s}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var s=t.prototype._subscribe.call(this,n);return!s.closed&&n.next(this._value),s},e.prototype.getValue=function(){var n=this,s=n.hasError,i=n.thrownError,r=n._value;if(s)throw i;return this._throwIfClosed(),r},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(vi),Xr={now:function(){return(Xr.delegate||Date).now()},delegate:void 0},Er=function(t){kt(e,t);function e(n,s,i){n===void 0&&(n=1/0),s===void 0&&(s=1/0),i===void 0&&(i=Xr);var r=t.call(this)||this;return r._bufferSize=n,r._windowTime=s,r._timestampProvider=i,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=s===1/0,r._bufferSize=Math.max(1,n),r._windowTime=Math.max(1,s),r}return e.prototype.next=function(n){var s=this,i=s.isStopped,r=s._buffer,o=s._infiniteTimeWindow,a=s._timestampProvider,l=s._windowTime;i||(r.push(n),!o&&r.push(a.now()+l)),this._trimBuffer(),t.prototype.next.call(this,n)},e.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var s=this._innerSubscribe(n),i=this,r=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),l=0;l<a.length&&!n.closed;l+=r?1:2)n.next(a[l]);return this._checkFinalizedStatuses(n),s},e.prototype._trimBuffer=function(){var n=this,s=n._bufferSize,i=n._timestampProvider,r=n._buffer,o=n._infiniteTimeWindow,a=(o?1:2)*s;if(s<1/0&&a<r.length&&r.splice(0,r.length-a),!o){for(var l=i.now(),u=0,d=1;d<r.length&&r[d]<=l;d+=2)u=d;u&&r.splice(0,u+1)}},e}(vi),Ih=function(t){kt(e,t);function e(n,s){return t.call(this)||this}return e.prototype.schedule=function(n,s){return this},e}(ns),sa={setInterval:function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return setInterval.apply(void 0,Tn([t,e],sn(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},_h=function(t){kt(e,t);function e(n,s){var i=t.call(this,n,s)||this;return i.scheduler=n,i.work=s,i.pending=!1,i}return e.prototype.schedule=function(n,s){var i;if(s===void 0&&(s=0),this.closed)return this;this.state=n;var r=this.id,o=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(o,r,s)),this.pending=!0,this.delay=s,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,s),this},e.prototype.requestAsyncId=function(n,s,i){return i===void 0&&(i=0),sa.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,s,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return s;s!=null&&sa.clearInterval(s)},e.prototype.execute=function(n,s){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,s);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,s){var i=!1,r;try{this.work(n)}catch(o){i=!0,r=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,s=n.id,i=n.scheduler,r=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Ws(r,this),s!=null&&(this.id=this.recycleAsyncId(i,s,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Ih),ia=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,s){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(s,n)},t.now=Xr.now,t}(),xh=function(t){kt(e,t);function e(n,s){s===void 0&&(s=ia.now);var i=t.call(this,n,s)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var s=this.actions;if(this._active){s.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=s.shift());if(this._active=!1,i){for(;n=s.shift();)n.unsubscribe();throw i}},e}(ia),Ph=new xh(_h),Oh=new ze(function(t){return t.complete()});function Nh(t){return t&&pe(t.schedule)}function Zr(t){return t[t.length-1]}function Ah(t){return pe(Zr(t))?t.pop():void 0}function is(t){return Nh(Zr(t))?t.pop():void 0}function Dh(t,e){return typeof Zr(t)=="number"?t.pop():e}var Qr=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function hl(t){return pe(t==null?void 0:t.then)}function fl(t){return pe(t[Yr])}function pl(t){return Symbol.asyncIterator&&pe(t==null?void 0:t[Symbol.asyncIterator])}function ml(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Lh(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var gl=Lh();function bl(t){return pe(t==null?void 0:t[gl])}function vl(t){return Sd(this,arguments,function(){var n,s,i,r;return Cc(this,function(o){switch(o.label){case 0:n=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Wi(n.read())];case 3:return s=o.sent(),i=s.value,r=s.done,r?[4,Wi(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Wi(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function yl(t){return pe(t==null?void 0:t.getReader)}function Ft(t){if(t instanceof ze)return t;if(t!=null){if(fl(t))return Mh(t);if(Qr(t))return jh(t);if(hl(t))return Fh(t);if(pl(t))return Sl(t);if(bl(t))return Uh(t);if(yl(t))return $h(t)}throw ml(t)}function Mh(t){return new ze(function(e){var n=t[Yr]();if(pe(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function jh(t){return new ze(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function Fh(t){return new ze(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,dl)})}function Uh(t){return new ze(function(e){var n,s;try{for(var i=Fs(t),r=i.next();!r.done;r=i.next()){var o=r.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{r&&!r.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}e.complete()})}function Sl(t){return new ze(function(e){Vh(t,e).catch(function(n){return e.error(n)})})}function $h(t){return Sl(vl(t))}function Vh(t,e){var n,s,i,r;return Cd(this,void 0,void 0,function(){var o,a;return Cc(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=Td(t),l.label=1;case 1:return[4,n.next()];case 2:if(s=l.sent(),!!s.done)return[3,4];if(o=s.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),s&&!s.done&&(r=n.return)?[4,r.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Wt(t,e,n,s,i){s===void 0&&(s=0),i===void 0&&(i=!1);var r=e.schedule(function(){n(),i?t.add(this.schedule(null,s)):this.unsubscribe()},s);if(t.add(r),!i)return r}function Cl(t,e){return e===void 0&&(e=0),Rt(function(n,s){n.subscribe(Lt(s,function(i){return Wt(s,t,function(){return s.next(i)},e)},function(){return Wt(s,t,function(){return s.complete()},e)},function(i){return Wt(s,t,function(){return s.error(i)},e)}))})}function Tl(t,e){return e===void 0&&(e=0),Rt(function(n,s){s.add(t.schedule(function(){return n.subscribe(s)},e))})}function Bh(t,e){return Ft(t).pipe(Tl(e),Cl(e))}function Hh(t,e){return Ft(t).pipe(Tl(e),Cl(e))}function qh(t,e){return new ze(function(n){var s=0;return e.schedule(function(){s===t.length?n.complete():(n.next(t[s++]),n.closed||this.schedule())})})}function Wh(t,e){return new ze(function(n){var s;return Wt(n,e,function(){s=t[gl](),Wt(n,e,function(){var i,r,o;try{i=s.next(),r=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(r)},0,!0)}),function(){return pe(s==null?void 0:s.return)&&s.return()}})}function wl(t,e){if(!t)throw new Error("Iterable cannot be null");return new ze(function(n){Wt(n,e,function(){var s=t[Symbol.asyncIterator]();Wt(n,e,function(){s.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Gh(t,e){return wl(vl(t),e)}function Kh(t,e){if(t!=null){if(fl(t))return Bh(t,e);if(Qr(t))return qh(t,e);if(hl(t))return Hh(t,e);if(pl(t))return wl(t,e);if(bl(t))return Wh(t,e);if(yl(t))return Gh(t,e)}throw ml(t)}function cn(t,e){return e?Kh(t,e):Ft(t)}function Gs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=is(t);return cn(t,n)}function He(t,e){return Rt(function(n,s){var i=0;n.subscribe(Lt(s,function(r){s.next(t.call(e,r,i++))}))})}var Jh=Array.isArray;function zh(t,e){return Jh(e)?t.apply(void 0,Tn([],sn(e))):t(e)}function kl(t){return He(function(e){return zh(t,e)})}var Yh=Array.isArray,Xh=Object.getPrototypeOf,Zh=Object.prototype,Qh=Object.keys;function ef(t){if(t.length===1){var e=t[0];if(Yh(e))return{args:e,keys:null};if(tf(e)){var n=Qh(e);return{args:n.map(function(s){return e[s]}),keys:n}}}return{args:t,keys:null}}function tf(t){return t&&typeof t=="object"&&Xh(t)===Zh}function nf(t,e){return t.reduce(function(n,s,i){return n[s]=e[i],n},{})}function rn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=is(t),s=Ah(t),i=ef(t),r=i.args,o=i.keys;if(r.length===0)return cn([],n);var a=new ze(sf(r,n,o?function(l){return nf(o,l)}:ss));return s?a.pipe(kl(s)):a}function sf(t,e,n){return n===void 0&&(n=ss),function(s){ra(e,function(){for(var i=t.length,r=new Array(i),o=i,a=i,l=function(d){ra(e,function(){var f=cn(t[d],e),c=!1;f.subscribe(Lt(s,function(h){r[d]=h,c||(c=!0,a--),a||s.next(n(r.slice()))},function(){--o||s.complete()}))},s)},u=0;u<i;u++)l(u)},s)}}function ra(t,e,n){t?Wt(n,t,e):e()}function rf(t,e,n,s,i,r,o,a){var l=[],u=0,d=0,f=!1,c=function(){f&&!l.length&&!u&&e.complete()},h=function(p){return u<s?m(p):l.push(p)},m=function(p){u++;var g=!1;Ft(n(p,d++)).subscribe(Lt(e,function(v){e.next(v)},function(){g=!0},void 0,function(){if(g)try{u--;for(var v=function(){var C=l.shift();o||m(C)};l.length&&u<s;)v();c()}catch(C){e.error(C)}}))};return t.subscribe(Lt(e,h,function(){f=!0,c()})),function(){}}function qn(t,e,n){return n===void 0&&(n=1/0),pe(e)?qn(function(s,i){return He(function(r,o){return e(s,r,i,o)})(Ft(t(s,i)))},n):(typeof e=="number"&&(n=e),Rt(function(s,i){return rf(s,i,t,n)}))}function Rl(t){return t===void 0&&(t=1/0),qn(ss,t)}function of(){return Rl(1)}function oa(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return of()(cn(t,is(t)))}var af=["addListener","removeListener"],cf=["addEventListener","removeEventListener"],lf=["on","off"];function Ir(t,e,n,s){if(pe(n)&&(s=n,n=void 0),s)return Ir(t,e,n).pipe(kl(s));var i=sn(hf(t)?cf.map(function(a){return function(l){return t[a](e,l,n)}}):uf(t)?af.map(aa(t,e)):df(t)?lf.map(aa(t,e)):[],2),r=i[0],o=i[1];if(!r&&Qr(t))return qn(function(a){return Ir(a,e,n)})(Ft(t));if(!r)throw new TypeError("Invalid event target");return new ze(function(a){var l=function(){for(var u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];return a.next(1<u.length?u:u[0])};return r(l),function(){return o(l)}})}function aa(t,e){return function(n){return function(s){return t[n](e,s)}}}function uf(t){return pe(t.addListener)&&pe(t.removeListener)}function df(t){return pe(t.on)&&pe(t.off)}function hf(t){return pe(t.addEventListener)&&pe(t.removeEventListener)}function ff(t,e,n){return new ze(function(s){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return s.next(o.length===1?o[0]:o)},r=t(i);return pe(e)?function(){return e(i,r)}:void 0})}function eo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=is(t),s=Dh(t,1/0),i=t;return i.length?i.length===1?Ft(i[0]):Rl(s)(cn(i,n)):Oh}function yi(t,e){return pe(e)?qn(t,e,1):qn(t,1)}function pf(t,e){return e===void 0&&(e=Ph),Rt(function(n,s){var i=null,r=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var u=r;r=null,s.next(u)}};function l(){var u=o+t,d=e.now();if(d<u){i=this.schedule(void 0,u-d),s.add(i);return}a()}n.subscribe(Lt(s,function(u){r=u,o=e.now(),i||(i=e.schedule(l,t),s.add(i))},function(){a(),s.complete()},void 0,function(){r=i=null}))})}function Je(t,e){return e===void 0&&(e=ss),t=t??mf,Rt(function(n,s){var i,r=!0;n.subscribe(Lt(s,function(o){var a=e(o);(r||!t(i,a))&&(r=!1,i=a,s.next(o))}))})}function mf(t,e){return t===e}function bs(t,e){return Je(function(n,s){return n[t]===s[t]})}function gf(){return Rt(function(t,e){var n,s=!1;t.subscribe(Lt(e,function(i){var r=n;n=i,s&&e.next([r,i]),s=!0}))})}function bf(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new vi}:e,s=t.resetOnError,i=s===void 0?!0:s,r=t.resetOnComplete,o=r===void 0?!0:r,a=t.resetOnRefCountZero,l=a===void 0?!0:a;return function(u){var d,f,c,h=0,m=!1,p=!1,g=function(){f==null||f.unsubscribe(),f=void 0},v=function(){g(),d=c=void 0,m=p=!1},C=function(){var S=d;v(),S==null||S.unsubscribe()};return Rt(function(S,T){h++,!p&&!m&&g();var w=c=c??n();T.add(function(){h--,h===0&&!p&&!m&&(f=Yi(C,l))}),w.subscribe(T),!d&&h>0&&(d=new Hn({next:function(E){return w.next(E)},error:function(E){p=!0,g(),f=Yi(v,i,E),w.error(E)},complete:function(){m=!0,g(),f=Yi(v,o),w.complete()}}),Ft(S).subscribe(d))})(u)}}function Yi(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(e===!0){t();return}if(e!==!1){var i=new Hn({next:function(){i.unsubscribe(),t()}});return Ft(e.apply(void 0,Tn([],sn(n)))).subscribe(i)}}function Ke(t,e,n){var s,i,r,o,a=!1;return t&&typeof t=="object"?(s=t.bufferSize,o=s===void 0?1/0:s,i=t.windowTime,e=i===void 0?1/0:i,r=t.refCount,a=r===void 0?!1:r,n=t.scheduler):o=t??1/0,bf({connector:function(){return new Er(o,e,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function Si(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=is(t);return Rt(function(s,i){(n?oa(t,s,n):oa(t,s)).subscribe(i)})}function _r(t,e){return e===void 0&&(e=!1),Rt(function(n,s){var i=0;n.subscribe(Lt(s,function(r){var o=t(r,i++);(o||e)&&s.next(r),!o&&s.complete()}))})}var Mn={exports:{}},vf=Mn.exports,ca;function yf(){return ca||(ca=1,function(t,e){(function(n,s){var i="1.0.40",r="",o="?",a="function",l="undefined",u="object",d="string",f="major",c="model",h="name",m="type",p="vendor",g="version",v="architecture",C="console",S="mobile",T="tablet",w="smarttv",E="wearable",_="embedded",A=500,q="Amazon",N="Apple",U="ASUS",L="BlackBerry",D="Browser",R="Chrome",x="Edge",$="Firefox",j="Google",k="Huawei",V="LG",X="Microsoft",xe="Motorola",Ae="Opera",ne="Samsung",ke="Sharp",fe="Sony",Ce="Xiaomi",$e="Zebra",Ut="Facebook",It="Chromium OS",ot="Mac OS",_t=" Browser",Q=function(B,W){var Y={};for(var ue in B)W[ue]&&W[ue].length%2===0?Y[ue]=W[ue].concat(B[ue]):Y[ue]=B[ue];return Y},ie=function(B){for(var W={},Y=0;Y<B.length;Y++)W[B[Y].toUpperCase()]=B[Y];return W},ee=function(B,W){return typeof B===d?le(W).indexOf(le(B))!==-1:!1},le=function(B){return B.toLowerCase()},ye=function(B){return typeof B===d?B.replace(/[^\d\.]/g,r).split(".")[0]:s},oe=function(B,W){if(typeof B===d)return B=B.replace(/^\s\s*/,r),typeof W===l?B:B.substring(0,A)},Re=function(B,W){for(var Y=0,ue,Ge,Se,re,J,tt;Y<W.length&&!J;){var hn=W[Y],en=W[Y+1];for(ue=Ge=0;ue<hn.length&&!J&&hn[ue];)if(J=hn[ue++].exec(B),J)for(Se=0;Se<en.length;Se++)tt=J[++Ge],re=en[Se],typeof re===u&&re.length>0?re.length===2?typeof re[1]==a?this[re[0]]=re[1].call(this,tt):this[re[0]]=re[1]:re.length===3?typeof re[1]===a&&!(re[1].exec&&re[1].test)?this[re[0]]=tt?re[1].call(this,tt,re[2]):s:this[re[0]]=tt?tt.replace(re[1],re[2]):s:re.length===4&&(this[re[0]]=tt?re[3].call(this,tt.replace(re[1],re[2])):s):this[re]=tt||s;Y+=2}},Te=function(B,W){for(var Y in W)if(typeof W[Y]===u&&W[Y].length>0){for(var ue=0;ue<W[Y].length;ue++)if(ee(W[Y][ue],B))return Y===o?s:Y}else if(ee(W[Y],B))return Y===o?s:Y;return W.hasOwnProperty("*")?W["*"]:B},De={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},et={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},H={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,g],[/opios[\/ ]+([\w\.]+)/i],[g,[h,Ae+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[h,Ae+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[h,Ae]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[h,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[g,[h,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[h,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[h,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[h,"UC"+D]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[h,"Smart Lenovo "+D]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+D],g],[/\bfocus\/([\w\.]+)/i],[g,[h,$+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[h,Ae+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[h,Ae+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[h,"MIUI"+_t]],[/fxios\/([\w\.-]+)/i],[g,[h,$]],[/\bqihoobrowser\/?([\w\.]*)/i],[g,[h,"360"]],[/\b(qq)\/([\w\.]+)/i],[[h,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1"+_t],g],[/samsungbrowser\/([\w\.]+)/i],[g,[h,ne+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[g,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[h,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[h],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[g,h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,Ut],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[h,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,R+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[h,"Android "+D]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[g,Te,De]],[/(webkit|khtml)\/([\w\.]+)/i],[h,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],g],[/(wolvic|librewolf)\/([\w\.]+)/i],[h,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[h,$+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[h,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[h,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,le]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows (ce|mobile); ppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[v,/ower/,r,le]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,le]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[p,ne],[m,T]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[c,[p,ne],[m,S]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[c,[p,N],[m,S]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[p,N],[m,T]],[/(macintosh);/i],[c,[p,N]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[p,ke],[m,S]],[/(?:honor)([-\w ]+)[;\)]/i],[c,[p,"Honor"],[m,S]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[p,k],[m,T]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[p,k],[m,S]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[c,/_/g," "],[p,Ce],[m,S]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[p,Ce],[m,T]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[p,"OPPO"],[m,S]],[/\b(opd2\d{3}a?) bui/i],[c,[p,"OPPO"],[m,T]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[p,"Vivo"],[m,S]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[c,[p,"Realme"],[m,S]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[p,xe],[m,S]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[p,xe],[m,T]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[p,V],[m,T]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[p,V],[m,S]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[p,"Lenovo"],[m,T]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[p,"Nokia"],[m,S]],[/(pixel c)\b/i],[c,[p,j],[m,T]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[p,j],[m,S]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[p,fe],[m,S]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[p,fe],[m,T]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[p,"OnePlus"],[m,S]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[p,q],[m,T]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[p,q],[m,S]],[/(playbook);[-\w\),; ]+(rim)/i],[c,p,[m,T]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[p,L],[m,S]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[p,U],[m,T]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[p,U],[m,S]],[/(nexus 9)/i],[c,[p,"HTC"],[m,T]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[c,/_/g," "],[m,S]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[c,[p,"TCL"],[m,T]],[/(itel) ((\w+))/i],[[p,le],c,[m,Te,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[p,"Acer"],[m,T]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[p,"Meizu"],[m,S]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[c,[p,"Ulefone"],[m,S]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[c,[p,"Energizer"],[m,S]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[c,[p,"Cat"],[m,S]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[c,[p,"Smartfren"],[m,S]],[/droid.+; (a(?:015|06[35]|142p?))/i],[c,[p,"Nothing"],[m,S]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,c,[m,S]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,c,[m,T]],[/(surface duo)/i],[c,[p,X],[m,T]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[p,"Fairphone"],[m,S]],[/(u304aa)/i],[c,[p,"AT&T"],[m,S]],[/\bsie-(\w*)/i],[c,[p,"Siemens"],[m,S]],[/\b(rct\w+) b/i],[c,[p,"RCA"],[m,T]],[/\b(venue[\d ]{2,7}) b/i],[c,[p,"Dell"],[m,T]],[/\b(q(?:mv|ta)\w+) b/i],[c,[p,"Verizon"],[m,T]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[p,"Barnes & Noble"],[m,T]],[/\b(tm\d{3}\w+) b/i],[c,[p,"NuVision"],[m,T]],[/\b(k88) b/i],[c,[p,"ZTE"],[m,T]],[/\b(nx\d{3}j) b/i],[c,[p,"ZTE"],[m,S]],[/\b(gen\d{3}) b.+49h/i],[c,[p,"Swiss"],[m,S]],[/\b(zur\d{3}) b/i],[c,[p,"Swiss"],[m,T]],[/\b((zeki)?tb.*\b) b/i],[c,[p,"Zeki"],[m,T]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],c,[m,T]],[/\b(ns-?\w{0,9}) b/i],[c,[p,"Insignia"],[m,T]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[p,"NextBook"],[m,T]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],c,[m,S]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],c,[m,S]],[/\b(ph-1) /i],[c,[p,"Essential"],[m,S]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[p,"Envizen"],[m,T]],[/\b(trio[-\w\. ]+) b/i],[c,[p,"MachSpeed"],[m,T]],[/\btu_(1491) b/i],[c,[p,"Rotor"],[m,T]],[/(shield[\w ]+) b/i],[c,[p,"Nvidia"],[m,T]],[/(sprint) (\w+)/i],[p,c,[m,S]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[p,X],[m,S]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[p,$e],[m,T]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[p,$e],[m,S]],[/smart-tv.+(samsung)/i],[p,[m,w]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[p,ne],[m,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,V],[m,w]],[/(apple) ?tv/i],[p,[c,N+" TV"],[m,w]],[/crkey/i],[[c,R+"cast"],[p,j],[m,w]],[/droid.+aft(\w+)( bui|\))/i],[c,[p,q],[m,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[p,ke],[m,w]],[/(bravia[\w ]+)( bui|\))/i],[c,[p,fe],[m,w]],[/(mitv-\w{5}) bui/i],[c,[p,Ce],[m,w]],[/Hbbtv.*(technisat) (.*);/i],[p,c,[m,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,oe],[c,oe],[m,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,c,[m,C]],[/droid.+; (shield) bui/i],[c,[p,"Nvidia"],[m,C]],[/(playstation [345portablevi]+)/i],[c,[p,fe],[m,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[p,X],[m,C]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[c,[p,ne],[m,E]],[/((pebble))app/i],[p,c,[m,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[c,[p,N],[m,E]],[/droid.+; (glass) \d/i],[c,[p,j],[m,E]],[/droid.+; (wt63?0{2,3})\)/i],[c,[p,$e],[m,E]],[/droid.+; (glass) \d/i],[c,[p,j],[m,E]],[/(pico) (4|neo3(?: link|pro)?)/i],[p,c,[m,E]],[/; (quest( \d| pro)?)/i],[c,[p,Ut],[m,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[m,_]],[/(aeobc)\b/i],[c,[p,q],[m,_]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[c,[m,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[m,T]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,T]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,S]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[h,x+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[h,g],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[g,Te,et]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,Te,et],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,ot],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,g],[/\(bb(10);/i],[g,[h,L]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[h,$+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[h,R+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,It],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,g],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,g]]},K=function(B,W){if(typeof B===u&&(W=B,B=s),!(this instanceof K))return new K(B,W).getResult();var Y=typeof n!==l&&n.navigator?n.navigator:s,ue=B||(Y&&Y.userAgent?Y.userAgent:r),Ge=Y&&Y.userAgentData?Y.userAgentData:s,Se=W?Q(H,W):H,re=Y&&Y.userAgent==ue;return this.getBrowser=function(){var J={};return J[h]=s,J[g]=s,Re.call(J,ue,Se.browser),J[f]=ye(J[g]),re&&Y&&Y.brave&&typeof Y.brave.isBrave==a&&(J[h]="Brave"),J},this.getCPU=function(){var J={};return J[v]=s,Re.call(J,ue,Se.cpu),J},this.getDevice=function(){var J={};return J[p]=s,J[c]=s,J[m]=s,Re.call(J,ue,Se.device),re&&!J[m]&&Ge&&Ge.mobile&&(J[m]=S),re&&J[c]=="Macintosh"&&Y&&typeof Y.standalone!==l&&Y.maxTouchPoints&&Y.maxTouchPoints>2&&(J[c]="iPad",J[m]=T),J},this.getEngine=function(){var J={};return J[h]=s,J[g]=s,Re.call(J,ue,Se.engine),J},this.getOS=function(){var J={};return J[h]=s,J[g]=s,Re.call(J,ue,Se.os),re&&!J[h]&&Ge&&Ge.platform&&Ge.platform!="Unknown"&&(J[h]=Ge.platform.replace(/chrome os/i,It).replace(/macos/i,ot)),J},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ue},this.setUA=function(J){return ue=typeof J===d&&J.length>A?oe(J,A):J,this},this.setUA(ue),this};K.VERSION=i,K.BROWSER=ie([h,g,f]),K.CPU=ie([v]),K.DEVICE=ie([c,p,m,C,S,w,T,E,_]),K.ENGINE=K.OS=ie([h,g]),t.exports&&(e=t.exports=K),e.UAParser=K;var F=typeof n!==l&&(n.jQuery||n.Zepto);if(F&&!F.ua){var ae=new K;F.ua=ae.getResult(),F.ua.get=function(){return ae.getUA()},F.ua.set=function(B){ae.setUA(B);var W=ae.getResult();for(var Y in W)F.ua[Y]=W[Y]}}})(typeof window=="object"?window:vf)}(Mn,Mn.exports)),Mn.exports}var Sf=yf(),dt={},Xi={},Zi={exports:{}},la;function to(){if(la)return Zi.exports;la=1;var t=Zi.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(s){s.reg||(s.reg=/(.*)/),s.format||(s.format="%s")})}),Zi.exports}var ua;function Cf(){return ua||(ua=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,l,u,d){if(d&&!u)l[d]=e(a[1]);else for(var f=0;f<u.length;f+=1)a[f+1]!=null&&(l[u[f]]=e(a[f+1]))},s=function(a,l,u){var d=a.name&&a.names;a.push&&!l[a.push]?l[a.push]=[]:d&&!l[a.name]&&(l[a.name]={});var f=a.push?{}:d?l[a.name]:l;n(u.match(a.reg),f,a.names,a.name),a.push&&l[a.push].push(f)},i=to(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var l={},u=[],d=l;return a.split(/(\r\n|\r|\n)/).filter(r).forEach(function(f){var c=f[0],h=f.slice(2);c==="m"&&(u.push({rtp:[],fmtp:[]}),d=u[u.length-1]);for(var m=0;m<(i[c]||[]).length;m+=1){var p=i[c][m];if(p.reg.test(h))return s(p,d,h)}}),l.media=u,l};var o=function(a,l){var u=l.split(/=(.+)/,2);return u.length===2?a[u[0]]=e(u[1]):u.length===1&&l.length>1&&(a[u[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var l=[],u=a.split(" ").map(e),d=0;d<u.length;d+=3)l.push({component:u[d],ip:u[d+1],port:u[d+2]});return l},t.parseImageAttributes=function(a){return a.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(l){return l.split(",").map(function(u){var d,f=!1;return u[0]!=="~"?d=e(u):(d=e(u.substring(1,u.length)),f=!0),{scid:d,paused:f}})})}}(Xi)),Xi}var Qi,da;function Tf(){if(da)return Qi;da=1;var t=to(),e=/%[sdv%]/g,n=function(o){var a=1,l=arguments,u=l.length;return o.replace(e,function(d){if(a>=u)return d;var f=l[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(f);case"%d":return Number(f);case"%v":return""}})},s=function(o,a,l){var u=a.format instanceof Function?a.format(a.push?l:l[a.name]):a.format,d=[o+"="+u];if(a.names)for(var f=0;f<a.names.length;f+=1){var c=a.names[f];a.name?d.push(l[a.name][c]):d.push(l[a.names[f]])}else d.push(l[a.name]);return n.apply(null,d)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],r=["i","c","b","a"];return Qi=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(f){f.payloads==null&&(f.payloads="")});var l=a.outerOrder||i,u=a.innerOrder||r,d=[];return l.forEach(function(f){t[f].forEach(function(c){c.name in o&&o[c.name]!=null?d.push(s(f,c,o)):c.push in o&&o[c.push]!=null&&o[c.push].forEach(function(h){d.push(s(f,c,h))})})}),o.media.forEach(function(f){d.push(s("m",t.m[0],f)),u.forEach(function(c){t[c].forEach(function(h){h.name in f&&f[h.name]!=null?d.push(s(c,h,f)):h.push in f&&f[h.push]!=null&&f[h.push].forEach(function(m){d.push(s(c,h,m))})})})}),d.join(`\r
`)+`\r
`},Qi}var ha;function wf(){if(ha)return dt;ha=1;var t=Cf(),e=Tf(),n=to();return dt.grammar=n,dt.write=e,dt.parse=t.parse,dt.parseParams=t.parseParams,dt.parseFmtpConfig=t.parseFmtpConfig,dt.parsePayloads=t.parsePayloads,dt.parseRemoteCandidates=t.parseRemoteCandidates,dt.parseImageAttributes=t.parseImageAttributes,dt.parseSimulcastStreamList=t.parseSimulcastStreamList,dt}var kf=wf();class no{constructor(e){this.buffer=[],this.enabled=!0,this.setEnabled=n=>{this.enabled!==n&&(this.enabled=n,this.buffer=[])},this.trace=(n,s)=>{this.enabled&&this.buffer.push([n,this.id,s,Date.now()])},this.take=()=>{const n=this.buffer;return this.buffer=[],{snapshot:n,rollback:()=>{this.buffer.unshift(...n)}}},this.dispose=()=>{this.buffer=[]},this.id=e}}const Wn=new no(null);if(typeof navigator<"u"&&typeof navigator.mediaDevices<"u"){const t=s=>({id:s.id,tracks:s.getTracks().map(i=>({id:i.id,kind:i.kind,label:i.label,enabled:i.enabled,muted:i.muted,readyState:i.readyState}))}),e=Wn.trace,n=navigator.mediaDevices;for(const s of["getUserMedia","getDisplayMedia"]){const i=n[s];i&&(n[s]=async function(o){const a=`navigator.mediaDevices.${s}`;e(a,o);try{const l=await i.call(n,o);return e(`${a}OnSuccess`,t(l)),l}catch(l){throw e(`${a}OnFailure`,l.name),l}})}}const er={AVAILABLE:"available",DISABLED:"disabled",AUTO_ON:"auto-on"},z={BLOCK_USERS:"block-users",CHANGE_MAX_DURATION:"change-max-duration",CREATE_CALL:"create-call",CREATE_REACTION:"create-reaction",ENABLE_NOISE_CANCELLATION:"enable-noise-cancellation",END_CALL:"end-call",JOIN_BACKSTAGE:"join-backstage",JOIN_CALL:"join-call",JOIN_ENDED_CALL:"join-ended-call",MUTE_USERS:"mute-users",PIN_FOR_EVERYONE:"pin-for-everyone",READ_CALL:"read-call",REMOVE_CALL_MEMBER:"remove-call-member",SCREENSHARE:"screenshare",SEND_AUDIO:"send-audio",SEND_VIDEO:"send-video",START_BROADCAST_CALL:"start-broadcast-call",START_CLOSED_CAPTIONS_CALL:"start-closed-captions-call",START_FRAME_RECORD_CALL:"start-frame-record-call",START_RECORD_CALL:"start-record-call",START_TRANSCRIPTION_CALL:"start-transcription-call",STOP_BROADCAST_CALL:"stop-broadcast-call",STOP_CLOSED_CAPTIONS_CALL:"stop-closed-captions-call",STOP_FRAME_RECORD_CALL:"stop-frame-record-call",STOP_RECORD_CALL:"stop-record-call",STOP_TRANSCRIPTION_CALL:"stop-transcription-call",UPDATE_CALL:"update-call",UPDATE_CALL_MEMBER:"update-call-member",UPDATE_CALL_PERMISSIONS:"update-call-permissions",UPDATE_CALL_SETTINGS:"update-call-settings"};class El extends Error{}var Ks;(function(t){t[t.NULL_VALUE=0]="NULL_VALUE"})(Ks||(Ks={}));class Rf extends P{constructor(){super("google.protobuf.Struct",[{no:1,name:"fields",kind:"map",K:9,V:{kind:"message",T:()=>vn}}])}internalJsonWrite(e,n){let s={};for(let[i,r]of Object.entries(e.fields))s[i]=vn.toJson(r);return s}internalJsonRead(e,n,s){if(!Us(e))throw new globalThis.Error("Unable to parse message "+this.typeName+" from JSON "+_n(e)+".");s||(s=this.create());for(let[i,r]of globalThis.Object.entries(e))s.fields[i]=vn.fromJson(r);return s}}const Js=new Rf;class Ef extends P{constructor(){super("google.protobuf.Value",[{no:1,name:"null_value",kind:"enum",oneof:"kind",T:()=>["google.protobuf.NullValue",Ks]},{no:2,name:"number_value",kind:"scalar",oneof:"kind",T:1},{no:3,name:"string_value",kind:"scalar",oneof:"kind",T:9},{no:4,name:"bool_value",kind:"scalar",oneof:"kind",T:8},{no:5,name:"struct_value",kind:"message",oneof:"kind",T:()=>Js},{no:6,name:"list_value",kind:"message",oneof:"kind",T:()=>fa}])}internalJsonWrite(e,n){if(e.kind.oneofKind===void 0)throw new globalThis.Error;switch(e.kind.oneofKind){case void 0:throw new globalThis.Error;case"boolValue":return e.kind.boolValue;case"nullValue":return null;case"numberValue":let s=e.kind.numberValue;if(typeof s=="number"&&!Number.isFinite(s))throw new globalThis.Error;return s;case"stringValue":return e.kind.stringValue;case"listValue":let i=this.fields.find(o=>o.no===6);if((i==null?void 0:i.kind)!=="message")throw new globalThis.Error;return i.T().toJson(e.kind.listValue);case"structValue":let r=this.fields.find(o=>o.no===5);if((r==null?void 0:r.kind)!=="message")throw new globalThis.Error;return r.T().toJson(e.kind.structValue)}}internalJsonRead(e,n,s){switch(s||(s=this.create()),typeof e){case"number":s.kind={oneofKind:"numberValue",numberValue:e};break;case"string":s.kind={oneofKind:"stringValue",stringValue:e};break;case"boolean":s.kind={oneofKind:"boolValue",boolValue:e};break;case"object":e===null?s.kind={oneofKind:"nullValue",nullValue:Ks.NULL_VALUE}:globalThis.Array.isArray(e)?s.kind={oneofKind:"listValue",listValue:fa.fromJson(e)}:s.kind={oneofKind:"structValue",structValue:Js.fromJson(e)};break;default:throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+_n(e))}return s}}const vn=new Ef;class If extends P{constructor(){super("google.protobuf.ListValue",[{no:1,name:"values",kind:"message",repeat:1,T:()=>vn}])}internalJsonWrite(e,n){return e.values.map(s=>vn.toJson(s))}internalJsonRead(e,n,s){if(!globalThis.Array.isArray(e))throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+_n(e));s||(s=this.create());let i=e.map(r=>vn.fromJson(r));return s.values.push(...i),s}}const fa=new If;class _f extends P{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const e=this.create(),n=Date.now();return e.seconds=ge.from(Math.floor(n/1e3)).toString(),e.nanos=n%1e3*1e6,e}toDate(e){return new Date(ge.from(e.seconds).toNumber()*1e3+Math.ceil(e.nanos/1e6))}fromDate(e){const n=this.create(),s=e.getTime();return n.seconds=ge.from(Math.floor(s/1e3)).toString(),n.nanos=(s%1e3+(s<0&&s%1e3!==0?1e3:0))*1e6,n}internalJsonWrite(e,n){let s=ge.from(e.seconds).toNumber()*1e3;if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let i="Z";if(e.nanos>0){let r=(e.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(s).toISOString().replace(".000Z",i)}internalJsonRead(e,n,s){if(typeof e!="string")throw new Error("Unable to parse Timestamp from JSON "+_n(e)+".");let i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return s||(s=this.create()),s.seconds=ge.from(r/1e3).toString(),s.nanos=0,i[7]&&(s.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),s}}const Gn=new _f;var Me;(function(t){t[t.PUBLISHER_UNSPECIFIED=0]="PUBLISHER_UNSPECIFIED",t[t.SUBSCRIBER=1]="SUBSCRIBER"})(Me||(Me={}));var Kn;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.POOR=1]="POOR",t[t.GOOD=2]="GOOD",t[t.EXCELLENT=3]="EXCELLENT"})(Kn||(Kn={}));var Gt;(function(t){t[t.LOW_UNSPECIFIED=0]="LOW_UNSPECIFIED",t[t.MID=1]="MID",t[t.HIGH=2]="HIGH",t[t.OFF=3]="OFF"})(Gt||(Gt={}));var O;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.AUDIO=1]="AUDIO",t[t.VIDEO=2]="VIDEO",t[t.SCREEN_SHARE=3]="SCREEN_SHARE",t[t.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"})(O||(O={}));var wn;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.PUBLISH_TRACK_NOT_FOUND=100]="PUBLISH_TRACK_NOT_FOUND",t[t.PUBLISH_TRACKS_MISMATCH=101]="PUBLISH_TRACKS_MISMATCH",t[t.PUBLISH_TRACK_OUT_OF_ORDER=102]="PUBLISH_TRACK_OUT_OF_ORDER",t[t.PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND=103]="PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND",t[t.LIVE_ENDED=104]="LIVE_ENDED",t[t.PARTICIPANT_NOT_FOUND=200]="PARTICIPANT_NOT_FOUND",t[t.PARTICIPANT_MIGRATING_OUT=201]="PARTICIPANT_MIGRATING_OUT",t[t.PARTICIPANT_MIGRATION_FAILED=202]="PARTICIPANT_MIGRATION_FAILED",t[t.PARTICIPANT_MIGRATING=203]="PARTICIPANT_MIGRATING",t[t.PARTICIPANT_RECONNECT_FAILED=204]="PARTICIPANT_RECONNECT_FAILED",t[t.PARTICIPANT_MEDIA_TRANSPORT_FAILURE=205]="PARTICIPANT_MEDIA_TRANSPORT_FAILURE",t[t.CALL_NOT_FOUND=300]="CALL_NOT_FOUND",t[t.REQUEST_VALIDATION_FAILED=400]="REQUEST_VALIDATION_FAILED",t[t.UNAUTHENTICATED=401]="UNAUTHENTICATED",t[t.PERMISSION_DENIED=403]="PERMISSION_DENIED",t[t.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",t[t.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",t[t.SFU_SHUTTING_DOWN=600]="SFU_SHUTTING_DOWN",t[t.SFU_FULL=700]="SFU_FULL"})(wn||(wn={}));var zt;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.REACT=1]="REACT",t[t.ANGULAR=2]="ANGULAR",t[t.ANDROID=3]="ANDROID",t[t.IOS=4]="IOS",t[t.FLUTTER=5]="FLUTTER",t[t.REACT_NATIVE=6]="REACT_NATIVE",t[t.UNITY=7]="UNITY",t[t.GO=8]="GO",t[t.PLAIN_JAVASCRIPT=9]="PLAIN_JAVASCRIPT"})(zt||(zt={}));var Jn;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.USER_MUTED=1]="USER_MUTED",t[t.PERMISSION_REVOKED=2]="PERMISSION_REVOKED",t[t.MODERATION=3]="MODERATION"})(Jn||(Jn={}));var zs;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SHUTTING_DOWN=1]="SHUTTING_DOWN",t[t.REBALANCE=2]="REBALANCE"})(zs||(zs={}));var zn;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ENDED=1]="ENDED",t[t.LIVE_ENDED=2]="LIVE_ENDED",t[t.KICKED=3]="KICKED",t[t.SESSION_ENDED=4]="SESSION_ENDED"})(zn||(zn={}));var se;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.DISCONNECT=1]="DISCONNECT",t[t.FAST=2]="FAST",t[t.REJOIN=3]="REJOIN",t[t.MIGRATE=4]="MIGRATE"})(se||(se={}));var Ys;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.NONE=1]="NONE",t[t.LIGHT=2]="LIGHT",t[t.MODERATE=3]="MODERATE",t[t.SEVERE=4]="SEVERE",t[t.CRITICAL=5]="CRITICAL",t[t.EMERGENCY=6]="EMERGENCY",t[t.SHUTDOWN=7]="SHUTDOWN"})(Ys||(Ys={}));var Xs;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.NOMINAL=1]="NOMINAL",t[t.FAIR=2]="FAIR",t[t.SERIOUS=3]="SERIOUS",t[t.CRITICAL=4]="CRITICAL"})(Xs||(Xs={}));class xf extends P{constructor(){super("stream.video.sfu.models.CallState",[{no:1,name:"participants",kind:"message",repeat:1,T:()=>ln},{no:2,name:"started_at",kind:"message",T:()=>Gn},{no:3,name:"participant_count",kind:"message",T:()=>so},{no:4,name:"pins",kind:"message",repeat:1,T:()=>io}])}}const Il=new xf;class Pf extends P{constructor(){super("stream.video.sfu.models.ParticipantCount",[{no:1,name:"total",kind:"scalar",T:13},{no:2,name:"anonymous",kind:"scalar",T:13}])}}const so=new Pf;class Of extends P{constructor(){super("stream.video.sfu.models.Pin",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}const io=new Of;class Nf extends P{constructor(){super("stream.video.sfu.models.Participant",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"published_tracks",kind:"enum",repeat:1,T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"joined_at",kind:"message",T:()=>Gn},{no:5,name:"track_lookup_prefix",kind:"scalar",T:9},{no:6,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",Kn,"CONNECTION_QUALITY_"]},{no:7,name:"is_speaking",kind:"scalar",T:8},{no:8,name:"is_dominant_speaker",kind:"scalar",T:8},{no:9,name:"audio_level",kind:"scalar",T:2},{no:10,name:"name",kind:"scalar",T:9},{no:11,name:"image",kind:"scalar",T:9},{no:12,name:"custom",kind:"message",T:()=>Js},{no:13,name:"roles",kind:"scalar",repeat:2,T:9}])}}const ln=new Nf;class Af extends P{constructor(){super("stream.video.sfu.models.StreamQuality",[{no:1,name:"video_quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",Gt,"VIDEO_QUALITY_"]},{no:2,name:"user_id",kind:"scalar",T:9}])}}const Df=new Af;class Lf extends P{constructor(){super("stream.video.sfu.models.VideoDimension",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13}])}}const Ci=new Lf;class Mf extends P{constructor(){super("stream.video.sfu.models.VideoLayer",[{no:1,name:"rid",kind:"scalar",T:9},{no:2,name:"video_dimension",kind:"message",T:()=>Ci},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"fps",kind:"scalar",T:13},{no:6,name:"quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",Gt,"VIDEO_QUALITY_"]}])}}const _l=new Mf;class jf extends P{constructor(){super("stream.video.sfu.models.SubscribeOption",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:2,name:"codecs",kind:"message",repeat:1,T:()=>Zt}])}}const ro=new jf;class Ff extends P{constructor(){super("stream.video.sfu.models.PublishOption",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:2,name:"codec",kind:"message",T:()=>Zt},{no:3,name:"bitrate",kind:"scalar",T:5},{no:4,name:"fps",kind:"scalar",T:5},{no:5,name:"max_spatial_layers",kind:"scalar",T:5},{no:6,name:"max_temporal_layers",kind:"scalar",T:5},{no:7,name:"video_dimension",kind:"message",T:()=>Ci},{no:8,name:"id",kind:"scalar",T:5}])}}const kn=new Ff;class Uf extends P{constructor(){super("stream.video.sfu.models.Codec",[{no:16,name:"payload_type",kind:"scalar",T:13},{no:10,name:"name",kind:"scalar",T:9},{no:14,name:"clock_rate",kind:"scalar",T:13},{no:15,name:"encoding_parameters",kind:"scalar",T:9},{no:12,name:"fmtp",kind:"scalar",T:9}])}}const Zt=new Uf;let $f=class extends P{constructor(){super("stream.video.sfu.models.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Me,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}};const oo=new $f;class Vf extends P{constructor(){super("stream.video.sfu.models.TrackInfo",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:5,name:"layers",kind:"message",repeat:1,T:()=>_l},{no:6,name:"mid",kind:"scalar",T:9},{no:7,name:"dtx",kind:"scalar",T:8},{no:8,name:"stereo",kind:"scalar",T:8},{no:9,name:"red",kind:"scalar",T:8},{no:10,name:"muted",kind:"scalar",T:8},{no:11,name:"codec",kind:"message",T:()=>Zt},{no:12,name:"publish_option_id",kind:"scalar",T:5}])}}const Ti=new Vf;let Bf=class extends P{constructor(){super("stream.video.sfu.models.Error",[{no:1,name:"code",kind:"enum",T:()=>["stream.video.sfu.models.ErrorCode",wn,"ERROR_CODE_"]},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"should_retry",kind:"scalar",T:8}])}};const bt=new Bf;class Hf extends P{constructor(){super("stream.video.sfu.models.ClientDetails",[{no:1,name:"sdk",kind:"message",T:()=>Pl},{no:2,name:"os",kind:"message",T:()=>Ol},{no:3,name:"browser",kind:"message",T:()=>Nl},{no:4,name:"device",kind:"message",T:()=>Dl}])}}const xl=new Hf;class qf extends P{constructor(){super("stream.video.sfu.models.Sdk",[{no:1,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.SdkType",zt,"SDK_TYPE_"]},{no:2,name:"major",kind:"scalar",T:9},{no:3,name:"minor",kind:"scalar",T:9},{no:4,name:"patch",kind:"scalar",T:9}])}}const Pl=new qf;class Wf extends P{constructor(){super("stream.video.sfu.models.OS",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"architecture",kind:"scalar",T:9}])}}const Ol=new Wf;class Gf extends P{constructor(){super("stream.video.sfu.models.Browser",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}const Nl=new Gf;class Kf extends P{constructor(){super("stream.video.sfu.models.RTMPIngress",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13},{no:3,name:"frame_rate",kind:"scalar",T:1},{no:4,name:"software",kind:"scalar",T:9},{no:5,name:"version",kind:"scalar",T:9},{no:6,name:"encoder",kind:"scalar",T:9},{no:7,name:"remote_addr",kind:"scalar",T:9}])}}const Al=new Kf;class Jf extends P{constructor(){super("stream.video.sfu.models.Device",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}const Dl=new Jf;class zf extends P{constructor(){super("stream.video.sfu.models.Call",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"host_user_id",kind:"scalar",T:9},{no:5,name:"custom",kind:"message",T:()=>Js},{no:6,name:"created_at",kind:"message",T:()=>Gn},{no:7,name:"updated_at",kind:"message",T:()=>Gn}])}}const Yf=new zf;class Xf extends P{constructor(){super("stream.video.sfu.models.CallGrants",[{no:1,name:"can_publish_audio",kind:"scalar",T:8},{no:2,name:"can_publish_video",kind:"scalar",T:8},{no:3,name:"can_screenshare",kind:"scalar",T:8}])}}const Ll=new Xf;class Zf extends P{constructor(){super("stream.video.sfu.models.InputDevices",[{no:1,name:"available_devices",kind:"scalar",repeat:2,T:9},{no:2,name:"current_device",kind:"scalar",T:9},{no:3,name:"is_permitted",kind:"scalar",T:8}])}}const xr=new Zf;class Qf extends P{constructor(){super("stream.video.sfu.models.AndroidState",[{no:1,name:"thermal_state",kind:"enum",T:()=>["stream.video.sfu.models.AndroidThermalState",Ys,"ANDROID_THERMAL_STATE_"]},{no:2,name:"is_power_saver_mode",kind:"scalar",T:8}])}}const Ml=new Qf;class ep extends P{constructor(){super("stream.video.sfu.models.AppleState",[{no:1,name:"thermal_state",kind:"enum",T:()=>["stream.video.sfu.models.AppleThermalState",Xs,"APPLE_THERMAL_STATE_"]},{no:2,name:"is_low_power_mode_enabled",kind:"scalar",T:8}])}}const jl=new ep;var Pr=Object.freeze({__proto__:null,AndroidState:Ml,get AndroidThermalState(){return Ys},AppleState:jl,get AppleThermalState(){return Xs},Browser:Nl,Call:Yf,get CallEndedReason(){return zn},CallGrants:Ll,CallState:Il,ClientDetails:xl,Codec:Zt,get ConnectionQuality(){return Kn},Device:Dl,Error:bt,get ErrorCode(){return wn},get GoAwayReason(){return zs},ICETrickle:oo,InputDevices:xr,OS:Ol,Participant:ln,ParticipantCount:so,get PeerType(){return Me},Pin:io,PublishOption:kn,RTMPIngress:Al,Sdk:Pl,get SdkType(){return zt},StreamQuality:Df,SubscribeOption:ro,TrackInfo:Ti,get TrackType(){return O},get TrackUnpublishReason(){return Jn},VideoDimension:Ci,VideoLayer:_l,get VideoQuality(){return Gt},get WebsocketReconnectStrategy(){return se}});class tp extends P{constructor(){super("stream.video.sfu.signal.StartNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}const np=new tp;class sp extends P{constructor(){super("stream.video.sfu.signal.StartNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>bt}])}}const ip=new sp;class rp extends P{constructor(){super("stream.video.sfu.signal.StopNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}const op=new rp;class ap extends P{constructor(){super("stream.video.sfu.signal.StopNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>bt}])}}const cp=new ap;class lp extends P{constructor(){super("stream.video.sfu.signal.Reconnection",[{no:1,name:"time_seconds",kind:"scalar",T:2},{no:2,name:"strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",se,"WEBSOCKET_RECONNECT_STRATEGY_"]}])}}const up=new lp;class dp extends P{constructor(){super("stream.video.sfu.signal.Telemetry",[{no:1,name:"connection_time_seconds",kind:"scalar",oneof:"data",T:2},{no:2,name:"reconnection",kind:"message",oneof:"data",T:()=>up}])}}const hp=new dp;class fp extends P{constructor(){super("stream.video.sfu.signal.SendStatsRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"subscriber_stats",kind:"scalar",T:9},{no:3,name:"publisher_stats",kind:"scalar",T:9},{no:4,name:"webrtc_version",kind:"scalar",T:9},{no:5,name:"sdk",kind:"scalar",T:9},{no:6,name:"sdk_version",kind:"scalar",T:9},{no:7,name:"audio_devices",kind:"message",T:()=>xr},{no:8,name:"video_devices",kind:"message",T:()=>xr},{no:9,name:"android",kind:"message",oneof:"deviceState",T:()=>Ml},{no:10,name:"apple",kind:"message",oneof:"deviceState",T:()=>jl},{no:11,name:"telemetry",kind:"message",T:()=>hp},{no:12,name:"rtmp",kind:"message",T:()=>Al},{no:13,name:"subscriber_rtc_stats",kind:"scalar",T:9},{no:14,name:"publisher_rtc_stats",kind:"scalar",T:9}])}}const pp=new fp;class mp extends P{constructor(){super("stream.video.sfu.signal.SendStatsResponse",[{no:1,name:"error",kind:"message",T:()=>bt}])}}const gp=new mp;class bp extends P{constructor(){super("stream.video.sfu.signal.ICERestartRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Me,"PEER_TYPE_"]}])}}const vp=new bp;class yp extends P{constructor(){super("stream.video.sfu.signal.ICERestartResponse",[{no:1,name:"error",kind:"message",T:()=>bt}])}}const Sp=new yp;class Cp extends P{constructor(){super("stream.video.sfu.signal.UpdateMuteStatesRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:3,name:"mute_states",kind:"message",repeat:1,T:()=>Ep}])}}const Tp=new Cp;class wp extends P{constructor(){super("stream.video.sfu.signal.UpdateMuteStatesResponse",[{no:4,name:"error",kind:"message",T:()=>bt}])}}const kp=new wp;class Rp extends P{constructor(){super("stream.video.sfu.signal.TrackMuteState",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:2,name:"muted",kind:"scalar",T:8}])}}const Ep=new Rp;class Ip extends P{constructor(){super("stream.video.sfu.signal.AudioMuteChanged",[{no:1,name:"muted",kind:"scalar",T:8}])}}new Ip;class _p extends P{constructor(){super("stream.video.sfu.signal.VideoMuteChanged",[{no:2,name:"muted",kind:"scalar",T:8}])}}new _p;class xp extends P{constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsRequest",[{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>ao}])}}const Pp=new xp;class Op extends P{constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsResponse",[{no:4,name:"error",kind:"message",T:()=>bt}])}}const Np=new Op;class Ap extends P{constructor(){super("stream.video.sfu.signal.TrackSubscriptionDetails",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"dimension",kind:"message",T:()=>Ci}])}}const ao=new Ap;class Dp extends P{constructor(){super("stream.video.sfu.signal.SendAnswerRequest",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Me,"PEER_TYPE_"]},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}}const Lp=new Dp;class Mp extends P{constructor(){super("stream.video.sfu.signal.SendAnswerResponse",[{no:4,name:"error",kind:"message",T:()=>bt}])}}const jp=new Mp;class Fp extends P{constructor(){super("stream.video.sfu.signal.ICETrickleResponse",[{no:4,name:"error",kind:"message",T:()=>bt}])}}const Up=new Fp;class $p extends P{constructor(){super("stream.video.sfu.signal.SetPublisherRequest",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>Ti}])}}const Vp=new $p;class Bp extends P{constructor(){super("stream.video.sfu.signal.SetPublisherResponse",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"ice_restart",kind:"scalar",T:8},{no:4,name:"error",kind:"message",T:()=>bt}])}}const Hp=new Bp,tr=new ch("stream.video.sfu.signal.SignalServer",[{name:"SetPublisher",options:{},I:Vp,O:Hp},{name:"SendAnswer",options:{},I:Lp,O:jp},{name:"IceTrickle",options:{},I:oo,O:Up},{name:"UpdateSubscriptions",options:{},I:Pp,O:Np},{name:"UpdateMuteStates",options:{},I:Tp,O:kp},{name:"IceRestart",options:{},I:vp,O:Sp},{name:"SendStats",options:{},I:pp,O:gp},{name:"StartNoiseCancellation",options:{},I:np,O:ip},{name:"StopNoiseCancellation",options:{},I:op,O:cp}]);class qp extends P{constructor(){super("stream.video.sfu.event.SfuEvent",[{no:1,name:"subscriber_offer",kind:"message",oneof:"eventPayload",T:()=>_m},{no:2,name:"publisher_answer",kind:"message",oneof:"eventPayload",T:()=>Pm},{no:3,name:"connection_quality_changed",kind:"message",oneof:"eventPayload",T:()=>Nm},{no:4,name:"audio_level_changed",kind:"message",oneof:"eventPayload",T:()=>$m},{no:5,name:"ice_trickle",kind:"message",oneof:"eventPayload",T:()=>oo},{no:6,name:"change_publish_quality",kind:"message",oneof:"eventPayload",T:()=>Jm},{no:10,name:"participant_joined",kind:"message",oneof:"eventPayload",T:()=>Tm},{no:11,name:"participant_left",kind:"message",oneof:"eventPayload",T:()=>km},{no:12,name:"dominant_speaker_changed",kind:"message",oneof:"eventPayload",T:()=>Mm},{no:13,name:"join_response",kind:"message",oneof:"eventPayload",T:()=>Sm},{no:14,name:"health_check_response",kind:"message",oneof:"eventPayload",T:()=>lm},{no:16,name:"track_published",kind:"message",oneof:"eventPayload",T:()=>dm},{no:17,name:"track_unpublished",kind:"message",oneof:"eventPayload",T:()=>fm},{no:18,name:"error",kind:"message",oneof:"eventPayload",T:()=>Qp},{no:19,name:"call_grants_updated",kind:"message",oneof:"eventPayload",T:()=>Ym},{no:20,name:"go_away",kind:"message",oneof:"eventPayload",T:()=>Zm},{no:21,name:"ice_restart",kind:"message",oneof:"eventPayload",T:()=>nm},{no:22,name:"pins_updated",kind:"message",oneof:"eventPayload",T:()=>Xp},{no:23,name:"call_ended",kind:"message",oneof:"eventPayload",T:()=>eg},{no:24,name:"participant_updated",kind:"message",oneof:"eventPayload",T:()=>Em},{no:25,name:"participant_migration_complete",kind:"message",oneof:"eventPayload",T:()=>zp},{no:27,name:"change_publish_options",kind:"message",oneof:"eventPayload",T:()=>Gp}])}}const pa=new qp;class Wp extends P{constructor(){super("stream.video.sfu.event.ChangePublishOptions",[{no:1,name:"publish_options",kind:"message",repeat:1,T:()=>kn},{no:2,name:"reason",kind:"scalar",T:9}])}}const Gp=new Wp;class Kp extends P{constructor(){super("stream.video.sfu.event.ChangePublishOptionsComplete",[])}}new Kp;class Jp extends P{constructor(){super("stream.video.sfu.event.ParticipantMigrationComplete",[])}}const zp=new Jp;class Yp extends P{constructor(){super("stream.video.sfu.event.PinsChanged",[{no:1,name:"pins",kind:"message",repeat:1,T:()=>io}])}}const Xp=new Yp;class Zp extends P{constructor(){super("stream.video.sfu.event.Error",[{no:4,name:"error",kind:"message",T:()=>bt},{no:5,name:"reconnect_strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",se,"WEBSOCKET_RECONNECT_STRATEGY_"]}])}}const Qp=new Zp;class em extends P{constructor(){super("stream.video.sfu.event.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Me,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9}])}}new em;class tm extends P{constructor(){super("stream.video.sfu.event.ICERestart",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Me,"PEER_TYPE_"]}])}}const nm=new tm;class sm extends P{constructor(){super("stream.video.sfu.event.SfuRequest",[{no:1,name:"join_request",kind:"message",oneof:"requestPayload",T:()=>Fl},{no:2,name:"health_check_request",kind:"message",oneof:"requestPayload",T:()=>am},{no:3,name:"leave_call_request",kind:"message",oneof:"requestPayload",T:()=>rm}])}}const On=new sm;class im extends P{constructor(){super("stream.video.sfu.event.LeaveCallRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9}])}}const rm=new im;class om extends P{constructor(){super("stream.video.sfu.event.HealthCheckRequest",[])}}const am=new om;class cm extends P{constructor(){super("stream.video.sfu.event.HealthCheckResponse",[{no:1,name:"participant_count",kind:"message",T:()=>so}])}}const lm=new cm;class um extends P{constructor(){super("stream.video.sfu.event.TrackPublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"participant",kind:"message",T:()=>ln}])}}const dm=new um;class hm extends P{constructor(){super("stream.video.sfu.event.TrackUnpublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"cause",kind:"enum",T:()=>["stream.video.sfu.models.TrackUnpublishReason",Jn,"TRACK_UNPUBLISH_REASON_"]},{no:5,name:"participant",kind:"message",T:()=>ln}])}}const fm=new hm;class pm extends P{constructor(){super("stream.video.sfu.event.JoinRequest",[{no:1,name:"token",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"subscriber_sdp",kind:"scalar",T:9},{no:8,name:"publisher_sdp",kind:"scalar",T:9},{no:4,name:"client_details",kind:"message",T:()=>xl},{no:5,name:"migration",kind:"message",T:()=>vm},{no:6,name:"fast_reconnect",kind:"scalar",T:8},{no:7,name:"reconnect_details",kind:"message",T:()=>gm},{no:9,name:"preferred_publish_options",kind:"message",repeat:1,T:()=>kn},{no:10,name:"preferred_subscribe_options",kind:"message",repeat:1,T:()=>ro}])}}const Fl=new pm;class mm extends P{constructor(){super("stream.video.sfu.event.ReconnectDetails",[{no:1,name:"strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",se,"WEBSOCKET_RECONNECT_STRATEGY_"]},{no:3,name:"announced_tracks",kind:"message",repeat:1,T:()=>Ti},{no:4,name:"subscriptions",kind:"message",repeat:1,T:()=>ao},{no:5,name:"reconnect_attempt",kind:"scalar",T:13},{no:6,name:"from_sfu_id",kind:"scalar",T:9},{no:7,name:"previous_session_id",kind:"scalar",T:9},{no:8,name:"reason",kind:"scalar",T:9}])}}const gm=new mm;class bm extends P{constructor(){super("stream.video.sfu.event.Migration",[{no:1,name:"from_sfu_id",kind:"scalar",T:9},{no:2,name:"announced_tracks",kind:"message",repeat:1,T:()=>Ti},{no:3,name:"subscriptions",kind:"message",repeat:1,T:()=>ao}])}}const vm=new bm;class ym extends P{constructor(){super("stream.video.sfu.event.JoinResponse",[{no:1,name:"call_state",kind:"message",T:()=>Il},{no:2,name:"reconnected",kind:"scalar",T:8},{no:3,name:"fast_reconnect_deadline_seconds",kind:"scalar",T:5},{no:4,name:"publish_options",kind:"message",repeat:1,T:()=>kn}])}}const Sm=new ym;class Cm extends P{constructor(){super("stream.video.sfu.event.ParticipantJoined",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>ln}])}}const Tm=new Cm;class wm extends P{constructor(){super("stream.video.sfu.event.ParticipantLeft",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>ln}])}}const km=new wm;class Rm extends P{constructor(){super("stream.video.sfu.event.ParticipantUpdated",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>ln}])}}const Em=new Rm;class Im extends P{constructor(){super("stream.video.sfu.event.SubscriberOffer",[{no:1,name:"ice_restart",kind:"scalar",T:8},{no:2,name:"sdp",kind:"scalar",T:9}])}}const _m=new Im;class xm extends P{constructor(){super("stream.video.sfu.event.PublisherAnswer",[{no:1,name:"sdp",kind:"scalar",T:9}])}}const Pm=new xm;class Om extends P{constructor(){super("stream.video.sfu.event.ConnectionQualityChanged",[{no:1,name:"connection_quality_updates",kind:"message",repeat:1,T:()=>Dm}])}}const Nm=new Om;class Am extends P{constructor(){super("stream.video.sfu.event.ConnectionQualityInfo",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",Kn,"CONNECTION_QUALITY_"]}])}}const Dm=new Am;class Lm extends P{constructor(){super("stream.video.sfu.event.DominantSpeakerChanged",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}const Mm=new Lm;class jm extends P{constructor(){super("stream.video.sfu.event.AudioLevel",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"level",kind:"scalar",T:2},{no:4,name:"is_speaking",kind:"scalar",T:8}])}}const Fm=new jm;class Um extends P{constructor(){super("stream.video.sfu.event.AudioLevelChanged",[{no:1,name:"audio_levels",kind:"message",repeat:1,T:()=>Fm}])}}const $m=new Um;class Vm extends P{constructor(){super("stream.video.sfu.event.AudioSender",[{no:2,name:"codec",kind:"message",T:()=>Zt},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"publish_option_id",kind:"scalar",T:5}])}}const Bm=new Vm;class Hm extends P{constructor(){super("stream.video.sfu.event.VideoLayerSetting",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"active",kind:"scalar",T:8},{no:3,name:"max_bitrate",kind:"scalar",T:5},{no:4,name:"scale_resolution_down_by",kind:"scalar",T:2},{no:6,name:"codec",kind:"message",T:()=>Zt},{no:7,name:"max_framerate",kind:"scalar",T:13},{no:8,name:"scalability_mode",kind:"scalar",T:9}])}}const qm=new Hm;class Wm extends P{constructor(){super("stream.video.sfu.event.VideoSender",[{no:2,name:"codec",kind:"message",T:()=>Zt},{no:3,name:"layers",kind:"message",repeat:1,T:()=>qm},{no:4,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:5,name:"publish_option_id",kind:"scalar",T:5}])}}const Gm=new Wm;class Km extends P{constructor(){super("stream.video.sfu.event.ChangePublishQuality",[{no:1,name:"audio_senders",kind:"message",repeat:1,T:()=>Bm},{no:2,name:"video_senders",kind:"message",repeat:1,T:()=>Gm}])}}const Jm=new Km;class zm extends P{constructor(){super("stream.video.sfu.event.CallGrantsUpdated",[{no:1,name:"current_grants",kind:"message",T:()=>Ll},{no:2,name:"message",kind:"scalar",T:9}])}}const Ym=new zm;class Xm extends P{constructor(){super("stream.video.sfu.event.GoAway",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.GoAwayReason",zs,"GO_AWAY_REASON_"]}])}}const Zm=new Xm;class Qm extends P{constructor(){super("stream.video.sfu.event.CallEnded",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.CallEndedReason",zn,"CALL_ENDED_REASON_"]}])}}const eg=new Qm;var we;(function(t){t.UNKNOWN="UNKNOWN",t.VISIBLE="VISIBLE",t.INVISIBLE="INVISIBLE"})(we||(we={}));var vt;(function(t){t[t.IMMEDIATE=20]="IMMEDIATE",t[t.FAST=100]="FAST",t[t.MEDIUM=600]="MEDIUM",t[t.SLOW=1200]="SLOW"})(vt||(vt={}));class tg{constructor(e){this._transport=e,this.typeName=tr.typeName,this.methods=tr.methods,this.options=tr.options}setPublisher(e,n){const s=this.methods[0],i=this._transport.mergeOptions(n);return xt("unary",this._transport,s,i,e)}sendAnswer(e,n){const s=this.methods[1],i=this._transport.mergeOptions(n);return xt("unary",this._transport,s,i,e)}iceTrickle(e,n){const s=this.methods[2],i=this._transport.mergeOptions(n);return xt("unary",this._transport,s,i,e)}updateSubscriptions(e,n){const s=this.methods[3],i=this._transport.mergeOptions(n);return xt("unary",this._transport,s,i,e)}updateMuteStates(e,n){const s=this.methods[4],i=this._transport.mergeOptions(n);return xt("unary",this._transport,s,i,e)}iceRestart(e,n){const s=this.methods[5],i=this._transport.mergeOptions(n);return xt("unary",this._transport,s,i,e)}sendStats(e,n){const s=this.methods[6],i=this._transport.mergeOptions(n);return xt("unary",this._transport,s,i,e)}startNoiseCancellation(e,n){const s=this.methods[7],i=this._transport.mergeOptions(n);return xt("unary",this._transport,s,i,e)}stopNoiseCancellation(e,n){const s=this.methods[8],i=this._transport.mergeOptions(n);return xt("unary",this._transport,s,i,e)}}const ng={baseUrl:"",sendJson:!0,timeout:5*1e3,jsonOptions:{ignoreUnknownFields:!0}},sg=t=>({interceptUnary(e,n,s,i){return i.meta={...i.meta,...t},e(n,s,i)}}),ig=(t,e)=>({interceptUnary:(n,s,i,r)=>{let o;try{o=n(s,i,r)}finally{t(e,`Invoked SFU RPC method ${s.name}`,{request:o==null?void 0:o.request,headers:o==null?void 0:o.requestHeaders,response:o==null?void 0:o.response})}return o}}),rg=t=>{const e={SendStats:!0};return{interceptUnary(n,s,i,r){if(e[s.name])return n(s,i,r);try{return t(s.name,i),n(s,i,r)}catch(o){throw t(`${s.name}OnFailure`,[i,o]),o}}}},og=t=>{const e=new mh({...ng,...t});return new tg(e)},Kt=t=>new Promise(e=>setTimeout(e,t));function Or(t){return t&&(Object.prototype.toString.call(t)==="[object Function]"||typeof t=="function"||t instanceof Function)}const mn={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function rs(t){const e=Math.min(500+t*2e3,5e3),n=Math.min(Math.max(250,(t-1)*2e3),5e3);return Math.floor(Math.random()*(e-n)+n)}function Nn(t){let e="";for(let n=0;n<t.length;n++)e+=t[n].toString(16).padStart(2,"0");return e}function Nr(){const t=cg(16);return t[6]=t[6]&15|64,t[8]=t[8]&191|128,[Nn(t.subarray(0,4)),Nn(t.subarray(4,6)),Nn(t.subarray(6,8)),Nn(t.subarray(8,10)),Nn(t.subarray(10,16))].join("-")}const ag=typeof crypto<"u"&&crypto.getRandomValues?crypto.getRandomValues.bind(crypto):function(e){const n=Math.pow(2,8*e.byteLength/e.length);for(let s=0;s<e.length;s++)e[s]=Math.random()*n};function cg(t){const e=new Uint8Array(t);return ag(e),e}function Ar(t){typeof window<"u"&&window.addEventListener&&(window.addEventListener("offline",t),window.addEventListener("online",t))}function Ul(t){typeof window<"u"&&window.removeEventListener&&(window.removeEventListener("offline",t),window.removeEventListener("online",t))}function lg(t){return!t.status||t.status<200||300<=t.status}function ug(t){return t.code!==void 0}const Le=()=>{var t;return typeof navigator>"u"?!1:((t=navigator.product)==null?void 0:t.toLowerCase())==="reactnative"},ma=Object.freeze({trace:0,debug:1,info:2,warn:3,error:4});let $l,co="info";const Vl=(t,e,...n)=>{let s;switch(t){case"error":if(Le()){e=`ERROR: ${e}`,s=console.info;break}s=console.error;break;case"warn":if(Le()){e=`WARN: ${e}`,s=console.info;break}s=console.warn;break;case"info":s=console.info;break;case"trace":s=console.trace;break;default:s=console.log;break}s(e,...n)},dg=(t,e)=>{$l=t,hg(e)},hg=t=>{co=t},Dr=()=>co,he=t=>{const e=$l||Vl,n=(t||[]).filter(Boolean).join(":");return(i,r,...o)=>{ma[i]>=ma[co]&&e(i,`[${n}]: ${r}`,...o)}},Pt=async(t,e)=>{var i;let n=0,s;do{n>0&&await Kt(rs(n));try{s=await t()}catch(r){const o=r instanceof Ye&&r.code===ve[ve.cancelled],a=(e==null?void 0:e.aborted)??!1;if(o||a)throw r;he(["sfu-client","rpc"])("debug",`rpc failed (${n})`,r),n++}}while(!s||(i=s.response.error)!=null&&i.shouldRetry);return s},ga=async t=>{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:t}),e.addTransceiver("audio",{direction:t});const s=(await e.createOffer()).sdp??"";return e.getTransceivers().forEach(i=>{var r;(r=i.stop)==null||r.call(i)}),e.close(),s},Lr=t=>t?(t=t.toLowerCase(),t==="vp9"||t==="av1"||t==="video/vp9"||t==="video/av1"):!1,fg={subscriberOffer:void 0,publisherAnswer:void 0,connectionQualityChanged:void 0,audioLevelChanged:void 0,iceTrickle:void 0,changePublishQuality:void 0,participantJoined:void 0,participantLeft:void 0,dominantSpeakerChanged:void 0,joinResponse:void 0,healthCheckResponse:void 0,trackPublished:void 0,trackUnpublished:void 0,error:void 0,callGrantsUpdated:void 0,goAway:void 0,iceRestart:void 0,pinsUpdated:void 0,callEnded:void 0,participantUpdated:void 0,participantMigrationComplete:void 0,changePublishOptions:void 0},ba=t=>Object.prototype.hasOwnProperty.call(fg,t);class pg{constructor(){this.logger=he(["Dispatcher"]),this.subscribers={},this.dispatch=(e,n="0")=>{const s=e.eventPayload.oneofKind;if(!s)return;const i=e.eventPayload[s];this.logger("debug",`Dispatching ${s}, tag=${n}`,i);const r=this.subscribers[s];if(r)for(const o of r)try{o(i)}catch(a){this.logger("warn","Listener failed with error",a)}},this.on=(e,n)=>{var s;return((s=this.subscribers)[e]??(s[e]=[])).push(n),()=>{this.off(e,n)}},this.off=(e,n)=>{this.subscribers[e]=(this.subscribers[e]||[]).filter(s=>s!==n)}}}class mg{constructor(){this.subscriberCandidates=new Er,this.publisherCandidates=new Er,this.push=e=>{const n=gg(e);n&&(e.peerType===Me.SUBSCRIBER?this.subscriberCandidates.next(n):e.peerType===Me.PUBLISHER_UNSPECIFIED?this.publisherCandidates.next(n):he(["sfu-client"])("warn","ICETrickle, Unknown peer type",e))},this.dispose=()=>{this.subscriberCandidates.complete(),this.publisherCandidates.complete()}}}const gg=t=>{try{return JSON.parse(t.iceCandidate)}catch(e){he(["sfu-client"])("error","Failed to parse ICE Trickle",e,t);return}},Qe=Bl(yg),nr=Bl(Sg),Rn=new Map;function bg(t){return Rn.has(t)}async function vg(t){let e;for(;e=Rn.get(t);)await e.promise}function Bl(t){return function(n,s){const{cb:i,onContinued:r}=t(n,s),o=Rn.get(n);o==null||o.onContinued();const a=o?o.promise.then(i,i):i();return Rn.set(n,{promise:a,onContinued:r}),a}}function yg(t,e){let n=!1;return{cb:()=>e().finally(()=>{n||Rn.delete(t)}),onContinued:()=>n=!0}}function Sg(t,e){const n=new AbortController;return{cb:()=>n.signal.aborted?Promise.resolve("canceled"):e(n.signal).finally(()=>{n.signal.aborted||Rn.delete(t)}),onContinued:()=>n.abort()}}const Cg=t=>typeof t=="function",ut=t=>{let e,n;if(rn([t]).subscribe({next:([s])=>{e=s},error:s=>{n=s}}).unsubscribe(),n)throw n;return e},wt=(t,e)=>{const n=Cg(e)?e(ut(t)):e;return t.next(n),n},Hl=(t,e)=>{const n=t.getValue(),s=wt(t,e);return{lastValue:n,value:s,rollback:()=>wt(t,n)}},ct=(t,e,n=s=>he(["RxUtils"])("warn","An observable emitted an error",s))=>{const s=t.subscribe({next:e,error:n});return()=>{s.unsubscribe()}},wi=(t,e)=>{const n=Symbol();return ct(t,s=>{Qe(n,()=>e(s))})};var va=Object.freeze({__proto__:null,createSafeAsyncSubscription:wi,createSubscription:ct,getCurrentValue:ut,setCurrentValue:wt,updateValue:Hl}),M;(function(t){t.UNKNOWN="unknown",t.IDLE="idle",t.RINGING="ringing",t.JOINING="joining",t.JOINED="joined",t.LEFT="left",t.RECONNECTING="reconnecting",t.MIGRATING="migrating",t.RECONNECTING_FAILED="reconnecting-failed",t.OFFLINE="offline"})(M||(M={}));class Tg{constructor(){this.connectedUserSubject=new te(void 0),this.callsSubject=new te([]),this.setConnectedUser=e=>wt(this.connectedUserSubject,e),this.setCalls=e=>wt(this.callsSubject,e),this.registerCall=e=>{this.calls.find(n=>n.cid===e.cid)||this.setCalls(n=>[...n,e])},this.unregisterCall=e=>(he(["client-state"])("trace",`Unregistering call: ${e.cid}`),this.setCalls(s=>s.filter(i=>i!==e))),this.findCall=(e,n)=>this.calls.find(s=>s.type===e&&s.id===n),this.connectedUserSubject.subscribe(async e=>{if(!e){const n=he(["client-state"]);for(const s of this.calls)s.state.callingState!==M.LEFT&&(n("info",`User disconnected, leaving call: ${s.cid}`),await s.leave({reason:"client.disconnectUser() called"}).catch(i=>{n("error",`Error leaving call: ${s.cid}`,i)}))}})}get connectedUser(){return ut(this.connectedUserSubject)}get calls(){return ut(this.callsSubject)}}class wg{constructor(e){this.getCurrentValue=ut,this.connectedUser$=e.connectedUserSubject.asObservable(),this.calls$=e.callsSubject.asObservable()}get connectedUser(){return ut(this.connectedUser$)}get calls(){return ut(this.calls$)}}const Mt=(...t)=>(e,n)=>{for(const s of t){const i=s(e,n);if(i!==0)return i}return 0},ql=t=>e=>(n,s)=>t(n,s)?e(n,s):0,pt=t=>t.publishedTracks.includes(O.VIDEO),Nt=t=>t.publishedTracks.includes(O.AUDIO),mt=t=>t.publishedTracks.includes(O.SCREEN_SHARE),ki=t=>t.publishedTracks.includes(O.SCREEN_SHARE_AUDIO),kg=t=>!!t.pin&&(t.pin.isLocalPin||t.pin.pinnedAt>0),Ri=(t,e)=>t.isDominantSpeaker&&!e.isDominantSpeaker?-1:!t.isDominantSpeaker&&e.isDominantSpeaker?1:0,Ei=(t,e)=>t.isSpeaking&&!e.isSpeaking?-1:!t.isSpeaking&&e.isSpeaking?1:0,lo=(t,e)=>mt(t)&&!mt(e)?-1:!mt(t)&&mt(e)?1:0,Ii=(t,e)=>pt(t)&&!pt(e)?-1:!pt(t)&&pt(e)?1:0,_i=(t,e)=>Nt(t)&&!Nt(e)?-1:!Nt(t)&&Nt(e)?1:0,uo=(t,e)=>{if(t.pin&&e.pin){if(!t.pin.isLocalPin&&e.pin.isLocalPin)return-1;if(t.pin.isLocalPin&&!e.pin.isLocalPin)return 1;if(t.pin.pinnedAt>e.pin.pinnedAt)return-1;if(t.pin.pinnedAt<e.pin.pinnedAt)return 1}return t.pin&&!e.pin?-1:!t.pin&&e.pin?1:0},xi=t=>(e,n)=>{var s,i,r,o;return((s=e.reaction)==null?void 0:s.type)===t&&((i=n.reaction)==null?void 0:i.type)!==t?-1:((r=e.reaction)==null?void 0:r.type)!==t&&((o=n.reaction)==null?void 0:o.type)===t?1:0},Rg=(...t)=>(e,n)=>vs(e,t)&&!vs(n,t)?-1:!vs(e,t)&&vs(n,t)?1:0,vs=(t,e)=>(t.roles||[]).some(n=>e.includes(n)),ho=ql((t,e)=>{var n,s;return((n=t.viewportVisibilityState)==null?void 0:n.videoTrack)===we.INVISIBLE||((s=e.viewportVisibilityState)==null?void 0:s.videoTrack)===we.INVISIBLE}),Eg=ql((t,e)=>{var n,s,i,r;return((n=t.viewportVisibilityState)==null?void 0:n.videoTrack)===we.INVISIBLE||((s=t.viewportVisibilityState)==null?void 0:s.videoTrack)===we.UNKNOWN||((i=e.viewportVisibilityState)==null?void 0:i.videoTrack)===we.INVISIBLE||((r=e.viewportVisibilityState)==null?void 0:r.videoTrack)===we.UNKNOWN}),Yn=Mt(uo,lo,ho(Mt(Ri,Ei,xi("raised-hand"),Ii,_i))),Ig=Mt(uo,lo,Ri,ho(Mt(Ei,xi("raised-hand"),Ii,_i)));Mt(uo,Eg(Mt(Ri,Ei,xi("raised-hand"),Ii,_i)));const ya=Mt(ho(Mt(Ri,Ei,xi("raised-hand"),Ii,_i)),Rg("admin","host","speaker")),Sa={broadcasting:!1,hls:{playlist_url:"",status:""},rtmps:[]};class Wl{constructor(){this.backstageSubject=new te(!0),this.blockedUserIdsSubject=new te([]),this.createdAtSubject=new te(new Date),this.endedAtSubject=new te(void 0),this.startsAtSubject=new te(void 0),this.updatedAtSubject=new te(new Date),this.createdBySubject=new te(void 0),this.customSubject=new te({}),this.egressSubject=new te(void 0),this.ingressSubject=new te(void 0),this.recordingSubject=new te(!1),this.sessionSubject=new te(void 0),this.settingsSubject=new te(void 0),this.transcribingSubject=new te(!1),this.captioningSubject=new te(!1),this.endedBySubject=new te(void 0),this.thumbnailsSubject=new te(void 0),this.membersSubject=new te([]),this.ownCapabilitiesSubject=new te([]),this.callingStateSubject=new te(M.UNKNOWN),this.startedAtSubject=new te(void 0),this.participantCountSubject=new te(0),this.anonymousParticipantCountSubject=new te(0),this.participantsSubject=new te([]),this.callStatsReportSubject=new te(void 0),this.closedCaptionsSubject=new te([]),this.orphanedTracks=[],this.logger=he(["CallState"]),this.sortParticipantsBy=Yn,this.closedCaptionsTasks=new Map,this.dispose=()=>{for(const[s,i]of this.closedCaptionsTasks.entries())clearTimeout(i),this.closedCaptionsTasks.delete(s)},this.setSortParticipantsBy=s=>{this.sortParticipantsBy=s,this.setCurrentValue(this.participantsSubject,i=>i)},this.getCurrentValue=ut,this.setCurrentValue=wt,this.setParticipantCount=s=>this.setCurrentValue(this.participantCountSubject,s),this.setStartedAt=s=>this.setCurrentValue(this.startedAtSubject,s),this.setCaptioning=s=>Hl(this.captioningSubject,s),this.setAnonymousParticipantCount=s=>this.setCurrentValue(this.anonymousParticipantCountSubject,s),this.setParticipants=s=>this.setCurrentValue(this.participantsSubject,s),this.setCallingState=s=>this.setCurrentValue(this.callingStateSubject,s),this.setCallStatsReport=s=>this.setCurrentValue(this.callStatsReportSubject,s),this.setMembers=s=>{this.setCurrentValue(this.membersSubject,s)},this.setOwnCapabilities=s=>this.setCurrentValue(this.ownCapabilitiesSubject,s),this.setBackstage=s=>this.setCurrentValue(this.backstageSubject,s),this.setEndedAt=s=>this.setCurrentValue(this.endedAtSubject,s),this.findParticipantBySessionId=s=>this.participants.find(i=>i.sessionId===s),this.getParticipantLookupBySessionId=()=>this.participants.reduce((s,i)=>(s[i.sessionId]=i,s),{}),this.updateParticipant=(s,i)=>{const r=this.findParticipantBySessionId(s);if(!r){this.logger("warn",`Participant with sessionId ${s} not found`);return}const o=typeof i=="function"?i(r):i,a={...r,...o};return this.setParticipants(l=>l.map(u=>u.sessionId===s?a:u))},this.updateOrAddParticipant=(s,i)=>this.setParticipants(r=>{let o=!0;const a=r.map(l=>l.sessionId===s?(o=!1,{...l,...i}):l);return o&&a.push(i),a}),this.updateParticipants=s=>Object.keys(s).length===0?this.participants:this.setParticipants(i=>i.map(r=>{const o=s[r.sessionId];return o?{...r,...o}:r})),this.updateParticipantTracks=(s,i)=>this.updateParticipants(Object.entries(i).reduce((r,[o,a])=>{a.dimension&&(a.dimension.height=Math.ceil(a.dimension.height),a.dimension.width=Math.ceil(a.dimension.width));const l=s==="videoTrack"?"videoDimension":s==="screenShareTrack"?"screenShareDimension":void 0;return l&&(r[o]={[l]:a.dimension}),r},{})),this.updateFromEvent=s=>{const i=this.eventHandlers[s.type];i&&i(s)},this.setServerSidePins=s=>{const i=s.reduce((r,o)=>(r[o.sessionId]=Date.now(),r),{});return this.setParticipants(r=>r.map(o=>{const a=i[o.sessionId];return a?{...o,pin:{isLocalPin:!1,pinnedAt:a}}:o.pin&&!o.pin.isLocalPin?{...o,pin:void 0}:o}))},this.registerOrphanedTrack=s=>{this.orphanedTracks.push(s)},this.removeOrphanedTrack=s=>{this.orphanedTracks=this.orphanedTracks.filter(i=>i.id!==s)},this.takeOrphanedTracks=s=>{const i=this.orphanedTracks.filter(r=>r.trackLookupPrefix===s);return i.length>0&&(this.orphanedTracks=this.orphanedTracks.filter(r=>r.trackLookupPrefix!==s)),i},this.updateClosedCaptionSettings=s=>{this.closedCaptionsSettings={...this.closedCaptionsSettings,...s}},this.updateFromCallResponse=s=>{this.setBackstage(s.backstage),this.setCurrentValue(this.blockedUserIdsSubject,s.blocked_user_ids),this.setCurrentValue(this.createdAtSubject,new Date(s.created_at)),this.setCurrentValue(this.updatedAtSubject,new Date(s.updated_at)),this.setCurrentValue(this.startsAtSubject,s.starts_at?new Date(s.starts_at):void 0),this.setEndedAt(s.ended_at?new Date(s.ended_at):void 0),this.setCurrentValue(this.createdBySubject,s.created_by),this.setCurrentValue(this.customSubject,s.custom),this.setCurrentValue(this.egressSubject,s.egress),this.setCurrentValue(this.ingressSubject,s.ingress),this.setCurrentValue(this.recordingSubject,s.recording);const i=this.setCurrentValue(this.sessionSubject,s.session);this.updateParticipantCountFromSession(i),this.setCurrentValue(this.settingsSubject,s.settings),this.setCurrentValue(this.transcribingSubject,s.transcribing),this.setCurrentValue(this.captioningSubject,s.captioning),this.setCurrentValue(this.thumbnailsSubject,s.thumbnails)},this.updateFromSfuCallState=(s,i,r)=>{const{participants:o,participantCount:a,startedAt:l,pins:u}=s,d=(r==null?void 0:r.announcedTracks.map(f=>f.trackType))??[];this.setParticipants(()=>{const f=this.getParticipantLookupBySessionId();return o.map(c=>{const h=f[c.sessionId],m=c.sessionId===i;return Object.assign({},h,c,{isLocalParticipant:m,publishedTracks:m?d:c.publishedTracks,viewportVisibilityState:(h==null?void 0:h.viewportVisibilityState)??{videoTrack:we.UNKNOWN,screenShareTrack:we.UNKNOWN}})})}),this.setParticipantCount((a==null?void 0:a.total)||0),this.setAnonymousParticipantCount((a==null?void 0:a.anonymous)||0),this.setStartedAt(l?Gn.toDate(l):new Date),this.setServerSidePins(u)},this.updateFromMemberRemoved=s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.membersSubject,i=>i.filter(r=>s.members.indexOf(r.user_id)===-1))},this.updateFromMemberAdded=s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.membersSubject,i=>[...i,...s.members])},this.updateFromHLSBroadcastStopped=()=>{this.setCurrentValue(this.egressSubject,(s=Sa)=>({...s,broadcasting:!1,hls:{...s.hls,status:""}}))},this.updateFromHLSBroadcastingFailed=()=>{this.setCurrentValue(this.egressSubject,(s=Sa)=>({...s,broadcasting:!1,hls:{...s.hls,status:""}}))},this.updateParticipantCountFromSession=s=>{if(!s||this.callingState===M.JOINED)return;const i=Object.values(s.participants_count_by_role).reduce((o,a)=>o+a,0),r=Math.max(i,s.participants.length);this.setParticipantCount(r),this.setAnonymousParticipantCount(s.anonymous_participant_count||0)},this.updateFromSessionParticipantCountUpdate=s=>{const i=this.setCurrentValue(this.sessionSubject,r=>r&&{...r,anonymous_participant_count:s.anonymous_participant_count,participants_count_by_role:s.participants_count_by_role});this.updateParticipantCountFromSession(i)},this.updateFromSessionParticipantLeft=s=>{const i=this.setCurrentValue(this.sessionSubject,r=>{if(!r)return r;const{participants:o,participants_count_by_role:a}=r,{user:l,user_session_id:u}=s.participant;return{...r,participants:o.filter(d=>d.user_session_id!==u),participants_count_by_role:{...a,[l.role]:Math.max(0,(a[l.role]||0)-1)}}});this.updateParticipantCountFromSession(i)},this.updateFromSessionParticipantJoined=s=>{const i=this.setCurrentValue(this.sessionSubject,r=>{if(!r)return r;const{participants:o,participants_count_by_role:a}=r,{user:l,user_session_id:u}=s.participant;let d=!0;const f=o.map(h=>h.user_session_id===u?(d=!1,s.participant):h);d&&f.push(s.participant);const c=d?1:0;return{...r,participants:f,participants_count_by_role:{...a,[l.role]:(a[l.role]||0)+c}}});this.updateParticipantCountFromSession(i)},this.updateMembers=s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.membersSubject,i=>i.map(r=>{const o=s.members.find(a=>a.user_id===r.user_id);return o||r}))},this.updateParticipantReaction=s=>{const{user:i,custom:r,type:o,emoji_code:a}=s.reaction;this.setParticipants(l=>l.map(u=>u.userId!==i.id?u:{...u,reaction:{type:o,emoji_code:a,custom:r}}))},this.unblockUser=s=>{this.setCurrentValue(this.blockedUserIdsSubject,i=>i&&i.filter(r=>r!==s.user.id))},this.blockUser=s=>{this.setCurrentValue(this.blockedUserIdsSubject,i=>[...i||[],s.user.id])},this.updateOwnCapabilities=s=>{var i;s.user.id===((i=this.localParticipant)==null?void 0:i.userId)&&this.setCurrentValue(this.ownCapabilitiesSubject,s.own_capabilities)},this.updateFromClosedCaptions=s=>{this.setCurrentValue(this.closedCaptionsSubject,i=>{const{closed_caption:r}=s,o=c=>`${c.speaker_id}/${c.start_time}`,a=o(r);if(i.some(c=>o(c)===a))return i;const u=[...i,r],{visibilityDurationMs:d=2700,maxVisibleCaptions:f=2}=this.closedCaptionsSettings||{};if(d>0){const c=setTimeout(()=>{this.setCurrentValue(this.closedCaptionsSubject,h=>h.filter(m=>m!==r)),this.closedCaptionsTasks.delete(a)},d);this.closedCaptionsTasks.set(a,c);for(let h=0;h<u.length-f;h++){const m=o(u[h]),p=this.closedCaptionsTasks.get(m);clearTimeout(p),this.closedCaptionsTasks.delete(m)}}return u.slice(-f)})},this.participants$=this.participantsSubject.asObservable().pipe(He(s=>s.sort(this.sortParticipantsBy)),Ke({bufferSize:1,refCount:!0})),this.localParticipant$=this.participants$.pipe(He(s=>s.find(i=>i.isLocalParticipant)),Ke({bufferSize:1,refCount:!0})),this.remoteParticipants$=this.participants$.pipe(He(s=>s.filter(i=>!i.isLocalParticipant)),Ke({bufferSize:1,refCount:!0})),this.pinnedParticipants$=this.participants$.pipe(He(s=>s.filter(i=>!!i.pin)),Ke({bufferSize:1,refCount:!0})),this.dominantSpeaker$=this.participants$.pipe(He(s=>s.find(i=>i.isDominantSpeaker)),Ke({bufferSize:1,refCount:!0})),this.hasOngoingScreenShare$=this.participants$.pipe(He(s=>s.some(i=>mt(i))),Je(),Ke({bufferSize:1,refCount:!0})),this.createdAt$=this.createdAtSubject.asObservable(),this.endedAt$=this.endedAtSubject.asObservable(),this.startsAt$=this.startsAtSubject.asObservable(),this.startedAt$=this.startedAtSubject.asObservable(),this.updatedAt$=this.updatedAtSubject.asObservable(),this.callStatsReport$=this.callStatsReportSubject.asObservable(),this.members$=this.membersSubject.asObservable(),this.createdBy$=this.createdBySubject.asObservable(),this.custom$=this.customSubject.asObservable(),this.egress$=this.egressSubject.asObservable(),this.ingress$=this.ingressSubject.asObservable(),this.session$=this.sessionSubject.asObservable(),this.settings$=this.settingsSubject.asObservable(),this.endedBy$=this.endedBySubject.asObservable(),this.thumbnails$=this.thumbnailsSubject.asObservable(),this.closedCaptions$=this.closedCaptionsSubject.asObservable();const e=(s,i)=>{if(s.length!==i.length)return!1;for(const r of s)if(!i.includes(r))return!1;for(const r of i)if(!s.includes(r))return!1;return!0},n=(s,i)=>s.asObservable().pipe(Je(i));this.anonymousParticipantCount$=n(this.anonymousParticipantCountSubject),this.blockedUserIds$=n(this.blockedUserIdsSubject,e),this.backstage$=n(this.backstageSubject),this.callingState$=n(this.callingStateSubject),this.ownCapabilities$=n(this.ownCapabilitiesSubject,e),this.participantCount$=n(this.participantCountSubject),this.recording$=n(this.recordingSubject),this.transcribing$=n(this.transcribingSubject),this.captioning$=n(this.captioningSubject),this.eventHandlers={"call.frame_recording_ready":void 0,"call.permission_request":void 0,"call.recording_ready":void 0,"call.rtmp_broadcast_failed":void 0,"call.rtmp_broadcast_started":void 0,"call.rtmp_broadcast_stopped":void 0,"call.transcription_ready":void 0,"call.user_muted":void 0,"connection.error":void 0,"connection.ok":void 0,"health.check":void 0,"user.updated":void 0,custom:void 0,"call.accepted":s=>this.updateFromCallResponse(s.call),"call.blocked_user":this.blockUser,"call.closed_caption":this.updateFromClosedCaptions,"call.closed_captions_failed":()=>{this.setCurrentValue(this.captioningSubject,!1)},"call.closed_captions_started":()=>{this.setCurrentValue(this.captioningSubject,!0)},"call.closed_captions_stopped":()=>{this.setCurrentValue(this.captioningSubject,!1)},"call.created":s=>this.updateFromCallResponse(s.call),"call.deleted":s=>this.updateFromCallResponse(s.call),"call.ended":s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.endedBySubject,s.user)},"call.frame_recording_failed":s=>{this.updateFromCallResponse(s.call)},"call.frame_recording_started":s=>{this.updateFromCallResponse(s.call)},"call.frame_recording_stopped":s=>{this.updateFromCallResponse(s.call)},"call.hls_broadcasting_failed":this.updateFromHLSBroadcastingFailed,"call.hls_broadcasting_started":s=>{this.updateFromCallResponse(s.call)},"call.hls_broadcasting_stopped":this.updateFromHLSBroadcastStopped,"call.live_started":s=>this.updateFromCallResponse(s.call),"call.member_added":this.updateFromMemberAdded,"call.member_removed":this.updateFromMemberRemoved,"call.member_updated_permission":this.updateMembers,"call.member_updated":this.updateMembers,"call.notification":s=>{this.updateFromCallResponse(s.call),this.setMembers(s.members)},"call.permissions_updated":this.updateOwnCapabilities,"call.reaction_new":this.updateParticipantReaction,"call.recording_started":()=>this.setCurrentValue(this.recordingSubject,!0),"call.recording_stopped":()=>this.setCurrentValue(this.recordingSubject,!1),"call.recording_failed":()=>this.setCurrentValue(this.recordingSubject,!1),"call.rejected":s=>this.updateFromCallResponse(s.call),"call.ring":s=>this.updateFromCallResponse(s.call),"call.missed":s=>this.updateFromCallResponse(s.call),"call.session_ended":s=>this.updateFromCallResponse(s.call),"call.session_participant_count_updated":this.updateFromSessionParticipantCountUpdate,"call.session_participant_joined":this.updateFromSessionParticipantJoined,"call.session_participant_left":this.updateFromSessionParticipantLeft,"call.session_started":s=>this.updateFromCallResponse(s.call),"call.transcription_started":()=>{this.setCurrentValue(this.transcribingSubject,!0)},"call.transcription_stopped":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.transcription_failed":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.unblocked_user":this.unblockUser,"call.updated":s=>this.updateFromCallResponse(s.call)}}get participantCount(){return this.getCurrentValue(this.participantCount$)}get startedAt(){return this.getCurrentValue(this.startedAt$)}get captioning(){return this.getCurrentValue(this.captioning$)}get anonymousParticipantCount(){return this.getCurrentValue(this.anonymousParticipantCount$)}get participants(){return this.getCurrentValue(this.participants$)}get localParticipant(){return this.getCurrentValue(this.localParticipant$)}get remoteParticipants(){return this.getCurrentValue(this.remoteParticipants$)}get dominantSpeaker(){return this.getCurrentValue(this.dominantSpeaker$)}get pinnedParticipants(){return this.getCurrentValue(this.pinnedParticipants$)}get hasOngoingScreenShare(){return this.getCurrentValue(this.hasOngoingScreenShare$)}get callingState(){return this.getCurrentValue(this.callingState$)}get callStatsReport(){return this.getCurrentValue(this.callStatsReport$)}get members(){return this.getCurrentValue(this.members$)}get ownCapabilities(){return this.getCurrentValue(this.ownCapabilities$)}get backstage(){return this.getCurrentValue(this.backstage$)}get blockedUserIds(){return this.getCurrentValue(this.blockedUserIds$)}get createdAt(){return this.getCurrentValue(this.createdAt$)}get endedAt(){return this.getCurrentValue(this.endedAt$)}get startsAt(){return this.getCurrentValue(this.startsAt$)}get updatedAt(){return this.getCurrentValue(this.updatedAt$)}get createdBy(){return this.getCurrentValue(this.createdBy$)}get custom(){return this.getCurrentValue(this.custom$)}get egress(){return this.getCurrentValue(this.egress$)}get ingress(){return this.getCurrentValue(this.ingress$)}get recording(){return this.getCurrentValue(this.recording$)}get session(){return this.getCurrentValue(this.session$)}get settings(){return this.getCurrentValue(this.settings$)}get transcribing(){return this.getCurrentValue(this.transcribing$)}get endedBy(){return this.getCurrentValue(this.endedBy$)}get thumbnails(){return this.getCurrentValue(this.thumbnails$)}get closedCaptions(){return this.getCurrentValue(this.closedCaptions$)}}const Zs=t=>{const e=[];return t.forEach(n=>{e.push(n)}),e},_g=t=>{const{sdk:e,...n}=t,s=Gl(e),i=Kl(e);return{sdkName:s,sdkVersion:i,...n}},Gl=t=>t&&t.type===zt.REACT?"stream-react":t&&t.type===zt.REACT_NATIVE?"stream-react-native":"stream-js",Kl=t=>t?`${t.major}.${t.minor}.${t.patch}`:"0.0.0-development",Jl=()=>typeof navigator>"u"?!1:/^((?!chrome|android).)*safari/i.test(navigator.userAgent||""),Pi=()=>{var t;return typeof navigator>"u"?!1:(t=navigator.userAgent)==null?void 0:t.includes("Firefox")},xg=()=>{var t;return typeof navigator>"u"?!1:(t=navigator.userAgent)==null?void 0:t.includes("Chrome")};var Ca=Object.freeze({__proto__:null,isChrome:xg,isFirefox:Pi,isSafari:Jl});const Pg=({subscriber:t,publisher:e,state:n,datacenter:s,pollingIntervalInMs:i=2e3})=>{const r=he(["stats"]),o=async(m,p)=>m==="subscriber"&&t?t.getStats(p):m==="publisher"&&e?e.getStats(p):void 0,a=async(m,p)=>{const g=m==="subscriber"?t:e;if(!g)return[];const v=[];for(const C of p){const S=await g.getStats(C),T=sr(S,{trackKind:C.kind,kind:m,publisher:void 0});v.push(T)}return v},l=m=>{d.add(m),f()},u=m=>{d.delete(m),f()},d=new Set,f=async()=>{const m={};if(d.size>0){const S=new Set(d);for(const T of n.participants){if(!S.has(T.sessionId))continue;const{audioStream:w,isLocalParticipant:E,sessionId:_,userId:A,videoStream:q}=T,N=E?"publisher":"subscriber";try{const U=E?(e==null?void 0:e.getPublishedTracks())||[]:[...(q==null?void 0:q.getVideoTracks())||[],...(w==null?void 0:w.getAudioTracks())||[]];m[_]=await a(N,U)}catch(U){r("warn",`Failed to collect ${N} stats for ${A}`,U)}}}const[p,g]=await Promise.all([t.getStats().then(S=>sr(S,{kind:"subscriber",trackKind:"video",publisher:e})).then(Ta),e?e.getStats().then(S=>sr(S,{kind:"publisher",trackKind:"video",publisher:e})).then(Ta):zl()]),[v,C]=await Promise.all([o("subscriber"),e?o("publisher"):void 0]);n.setCallStatsReport({datacenter:s,publisherStats:g,subscriberStats:p,subscriberRawStats:v,publisherRawStats:C,participants:m,timestamp:Date.now()})};let c;if(i>0){const m=async()=>{await f().catch(p=>{r("debug","Failed to collect stats",p)}),c=setTimeout(m,i)};m()}return{getRawStatsForTrack:o,getStatsForStream:a,startReportingStatsFor:l,stopReportingStatsFor:u,stop:()=>{c&&clearTimeout(c)}}},sr=(t,e)=>{const{trackKind:n,kind:s,publisher:i}=e,r=s==="subscriber"?"inbound-rtp":"outbound-rtp",o=Zs(t),a=o.filter(l=>l.type===r&&l.kind===n).map(l=>{const u=l,d=o.find(m=>m.type==="codec"&&m.id===u.codecId),f=o.find(m=>m.type==="transport"&&m.id===u.transportId);let c;if(f&&f.dtlsState==="connected"){const m=o.find(p=>p.type==="candidate-pair"&&p.id===f.selectedCandidatePairId);c=m==null?void 0:m.currentRoundTripTime}let h;if(s==="publisher"&&i){const m=Pi(),p=o.find(g=>g.type==="media-source"&&(m?!0:g.id===u.mediaSourceId));p&&(h=i.getTrackType(p.trackIdentifier))}return{bytesSent:u.bytesSent,bytesReceived:u.bytesReceived,codec:d==null?void 0:d.mimeType,currentRoundTripTime:c,frameHeight:u.frameHeight,frameWidth:u.frameWidth,framesPerSecond:u.framesPerSecond,jitter:u.jitter,kind:u.kind,mediaSourceId:u.mediaSourceId,qualityLimitationReason:u.qualityLimitationReason,rid:u.rid,ssrc:u.ssrc,trackType:h}});return{rawStats:t,streams:a,timestamp:Date.now()}},zl=t=>({rawReport:t??{streams:[],timestamp:Date.now()},totalBytesSent:0,totalBytesReceived:0,averageJitterInMs:0,averageRoundTripTimeInMs:0,qualityLimitationReasons:"none",highestFrameWidth:0,highestFrameHeight:0,highestFramesPerSecond:0,codec:"",codecPerTrackType:{},timestamp:Date.now()}),Ta=t=>{const e=zl(t);let n=-1;const s=(l,u)=>l*u,i=new Set,r=t.streams,o=r.reduce((l,u)=>{l.totalBytesSent+=u.bytesSent||0,l.totalBytesReceived+=u.bytesReceived||0,l.averageJitterInMs+=u.jitter||0,l.averageRoundTripTimeInMs+=u.currentRoundTripTime||0;const d=s(u.frameWidth||0,u.frameHeight||0);return d>n&&(l.highestFrameWidth=u.frameWidth||0,l.highestFrameHeight=u.frameHeight||0,l.highestFramesPerSecond=u.framesPerSecond||0,n=d),i.add(u.qualityLimitationReason||""),l},e);r.length>0&&(o.averageJitterInMs=Math.round(o.averageJitterInMs/r.length*1e3),o.averageRoundTripTimeInMs=Math.round(o.averageRoundTripTimeInMs/r.length*1e3),o.codec=r[0].codec||"",o.codecPerTrackType=r.reduce((l,u)=>(u.trackType&&(l[u.trackType]=u.codec||""),l),{}));const a=[i.has("cpu")&&"cpu",i.has("bandwidth")&&"bandwidth",i.has("other")&&"other"].filter(Boolean).join(", ");return a&&(o.qualityLimitationReasons=a),o},Og="1.20.0",[Ng,Ag,Dg]=Og.split(".");let Qs={type:zt.PLAIN_JAVASCRIPT,major:Ng,minor:Ag,patch:Dg},Lg,Mg,jg={oneofKind:void 0};const Fg=t=>{Qs=t},Ug=()=>Qs,$g=()=>jg,wa=async()=>{if(Le())return{sdk:Qs,os:Lg,device:Mg};const t=navigator.userAgentData;let e;if(t&&t.getHighEntropyValues)try{e=await t.getHighEntropyValues(["platform","platformVersion"])}catch{}const n=new Sf.UAParser(navigator.userAgent),{browser:s,os:i,device:r,cpu:o}=n.getResult();return{sdk:Qs,browser:{name:s.name||navigator.userAgent,version:s.version||""},os:{name:(e==null?void 0:e.platform)||i.name||"",version:(e==null?void 0:e.platformVersion)||i.version||"",architecture:o.architecture||""},device:{name:[r.vendor,r.model,r.type].filter(Boolean).join(" "),version:""}}};class Vg{constructor(e,{options:n,clientDetails:s,subscriber:i,publisher:r,microphone:o,camera:a,state:l}){this.logger=he(["SfuStatsReporter"]),this.inputDevices=new Map,this.observeDevice=(f,c)=>{var m;const{hasBrowserPermission$:h}=f.state;(m=this.unsubscribeDevicePermissionsSubscription)==null||m.call(this),this.unsubscribeDevicePermissionsSubscription=ct(rn([h,this.state.ownCapabilities$]),([p,g])=>{var C;(C=this.unsubscribeListDevicesSubscription)==null||C.call(this);const v=c==="mic"?g.includes(z.SEND_AUDIO):g.includes(z.SEND_VIDEO);if(!p||!v){this.inputDevices.set(c,{currentDevice:"",availableDevices:[],isPermitted:!1});return}this.unsubscribeListDevicesSubscription=ct(rn([f.listDevices(),f.state.selectedDevice$]),([S,T])=>{const w=S.find(E=>E.deviceId===T);this.inputDevices.set(c,{currentDevice:(w==null?void 0:w.label)||T||"",availableDevices:S.map(E=>E.label),isPermitted:!0})})})},this.sendConnectionTime=f=>{this.sendTelemetryData({data:{oneofKind:"connectionTimeSeconds",connectionTimeSeconds:f}})},this.sendReconnectionTime=(f,c)=>{this.sendTelemetryData({data:{oneofKind:"reconnection",reconnection:{strategy:f,timeSeconds:c}}})},this.sendTelemetryData=f=>{this.run(f).catch(c=>{this.logger("warn","Failed to send telemetry data",c)})},this.run=async f=>{var S,T;const[c,h]=await Promise.all([this.subscriber.getStats().then(Zs).then(JSON.stringify),((S=this.publisher)==null?void 0:S.getStats().then(Zs).then(JSON.stringify))??"[]"]),m=this.subscriber.getTrace(),p=(T=this.publisher)==null?void 0:T.getTrace(),g=Wn.take(),v=this.sfuClient.getTrace(),C=[...g.snapshot,...(v==null?void 0:v.snapshot)??[],...(p==null?void 0:p.snapshot)??[]];try{await this.sfuClient.sendStats({sdk:this.sdkName,sdkVersion:this.sdkVersion,webrtcVersion:this.webRTCVersion,subscriberStats:c,subscriberRtcStats:m?JSON.stringify(m.snapshot):"",publisherStats:h,publisherRtcStats:C.length>0?JSON.stringify(C):"",audioDevices:this.inputDevices.get("mic"),videoDevices:this.inputDevices.get("camera"),deviceState:$g(),telemetry:f})}catch(w){throw p==null||p.rollback(),m==null||m.rollback(),g.rollback(),v==null||v.rollback(),w}},this.start=()=>{this.options.reporting_interval_ms<=0||(this.observeDevice(this.microphone,"mic"),this.observeDevice(this.camera,"camera"),clearInterval(this.intervalId),this.intervalId=setInterval(()=>{this.run().catch(f=>{this.logger("warn","Failed to report stats",f)})},this.options.reporting_interval_ms))},this.stop=()=>{var f,c;(f=this.unsubscribeDevicePermissionsSubscription)==null||f.call(this),this.unsubscribeDevicePermissionsSubscription=void 0,(c=this.unsubscribeListDevicesSubscription)==null||c.call(this),this.unsubscribeListDevicesSubscription=void 0,this.inputDevices.clear(),clearInterval(this.intervalId),this.intervalId=void 0},this.sfuClient=e,this.options=n,this.subscriber=i,this.publisher=r,this.microphone=o,this.camera=a,this.state=l;const{sdk:u,browser:d}=s;this.sdkName=Gl(u),this.sdkVersion=Kl(u),this.webRTCVersion=`${(d==null?void 0:d.name)||""}-${(d==null?void 0:d.version)||""}`||"N/A"}}const Bg=(t,e)=>{t.addEventListener("icecandidate",o=>{e("onicecandidate",o.candidate)}),t.addEventListener("track",o=>{const a=o.streams.map(l=>`stream:${l.id}`);e("ontrack",`${o.track.kind}:${o.track.id} ${a}`)}),t.addEventListener("signalingstatechange",()=>{e("onsignalingstatechange",t.signalingState)}),t.addEventListener("iceconnectionstatechange",()=>{e("oniceconnectionstatechange",t.iceConnectionState)}),t.addEventListener("icegatheringstatechange",()=>{e("onicegatheringstatechange",t.iceGatheringState)}),t.addEventListener("connectionstatechange",()=>{e("onconnectionstatechange",t.connectionState)}),t.addEventListener("negotiationneeded",()=>{e("onnegotiationneeded",void 0)}),t.addEventListener("datachannel",({channel:o})=>{e("ondatachannel",[o.id,o.label])});let n={};const s=()=>{t.getStats(null).then(o=>{const a=Hg(o);e("getstats",qg(n,a)),n=a}).catch(o=>{e("getstatsOnFailure",o.toString())})},i=setInterval(()=>{s()},8e3);t.addEventListener("connectionstatechange",()=>{const o=t.connectionState;(o==="connected"||o==="failed")&&s()});const r=t.close;t.close=function(){return clearInterval(i),e("close",void 0),r.call(this)};for(const o of["createOffer","createAnswer","setLocalDescription","setRemoteDescription","addIceCandidate"]){const a=t[o];a&&(t[o]=async function(...u){try{e(o,u);const d=await a.apply(this,u);return e(`${o}OnSuccess`,d),d}catch(d){throw e(`${o}OnFailure`,d.toString()),d}})}},Hg=t=>{const e={};return t.forEach((n,s)=>{e[s]=n}),e},qg=(t,e)=>{e=JSON.parse(JSON.stringify(e));for(const[s,i]of Object.entries(e))if(delete i.id,!!t[s])for(const[r,o]of Object.entries(i))o===t[s][r]&&delete i[r];let n=-1/0;for(const s of Object.values(e))s.timestamp>n&&(n=s.timestamp);for(const s of Object.values(e))s.timestamp===n&&(s.timestamp=0);return e.timestamp=n,e};class Yl{constructor(e,{sfuClient:n,connectionConfig:s,state:i,dispatcher:r,onUnrecoverableError:o,logTag:a,clientDetails:l,enableTracing:u}){if(this.isIceRestarting=!1,this.isDisposed=!1,this.subscriptions=[],this.on=(d,f)=>{this.subscriptions.push(this.dispatcher.on(d,c=>{Qe(`pc.${d}`,async()=>f(c)).catch(h=>{this.isDisposed||this.logger("warn",`Error handling ${d}`,h)})}))},this.addTrickledIceCandidates=()=>{var c;const{iceTrickleBuffer:d}=this.sfuClient,f=this.peerType===Me.SUBSCRIBER?d.subscriberCandidates:d.publisherCandidates;(c=this.unsubscribeIceTrickle)==null||c.call(this),this.unsubscribeIceTrickle=wi(f,async h=>this.pc.addIceCandidate(h).catch(m=>{this.isDisposed||this.logger("warn","ICE candidate error",m,h)}))},this.setSfuClient=d=>{this.sfuClient=d},this.getStats=d=>this.pc.getStats(d),this.getTrace=()=>{var d;return(d=this.tracer)==null?void 0:d.take()},this.onIceCandidate=d=>{const{candidate:f}=d;if(!f){this.logger("debug","null ice candidate");return}const c=this.asJSON(f);this.sfuClient.iceTrickle({peerType:this.peerType,iceCandidate:c}).catch(h=>{this.isDisposed||this.logger("warn","ICETrickle failed",h)})},this.asJSON=d=>{if(!d.usernameFragment){const f=d.candidate.split(" "),c=f.findIndex(m=>m==="ufrag")+1,h=f[c];return JSON.stringify({...d,usernameFragment:h})}return JSON.stringify(d.toJSON())},this.onIceConnectionStateChange=()=>{const d=this.pc.iceConnectionState;this.logger("debug","ICE connection state changed",d),this.state.callingState!==M.OFFLINE&&this.state.callingState!==M.RECONNECTING&&(this.isIceRestarting||(d==="failed"||d==="disconnected")&&(this.logger("debug","Attempting to restart ICE"),this.restartIce().catch(f=>{var h;if(this.isDisposed)return;const c="ICE restart failed";this.logger("error",c,f),(h=this.onUnrecoverableError)==null||h.call(this,`${c}: ${f}`)})))},this.onIceCandidateError=d=>{const f=d instanceof RTCPeerConnectionIceErrorEvent&&`${d.errorCode}: ${d.errorText}`,c=this.pc.iceConnectionState,h=c==="connected"||c==="checking"?"debug":"warn";this.logger(h,"ICE Candidate error",f)},this.onIceGatherChange=()=>{this.logger("debug","ICE Gathering State",this.pc.iceGatheringState)},this.onSignalingChange=()=>{this.logger("debug","Signaling state changed",this.pc.signalingState)},this.peerType=e,this.sfuClient=n,this.state=i,this.dispatcher=r,this.onUnrecoverableError=o,this.logger=he([e===Me.SUBSCRIBER?"Subscriber":"Publisher",a]),this.pc=new RTCPeerConnection(s),u){const d=`${a}-${e===Me.SUBSCRIBER?"sub":"pub"}`;this.tracer=new no(d),this.tracer.trace("clientDetails",l),this.tracer.trace("create",s),Bg(this.pc,this.tracer.trace)}this.pc.addEventListener("icecandidate",this.onIceCandidate),this.pc.addEventListener("icecandidateerror",this.onIceCandidateError),this.pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.pc.addEventListener("icegatheringstatechange",this.onIceGatherChange),this.pc.addEventListener("signalingstatechange",this.onSignalingChange)}dispose(){var e;this.onUnrecoverableError=void 0,this.isDisposed=!0,this.detachEventHandlers(),this.pc.close(),(e=this.tracer)==null||e.dispose()}detachEventHandlers(){var e;this.pc.removeEventListener("icecandidate",this.onIceCandidate),this.pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this.pc.removeEventListener("signalingstatechange",this.onSignalingChange),this.pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.pc.removeEventListener("icegatheringstatechange",this.onIceGatherChange),(e=this.unsubscribeIceTrickle)==null||e.call(this),this.subscriptions.forEach(n=>n())}}class Wg{constructor(){this.cache=[],this.layers=[],this.transceiverOrder=[],this.add=(e,n)=>{this.cache.push({publishOption:e,transceiver:n}),this.transceiverOrder.push(n)},this.get=e=>{var n;return(n=this.findTransceiver(e))==null?void 0:n.transceiver},this.has=e=>!!this.get(e),this.find=e=>this.cache.find(e),this.items=()=>this.cache,this.indexOf=e=>this.transceiverOrder.indexOf(e),this.getLayers=e=>{const n=this.layers.find(s=>s.publishOption.id===e.id&&s.publishOption.trackType===e.trackType);return n==null?void 0:n.layers},this.setLayers=(e,n=[])=>{const s=this.findLayer(e);s?s.layers=n:this.layers.push({publishOption:e,layers:n})},this.findTransceiver=e=>this.cache.find(n=>n.publishOption.id===e.id&&n.publishOption.trackType===e.trackType),this.findLayer=e=>this.layers.find(n=>n.publishOption.id===e.id&&n.publishOption.trackType===e.trackType)}}const Xn=(t,e)=>{he(["helpers"])("warn",e,t)},fo=t=>{switch(t){case O.SCREEN_SHARE:return"screenShareStream";case O.SCREEN_SHARE_AUDIO:return"screenShareAudioStream";case O.VIDEO:return"videoStream";case O.AUDIO:return"audioStream";case O.UNSPECIFIED:throw new Error("Track type is unspecified");default:Xn(t,"Unknown track type")}},Gg=t=>{switch(t){case"audio":return O.AUDIO;case"video":return O.VIDEO;case"screenshare":return O.SCREEN_SHARE;case"screenshare_audio":return O.SCREEN_SHARE_AUDIO;default:Xn(t,"Unknown mute type")}},Kg=t=>{switch(t){case"TRACK_TYPE_AUDIO":return O.AUDIO;case"TRACK_TYPE_VIDEO":return O.VIDEO;case"TRACK_TYPE_SCREEN_SHARE":return O.SCREEN_SHARE;case"TRACK_TYPE_SCREEN_SHARE_AUDIO":return O.SCREEN_SHARE_AUDIO;default:return}},po=t=>t===O.AUDIO||t===O.SCREEN_SHARE_AUDIO,Jg={q:3e5,h:75e4,f:125e4},zg=t=>{if(!t)return;const e=s=>i=>i.rid===s;return[{...t.find(e("f"))||t.find(e("h"))||t.find(e("q")),rid:"q"}]},Yg=t=>t==="q"?Gt.LOW_UNSPECIFIED:t==="h"?Gt.MID:Gt.HIGH,Xg=(t=[])=>t.map(e=>({rid:e.rid||"",bitrate:e.maxBitrate||0,fps:e.maxFramerate||0,quality:Yg(e.rid||""),videoDimension:{width:e.width,height:e.height}})),Zg=(t,e)=>`L${t}T${e}${t>1?"_KEY":""}`,ka=(t,e)=>{if(po(e.trackType))return;const n=[],s=t.getSettings(),{width:i=0,height:r=0}=s,{bitrate:o,codec:a,fps:l,maxSpatialLayers:u=3,maxTemporalLayers:d=3,videoDimension:f={width:1280,height:720}}=e,c=Qg(f,i,r,o);let h=1,m=1;const p=Lr(a==null?void 0:a.name);for(const g of["f","h","q"].slice(0,u)){const v={active:!0,rid:g,width:Math.round(i/h),height:Math.round(r/h),maxBitrate:Math.round(c/m)||Jg[g],maxFramerate:l};p?v.scalabilityMode=Zg(u,d):v.scaleResolutionDownBy=h,h*=2,m*=2,n.unshift(v)}return eb(s,n)},Qg=(t,e,n,s)=>{const{width:i,height:r}=t;if(e<i||n<r){const o=e*n,a=i*r,l=o/a;return Math.round(s*l)}return s},eb=(t,e)=>{let n;const s=Math.max(t.width||0,t.height||0);s<=320?n=e.filter(r=>r.rid==="f"):s<=640?n=e.filter(r=>r.rid!=="h"):n=e;const i=["q","h","f"];return n.map((r,o)=>({...r,rid:i[o]}))},tb=(t,e,n)=>{if(t.mid)return t.mid;if(!n)return String(e);const s=t.sender.track,r=kf.parse(n).media.find(o=>{var a;return o.type===s.kind&&(((a=o.msid)==null?void 0:a.includes(s.id))??!0)});return typeof(r==null?void 0:r.mid)<"u"?String(r.mid):e<0?"":String(e)};class nb extends Yl{constructor({publishOptions:e,...n}){super(Me.PUBLISHER_UNSPECIFIED,n),this.transceiverCache=new Wg,this.clonedTracks=new Set,this.publish=async(s,i)=>{if(!this.publishOptions.some(r=>r.trackType===i))throw new Error(`No publish options found for ${O[i]}`);for(const r of this.publishOptions){if(r.trackType!==i)continue;const o=this.cloneTrack(s),a=this.transceiverCache.get(r);if(!a)await this.addTransceiver(o,r);else{const l=a.sender.track;await a.sender.replaceTrack(o),Le()||this.stopTrack(l)}}},this.addTransceiver=async(s,i)=>{var u;const r=ka(s,i),o=Lr((u=i.codec)==null?void 0:u.name)?zg(r):r,a=this.pc.addTransceiver(s,{direction:"sendonly",sendEncodings:o}),l=i.trackType;this.logger("debug",`Added ${O[l]} transceiver`),this.transceiverCache.add(i,a),await this.negotiate()},this.syncPublishOptions=async()=>{for(const s of this.publishOptions){const{trackType:i}=s;if(!this.isPublishing(i)||this.transceiverCache.has(s))continue;const r=this.transceiverCache.find(a=>!!a.transceiver.sender.track&&a.publishOption.trackType===i);if(!r||!r.transceiver)continue;const o=this.cloneTrack(r.transceiver.sender.track);await this.addTransceiver(o,s)}for(const s of this.transceiverCache.items()){const{publishOption:i,transceiver:r}=s;this.publishOptions.some(a=>a.id===i.id&&a.trackType===i.trackType)||(this.stopTrack(r.sender.track),await r.sender.replaceTrack(null))}},this.isPublishing=s=>{for(const i of this.transceiverCache.items()){if(i.publishOption.trackType!==s)continue;const r=i.transceiver.sender.track;if(r&&r.readyState==="live"&&r.enabled)return!0}return!1},this.getTrackType=s=>{var i;for(const r of this.transceiverCache.items()){const{publishOption:o,transceiver:a}=r;if(((i=a.sender.track)==null?void 0:i.id)===s)return o.trackType}},this.stopTracks=(...s)=>{for(const i of this.transceiverCache.items()){const{publishOption:r,transceiver:o}=i;s.includes(r.trackType)&&this.stopTrack(o.sender.track)}},this.stopAllTracks=()=>{for(const{transceiver:s}of this.transceiverCache.items())this.stopTrack(s.sender.track);for(const s of this.clonedTracks)this.stopTrack(s)},this.changePublishQuality=async s=>{var g;const{trackType:i,layers:r,publishOptionId:o}=s,a=r.filter(v=>v.active),l="Update publish quality:";this.logger("info",`${l} requested layers by SFU:`,a);const u=this.transceiverCache.find(v=>v.publishOption.id===o&&v.publishOption.trackType===i),d=u==null?void 0:u.transceiver.sender;if(!d)return this.logger("warn",`${l} no video sender found.`);const f=d.getParameters();if(f.encodings.length===0)return this.logger("warn",`${l} there are no encodings set.`);const c=(g=u==null?void 0:u.publishOption.codec)==null?void 0:g.name,h=c&&Lr(c);let m=!1;for(const v of f.encodings){const C=h?a[0]:a.find(A=>A.name===v.rid)??(f.encodings.length===1?a[0]:void 0),S=!!(C!=null&&C.active);if(S!==v.active&&(v.active=S,m=!0),!C)continue;const{maxFramerate:T,scaleResolutionDownBy:w,maxBitrate:E,scalabilityMode:_}=C;w>=1&&w!==v.scaleResolutionDownBy&&(v.scaleResolutionDownBy=w,m=!0),E>0&&E!==v.maxBitrate&&(v.maxBitrate=E,m=!0),T>0&&T!==v.maxFramerate&&(v.maxFramerate=T,m=!0),_&&_!==v.scalabilityMode&&(v.scalabilityMode=_,m=!0)}const p=f.encodings.filter(v=>v.active);if(!m)return this.logger("info",`${l} no change:`,p);await d.setParameters(f),this.logger("info",`${l} enabled rids:`,p)},this.restartIce=async()=>{this.logger("debug","Restarting ICE connection");const s=this.pc.signalingState;if(this.isIceRestarting||s==="have-local-offer"){this.logger("debug","ICE restart is already in progress");return}await this.negotiate({iceRestart:!0})},this.negotiate=async s=>Qe("publisher.negotiate",async()=>{const i=await this.pc.createOffer(s),r=this.getAnnouncedTracks(i.sdp);if(!r.length)throw new Error("Can't negotiate without any tracks");try{this.isIceRestarting=(s==null?void 0:s.iceRestart)??!1,await this.pc.setLocalDescription(i);const{sdp:o=""}=i,{response:a}=await this.sfuClient.setPublisher({sdp:o,tracks:r});if(a.error)throw new Error(a.error.message);const{sdp:l}=a;await this.pc.setRemoteDescription({type:"answer",sdp:l})}finally{this.isIceRestarting=!1}this.addTrickledIceCandidates()}),this.getPublishedTracks=()=>{const s=[];for(const{transceiver:i}of this.transceiverCache.items()){const r=i.sender.track;r&&r.readyState==="live"&&s.push(r)}return s},this.getAnnouncedTracks=s=>{const i=[];for(const r of this.transceiverCache.items()){const{transceiver:o,publishOption:a}=r;o.sender.track&&i.push(this.toTrackInfo(o,a,s))}return i},this.getAnnouncedTracksForReconnect=()=>{var r;const s=(r=this.pc.localDescription)==null?void 0:r.sdp,i=[];for(const o of this.publishOptions){const a=this.transceiverCache.get(o);!a||!a.sender.track||i.push(this.toTrackInfo(a,o,s))}return i},this.toTrackInfo=(s,i,r)=>{var h;const o=s.sender.track,a=o.readyState==="live",l=a?ka(o,i):this.transceiverCache.getLayers(i);this.transceiverCache.setLayers(i,l);const u=po(i.trackType),d=u&&o.getSettings().channelCount===2,f=this.transceiverCache.indexOf(s),c=(h=this.state.settings)==null?void 0:h.audio;return{trackId:o.id,layers:Xg(l),trackType:i.trackType,mid:tb(s,f,r),stereo:d,dtx:u&&!!(c!=null&&c.opus_dtx_enabled),red:u&&!!(c!=null&&c.redundant_coding_enabled),muted:!a,codec:i.codec,publishOptionId:i.id}},this.cloneTrack=s=>{const i=s.clone();return this.clonedTracks.add(i),i},this.stopTrack=s=>{s&&(s.stop(),this.clonedTracks.delete(s))},this.publishOptions=e,this.on("iceRestart",s=>{s.peerType===Me.PUBLISHER_UNSPECIFIED&&this.restartIce().catch(i=>{var o;const r="ICE restart failed";this.logger("warn",r,i),(o=this.onUnrecoverableError)==null||o.call(this,`${r}: ${i}`)})}),this.on("changePublishQuality",async s=>{for(const i of s.videoSenders)await this.changePublishQuality(i)}),this.on("changePublishOptions",s=>(this.publishOptions=s.publishOptions,this.syncPublishOptions()))}dispose(){super.dispose(),this.stopAllTracks(),this.clonedTracks.clear()}}class sb extends Yl{constructor(e){super(Me.SUBSCRIBER,e),this.restartIce=async()=>{if(this.logger("debug","Restarting ICE connection"),this.pc.signalingState==="have-remote-offer"){this.logger("debug","ICE restart is already in progress");return}if(this.pc.connectionState==="new"){this.logger("debug","ICE connection is not yet established, skipping restart.");return}const n=this.isIceRestarting;try{this.isIceRestarting=!0,await this.sfuClient.iceRestart({peerType:Me.SUBSCRIBER})}catch(s){throw this.isIceRestarting=n,s}},this.handleOnTrack=n=>{const[s]=n.streams,[i,r]=s.id.split(":"),o=this.state.participants.find(f=>f.trackLookupPrefix===i);this.logger("debug",`[onTrack]: Got remote ${r} track for userId: ${o==null?void 0:o.userId}`,n.track.id,n.track);const a=`${o==null?void 0:o.userId} ${r}:${i}`;n.track.addEventListener("mute",()=>{this.logger("info",`[onTrack]: Track muted: ${a}`)}),n.track.addEventListener("unmute",()=>{this.logger("info",`[onTrack]: Track unmuted: ${a}`)}),n.track.addEventListener("ended",()=>{this.logger("info",`[onTrack]: Track ended: ${a}`),this.state.removeOrphanedTrack(s.id)});const l=Kg(r);if(!l)return this.logger("error",`Unknown track type: ${r}`);if(!o){this.logger("warn",`[onTrack]: Received track for unknown participant: ${i}`,n),this.state.registerOrphanedTrack({id:s.id,trackLookupPrefix:i,track:s,trackType:l});return}const u=fo(l);if(!u){this.logger("error",`Unknown track type: ${r}`);return}const d=o[u];this.state.updateParticipant(o.sessionId,{[u]:s}),d&&(this.logger("info",`[onTrack]: Cleaning up previous remote ${n.track.kind} tracks for userId: ${o.userId}`),d.getTracks().forEach(f=>{f.stop(),d.removeTrack(f)}))},this.negotiate=async n=>{await this.pc.setRemoteDescription({type:"offer",sdp:n.sdp}),this.addTrickledIceCandidates();const s=await this.pc.createAnswer();await this.pc.setLocalDescription(s),await this.sfuClient.sendAnswer({peerType:Me.SUBSCRIBER,sdp:s.sdp||""}),this.isIceRestarting=!1},this.pc.addEventListener("track",this.handleOnTrack),this.on("subscriberOffer",async n=>this.negotiate(n).catch(s=>{this.logger("error","Negotiation failed.",s)}))}detachEventHandlers(){super.detachEventHandlers(),this.pc.removeEventListener("track",this.handleOnTrack)}}const ib=t=>{const{endpoint:e,onMessage:n,logTag:s}=t,i=he(["SfuClientWS",s]);i("debug","Creating signaling WS channel:",e);const r=new WebSocket(e);return r.binaryType="arraybuffer",r.addEventListener("error",o=>{i("error","Signaling WS channel error",o)}),r.addEventListener("close",o=>{i("info","Signaling WS channel is closed",o)}),r.addEventListener("open",o=>{i("info","Signaling WS channel is open",o)}),r.addEventListener("message",o=>{try{const a=o.data instanceof ArrayBuffer?pa.fromBinary(new Uint8Array(o.data)):pa.fromJsonString(o.data.toString());n(a)}catch(a){i("error","Failed to decode a message. Check whether the Proto models match.",{event:o,error:a})}}),r},rb=t=>({bundlePolicy:"max-bundle",iceServers:t.map(e=>({urls:e.urls,username:e.username,credential:e.password}))});function Zn(t){let e=!0;const n=t.then(i=>({status:"resolved",result:i}),i=>({status:"rejected",error:i})).finally(()=>e=!1),s=()=>n.then(i=>{if(i.status==="rejected")throw i.error;return i.result});return s.checkPending=()=>e,s}const jn=()=>{let t,e;const n=new Promise((a,l)=>{t=a,e=l});let s=!1,i=!1;return{promise:n,resolve:a=>{s=!0,t(a)},reject:a=>{i=!0,e(a)},isResolved:()=>s,isRejected:()=>i}},Ra=Symbol("uninitialized");function un(t){let e=Ra;return()=>(e===Ra&&(e=t()),e)}const ob={src:`const timerIdMapping = new Map();
self.addEventListener('message', (event) => {
    const request = event.data;
    switch (request.type) {
        case 'setTimeout':
        case 'setInterval':
            timerIdMapping.set(request.id, (request.type === 'setTimeout' ? setTimeout : setInterval)(() => {
                tick(request.id);
                if (request.type === 'setTimeout') {
                    timerIdMapping.delete(request.id);
                }
            }, request.timeout));
            break;
        case 'clearTimeout':
        case 'clearInterval':
            (request.type === 'clearTimeout' ? clearTimeout : clearInterval)(timerIdMapping.get(request.id));
            timerIdMapping.delete(request.id);
            break;
    }
});
function tick(id) {
    const message = { type: 'tick', id };
    self.postMessage(message);
}`};class ab{constructor(){this.currentTimerId=1,this.callbacks=new Map,this.fallback=!1}setup({useTimerWorker:e=!0}={}){if(!e){this.fallback=!0;return}try{const n=ob.src,s=new Blob([n],{type:"application/javascript; charset=utf-8"}),i=URL.createObjectURL(s);this.worker=new Worker(i,{name:"str-timer-worker"}),this.worker.addEventListener("message",r=>{var l;const{type:o,id:a}=r.data;o==="tick"&&((l=this.callbacks.get(a))==null||l())})}catch(n){he(["timer-worker"])("error",n),this.fallback=!0}}destroy(){var e;this.callbacks.clear(),(e=this.worker)==null||e.terminate(),this.worker=void 0,this.fallback=!1}get ready(){return this.fallback||!!this.worker}setInterval(e,n){return this.setTimer("setInterval",e,n)}clearInterval(e){this.clearTimer("clearInterval",e)}setTimeout(e,n){return this.setTimer("setTimeout",e,n)}clearTimeout(e){this.clearTimer("clearTimeout",e)}setTimer(e,n,s){if(this.ready||this.setup(),this.fallback)return(e==="setTimeout"?setTimeout:setInterval)(n,s);const i=this.getTimerId();return this.callbacks.set(i,()=>{n(),e==="setTimeout"&&this.callbacks.delete(i)}),this.sendMessage({type:e,id:i,timeout:s}),i}clearTimer(e,n){if(n){if(this.ready||this.setup(),this.fallback){(e==="clearTimeout"?clearTimeout:clearInterval)(n);return}this.callbacks.delete(n),this.sendMessage({type:e,id:n})}}getTimerId(){return this.currentTimerId++}sendMessage(e){if(!this.worker)throw new Error("Cannot use timer worker before it's set up");this.worker.postMessage(e)}}let Xl=!1;const cb=()=>{Xl=!0},ei=un(()=>{const t=new ab;return t.setup({useTimerWorker:Xl}),t});class lt{constructor({dispatcher:e,credentials:n,sessionId:s,logTag:i,joinResponseTimeout:r=5e3,onSignalClose:o,streamClient:a,enableTracing:l}){this.iceTrickleBuffer=new mg,this.isLeaving=!1,this.isClosing=!1,this.pingIntervalInMs=10*1e3,this.unhealthyTimeoutInMs=this.pingIntervalInMs+5*1e3,this.joinResponseTask=jn(),this.abortController=new AbortController,this.createWebSocket=()=>{this.signalWs=ib({logTag:this.logTag,endpoint:`${this.credentials.server.ws_endpoint}?tag=${this.logTag}`,onMessage:f=>{this.lastMessageTimestamp=new Date,this.scheduleConnectionCheck(),this.dispatcher.dispatch(f,this.logTag)}}),this.signalReady=Zn(Promise.race([new Promise((f,c)=>{const h=()=>{this.signalWs.removeEventListener("open",h),f(this.signalWs)};this.signalWs.addEventListener("open",h),this.signalWs.addEventListener("close",m=>{this.handleWebSocketClose(m),c(new Error("SFU WS closed unexpectedly"))})}),new Promise((f,c)=>{setTimeout(()=>c(new Error("SFU WS connection timed out")),this.joinResponseTimeout)})]))},this.cleanUpWebSocket=()=>{this.signalWs.removeEventListener("close",this.handleWebSocketClose)},this.handleWebSocketClose=f=>{var c;this.signalWs.removeEventListener("close",this.handleWebSocketClose),ei().clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),(c=this.onSignalClose)==null||c.call(this,`${f.code} ${f.reason}`)},this.close=(f=lt.NORMAL_CLOSURE,c)=>{this.isClosing=!0,this.signalWs.readyState===WebSocket.OPEN&&(this.logger("debug",`Closing SFU WS connection: ${f} - ${c}`),this.signalWs.close(f,`js-client: ${c}`),this.cleanUpWebSocket()),this.dispose()},this.dispose=()=>{var f;this.logger("debug","Disposing SFU client"),this.unsubscribeIceTrickle(),this.unsubscribeNetworkChanged(),clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),clearTimeout(this.migrateAwayTimeout),this.abortController.abort(),(f=this.migrationTask)==null||f.resolve(),this.iceTrickleBuffer.dispose()},this.getTrace=()=>{var f;return(f=this.tracer)==null?void 0:f.take()},this.leaveAndClose=async f=>{await this.joinTask;try{this.isLeaving=!0,await this.notifyLeave(f)}catch(c){this.logger("debug","Error notifying SFU about leaving call",c)}this.close(lt.NORMAL_CLOSURE,f.substring(0,115))},this.updateSubscriptions=async f=>(await this.joinTask,Pt(()=>this.rpc.updateSubscriptions({sessionId:this.sessionId,tracks:f}),this.abortController.signal)),this.setPublisher=async f=>(await this.joinTask,Pt(()=>this.rpc.setPublisher({...f,sessionId:this.sessionId}),this.abortController.signal)),this.sendAnswer=async f=>(await this.joinTask,Pt(()=>this.rpc.sendAnswer({...f,sessionId:this.sessionId}),this.abortController.signal)),this.iceTrickle=async f=>(await this.joinTask,Pt(()=>this.rpc.iceTrickle({...f,sessionId:this.sessionId}),this.abortController.signal)),this.iceRestart=async f=>(await this.joinTask,Pt(()=>this.rpc.iceRestart({...f,sessionId:this.sessionId}),this.abortController.signal)),this.updateMuteStates=async f=>(await this.joinTask,Pt(()=>this.rpc.updateMuteStates({muteStates:f,sessionId:this.sessionId}),this.abortController.signal)),this.sendStats=async f=>(await this.joinTask,Pt(()=>this.rpc.sendStats({...f,sessionId:this.sessionId}),this.abortController.signal)),this.startNoiseCancellation=async()=>(await this.joinTask,Pt(()=>this.rpc.startNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.stopNoiseCancellation=async()=>(await this.joinTask,Pt(()=>this.rpc.stopNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.enterMigration=async(f={})=>{var p;this.isLeaving=!0;const{timeout:c=7*1e3}=f;(p=this.migrationTask)==null||p.reject(new Error("Cancelled previous migration"));const h=this.migrationTask=jn(),m=this.dispatcher.on("participantMigrationComplete",()=>{m(),clearTimeout(this.migrateAwayTimeout),h.resolve()});return this.migrateAwayTimeout=setTimeout(()=>{m(),h.reject(new Error(`Migration (${this.logTag}) failed to complete in ${c}ms`))},c),h.promise},this.join=async f=>{await this.signalReady(),(this.joinResponseTask.isResolved()||this.joinResponseTask.isRejected())&&(this.joinResponseTask=jn());const c=this.joinResponseTask;let h;const m=this.dispatcher.on("joinResponse",p=>{this.logger("debug","Received joinResponse",p),clearTimeout(h),m(),this.keepAlive(),c.resolve(p)});return h=setTimeout(()=>{m(),c.reject(new Error('Waiting for "joinResponse" has timed out'))},this.joinResponseTimeout),await this.send(On.create({requestPayload:{oneofKind:"joinRequest",joinRequest:Fl.create({...f,sessionId:this.sessionId,token:this.credentials.token})}})),c.promise},this.ping=async()=>this.send(On.create({requestPayload:{oneofKind:"healthCheckRequest",healthCheckRequest:{}}})),this.notifyLeave=async f=>this.send(On.create({requestPayload:{oneofKind:"leaveCallRequest",leaveCallRequest:{sessionId:this.sessionId,reason:f}}})),this.send=async f=>{await this.signalReady();const c=On.toJson(f);if(this.signalWs.readyState!==WebSocket.OPEN){this.logger("debug","Signal WS is not open. Skipping message",c);return}this.logger("debug",`Sending message to: ${this.edgeName}`,c),this.signalWs.send(On.toBinary(f))},this.keepAlive=()=>{const f=ei();f.clearInterval(this.keepAliveInterval),this.keepAliveInterval=f.setInterval(()=>{this.ping().catch(c=>{this.logger("error","Error sending healthCheckRequest to SFU",c)})},this.pingIntervalInMs)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeout),this.connectionCheckTimeout=setTimeout(()=>{this.lastMessageTimestamp&&new Date().getTime()-this.lastMessageTimestamp.getTime()>this.unhealthyTimeoutInMs&&this.close(lt.ERROR_CONNECTION_UNHEALTHY,`SFU connection unhealthy. Didn't receive any message for ${this.unhealthyTimeoutInMs}ms`)},this.unhealthyTimeoutInMs)},this.dispatcher=e,this.sessionId=s||Nr(),this.onSignalClose=o,this.credentials=n;const{server:u,token:d}=n;this.edgeName=u.edge_name,this.joinResponseTimeout=r,this.logTag=i,this.logger=he(["SfuClient",i]),this.tracer=l?new no(i):void 0,this.rpc=og({baseUrl:u.url,interceptors:[sg({Authorization:`Bearer ${d}`}),this.tracer&&rg(this.tracer.trace),Dr()==="trace"&&ig(this.logger,"trace")].filter(f=>!!f)}),this.unsubscribeIceTrickle=e.on("iceTrickle",f=>{this.iceTrickleBuffer.push(f)}),this.unsubscribeNetworkChanged=a.on("network.changed",f=>{var c;f.online?(c=this.networkAvailableTask)==null||c.resolve():this.networkAvailableTask=jn()}),this.createWebSocket()}get isHealthy(){return this.signalWs.readyState===WebSocket.OPEN&&this.joinResponseTask.isResolved()}get joinTask(){return this.joinResponseTask.promise}}lt.NORMAL_CLOSURE=1e3;lt.ERROR_CONNECTION_UNHEALTHY=4001;lt.DISPOSE_OLD_SOCKET=4002;const lb=t=>async function(n){if(n.user.id===t.currentUserId)return;const{state:s}=t;n.call.created_by.id===t.currentUserId&&s.callingState===M.RINGING&&await t.join()},ub=t=>async function(n){if(n.user.id===t.currentUserId)return;const{call:s}=n,{session:i}=s;if(!i){t.logger("warn","No call session provided. Ignoring call.rejected event.",n);return}const r=i.rejected_by,{members:o,callingState:a}=t.state;if(a!==M.RINGING){t.logger("info","Call is not in ringing mode (it is either accepted or rejected already). Ignoring call.rejected event.",n);return}t.isCreatedByMe?o.filter(u=>u.user_id!==t.currentUserId).every(u=>r[u.user_id])&&(t.logger("info","everyone rejected, leaving the call"),await t.leave({reason:"ring: everyone rejected"})):r[s.created_by.id]&&(t.logger("info","call creator rejected, leaving call"),await t.leave({reason:"ring: creator rejected"}))},db=t=>function(){const{callingState:n}=t.state;n!==M.IDLE&&n!==M.LEFT&&t.leave({reason:"call.ended event received",reject:!1}).catch(s=>{t.logger("error","Failed to leave call after call.ended ",s)})},hb=t=>t.on("callEnded",async e=>{if(t.state.callingState!==M.LEFT)try{t.state.setEndedAt(new Date);const n=zn[e.reason];await t.leave({reason:`callEnded received: ${n}`})}catch(n){t.logger("error","Failed to leave call after being ended by the SFU",n)}}),fb=t=>function(n){const{currentGrants:s}=n;if(s){const{canPublishAudio:i,canPublishVideo:r,canScreenshare:o}=s,a={[z.SEND_AUDIO]:i,[z.SEND_VIDEO]:r,[z.SCREENSHARE]:o},l=t.ownCapabilities.filter(u=>a[u]!==!1);Object.entries(a).forEach(([u,d])=>{d&&!l.includes(u)&&l.push(u)}),t.setOwnCapabilities(l)}},pb=(t,e)=>t.on("connectionQualityChanged",n=>{const{connectionQualityUpdates:s}=n;s&&e.updateParticipants(s.reduce((i,r)=>{const{sessionId:o,connectionQuality:a}=r;return i[o]={connectionQuality:a},i},{}))}),mb=(t,e)=>t.on("healthCheckResponse",n=>{const{participantCount:s}=n;s&&(e.setParticipantCount(s.total),e.setAnonymousParticipantCount(s.anonymous))}),gb=(t,e)=>t.on("error",n=>{n.error&&n.error.code!==wn.LIVE_ENDED||(e.state.setBackstage(!0),e.permissionsContext.hasPermission(z.JOIN_BACKSTAGE)||e.leave({reason:"live ended"}).catch(s=>{e.logger("error","Failed to leave call after live ended",s)}))}),bb=t=>t.on("error",e=>{if(!e.error)return;const n=he(["SfuClient"]),{error:s,reconnectStrategy:i}=e;n("error","SFU reported error",{code:wn[s.code],reconnectStrategy:se[i],message:s.message,shouldRetry:s.shouldRetry})}),vb=t=>function(n){const{pins:s}=n;t.setServerSidePins(s)},yb=t=>t.on("trackUnpublished",async e=>{const{cause:n,type:s,sessionId:i}=e,{localParticipant:r}=t.state;if(n===Jn.MODERATION&&i===(r==null?void 0:r.sessionId)){const o=t.logger;o("info",`Local participant's ${O[s]} track is muted remotely`);try{s===O.VIDEO?await t.camera.disable():s===O.AUDIO?await t.microphone.disable():s===O.SCREEN_SHARE||s===O.SCREEN_SHARE_AUDIO?await t.screenShare.disable():o("warn","Unsupported track type to soft mute",O[s])}catch(a){o("error","Failed to stop publishing",a)}}}),As=(t,...e)=>{for(const n of e)t.includes(n)||t.push(n);return t},Sb=t=>function(n){const{participant:s}=n;if(!s)return;const i=mo(t,s);t.updateOrAddParticipant(s.sessionId,Object.assign(s,i,{viewportVisibilityState:{videoTrack:we.UNKNOWN,screenShareTrack:we.UNKNOWN}}))},Cb=t=>function(n){const{participant:s}=n;s&&t.setParticipants(i=>i.filter(r=>r.sessionId!==s.sessionId))},Tb=t=>function(n){const{participant:s}=n;s&&t.updateParticipant(s.sessionId,s)},wb=t=>function(n){const{type:s,sessionId:i}=n;if(n.participant){const r=mo(t,n.participant),o=Object.assign(n.participant,r);t.updateOrAddParticipant(i,o)}else t.updateParticipant(i,r=>({publishedTracks:As([...r.publishedTracks],s)}))},kb=t=>function(n){const{type:s,sessionId:i}=n;if(n.participant){const r=mo(t,n.participant),o=Object.assign(n.participant,r);t.updateOrAddParticipant(i,o)}else t.updateParticipant(i,r=>({publishedTracks:r.publishedTracks.filter(o=>o!==s)}))},mo=(t,e)=>{const n=t.takeOrphanedTracks(e.trackLookupPrefix);if(!n.length)return;const s={};for(const i of n){const r=fo(i.trackType);r&&(s[r]=i.track)}return s},Rb=(t,e)=>t.on("dominantSpeakerChanged",n=>{var i;const{sessionId:s}=n;s!==((i=e.dominantSpeaker)==null?void 0:i.sessionId)&&e.setParticipants(r=>r.map(o=>o.sessionId===s?{...o,isDominantSpeaker:!0}:o.isDominantSpeaker?{...o,isDominantSpeaker:!1}:o))}),Eb=(t,e)=>t.on("audioLevelChanged",n=>{const{audioLevels:s}=n;e.updateParticipants(s.reduce((i,r)=>(i[r.sessionId]={audioLevel:r.level,isSpeaking:r.isSpeaking},i),{}))}),Ib=(t,e)=>{const n=t.state,s=[t.on("call.ended",db(t)),hb(t),gb(e,t),bb(e),pb(e,n),mb(e,n),t.on("participantJoined",Sb(n)),t.on("participantLeft",Cb(n)),t.on("participantUpdated",Tb(n)),t.on("trackPublished",wb(n)),t.on("trackUnpublished",kb(n)),Eb(e,n),Rb(e,n),t.on("callGrantsUpdated",fb(n)),t.on("pinsUpdated",vb(n)),yb(t)];return t.ringing&&s.push(Zl(t)),()=>{s.forEach(i=>i())}},Zl=t=>{const e={"call.accepted":lb(t),"call.rejected":ub(t)},n=Object.keys(e).map(s=>{const i=s;return t.on(i,e[i])});return()=>{n.forEach(s=>s())}},_b=.35;class xb{constructor(){this.elementHandlerMap=new Map,this.observer=null,this.queueSet=new Set,this.setViewport=(e,n)=>{const s=()=>{var i;(i=this.observer)==null||i.disconnect(),this.observer=null,this.elementHandlerMap.clear()};return this.observer=new IntersectionObserver(i=>{i.forEach(r=>{const o=this.elementHandlerMap.get(r.target);o==null||o(r)})},{root:e,...n,threshold:(n==null?void 0:n.threshold)??_b}),this.queueSet.size&&(this.queueSet.forEach(([i,r])=>{e.contains(i)&&(this.observer.observe(i),this.elementHandlerMap.set(i,r))}),this.queueSet.clear()),s},this.observe=(e,n)=>{const s=[e,n],i=()=>{var r;this.elementHandlerMap.delete(e),(r=this.observer)==null||r.unobserve(e),this.queueSet.delete(s)};return this.elementHandlerMap.has(e)?i:this.observer?(this.observer.root.contains(e)&&(this.elementHandlerMap.set(e,n),this.observer.observe(e)),i):(this.queueSet.add(s),i)}}}const Ea={videoTrack:we.UNKNOWN,screenShareTrack:we.UNKNOWN},ys=Symbol("globalOverrideKey");class Pb{constructor(e,n){this.viewportTracker=new xb,this.logger=he(["DynascaleManager"]),this.pendingSubscriptionsUpdate=null,this.videoTrackSubscriptionOverridesSubject=new te({}),this.videoTrackSubscriptionOverrides$=this.videoTrackSubscriptionOverridesSubject.asObservable(),this.incomingVideoSettings$=this.videoTrackSubscriptionOverrides$.pipe(He(s=>{const{[ys]:i,...r}=s;return{enabled:(i==null?void 0:i.enabled)!==!1,preferredResolution:i!=null&&i.enabled?i.dimension:void 0,participants:Object.fromEntries(Object.entries(r).map(([o,a])=>[o,{enabled:(a==null?void 0:a.enabled)!==!1,preferredResolution:a!=null&&a.enabled?a.dimension:void 0}])),isParticipantVideoEnabled:o=>{var a,l;return((a=s[o])==null?void 0:a.enabled)??((l=s[ys])==null?void 0:l.enabled)??!0}}}),Ke(1)),this.setVideoTrackSubscriptionOverrides=(s,i)=>i?wt(this.videoTrackSubscriptionOverridesSubject,r=>({...r,...Object.fromEntries(i.map(o=>[o,s]))})):wt(this.videoTrackSubscriptionOverridesSubject,s?{[ys]:s}:{}),this.applyTrackSubscriptions=(s=vt.SLOW)=>{this.pendingSubscriptionsUpdate&&clearTimeout(this.pendingSubscriptionsUpdate);const i=()=>{var r;this.pendingSubscriptionsUpdate=null,(r=this.sfuClient)==null||r.updateSubscriptions(this.trackSubscriptions).catch(o=>{this.logger("debug","Failed to update track subscriptions",o)})};s?this.pendingSubscriptionsUpdate=setTimeout(i,s):i()},this.trackElementVisibility=(s,i,r)=>{const o=this.viewportTracker.observe(s,a=>{this.callState.updateParticipant(i,l=>{const u=l.viewportVisibilityState??Ea,d=a.isIntersecting||document.fullscreenElement===s?we.VISIBLE:we.INVISIBLE;return{...l,viewportVisibilityState:{...u,[r]:d}}})});return()=>{o(),this.callState.updateParticipant(i,a=>{const l=a.viewportVisibilityState??Ea;return{...a,viewportVisibilityState:{...l,[r]:we.UNKNOWN}}})}},this.setViewport=s=>this.viewportTracker.setViewport(s),this.bindVideoElement=(s,i,r)=>{const o=this.callState.findParticipantBySessionId(i);if(!o)return;const a=(p,g)=>{g&&(g.width===0||g.height===0)&&(this.logger("debug","Ignoring 0x0 dimension",o),g=void 0),this.callState.updateParticipantTracks(r,{[i]:{dimension:g}}),this.applyTrackSubscriptions(p)},l=this.callState.participants$.pipe(He(p=>p.find(g=>g.sessionId===i)),_r(p=>!!p),Je(),Ke({bufferSize:1,refCount:!0}));let u;const d=o.isLocalParticipant?null:l.pipe(He(p=>{var g;return(g=p.viewportVisibilityState)==null?void 0:g[r]}),Je()).subscribe(p=>{if(!u){u=p??we.UNKNOWN;return}if(u=p??we.UNKNOWN,p===we.INVISIBLE)return a(vt.MEDIUM,void 0);a(vt.MEDIUM,{width:s.clientWidth,height:s.clientHeight})});let f;const c=o.isLocalParticipant?null:new ResizeObserver(()=>{const p={width:s.clientWidth,height:s.clientHeight};if(!f){f=p;return}if(f.width===p.width&&f.height===p.height||u===we.INVISIBLE)return;const v=Math.max(p.width/f.width,p.height/f.height)>1.2?vt.IMMEDIATE:vt.MEDIUM;a(v,{width:s.clientWidth,height:s.clientHeight}),f=p});c==null||c.observe(s);const h=o.isLocalParticipant?null:l.pipe(bs("publishedTracks"),He(p=>r==="videoTrack"?pt(p):mt(p)),Je()).subscribe(p=>{p?a(vt.IMMEDIATE,{width:s.clientWidth,height:s.clientHeight}):a(vt.FAST,void 0)});s.autoplay=!0,s.playsInline=!0,s.muted=!0;const m=l.pipe(bs(r==="videoTrack"?"videoStream":"screenShareStream")).subscribe(p=>{const g=r==="videoTrack"?p.videoStream:p.screenShareStream;s.srcObject!==g&&(s.srcObject=g??null,(Jl()||Pi())&&setTimeout(()=>{s.srcObject=g??null,s.play().catch(v=>{this.logger("warn","Failed to play stream",v)})},25))});return()=>{a(vt.FAST,void 0),d==null||d.unsubscribe(),h==null||h.unsubscribe(),m.unsubscribe(),c==null||c.disconnect()}},this.bindAudioElement=(s,i,r)=>{const o=this.callState.findParticipantBySessionId(i);if(!o||o.isLocalParticipant)return;const a=this.callState.participants$.pipe(He(f=>f.find(c=>c.sessionId===i)),_r(f=>!!f),Je(),Ke({bufferSize:1,refCount:!0})),l=a.pipe(bs(r==="screenShareAudioTrack"?"screenShareAudioStream":"audioStream")).subscribe(f=>{const c=r==="screenShareAudioTrack"?f.screenShareAudioStream:f.audioStream;s.srcObject!==c&&setTimeout(()=>{if(s.srcObject=c??null,s.srcObject){s.play().catch(m=>{this.logger("warn","Failed to play stream",m)});const{selectedDevice:h}=this.speaker.state;h&&"setSinkId"in s&&(s.setSinkId(h),Wn.trace("navigator.mediaDevices.setSinkId",h))}})}),u="setSinkId"in s?this.speaker.state.selectedDevice$.subscribe(f=>{f&&(s.setSinkId(f),Wn.trace("navigator.mediaDevices.setSinkId",f))}):null,d=rn([this.speaker.state.volume$,a.pipe(bs("audioVolume"))]).subscribe(([f,c])=>{s.volume=c.audioVolume??f});return s.autoplay=!0,()=>{u==null||u.unsubscribe(),d.unsubscribe(),l.unsubscribe()}},this.callState=e,this.speaker=n}setSfuClient(e){this.sfuClient=e}get trackSubscriptions(){const e=[];for(const n of this.callState.remoteParticipants){if(n.videoDimension&&pt(n)){const s=this.videoTrackSubscriptionOverrides[n.sessionId]??this.videoTrackSubscriptionOverrides[ys];(s==null?void 0:s.enabled)!==!1&&e.push({userId:n.userId,sessionId:n.sessionId,trackType:O.VIDEO,dimension:(s==null?void 0:s.dimension)??n.videoDimension})}n.screenShareDimension&&mt(n)&&e.push({userId:n.userId,sessionId:n.sessionId,trackType:O.SCREEN_SHARE,dimension:n.screenShareDimension}),ki(n)&&e.push({userId:n.userId,sessionId:n.sessionId,trackType:O.SCREEN_SHARE_AUDIO})}return e}get videoTrackSubscriptionOverrides(){return ut(this.videoTrackSubscriptionOverrides$)}}class Ob{constructor(){this.permissions=[],this.setPermissions=e=>{this.permissions=e||[]},this.setCallSettings=e=>{this.settings=e},this.hasPermission=e=>this.permissions.includes(e),this.canPublish=e=>{switch(e){case O.AUDIO:return this.hasPermission(z.SEND_AUDIO);case O.VIDEO:return this.hasPermission(z.SEND_VIDEO);case O.SCREEN_SHARE:case O.SCREEN_SHARE_AUDIO:return this.hasPermission(z.SCREENSHARE);case O.UNSPECIFIED:return!1;default:Xn(e,"Unknown track type")}},this.canRequest=(e,n=this.settings)=>{if(!n)return!1;const{audio:s,video:i,screensharing:r}=n;switch(e){case z.SEND_AUDIO:return s.access_request_enabled;case z.SEND_VIDEO:return i.access_request_enabled;case z.SCREENSHARE:return r.access_request_enabled;default:return!1}}}}class Fn{constructor(e,n={sortParticipantsBy:Yn}){this.name=e,this.options=n}}class Nb{constructor(e){this.register=n=>{this.callTypes[n.name]=n},this.unregister=n=>{delete this.callTypes[n]},this.get=n=>(this.callTypes[n]||this.register(new Fn(n)),this.callTypes[n]),this.callTypes=e.reduce((n,s)=>(n[s.name]=s,n),{})}}const Ql=new Nb([new Fn("default",{sortParticipantsBy:Yn}),new Fn("development",{sortParticipantsBy:Yn}),new Fn("livestream",{sortParticipantsBy:ya}),new Fn("audio_room",{sortParticipantsBy:ya})]);class eu{constructor(e){this.permission=e,this.disposeController=new AbortController,this.wasPrompted=!1,this.listeners=new Set,this.logger=he(["permissions"]);const n=this.disposeController.signal;this.ready=(async()=>{const s=()=>{this.setState("prompt")};if(!Ab())return s();try{const i=await navigator.permissions.query({name:e.queryName});n.aborted||(this.setState(i.state),i.addEventListener("change",()=>this.setState(i.state),{signal:n}))}catch(i){this.logger("debug","Failed to query permission status",i),s()}})()}dispose(){this.state=void 0,this.disposeController.abort()}async getState(){if(await this.ready,!this.state)throw new Error("BrowserPermission instance possibly disposed");return this.state}async prompt({forcePrompt:e=!1,throwOnNotAllowed:n=!1}={}){return await Qe(`permission-prompt-${this.permission.queryName}`,async()=>{if(await this.getState()!=="prompt"||this.wasPrompted&&!e){const s=this.state==="granted";if(!s&&n)throw new Error("Permission was not granted previously, and prompting again is not allowed");return s}try{this.wasPrompted=!0,this.setState("prompting");const s=await navigator.mediaDevices.getUserMedia(this.permission.constraints);return Ub(s),this.setState("granted"),!0}catch(s){if(s&&typeof s=="object"&&"name"in s&&(s.name==="NotAllowedError"||s.name==="SecurityError")){if(this.logger("info","Browser permission was not granted",{permission:this.permission}),this.setState("denied"),n)throw s;return!1}throw this.logger("error","Failed to getUserMedia",{error:s,permission:this.permission}),this.setState("prompt"),s}})}listen(e){return this.listeners.add(e),this.state&&e(this.state),()=>this.listeners.delete(e)}asObservable(){return this.getStateObservable().pipe(He(e=>e!=="denied"))}getIsPromptingObservable(){return this.getStateObservable().pipe(He(e=>e==="prompting"))}getStateObservable(){return ff(e=>this.listen(e),(e,n)=>n())}setState(e){this.state!==e&&(this.state=e,this.listeners.forEach(n=>n(e)))}}function Ab(){var t;return!Le()&&typeof navigator<"u"&&!!((t=navigator.permissions)!=null&&t.query)}const go=(t,e)=>cn((async()=>{let n=await navigator.mediaDevices.enumerateDevices();return n.some(i=>i.kind===e&&i.label==="")&&await t.prompt()&&(n=await navigator.mediaDevices.enumerateDevices()),n.filter(i=>i.kind===e&&i.label!==""&&i.deviceId!=="default")})()),Db=()=>typeof document>"u"?!1:"setSinkId"in document.createElement("audio"),tu={audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0}},nu={video:{width:1280,height:720}},En=un(()=>new eu({constraints:tu,queryName:"microphone"})),ti=un(()=>new eu({constraints:nu,queryName:"camera"})),Oi=un(()=>navigator.mediaDevices.addEventListener?Ir(navigator.mediaDevices,"devicechange").pipe(He(()=>{}),pf(500)):cn([])),Lb=un(()=>eo(Oi(),En().asObservable()).pipe(Si(void 0),yi(()=>go(En(),"audioinput")),Ke(1))),Mb=un(()=>eo(Oi(),ti().asObservable()).pipe(Si(void 0),yi(()=>go(ti(),"videoinput")),Ke(1))),jb=un(()=>eo(Oi(),En().asObservable()).pipe(Si(void 0),yi(()=>go(En(),"audiooutput")),Ke(1))),su=async t=>{const e=await navigator.mediaDevices.getUserMedia(t);return Pi()&&navigator.mediaDevices.dispatchEvent(new Event("devicechange")),e};function iu(t){if(!t||typeof t!="object")return!1;if("name"in t&&typeof t.name=="string"){const e=t.name;if(["OverconstrainedError","NotFoundError"].includes(e))return!0}return!!("message"in t&&typeof t.message=="string"&&t.message.startsWith("OverconstrainedError"))}const ru=async t=>{const e={audio:{...tu.audio,...t}};try{return await En().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),await su(e)}catch(n){if(iu(n)&&(t!=null&&t.deviceId)){const{deviceId:s,...i}=t;return he(["devices"])("warn","Failed to get audio stream, will try again with relaxed constraints",{error:n,constraints:e,relaxedConstraints:i}),ru(i)}throw he(["devices"])("error","Failed to get audio stream",{error:n,constraints:e}),n}},ou=async t=>{const e={video:{...nu.video,...t}};try{return await ti().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),await su(e)}catch(n){if(iu(n)&&(t!=null&&t.deviceId)){const{deviceId:s,...i}=t;return he(["devices"])("warn","Failed to get video stream, will try again with relaxed constraints",{error:n,constraints:e,relaxedConstraints:i}),ou(i)}throw he(["devices"])("error","Failed to get video stream",{error:n,constraints:e}),n}},Fb=async t=>{try{return await navigator.mediaDevices.getDisplayMedia({video:!0,audio:{channelCount:{ideal:2},echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},systemAudio:"include",...t})}catch(e){throw he(["devices"])("error","Failed to get screen share stream",e),e}},ni=typeof navigator<"u"&&typeof navigator.mediaDevices<"u"?Oi().pipe(Si(void 0),yi(()=>navigator.mediaDevices.enumerateDevices()),Ke(1)):void 0,Ub=t=>{t.active&&(t.getTracks().forEach(e=>{e.stop()}),typeof t.release=="function"&&t.release())},au=()=>/Mobi/i.test(navigator.userAgent);class bo{constructor(e,n,s){this.call=e,this.state=n,this.trackType=s,this.stopOnLeave=!0,this.subscriptions=[],this.isTrackStoppedDueToTrackEnd=!1,this.filters=[],this.statusChangeConcurrencyTag=Symbol("statusChangeConcurrencyTag"),this.filterRegistrationConcurrencyTag=Symbol("filterRegistrationConcurrencyTag"),this.dispose=()=>{this.subscriptions.forEach(i=>i())},this.logger=he([`${O[s].toLowerCase()} manager`]),ni&&!Le()&&(this.trackType===O.AUDIO||this.trackType===O.VIDEO)&&this.handleDisconnectedOrReplacedDevices()}listDevices(){return this.getDevices()}get enabled(){return this.state.status==="enabled"}async enable(){this.state.prevStatus=this.state.optimisticStatus,this.state.optimisticStatus!=="enabled"&&(this.state.setPendingStatus("enabled"),await nr(this.statusChangeConcurrencyTag,async e=>{try{await this.unmuteStream(),this.state.setStatus("enabled")}finally{e.aborted||this.state.setPendingStatus(this.state.status)}}))}async disable(e=!1){this.state.prevStatus=this.state.optimisticStatus,!(!e&&this.state.optimisticStatus==="disabled")&&(this.state.setPendingStatus("disabled"),await nr(this.statusChangeConcurrencyTag,async n=>{try{const s=e||this.state.disableMode==="stop-tracks";await this.muteStream(s),this.state.setStatus("disabled")}finally{n.aborted||this.state.setPendingStatus(this.state.status)}}))}async statusChangeSettled(){await vg(this.statusChangeConcurrencyTag)}async resume(){this.state.prevStatus==="enabled"&&this.state.status!=="enabled"&&await this.enable()}async toggle(){return this.state.optimisticStatus==="enabled"?await this.disable():await this.enable()}registerFilter(e){const n={start:e,stop:void 0};return{registered:Qe(this.filterRegistrationConcurrencyTag,async()=>{this.filters.push(n),await this.applySettingsToStream()}),unregister:()=>Qe(this.filterRegistrationConcurrencyTag,async()=>{var i;(i=n.stop)==null||i.call(n),this.filters=this.filters.filter(r=>r!==n),await this.applySettingsToStream()})}}setDefaultConstraints(e){this.state.setDefaultConstraints(e)}async select(e){if(Le())throw new Error("This method is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for reference.");const n=this.state.selectedDevice;if(e!==n)try{this.state.setDevice(e),await this.applySettingsToStream()}catch(s){throw this.state.setDevice(n),s}}async applySettingsToStream(){await nr(this.statusChangeConcurrencyTag,async()=>{this.enabled&&(await this.muteStream(),await this.unmuteStream())})}publishStream(e){return this.call.publish(e,this.trackType)}stopPublishStream(){return this.call.stopPublish(this.trackType)}getTracks(){var e;return((e=this.state.mediaStream)==null?void 0:e.getTracks())??[]}async muteStream(e=!0){const n=this.state.mediaStream;if(!n)return;this.logger("debug",`${e?"Stopping":"Disabling"} stream`),this.call.state.callingState===M.JOINED&&await this.stopPublishStream(),this.muteLocalStream(e),this.getTracks().every(i=>i.readyState==="ended")&&(typeof n.release=="function"&&n.release(),this.state.setMediaStream(void 0,void 0),this.filters.forEach(i=>{var r;return(r=i.stop)==null?void 0:r.call(i)}))}disableTracks(){this.getTracks().forEach(e=>{e.enabled&&(e.enabled=!1)})}enableTracks(){this.getTracks().forEach(e=>{e.enabled||(e.enabled=!0)})}stopTracks(){this.getTracks().forEach(e=>{e.readyState==="live"&&e.stop()})}muteLocalStream(e){this.state.mediaStream&&(e?this.stopTracks():this.disableTracks())}async unmuteStream(){this.logger("debug","Starting stream");let e,n;if(this.state.mediaStream&&this.getTracks().every(s=>s.readyState==="live"))e=this.state.mediaStream,this.enableTracks();else{const i={...this.state.defaultConstraints,deviceId:this.state.selectedDevice?{exact:this.state.selectedDevice}:void 0},r=o=>async a=>{if(!o)return a;const l=await o;return a.getTracks().forEach(u=>{const d=u.stop;u.stop=function(){d.call(u),l.getTracks().forEach(c=>{c.kind===u.kind&&c.stop()})}}),l.getTracks().forEach(u=>{const d=()=>{a.getTracks().forEach(f=>{u.kind===f.kind&&(f.stop(),f.dispatchEvent(new Event("ended")))})};u.addEventListener("ended",d),this.subscriptions.push(()=>{u.removeEventListener("ended",d)})}),a};n=this.getStream(i),e=await this.filters.reduce((o,a)=>o.then(l=>{const{stop:u,output:d}=a.start(l);return a.stop=u,d}).then(r(o),l=>(this.logger("warn","Filter failed to start and will be ignored",l),o)),n)}if(this.call.state.callingState===M.JOINED&&await this.publishStream(e),this.state.mediaStream!==e){this.state.setMediaStream(e,await n);const s=async()=>{await this.statusChangeSettled(),this.enabled&&(this.isTrackStoppedDueToTrackEnd=!0,setTimeout(()=>{this.isTrackStoppedDueToTrackEnd=!1},2e3),await this.disable())},i=r=>()=>{!au()||this.trackType!==O.VIDEO||this.call.notifyTrackMuteState(r,this.trackType).catch(o=>{this.logger("warn","Error while notifying track mute state",o)})};e.getTracks().forEach(r=>{const o=i(!0),a=i(!1);r.addEventListener("mute",o),r.addEventListener("unmute",a),r.addEventListener("ended",s),this.subscriptions.push(()=>{r.removeEventListener("mute",o),r.removeEventListener("unmute",a),r.removeEventListener("ended",s)})})}}get mediaDeviceKind(){return this.trackType===O.AUDIO?"audioinput":this.trackType===O.VIDEO?"videoinput":""}handleDisconnectedOrReplacedDevices(){this.subscriptions.push(ct(rn([ni.pipe(gf()),this.state.selectedDevice$]),async([[e,n],s])=>{try{if(!s)return;await this.statusChangeSettled();let i=!1,r=!1;const o=this.findDevice(n,s),a=this.findDevice(e,s);!o&&a?i=!0:o&&a&&o.deviceId===a.deviceId&&o.groupId!==a.groupId&&(r=!0),i&&(await this.disable(),await this.select(void 0)),r&&(this.isTrackStoppedDueToTrackEnd&&this.state.status==="disabled"?(await this.enable(),this.isTrackStoppedDueToTrackEnd=!1):await this.applySettingsToStream())}catch(i){this.logger("warn","Unexpected error while handling disconnected or replaced device",i)}}))}findDevice(e,n){const s=this.mediaDeviceKind;return e.find(i=>i.deviceId===n&&i.kind===s)}}class vo{constructor(e="stop-tracks",n){this.disableMode=e,this.statusSubject=new te(void 0),this.optimisticStatusSubject=new te(void 0),this.mediaStreamSubject=new te(void 0),this.selectedDeviceSubject=new te(void 0),this.defaultConstraintsSubject=new te(void 0),this.mediaStream$=this.mediaStreamSubject.asObservable(),this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe(Je()),this.status$=this.statusSubject.asObservable().pipe(Je()),this.optimisticStatus$=this.optimisticStatusSubject.asObservable().pipe(Je()),this.defaultConstraints$=this.defaultConstraintsSubject.asObservable(),this.getCurrentValue=ut,this.setCurrentValue=wt,this.hasBrowserPermission$=n?n.asObservable().pipe(Ke(1)):Gs(!0),this.isPromptingPermission$=n?n.getIsPromptingObservable().pipe(Ke(1)):Gs(!1)}get status(){return this.getCurrentValue(this.status$)}get optimisticStatus(){return this.getCurrentValue(this.optimisticStatus$)}get selectedDevice(){return this.getCurrentValue(this.selectedDevice$)}get mediaStream(){return this.getCurrentValue(this.mediaStream$)}setStatus(e){this.setCurrentValue(this.statusSubject,e)}setPendingStatus(e){this.setCurrentValue(this.optimisticStatusSubject,e)}setMediaStream(e,n){this.setCurrentValue(this.mediaStreamSubject,e),n&&this.setDevice(this.getDeviceIdFromStream(n))}setDevice(e){this.setCurrentValue(this.selectedDeviceSubject,e)}get defaultConstraints(){return this.getCurrentValue(this.defaultConstraints$)}setDefaultConstraints(e){this.setCurrentValue(this.defaultConstraintsSubject,e)}}class $b extends vo{constructor(){super("stop-tracks",ti()),this.directionSubject=new te(void 0),this.direction$=this.directionSubject.asObservable().pipe(Je())}get direction(){return this.getCurrentValue(this.direction$)}setDirection(e){this.setCurrentValue(this.directionSubject,e)}setMediaStream(e,n){var s;if(super.setMediaStream(e,n),e){const i=Le()?this.direction:((s=e.getVideoTracks()[0])==null?void 0:s.getSettings().facingMode)==="environment"?"back":"front";this.setDirection(i)}}getDeviceIdFromStream(e){const[n]=e.getVideoTracks();return n==null?void 0:n.getSettings().deviceId}}class Vb extends bo{constructor(e){super(e,new $b,O.VIDEO),this.targetResolution={width:1280,height:720}}isDirectionSupportedByDevice(){return Le()||au()}async selectDirection(e){if(this.isDirectionSupportedByDevice())if(Le()){const n=this.getTracks()[0];if(!n){this.logger("warn","No video track found to do direction selection");return}await n.applyConstraints({facingMode:e==="front"?"user":"environment"}),this.state.setDirection(e),this.state.setDevice(void 0)}else this.state.setDirection(e),this.state.setDevice(void 0),this.getTracks().forEach(n=>{n.stop()}),await this.unmuteStream();else this.logger("warn","Camera direction ignored for desktop devices")}async flip(){const e=this.state.direction==="front"?"back":"front";await this.selectDirection(e)}async selectTargetResolution(e){if(this.targetResolution.height=e.height,this.targetResolution.width=e.width,this.state.optimisticStatus==="enabled")try{await this.statusChangeSettled()}catch(n){this.logger("warn","could not apply target resolution",n)}if(this.enabled&&this.state.mediaStream){const[n]=this.state.mediaStream.getVideoTracks();if(!n)return;const{width:s,height:i}=n.getSettings();(s!==this.targetResolution.width||i!==this.targetResolution.height)&&(await this.applySettingsToStream(),this.logger("debug",`${s}x${i} target resolution applied to media stream`))}}async apply(e,n){var u;const s=!!((u=this.call.state.localParticipant)!=null&&u.videoStream),i=this.call.permissionsContext.hasPermission(z.SEND_AUDIO);if(s||!i)return;await this.statusChangeSettled();const{target_resolution:r,camera_facing:o,camera_default_on:a}=e;if(await this.selectTargetResolution(r),!this.state.direction&&!this.state.selectedDevice&&this.state.setDirection(o==="front"?"front":"back"),!n)return;const{mediaStream:l}=this.state;this.enabled&&l?await this.publishStream(l):this.state.status===void 0&&a&&await this.enable()}getDevices(){return Mb()}getStream(e){return e.width=this.targetResolution.width,e.height=this.targetResolution.height,!e.deviceId&&this.state.direction&&this.isDirectionSupportedByDevice()&&(e.facingMode=this.state.direction==="front"?"user":"environment"),ou(e)}}class Bb extends vo{constructor(e){super(e,En()),this.speakingWhileMutedSubject=new te(!1),this.speakingWhileMuted$=this.speakingWhileMutedSubject.asObservable().pipe(Je())}get speakingWhileMuted(){return this.getCurrentValue(this.speakingWhileMuted$)}setSpeakingWhileMuted(e){this.setCurrentValue(this.speakingWhileMutedSubject,e)}getDeviceIdFromStream(e){const[n]=e.getAudioTracks();return n==null?void 0:n.getSettings().deviceId}}const Hb=500,qb=150,Wb=128,Gb=(t,e,n={})=>{const{detectionFrequencyInMs:s=Hb,audioLevelThreshold:i=qb,fftSize:r=Wb,destroyStreamOnStop:o=!0}=n,a=new AudioContext,l=a.createAnalyser();l.fftSize=r;const u=a.createMediaStreamSource(t);u.connect(l);const d=setInterval(()=>{var p;const f=new Uint8Array(l.frequencyBinCount);l.getByteFrequencyData(f);const c=f.some(g=>g>=i),h=f.reduce((g,v)=>g+v,0)/f.length,m=h>i?100:Math.round(h/i*100);(p=t.getAudioTracks()[0])!=null&&p.enabled?e({isSoundDetected:c,audioLevel:m}):e({isSoundDetected:!1,audioLevel:0})},s);return async function(){clearInterval(d),u.disconnect(),l.disconnect(),a.state!=="closed"&&await a.close(),o&&t.getTracks().forEach(c=>{c.stop(),t.removeTrack(c)})}};class Kb{constructor(){this.pc1=new RTCPeerConnection({}),this.pc2=new RTCPeerConnection({})}async start(e){try{this.cleanupAudioStream();const n=await navigator.mediaDevices.getUserMedia({audio:!0});this.audioStream=n,this.pc1.addEventListener("icecandidate",async o=>{await this.pc2.addIceCandidate(o.candidate)}),this.pc2.addEventListener("icecandidate",async o=>{await this.pc1.addIceCandidate(o.candidate)}),this.pc2.addEventListener("track",o=>{o.streams[0].getTracks().forEach(a=>{a._setVolume(0)})}),n.getTracks().forEach(o=>this.pc1.addTrack(o,n));const s=await this.pc1.createOffer({});await this.pc2.setRemoteDescription(s),await this.pc1.setLocalDescription(s);const i=await this.pc2.createAnswer();await this.pc1.setRemoteDescription(i),await this.pc2.setLocalDescription(i);const r=this.onSpeakingDetectedStateChange(e);return()=>{r(),this.stop()}}catch(n){return he(["RNSpeechDetector"])("error","error handling permissions: ",n),()=>{}}}stop(){this.pc1.close(),this.pc2.close(),this.cleanupAudioStream()}onSpeakingDetectedStateChange(e){let s=.13,i=!1,r,o;const a=[],l=10,u=1.1,d=.9,f=500,c=5e3,m=setInterval(async()=>{try{const p=await this.pc1.getStats(),v=Zs(p).find(C=>C.type==="media-source"&&C.kind==="audio");if(v){const{audioLevel:C}=v;if(C){a.push(C),a.length>l&&a.shift();const S=a.reduce((T,w)=>T+w,0)/a.length;S<s*u?o||(o=setTimeout(()=>{s=Math.min(S*d,.13)},c)):(clearTimeout(o),o=void 0),S>s*1.5&&(i||(i=!0,e({isSoundDetected:!0,audioLevel:C})),clearTimeout(r),r=setTimeout(()=>{i=!1,e({isSoundDetected:!1,audioLevel:0})},f))}}}catch(p){he(["RNSpeechDetector"])("error","error checking audio level from stats",p)}},100);return()=>{clearInterval(m),clearTimeout(r),clearTimeout(o)}}cleanupAudioStream(){this.audioStream&&(this.audioStream.getTracks().forEach(e=>e.stop()),typeof this.audioStream.release=="function"&&this.audioStream.release())}}class Jb extends bo{constructor(e,n="stop-tracks"){super(e,new Bb(n),O.AUDIO),this.speakingWhileMutedNotificationEnabled=!0,this.soundDetectorConcurrencyTag=Symbol("soundDetectorConcurrencyTag"),this.subscriptions.push(wi(rn([this.call.state.callingState$,this.call.state.ownCapabilities$,this.state.selectedDevice$,this.state.status$]),async([s,i,r,o])=>{try{if(s===M.LEFT&&await this.stopSpeakingWhileMutedDetection(),s!==M.JOINED||!this.speakingWhileMutedNotificationEnabled)return;i.includes(z.SEND_AUDIO)?o==="disabled"?await this.startSpeakingWhileMutedDetection(r):await this.stopSpeakingWhileMutedDetection():await this.stopSpeakingWhileMutedDetection()}catch(a){this.logger("warn","Could not enable speaking while muted",a)}})),this.subscriptions.push(ct(this.call.state.callingState$,s=>{var r,o;if(!this.noiseCancellationRegistration||!this.noiseCancellation)return;((o=(r=this.call.state.settings)==null?void 0:r.audio.noise_cancellation)==null?void 0:o.mode)===er.AUTO_ON&&s===M.JOINED?this.noiseCancellationRegistration.then(()=>{var a;return(a=this.noiseCancellation)==null?void 0:a.enable()}).catch(a=>(this.logger("warn","Failed to enable noise cancellation",a),this.call.notifyNoiseCancellationStopped())):s===M.LEFT&&this.noiseCancellationRegistration.then(()=>{var a;return(a=this.noiseCancellation)==null?void 0:a.disable()}).catch(a=>{this.logger("warn","Failed to disable noise cancellation",a)})}))}async enableNoiseCancellation(e){if(Le())throw new Error("Noise cancellation is not supported in React Native");const{ownCapabilities:n,settings:s}=this.call.state;if(!n.includes(z.ENABLE_NOISE_CANCELLATION))throw new Error("Noise cancellation is not available.");const r=s==null?void 0:s.audio.noise_cancellation;if(!r||r.mode===er.DISABLED)throw new Error("Noise cancellation is disabled for this call type.");try{this.noiseCancellation=e,this.noiseCancellationChangeUnsubscribe=this.noiseCancellation.on("change",a=>{a?this.call.notifyNoiseCancellationStarting().catch(l=>{this.logger("warn","notifyNoiseCancellationStart failed",l)}):this.call.notifyNoiseCancellationStopped().catch(l=>{this.logger("warn","notifyNoiseCancellationStop failed",l)})});const o=this.registerFilter(e.toFilter());this.noiseCancellationRegistration=o.registered,this.unregisterNoiseCancellation=o.unregister,await this.noiseCancellationRegistration,r.mode===er.AUTO_ON&&this.call.state.callingState===M.JOINED&&e.enable()}catch(o){this.logger("warn","Failed to enable noise cancellation",o),await this.disableNoiseCancellation().catch(a=>{this.logger("warn","Failed to disable noise cancellation",a)})}}async disableNoiseCancellation(){var e;if(Le())throw new Error("Noise cancellation is not supported in React Native");await(((e=this.unregisterNoiseCancellation)==null?void 0:e.call(this))??Promise.resolve()).then(()=>{var n;return(n=this.noiseCancellation)==null?void 0:n.disable()}).then(()=>{var n;return(n=this.noiseCancellationChangeUnsubscribe)==null?void 0:n.call(this)}).catch(n=>{this.logger("warn","Failed to unregister noise cancellation",n)}),await this.call.notifyNoiseCancellationStopped()}async enableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!0,this.state.status==="disabled"&&await this.startSpeakingWhileMutedDetection(this.state.selectedDevice)}async disableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!1,await this.stopSpeakingWhileMutedDetection()}async apply(e,n){var o;if(!n)return;const s=!!((o=this.call.state.localParticipant)!=null&&o.audioStream),i=this.call.permissionsContext.hasPermission(z.SEND_AUDIO);if(s||!i)return;await this.statusChangeSettled();const{mediaStream:r}=this.state;this.enabled&&r?await this.publishStream(r):this.state.status===void 0&&e.mic_default_on&&await this.enable()}getDevices(){return Lb()}getStream(e){return ru(e)}async startSpeakingWhileMutedDetection(e){await Qe(this.soundDetectorConcurrencyTag,async()=>{if(await this.stopSpeakingWhileMutedDetection(),Le()){this.rnSpeechDetector=new Kb;const n=await this.rnSpeechDetector.start(s=>{this.state.setSpeakingWhileMuted(s.isSoundDetected)});this.soundDetectorCleanup=()=>{n(),this.rnSpeechDetector=void 0}}else{const n=await this.getStream({deviceId:{exact:e}});this.soundDetectorCleanup=Gb(n,s=>{this.state.setSpeakingWhileMuted(s.isSoundDetected)})}})}async stopSpeakingWhileMutedDetection(){await Qe(this.soundDetectorConcurrencyTag,async()=>{if(!this.soundDetectorCleanup)return;const e=this.soundDetectorCleanup;this.soundDetectorCleanup=void 0,this.state.setSpeakingWhileMuted(!1),await e()})}}class zb extends vo{constructor(){super(...arguments),this.audioEnabledSubject=new te(!0),this.settingsSubject=new te(void 0),this.audioEnabled$=this.audioEnabledSubject.asObservable().pipe(Je()),this.settings$=this.settingsSubject.asObservable(),this.getDeviceIdFromStream=e=>{const[n]=e.getTracks();return n==null?void 0:n.getSettings().deviceId}}get audioEnabled(){return this.getCurrentValue(this.audioEnabled$)}setAudioEnabled(e){this.setCurrentValue(this.audioEnabledSubject,e)}get settings(){return this.getCurrentValue(this.settings$)}setSettings(e){this.setCurrentValue(this.settingsSubject,e)}}class Yb extends bo{constructor(e){super(e,new zb,O.SCREEN_SHARE),this.subscriptions.push(ct(e.state.settings$,n=>{const s=n==null?void 0:n.screensharing.target_resolution;s&&this.setDefaultConstraints({video:{width:s.width,height:s.height}})}))}enableScreenShareAudio(){this.state.setAudioEnabled(!0)}async disableScreenShareAudio(){var e;this.state.setAudioEnabled(!1),(e=this.call.publisher)!=null&&e.isPublishing(O.SCREEN_SHARE_AUDIO)&&await this.call.stopPublish(O.SCREEN_SHARE_AUDIO)}getSettings(){return this.state.settings}setSettings(e){this.state.setSettings(e)}getDevices(){return Gs([])}getStream(e){return this.state.audioEnabled||(e.audio=!1),Fb(e)}async stopPublishStream(){return this.call.stopPublish(O.SCREEN_SHARE,O.SCREEN_SHARE_AUDIO)}async select(){throw new Error("This method is not supported in for Screen Share")}}class Xb{constructor(){this.selectedDeviceSubject=new te(""),this.volumeSubject=new te(1),this.isDeviceSelectionSupported=Db(),this.getCurrentValue=ut,this.setCurrentValue=wt,this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe(Je()),this.volume$=this.volumeSubject.asObservable().pipe(Je())}get selectedDevice(){return this.getCurrentValue(this.selectedDevice$)}get volume(){return this.getCurrentValue(this.volume$)}setDevice(e){this.setCurrentValue(this.selectedDeviceSubject,e)}setVolume(e){this.setCurrentValue(this.volumeSubject,e)}}class Zb{constructor(e){this.state=new Xb,this.subscriptions=[],this.dispose=()=>{this.subscriptions.forEach(n=>n.unsubscribe())},this.call=e,ni&&!Le()&&this.subscriptions.push(rn([ni,this.state.selectedDevice$]).subscribe(([n,s])=>{if(!s)return;n.find(r=>r.deviceId===s&&r.kind==="audiooutput")||this.select("")}))}listDevices(){if(Le())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");return jb()}select(e){if(Le())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");this.state.setDevice(e)}setVolume(e){if(Le())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(e&&(e<0||e>1))throw new Error("Volume must be between 0 and 1");this.state.setVolume(e)}setParticipantVolume(e,n){if(Le())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(n&&(n<0||n>1))throw new Error("Volume must be between 0 and 1, or undefined");this.call.state.updateParticipant(e,{audioVolume:n})}}class An{constructor({type:e,id:n,streamClient:s,members:i,ownCapabilities:r,sortParticipantsBy:o,clientStore:a,ringing:l=!1,watching:u=!1}){this.state=new Wl,this.permissionsContext=new Ob,this.dispatcher=new pg,this.sfuClientTag=0,this.reconnectConcurrencyTag=Symbol("reconnectConcurrencyTag"),this.reconnectAttempts=0,this.reconnectStrategy=se.UNSPECIFIED,this.reconnectReason="",this.fastReconnectDeadlineSeconds=0,this.disconnectionTimeoutSeconds=0,this.lastOfflineTimestamp=0,this.trackPublishOrder=[],this.hasJoinedOnce=!1,this.deviceSettingsAppliedOnce=!1,this.initialized=!1,this.joinLeaveConcurrencyTag=Symbol("joinLeaveConcurrencyTag"),this.leaveCallHooks=new Set,this.streamClientEventHandlers=new Map,this.setup=async()=>{await Qe(this.joinLeaveConcurrencyTag,async()=>{this.initialized||(this.leaveCallHooks.add(this.on("all",c=>{this.state.updateFromEvent(c)})),this.leaveCallHooks.add(this.on("changePublishOptions",c=>{this.currentPublishOptions=c.publishOptions})),this.leaveCallHooks.add(Ib(this,this.dispatcher)),this.registerEffects(),this.registerReconnectHandlers(),this.state.callingState===M.LEFT&&this.state.setCallingState(M.IDLE),this.initialized=!0)})},this.registerEffects=()=>{this.leaveCallHooks.add(ct(this.state.settings$,c=>{c&&this.permissionsContext.setCallSettings(c)})),this.leaveCallHooks.add(wi(this.state.ownCapabilities$,this.handleOwnCapabilitiesUpdated)),this.leaveCallHooks.add(ct(this.state.blockedUserIds$,async c=>{if(!c||c.length===0)return;const h=this.currentUserId;h&&c.includes(h)&&(this.logger("info","Leaving call because of being blocked"),await this.leave({reason:"user blocked"}).catch(m=>{this.logger("error","Error leaving call after being blocked",m)}))})),this.leaveCallHooks.add(ct(this.state.session$,c=>{var v;if(!this.ringing)return;const h=(v=this.clientStore.connectedUser)==null?void 0:v.id;if(!h)return;const m=!!(c!=null&&c.accepted_by[h]),p=!!(c!=null&&c.rejected_by[h]);(m||p)&&this.cancelAutoDrop(),(m&&this.state.callingState===M.RINGING||p)&&!bg(this.joinLeaveConcurrencyTag)&&this.leave().catch(()=>{this.logger("error","Could not leave a call that was accepted or rejected elsewhere")})})),this.leaveCallHooks.add(ct(this.ringingSubject,c=>{var T,w;if(!c)return;const h=this.state.session,m=(T=this.clientStore.connectedUser)==null?void 0:T.id,p=h==null?void 0:h.ended_at,g=(w=this.state.createdBy)==null?void 0:w.id,v=h==null?void 0:h.rejected_by,C=h==null?void 0:h.accepted_by;let S=!1;p?S=!0:g&&v?v[g]&&(S=!0):m&&v?v[m]&&(S=!0):m&&C&&C[m]&&(S=!0),S?this.state.callingState!==M.IDLE&&this.state.setCallingState(M.IDLE):(this.state.callingState===M.IDLE&&this.state.setCallingState(M.RINGING),this.scheduleAutoDrop(),this.leaveCallHooks.add(Zl(this)))}))},this.handleOwnCapabilitiesUpdated=async c=>{if(this.permissionsContext.setPermissions(c),!this.publisher)return;const h={[z.SEND_AUDIO]:O.AUDIO,[z.SEND_VIDEO]:O.VIDEO,[z.SCREENSHARE]:O.SCREEN_SHARE};for(const[m,p]of Object.entries(h))if(!this.permissionsContext.hasPermission(m))try{switch(p){case O.AUDIO:this.microphone.enabled&&await this.microphone.disable();break;case O.VIDEO:this.camera.enabled&&await this.camera.disable();break;case O.SCREEN_SHARE:this.screenShare.enabled&&await this.screenShare.disable();break}}catch(v){this.logger("error","Can't disable mic/camera/screenshare after revoked permissions",v)}},this.on=(c,h)=>{if(ba(c))return this.dispatcher.on(c,h);const m=this.streamClient.on(c,p=>{const g=p;g.call_cid&&g.call_cid===this.cid&&h(g)});return this.streamClientEventHandlers.set(h,m),()=>{this.off(c,h)}},this.off=(c,h)=>{if(ba(c))return this.dispatcher.off(c,h);const m=this.streamClientEventHandlers.get(h);m&&m()},this.leave=async({reject:c,reason:h="user is leaving the call"}={})=>{await Qe(this.joinLeaveConcurrencyTag,async()=>{var g,v,C,S,T;const m=this.state.callingState;if(m===M.LEFT)throw new Error("Cannot leave call that has already been left.");if(m===M.JOINING&&await new Promise(E=>{this.state.callingState$.pipe(_r(_=>_!==M.JOINED,!0)).subscribe(()=>E())}),m===M.RINGING&&c!==!1)if(c)await this.reject("decline");else{const w=this.state.remoteParticipants.length>0;this.isCreatedByMe&&!w&&await this.reject("cancel")}(g=this.statsReporter)==null||g.stop(),this.statsReporter=void 0,(v=this.sfuStatsReporter)==null||v.stop(),this.sfuStatsReporter=void 0,(C=this.subscriber)==null||C.dispose(),this.subscriber=void 0,(S=this.publisher)==null||S.dispose(),this.publisher=void 0,await((T=this.sfuClient)==null?void 0:T.leaveAndClose(h)),this.sfuClient=void 0,this.dynascaleManager.setSfuClient(void 0),this.state.setCallingState(M.LEFT),this.state.setParticipants([]),this.state.dispose(),this.leaveCallHooks.forEach(w=>w()),this.initialized=!1,this.hasJoinedOnce=!1,this.ringingSubject.next(!1),this.cancelAutoDrop(),this.clientStore.unregisterCall(this),this.camera.dispose(),this.microphone.dispose(),this.screenShare.dispose(),this.speaker.dispose();const p=[];this.camera.stopOnLeave&&p.push(this.camera.disable(!0)),this.microphone.stopOnLeave&&p.push(this.microphone.disable(!0)),this.screenShare.stopOnLeave&&p.push(this.screenShare.disable(!0)),await Promise.all(p)})},this.updateFromRingingEvent=async c=>{await this.setup();const{created_by:h,settings:m}=c.call,p=this.state.members.find(v=>v.user.id===h.id);p?this.state.setMembers([p,...c.members]):this.state.setMembers(c.members),this.state.updateFromCallResponse(c.call),this.watching=!0,this.ringingSubject.next(!0);const g=this.clientStore.calls.filter(v=>v.cid!==this.cid);this.clientStore.setCalls([this,...g]),await this.applyDeviceConfig(m,!1)},this.get=async c=>{await this.setup();const h=await this.streamClient.get(this.streamClientBasePath,c);return this.state.updateFromCallResponse(h.call),this.state.setMembers(h.members),this.state.setOwnCapabilities(h.own_capabilities),c!=null&&c.ring&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(h.call.settings,!1),h},this.getOrCreate=async c=>{await this.setup();const h=await this.streamClient.post(this.streamClientBasePath,c);return this.state.updateFromCallResponse(h.call),this.state.setMembers(h.members),this.state.setOwnCapabilities(h.own_capabilities),c!=null&&c.ring&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(h.call.settings,!1),h},this.create=async c=>this.getOrCreate(c),this.delete=async(c={})=>this.streamClient.post(`${this.streamClientBasePath}/delete`,c),this.ring=async()=>await this.get({ring:!0}),this.notify=async()=>await this.get({notify:!0}),this.accept=async()=>this.streamClient.post(`${this.streamClientBasePath}/accept`),this.reject=async(c="decline")=>this.streamClient.post(`${this.streamClientBasePath}/reject`,{reason:c}),this.join=async({maxJoinRetries:c=3,...h}={})=>{await this.setup();const m=this.state.callingState;if([M.JOINED,M.JOINING].includes(m))throw new Error("Illegal State: call.join() shall be called only once");this.state.setCallingState(M.JOINING),c=Math.max(c,1);for(let p=0;p<c;p++){try{return this.logger("trace",`Joining call (${p})`,this.cid),await this.doJoin(h)}catch(g){if(this.logger("warn",`Failed to join call (${p})`,this.cid),p===c-1)throw this.state.setCallingState(m),g}await Kt(rs(p))}},this.doJoin=async c=>{var A,q,N,U;const h=Date.now(),m=this.state.callingState;this.joinCallData=c,this.logger("debug","Starting join flow"),this.state.setCallingState(M.JOINING);const p=this.reconnectStrategy===se.MIGRATE,g=this.reconnectStrategy===se.REJOIN,v=this.reconnectStrategy===se.FAST;let C=(A=this.sfuStatsReporter)==null?void 0:A.options;if(!this.credentials||!C||g||p)try{const L=await this.doJoinRequest(c);this.credentials=L.credentials,C=L.stats_options}catch(L){throw this.state.callingState===M.OFFLINE||this.state.setCallingState(m),L}const S=this.sfuClient,T=S==null?void 0:S.sessionId,w=!!(S!=null&&S.isHealthy),E=g||p||!w?new lt({logTag:String(++this.sfuClientTag),dispatcher:this.dispatcher,credentials:this.credentials,streamClient:this.streamClient,enableTracing:C.enable_rtc_stats,sessionId:g?void 0:T,onSignalClose:L=>this.handleSfuSignalClose(E,L)}):S;this.sfuClient=E,this.dynascaleManager.setSfuClient(E);const _=await wa();if(S!==E){const[L,D]=await Promise.all([ga("recvonly"),ga("sendonly")]),R=this.reconnectStrategy!==se.UNSPECIFIED,x=R?this.getReconnectDetails(c==null?void 0:c.migrating_from,T):void 0,$=R?this.currentPublishOptions||[]:this.getPreferredPublishOptions(),j=R?[]:this.getPreferredSubscribeOptions();try{const{callState:k,fastReconnectDeadlineSeconds:V,publishOptions:X}=await E.join({subscriberSdp:L,publisherSdp:D,clientDetails:_,fastReconnect:v,reconnectDetails:x,preferredPublishOptions:$,preferredSubscribeOptions:j});this.currentPublishOptions=X,this.fastReconnectDeadlineSeconds=V,k&&this.state.updateFromSfuCallState(k,E.sessionId,x)}catch(k){throw this.logger("warn","Join SFU request failed",k),E.close(lt.ERROR_CONNECTION_UNHEALTHY,"Join request failed, connection considered unhealthy"),this.state.setCallingState(m),k}}if(p||this.state.setCallingState(M.JOINED),this.hasJoinedOnce=!0,v)await this.restoreICE(E,{includeSubscriber:!1});else{const L=rb(this.credentials.ice_servers);this.initPublisherAndSubscriber({sfuClient:E,connectionConfig:L,clientDetails:_,statsOptions:C,publishOptions:this.currentPublishOptions||[],closePreviousInstances:!p})}if(!g&&!v&&!p&&((q=this.sfuStatsReporter)==null||q.sendConnectionTime((Date.now()-h)/1e3)),g){const L=se[this.reconnectStrategy];await(S==null?void 0:S.leaveAndClose(`Closing previous WS after reconnect with strategy: ${L}`))}else w||S==null||S.close(lt.DISPOSE_OLD_SOCKET,"Closing unhealthy WS after reconnect");!this.deviceSettingsAppliedOnce&&this.state.settings&&(await this.applyDeviceConfig(this.state.settings,!0),this.deviceSettingsAppliedOnce=!0),(N=this.joinCallData)==null||delete N.ring,(U=this.joinCallData)==null||delete U.notify,this.reconnectStrategy=se.UNSPECIFIED,this.reconnectReason="",this.logger("info",`Joined call ${this.cid}`)},this.getReconnectDetails=(c,h)=>{var v;const m=this.reconnectStrategy,p=m===se.REJOIN,g=((v=this.publisher)==null?void 0:v.getAnnouncedTracksForReconnect())||[];return{strategy:m,announcedTracks:g,subscriptions:this.dynascaleManager.trackSubscriptions,reconnectAttempt:this.reconnectAttempts,fromSfuId:c||"",previousSessionId:p&&h||"",reason:this.reconnectReason}},this.getPreferredPublishOptions=()=>{const{preferredCodec:c,fmtpLine:h,preferredBitrate:m,maxSimulcastLayers:p}=this.clientPublishOptions||{};if(!c&&!m&&!p)return[];const g=c?Zt.create({name:c.split("/").pop(),fmtp:h}):void 0,v=[kn.create({trackType:O.VIDEO,codec:g,bitrate:m,maxSpatialLayers:p})],C=this.screenShare.getSettings();return C&&v.push(kn.create({trackType:O.SCREEN_SHARE,fps:C.maxFramerate,bitrate:C.maxBitrate})),v},this.getPreferredSubscribeOptions=()=>{const{subscriberCodec:c,subscriberFmtpLine:h}=this.clientPublishOptions||{};return!c||!h?[]:[ro.create({trackType:O.VIDEO,codecs:[{name:c.split("/").pop(),fmtp:h}]})]},this.restoreICE=async(c,h={})=>{const{includeSubscriber:m=!0,includePublisher:p=!0}=h;this.subscriber&&(this.subscriber.setSfuClient(c),m&&await this.subscriber.restartIce()),this.publisher&&(this.publisher.setSfuClient(c),p&&await this.publisher.restartIce())},this.initPublisherAndSubscriber=c=>{var w,E,_;const{sfuClient:h,connectionConfig:m,clientDetails:p,statsOptions:g,publishOptions:v,closePreviousInstances:C}=c,{enable_rtc_stats:S}=g;C&&this.subscriber&&this.subscriber.dispose(),this.subscriber=new sb({sfuClient:h,dispatcher:this.dispatcher,state:this.state,connectionConfig:m,logTag:String(this.sfuClientTag),clientDetails:p,enableTracing:S,onUnrecoverableError:A=>{this.reconnect(se.REJOIN,A).catch(q=>{this.logger("warn",`[Reconnect] Error reconnecting after a subscriber error: ${A}`,q)})}}),((w=this.streamClient.user)==null?void 0:w.type)==="anonymous"||(C&&this.publisher&&this.publisher.dispose(),this.publisher=new nb({sfuClient:h,dispatcher:this.dispatcher,state:this.state,connectionConfig:m,publishOptions:v,logTag:String(this.sfuClientTag),clientDetails:p,enableTracing:S,onUnrecoverableError:A=>{this.reconnect(se.REJOIN,A).catch(q=>{this.logger("warn",`[Reconnect] Error reconnecting after a publisher error: ${A}`,q)})}})),Wn.setEnabled(S),(E=this.statsReporter)==null||E.stop(),this.statsReporter=Pg({subscriber:this.subscriber,publisher:this.publisher,state:this.state,datacenter:h.edgeName}),(_=this.sfuStatsReporter)==null||_.stop(),(g==null?void 0:g.reporting_interval_ms)>0&&(this.sfuStatsReporter=new Vg(h,{clientDetails:p,options:g,subscriber:this.subscriber,publisher:this.publisher,microphone:this.microphone,camera:this.camera,state:this.state}),this.sfuStatsReporter.start())},this.doJoinRequest=async c=>{const h=await this.streamClient.getLocationHint(),m={...c,location:h},p=await this.streamClient.post(`${this.streamClientBasePath}/join`,m);return this.state.updateFromCallResponse(p.call),this.state.setMembers(p.members),this.state.setOwnCapabilities(p.own_capabilities),c!=null&&c.ring&&this.ringingSubject.next(!0),!(this.reconnectStrategy!==se.UNSPECIFIED)&&this.ringing&&!this.isCreatedByMe&&await this.accept(),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),p},this.handleSfuSignalClose=(c,h)=>{this.logger("debug","[Reconnect] SFU signal connection closed");const{callingState:m}=this.state;m===M.JOINING||m===M.RECONNECTING||m===M.IDLE||m===M.LEFT||c.isLeaving||c.isClosing||this.reconnect(se.REJOIN,h).catch(p=>{this.logger("warn","[Reconnect] Error reconnecting",p)})},this.reconnect=async(c,h)=>{if(!(this.state.callingState===M.RECONNECTING||this.state.callingState===M.RECONNECTING_FAILED))return Qe(this.reconnectConcurrencyTag,async()=>{var p;this.logger("info",`[Reconnect] Reconnecting with strategy ${se[c]}`);const m=Date.now();this.reconnectStrategy=c,this.reconnectReason=h;do{if(this.disconnectionTimeoutSeconds>0&&(Date.now()-m)/1e3>this.disconnectionTimeoutSeconds){this.logger("warn","[Reconnect] Stopping reconnection attempts after reaching disconnection timeout"),this.state.setCallingState(M.RECONNECTING_FAILED);return}this.reconnectStrategy!==se.FAST&&this.reconnectAttempts++;const g=se[this.reconnectStrategy];try{switch(await((p=this.networkAvailableTask)==null?void 0:p.promise),this.reconnectStrategy){case se.UNSPECIFIED:case se.DISCONNECT:this.logger("debug",`[Reconnect] No-op strategy ${g}`);break;case se.FAST:await this.reconnectFast();break;case se.REJOIN:await this.reconnectRejoin();break;case se.MIGRATE:await this.reconnectMigrate();break;default:Xn(this.reconnectStrategy,"Unknown reconnection strategy");break}break}catch(v){if(this.state.callingState===M.OFFLINE){this.logger("trace","[Reconnect] Can't reconnect while offline, stopping reconnection attempts");break}if(v instanceof El&&v.unrecoverable){this.logger("warn","[Reconnect] Can't reconnect due to coordinator unrecoverable error",v),this.state.setCallingState(M.RECONNECTING_FAILED);return}this.logger("warn",`[Reconnect] ${g} (${this.reconnectAttempts}) failed. Attempting with REJOIN`,v),await Kt(500),this.reconnectStrategy=se.REJOIN}}while(this.state.callingState!==M.JOINED&&this.state.callingState!==M.RECONNECTING_FAILED&&this.state.callingState!==M.LEFT)})},this.reconnectFast=async()=>{var h;const c=Date.now();this.reconnectStrategy=se.FAST,this.state.setCallingState(M.RECONNECTING),await this.doJoin(this.joinCallData),(h=this.sfuStatsReporter)==null||h.sendReconnectionTime(se.FAST,(Date.now()-c)/1e3)},this.reconnectRejoin=async()=>{var h;const c=Date.now();this.reconnectStrategy=se.REJOIN,this.state.setCallingState(M.RECONNECTING),await this.doJoin(this.joinCallData),await this.restorePublishedTracks(),this.restoreSubscribedTracks(),(h=this.sfuStatsReporter)==null||h.sendReconnectionTime(se.REJOIN,(Date.now()-c)/1e3)},this.reconnectMigrate=async()=>{var v,C;const c=Date.now(),h=this.sfuClient;if(!h)throw new Error("Cannot migrate without an active SFU client");this.reconnectStrategy=se.MIGRATE,this.state.setCallingState(M.MIGRATING);const m=this.subscriber,p=this.publisher;m==null||m.detachEventHandlers(),p==null||p.detachEventHandlers();const g=Zn(h.enterMigration());try{const S=h.edgeName;await this.doJoin({...this.joinCallData,migrating_from:S})}finally{(v=this.joinCallData)==null||delete v.migrating_from}await this.restorePublishedTracks(),this.restoreSubscribedTracks();try{await g(),this.state.setCallingState(M.JOINED)}finally{m==null||m.dispose(),p==null||p.dispose(),h.close(lt.NORMAL_CLOSURE,"Migrating away")}(C=this.sfuStatsReporter)==null||C.sendReconnectionTime(se.MIGRATE,(Date.now()-c)/1e3)},this.registerReconnectHandlers=()=>{const c=this.on("goAway",()=>{this.reconnect(se.MIGRATE,"goAway").catch(p=>this.logger("warn","[Reconnect] Error reconnecting",p))}),h=this.on("error",p=>{const{reconnectStrategy:g,error:v}=p;g!==se.UNSPECIFIED&&(g===se.DISCONNECT?this.leave({reason:"SFU instructed to disconnect"}).catch(C=>{this.logger("warn","Can't leave call after disconnect request",C)}):this.reconnect(g,(v==null?void 0:v.message)||"SFU Error").catch(C=>{this.logger("warn","[Reconnect] Error reconnecting",C)}))}),m=this.streamClient.on("network.changed",p=>{var g,v,C,S;if(p.online)this.logger("debug","[Reconnect] Going online"),(v=this.sfuClient)==null||v.close(lt.DISPOSE_OLD_SOCKET,"Closing WS to reconnect after going online"),(C=this.networkAvailableTask)==null||C.resolve(),this.networkAvailableTask=void 0,(S=this.sfuStatsReporter)==null||S.start();else{if(this.logger("debug","[Reconnect] Going offline"),!this.hasJoinedOnce)return;this.lastOfflineTimestamp=Date.now();const T=jn();T.promise.then(()=>{let w=se.FAST;this.lastOfflineTimestamp&&(Date.now()-this.lastOfflineTimestamp)/1e3>this.fastReconnectDeadlineSeconds&&(w=se.REJOIN),this.reconnect(w,"Going online").catch(E=>{this.logger("warn","[Reconnect] Error reconnecting after going online",E)})}),this.networkAvailableTask=T,(g=this.sfuStatsReporter)==null||g.stop(),this.state.setCallingState(M.OFFLINE)}});this.leaveCallHooks.add(c).add(h).add(m)},this.restorePublishedTracks=async()=>{for(const c of this.trackPublishOrder){let h;switch(c){case O.AUDIO:h=this.microphone.state.mediaStream;break;case O.VIDEO:h=this.camera.state.mediaStream;break;case O.SCREEN_SHARE:h=this.screenShare.state.mediaStream;break;case O.SCREEN_SHARE_AUDIO:case O.UNSPECIFIED:break;default:Xn(c,"Unknown track type");break}h&&await this.publish(h,c)}},this.restoreSubscribedTracks=()=>{const{remoteParticipants:c}=this.state;c.length<=0||this.dynascaleManager.applyTrackSubscriptions(void 0)},this.publishVideoStream=async c=>{await this.publish(c,O.VIDEO)},this.publishAudioStream=async c=>{await this.publish(c,O.AUDIO)},this.publishScreenShareStream=async c=>{await this.publish(c,O.SCREEN_SHARE)},this.publish=async(c,h)=>{if(!this.sfuClient)throw new Error("Call not joined yet.");if(await this.sfuClient.joinTask,!this.permissionsContext.canPublish(h))throw new Error(`No permission to publish ${O[h]}`);if(!this.publisher)throw new Error("Publisher is not initialized");const[m]=po(h)?c.getAudioTracks():c.getVideoTracks();if(!m)throw new Error(`There is no ${O[h]} track in the stream`);if(m.readyState==="ended")throw new Error("Can't publish ended tracks.");As(this.trackPublishOrder,h),await this.publisher.publish(m,h);const p=[h];if(h===O.SCREEN_SHARE){const[g]=c.getAudioTracks();g&&(As(this.trackPublishOrder,O.SCREEN_SHARE_AUDIO),await this.publisher.publish(g,O.SCREEN_SHARE_AUDIO),p.push(O.SCREEN_SHARE_AUDIO))}await this.updateLocalStreamState(c,...p)},this.stopPublish=async(...c)=>{!this.sfuClient||!this.publisher||(this.publisher.stopTracks(...c),await this.updateLocalStreamState(void 0,...c))},this.updateLocalStreamState=async(c,...h)=>{if(!this.sfuClient||!this.sfuClient.sessionId)return;await this.notifyTrackMuteState(!c,...h);const{sessionId:m}=this.sfuClient;for(const p of h){const g=fo(p);g&&this.state.updateParticipant(m,v=>({publishedTracks:c?As([...v.publishedTracks],p):v.publishedTracks.filter(C=>C!==p),[g]:c}))}},this.updatePublishOptions=c=>{this.logger("warn","[call.updatePublishOptions]: You are manually overriding the publish options for this call. This is not recommended, and it can cause call stability/compatibility issues. Use with caution."),this.state.callingState===M.JOINED&&this.logger("warn","Updating publish options after joining the call does not have an effect"),this.clientPublishOptions={...this.clientPublishOptions,...c}},this.notifyNoiseCancellationStarting=async()=>{var c;return(c=this.sfuClient)==null?void 0:c.startNoiseCancellation().catch(h=>{this.logger("warn","Failed to notify start of noise cancellation",h)})},this.notifyNoiseCancellationStopped=async()=>{var c;return(c=this.sfuClient)==null?void 0:c.stopNoiseCancellation().catch(h=>{this.logger("warn","Failed to notify stop of noise cancellation",h)})},this.notifyTrackMuteState=async(c,...h)=>{this.sfuClient&&await this.sfuClient.updateMuteStates(h.map(m=>({trackType:m,muted:c})))},this.startReportingStatsFor=c=>{var h;return(h=this.statsReporter)==null?void 0:h.startReportingStatsFor(c)},this.stopReportingStatsFor=c=>{var h;return(h=this.statsReporter)==null?void 0:h.stopReportingStatsFor(c)},this.resetReaction=c=>{this.state.updateParticipant(c,{reaction:void 0})},this.setSortParticipantsBy=c=>this.state.setSortParticipantsBy(c),this.sendReaction=async c=>this.streamClient.post(`${this.streamClientBasePath}/reaction`,c),this.blockUser=async c=>this.streamClient.post(`${this.streamClientBasePath}/block`,{user_id:c}),this.unblockUser=async c=>this.streamClient.post(`${this.streamClientBasePath}/unblock`,{user_id:c}),this.muteSelf=c=>{const h=this.currentUserId;if(h)return this.muteUser(h,c)},this.muteOthers=c=>{const h=Gg(c);if(!h)return;const m=[];for(const p of this.state.remoteParticipants)p.publishedTracks.includes(h)&&m.push(p.userId);if(m.length>0)return this.muteUser(m,c)},this.muteUser=(c,h)=>this.streamClient.post(`${this.streamClientBasePath}/mute_users`,{user_ids:Array.isArray(c)?c:[c],[h]:!0}),this.muteAllUsers=c=>this.streamClient.post(`${this.streamClientBasePath}/mute_users`,{mute_all_users:!0,[c]:!0}),this.startRecording=async c=>this.streamClient.post(`${this.streamClientBasePath}/start_recording`,c||{}),this.stopRecording=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_recording`,{}),this.startTranscription=async c=>this.streamClient.post(`${this.streamClientBasePath}/start_transcription`,c),this.stopTranscription=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_transcription`),this.startClosedCaptions=async c=>{const h=this.state.setCaptioning(!0);try{return await this.streamClient.post(`${this.streamClientBasePath}/start_closed_captions`,c)}catch(m){throw h.rollback(),m}},this.stopClosedCaptions=async c=>{const h=this.state.setCaptioning(!1);try{return await this.streamClient.post(`${this.streamClientBasePath}/stop_closed_captions`,c)}catch(m){throw h.rollback(),m}},this.updateClosedCaptionSettings=c=>{this.state.updateClosedCaptionSettings(c)},this.requestPermissions=async c=>{const{permissions:h}=c;if(!h.every(p=>this.permissionsContext.canRequest(p)))throw new Error(`You are not allowed to request permissions: ${h.join(", ")}`);return this.streamClient.post(`${this.streamClientBasePath}/request_permission`,c)},this.grantPermissions=async(c,h)=>this.updateUserPermissions({user_id:c,grant_permissions:h}),this.revokePermissions=async(c,h)=>this.updateUserPermissions({user_id:c,revoke_permissions:h}),this.updateUserPermissions=async c=>this.streamClient.post(`${this.streamClientBasePath}/user_permissions`,c),this.goLive=async(c={},h)=>this.streamClient.post(`${this.streamClientBasePath}/go_live`,c,h),this.stopLive=async(c={})=>this.streamClient.post(`${this.streamClientBasePath}/stop_live`,c),this.startHLS=async()=>this.streamClient.post(`${this.streamClientBasePath}/start_broadcasting`,{}),this.stopHLS=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_broadcasting`,{}),this.startRTMPBroadcasts=async c=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts`,c),this.stopAllRTMPBroadcasts=async()=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts/stop`),this.stopRTMPBroadcast=async c=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts/${c}/stop`),this.startFrameRecording=async c=>this.streamClient.post(`${this.streamClientBasePath}/start_frame_recording`,c),this.stopFrameRecording=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_frame_recording`),this.update=async c=>{const h=await this.streamClient.patch(`${this.streamClientBasePath}`,c),{call:m,members:p,own_capabilities:g}=h;return this.state.updateFromCallResponse(m),this.state.setMembers(p),this.state.setOwnCapabilities(g),h},this.endCall=async()=>this.streamClient.post(`${this.streamClientBasePath}/mark_ended`),this.pin=c=>{this.state.updateParticipant(c,{pin:{isLocalPin:!0,pinnedAt:Date.now()}})},this.unpin=c=>{this.state.updateParticipant(c,{pin:void 0})},this.pinForEveryone=async c=>this.streamClient.post(`${this.streamClientBasePath}/pin`,c),this.unpinForEveryone=async c=>this.streamClient.post(`${this.streamClientBasePath}/unpin`,c),this.queryMembers=c=>this.streamClient.post("/call/members",{...c||{},id:this.id,type:this.type}),this.updateCallMembers=async c=>this.streamClient.post(`${this.streamClientBasePath}/members`,c),this.scheduleAutoDrop=()=>{this.cancelAutoDrop();const c=this.state.settings;if(!c||this.state.callingState!==M.RINGING)return;const h=this.isCreatedByMe?c.ring.auto_cancel_timeout_ms:c.ring.incoming_call_timeout_ms;h<=0||(this.dropTimeout=setTimeout(()=>{this.state.callingState===M.RINGING&&this.leave({reject:!0,reason:"timeout"}).catch(m=>{this.logger("error","Failed to drop call",m)})},h))},this.cancelAutoDrop=()=>{clearTimeout(this.dropTimeout),this.dropTimeout=void 0},this.queryRecordings=async c=>{let h=this.streamClientBasePath;return c&&(h=`${h}/${c}`),this.streamClient.get(`${h}/recordings`)},this.queryTranscriptions=async()=>this.streamClient.get(`${this.streamClientBasePath}/transcriptions`),this.getCallStats=async c=>{const h=`${this.streamClientBasePath}/stats/${c}`;return this.streamClient.get(h)},this.getCallReport=async(c="")=>{const h=`${this.streamClientBasePath}/report`,m=c!==""?{session_id:c}:{};return this.streamClient.get(h,m)},this.submitFeedback=async(c,{reason:h,custom:m}={})=>{var C;const{sdkName:p,sdkVersion:g,...v}=_g(await wa());return this.streamClient.post(`${this.streamClientBasePath}/feedback`,{rating:c,reason:h,user_session_id:(C=this.sfuClient)==null?void 0:C.sessionId,sdk:p,sdk_version:g,custom:{...m,"x-stream-platform-data":v}})},this.sendCustomEvent=async c=>this.streamClient.post(`${this.streamClientBasePath}/event`,{custom:c}),this.applyDeviceConfig=async(c,h)=>{await this.camera.apply(c.video,h).catch(m=>{this.logger("warn","Camera init failed",m)}),await this.microphone.apply(c.audio,h).catch(m=>{this.logger("warn","Mic init failed",m)})},this.trackElementVisibility=(c,h,m)=>this.dynascaleManager.trackElementVisibility(c,h,m),this.setViewport=c=>this.dynascaleManager.setViewport(c),this.bindVideoElement=(c,h,m)=>{const p=this.dynascaleManager.bindVideoElement(c,h,m);if(p)return this.leaveCallHooks.add(p),()=>{this.leaveCallHooks.delete(p),p()}},this.bindAudioElement=(c,h,m="audioTrack")=>{const p=this.dynascaleManager.bindAudioElement(c,h,m);if(p)return this.leaveCallHooks.add(p),()=>{this.leaveCallHooks.delete(p),p()}},this.bindCallThumbnailElement=(c,h={})=>{const m=()=>{c.src=h.fallbackImageSource||"https://getstream.io/random_svg/?name=x&id=x"},p=ct(this.state.thumbnails$,g=>{if(!g)return;c.addEventListener("error",m);const v=new URL(g.image_url);v.searchParams.set("w",String(c.clientWidth)),v.searchParams.set("h",String(c.clientHeight)),c.src=v.toString()});return()=>{p(),c.removeEventListener("error",m)}},this.setPreferredIncomingVideoResolution=(c,h)=>{this.dynascaleManager.setVideoTrackSubscriptionOverrides(c?{enabled:!0,dimension:c}:void 0,h),this.dynascaleManager.applyTrackSubscriptions()},this.setIncomingVideoEnabled=c=>{this.dynascaleManager.setVideoTrackSubscriptionOverrides(c?void 0:{enabled:!1}),this.dynascaleManager.applyTrackSubscriptions()},this.setDisconnectionTimeout=c=>{this.disconnectionTimeoutSeconds=c},this.type=e,this.id=n,this.cid=`${e}:${n}`,this.ringingSubject=new te(l),this.watching=u,this.streamClient=s,this.clientStore=a,this.streamClientBasePath=`/call/${this.type}/${this.id}`,this.logger=he(["Call"]);const d=Ql.get(e),f=o||d.options.sortParticipantsBy;f&&this.state.setSortParticipantsBy(f),this.state.setMembers(i||[]),this.state.setOwnCapabilities(r||[]),this.state.setCallingState(l?M.RINGING:M.IDLE),this.camera=new Vb(this),this.microphone=new Jb(this),this.speaker=new Zb(this),this.screenShare=new Yb(this),this.dynascaleManager=new Pb(this.state,this.speaker)}get ringing(){return ut(this.ringingSubject)}get currentUserId(){var e;return(e=this.clientStore.connectedUser)==null?void 0:e.id}get isCreatedByMe(){var e;return((e=this.state.createdBy)==null?void 0:e.id)===this.currentUserId}}var Qb=null;class ev{constructor(e){this._log=(n,s={},i="info")=>{this.client.logger(i,`connection:${n}`,s)},this.setClient=n=>{this.client=n},this._buildUrl=()=>{const n=new URLSearchParams;return n.set("api_key",this.client.key),n.set("stream-auth-type",this.client.getAuthType()),n.set("X-Stream-Client",this.client.getUserAgent()),`${this.client.wsBaseURL}/connect?${n.toString()}`},this.onlineStatusChanged=n=>{n.type==="offline"?(this._log("onlineStatusChanged() - Status changing to offline"),this._setHealth(!1,!0)):n.type==="online"&&(this._log(`onlineStatusChanged() - Status changing to online. isHealthy: ${this.isHealthy}`),this.isHealthy||this._reconnect({interval:10}))},this.onopen=n=>{var o;if(this.wsID!==n)return;const s=this.client.user;if(!s){this.client.logger("error","User not set, can't connect to WS");return}const i=this.client._getToken();if(!i){this.client.logger("error","Token not set, can't connect authenticate");return}const r=JSON.stringify({token:i,user_details:{id:s.id,name:s.name,image:s.image,custom:s.custom}});this._log(`onopen() - Sending auth message ${r}`,{},"trace"),(o=this.ws)==null||o.send(r),this._log("onopen() - onopen callback",{wsID:n})},this.onmessage=(n,s)=>{var r,o;if(this.wsID!==n)return;this._log("onmessage() - onmessage callback",{event:s,wsID:n});const i=typeof s.data=="string"?JSON.parse(s.data):null;if(!this.isConnectionOpenResolved&&i&&i.type==="connection.error"&&(this.isConnectionOpenResolved=!0,i.error)){(r=this.rejectConnectionOpen)==null||r.call(this,this._errorFromWSEvent(i,!1));return}if(this.lastEvent=new Date,i&&(i.type==="health.check"||i.type==="connection.ok")&&this.scheduleNextPing(),i&&i.type==="connection.ok"&&((o=this.resolveConnectionOpen)==null||o.call(this,i),this._setHealth(!0)),i&&i.type==="connection.error"&&i.error){const{code:a}=i.error;this.isHealthy=!1,this.isConnecting=!1,this.consecutiveFailures+=1,a===mn.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic()&&(clearTimeout(this.connectionCheckTimeoutRef),this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}))}i&&(i.received_at=new Date,this.client.dispatchEvent(i)),this.scheduleConnectionCheck()},this.onclose=(n,s)=>{var i,r;if(this.wsID===n)if(this._log("onclose() - onclose callback - "+s.code,{event:s,wsID:n}),s.code===mn.WS_CLOSED_SUCCESS){const o=new Error(`WS connection reject with error ${s.reason}`);o.reason=s.reason,o.code=s.code,o.wasClean=s.wasClean,o.target=s.target,(i=this.rejectConnectionOpen)==null||i.call(this,o),this._log(`onclose() - WS connection reject with error ${s.reason}`,{event:s})}else this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,(r=this.rejectConnectionOpen)==null||r.call(this,this._errorFromWSEvent(s)),this._log("onclose() - WS connection closed. Calling reconnect ...",{event:s}),this._reconnect()},this.onerror=(n,s)=>{var i;this.wsID===n&&(this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,(i=this.rejectConnectionOpen)==null||i.call(this,new Error(`WebSocket error: ${s}`)),this._log("onerror() - WS connection resulted into error",{event:s}),this._reconnect())},this._setHealth=(n,s=!1)=>{if(n!==this.isHealthy){if(this.isHealthy=n,this.isHealthy||s){this.client.dispatchEvent({type:"connection.changed",online:this.isHealthy});return}setTimeout(()=>{this.isHealthy||this.client.dispatchEvent({type:"connection.changed",online:this.isHealthy})},5e3)}},this._errorFromWSEvent=(n,s=!0)=>{let i,r,o;if(ug(n))i=n.code,o=n.reason,r=0;else{const{error:u}=n;i=u.code,o=u.message,r=u.StatusCode}const a=`WS failed with code: ${i} and reason: ${o}`;this._log(a,{event:n},"warn");const l=new Error(a);return l.code=i,l.StatusCode=r,l.isWSFailure=s,l},this._setupConnectionPromise=()=>{this.isConnectionOpenResolved=!1,this.connectionOpenSafe=Zn(new Promise((n,s)=>{this.resolveConnectionOpen=n,this.rejectConnectionOpen=s}))},this.scheduleNextPing=()=>{const n=ei();this.healthCheckTimeoutRef&&n.clearTimeout(this.healthCheckTimeoutRef),this.healthCheckTimeoutRef=n.setTimeout(()=>{var i;const s=[{type:"health.check",client_id:this.client.clientID}];try{(i=this.ws)==null||i.send(JSON.stringify(s))}catch{}},this.pingInterval)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeoutRef),this.connectionCheckTimeoutRef=setTimeout(()=>{const n=new Date;this.lastEvent&&n.getTime()-this.lastEvent.getTime()>this.connectionCheckTimeout&&(this._log("scheduleConnectionCheck - going to reconnect"),this._setHealth(!1),this._reconnect())},this.connectionCheckTimeout)},this.client=e,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isDisconnected=!1,this.isConnectionOpenResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25*1e3,this.connectionCheckTimeout=this.pingInterval+10*1e3,Ar(this.onlineStatusChanged)}async connect(e=15e3){if(this.isConnecting)throw Error("You've called connect twice, can only attempt 1 connection at the time");this.isDisconnected=!1;try{const n=await this._connect();this.consecutiveFailures=0,this._log(`connect() - Established ws connection with healthcheck: ${n}`)}catch(n){if(this.isHealthy=!1,this.consecutiveFailures+=1,n.code===mn.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0});else if(!n.isWSFailure)throw new Error(JSON.stringify({code:n.code,StatusCode:n.StatusCode,message:n.message,isWSFailure:n.isWSFailure}))}return await this._waitForHealthy(e)}async _waitForHealthy(e=15e3){return Promise.race([(async()=>{for(let s=0;s<=e;s+=50)try{return await this.connectionOpen}catch(i){if(s===e)throw new Error(JSON.stringify({code:i.code,StatusCode:i.StatusCode,message:i.message,isWSFailure:i.isWSFailure}));await Kt(50)}})(),(async()=>{throw await Kt(e),this.isConnecting=!1,new Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}))})()])}disconnect(e){this._log(`disconnect() - Closing the websocket connection for wsID ${this.wsID}`),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&ei().clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),Ul(this.onlineStatusChanged),this.isHealthy=!1;let n;const{ws:s}=this;return s&&s.close&&s.readyState===s.OPEN?(n=new Promise(i=>{const r=o=>{this._log(`disconnect() - resolving isClosedPromise ${o?"with":"without"} close frame`,{event:o}),i()};s.onclose=r,setTimeout(r,e??1e3)}),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),s.close(mn.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),n=Promise.resolve()),delete this.ws,n}async _connect(){var n,s,i,r;if(this.isConnecting)return;this.isConnecting=!0;let e=!1;try{this._log("_connect() - waiting for token"),await this.client.tokenManager.tokenReady(),e=!0}catch{}try{e||(this._log("_connect() - tokenProvider failed before, so going to retry"),await this.client.tokenManager.loadToken()),this.client.isConnectionIsPromisePending||this.client._setupConnectionIdPromise(),this._setupConnectionPromise();const o=this._buildUrl();this._log(`_connect() - Connecting to ${o}`);const a=this.client.options.WebSocketImpl??WebSocket;this.ws=new a(o),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID);const l=await this.connectionOpen;if(this.isConnecting=!1,l)return this.connectionID=l.connection_id,(s=(n=this.client).resolveConnectionId)==null||s.call(n,this.connectionID),l}catch(o){throw this.client._setupConnectionIdPromise(),this.isConnecting=!1,this._log("_connect() - Error - ",o),(r=(i=this.client).rejectConnectionId)==null||r.call(i,o),o}}async _reconnect(e={}){if(this._log("_reconnect() - Initiating the reconnect"),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (1) since already connecting or healthy");return}let n=e.interval;if(n||(n=rs(this.consecutiveFailures)),await Kt(n),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (2) since already connecting or healthy");return}if(this.isDisconnected){this._log("_reconnect() - Abort (3) since disconnect() is called");return}this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),e.refreshToken&&await this.client.tokenManager.loadToken();try{await this._connect(),this._log("_reconnect() - Waiting for recoverCallBack"),this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0}catch(s){if(this.isHealthy=!1,this.consecutiveFailures+=1,s.code===mn.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0});s.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect())}this._log("_reconnect() - == END ==")}_destroyCurrentWSConnection(){var e;this.wsID+=1;try{(e=this==null?void 0:this.ws)==null||e.close()}catch{}}get connectionOpen(){var e;return(e=this.connectionOpenSafe)==null?void 0:e.call(this)}}function tv(t){const e=t.split(".");if(e.length!==3)return"";const n=e[1],s=nv(n);return JSON.parse(s).user_id}const nv=t=>{const e={},n=String.fromCharCode,s=t.length;let i,r=0,o,a,l=0,u,d="";const f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(i=0;i<64;i++)e[f.charAt(i)]=i;for(a=0;a<s;a++)for(o=e[t.charAt(a)],r=(r<<6)+o,l+=6;l>=8;)((u=r>>>(l-=8)&255)||a<s-2)&&(d+=n(u));return d};class sv{constructor(e){this.loadTokenPromise=null,this.type="static",this.setTokenOrProvider=async(n,s,i)=>{this.user=s,this.isAnonymous=i,this.validateToken(n),Or(n)&&(this.tokenProvider=n,this.type="provider"),typeof n=="string"&&(this.token=n,this.type="static"),await this.loadToken()},this.reset=()=>{this.token=void 0,this.tokenProvider=void 0,this.type="static",this.user=void 0,this.loadTokenPromise=null},this.validateToken=n=>{if(!(this.user&&this.isAnonymous&&!n)){if(!this.secret&&!n)throw new Error("User token can not be empty");if(typeof n!="string"&&!Or(n))throw new Error("User token should either be a string or a function");if(typeof n=="string"){if(this.isAnonymous&&n==="")return;const s=tv(n);if(n!=null&&(s==null||s===""||!this.isAnonymous&&s!==this.user.id))throw new Error("userToken does not have a user_id or is not matching with user.id")}}},this.tokenReady=()=>this.loadTokenPromise,this.loadToken=()=>(this.loadTokenPromise=new Promise(async(n,s)=>{if(this.type==="static")return n(this.token);if(this.tokenProvider&&typeof this.tokenProvider!="string"){try{const i=await this.tokenProvider();this.validateToken(i),this.token=i}catch(i){return s(new Error(`Call to tokenProvider failed with message: ${i}`))}n(this.token)}}),this.loadTokenPromise),this.getToken=()=>{if(this.token)return this.token;if(this.user&&!this.token)return this.token;throw new Error("User token is not set. Either client.connectUser wasn't called or client.disconnect was called")},this.isStatic=()=>this.type==="static",this.secret=e}}const Ia=async(t="https://hint.stream-io-video.com/",e=2e3,n=3)=>{const s=he(["location-hint"]);let i=0,r="ERR";do{const o=new AbortController,a=setTimeout(()=>o.abort(),e);try{const u=(await fetch(t,{method:"HEAD",signal:o.signal})).headers.get("x-amz-cf-pop")||"ERR";s("debug",`Location header: ${u}`),r=u.substring(0,3)}catch(l){s("warn",`Failed to get location hint from ${t}`,l),r="ERR"}finally{clearTimeout(a)}}while(r==="ERR"&&++i<n);return r};class iv{constructor(e,n){var i;this.listeners={},this.getAuthType=()=>this.anonymous?"anonymous":"jwt",this.setBaseURL=r=>{this.baseURL=r,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")},this.getLocationHint=async(r,o)=>{const a=await this.locationHint;return!a||a==="ERR"?(this.locationHint=Ia(r??this.options.locationHintUrl,o??this.options.locationHintTimeout),this.locationHint):a},this._getConnectionID=()=>{var r;return(r=this.wsConnection)==null?void 0:r.connectionID},this._hasConnectionID=()=>!!this._getConnectionID(),this.connectUser=async(r,o)=>{if(!r.id)throw new Error('The "id" field on the user is missing');if(this.userID===r.id&&this.connectUserTask)return this.logger("warn","Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),this.connectUserTask;if(this.userID)throw new Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");(this.secret||this.node)&&!this.options.allowServerSideConnect&&this.logger("warn","Please do not use connectUser server side. Use our @stream-io/node-sdk instead: https://getstream.io/video/docs/api/"),this.userID=r.id,this.anonymous=!1,await this.tokenManager.setTokenOrProvider(o,r,!1),this._setUser(r),this.connectUserTask=this.openConnection();try{return Ar(this.updateNetworkConnectionStatus),await this.connectUserTask}catch(a){throw this.persistUserOnConnectionFailure?await this.closeConnection():await this.disconnectUser(),a}},this._setUser=r=>{this.user=r,this.userID=r.id,this._user={...r}},this.closeConnection=async r=>{var o;await((o=this.wsConnection)==null?void 0:o.disconnect(r))},this.openConnection=async()=>{var a,l,u;if(!this.userID)throw Error("UserWithId is not set on client, use client.connectUser or client.connectAnonymousUser instead");const r=(a=this.wsPromiseSafe)==null?void 0:a.call(this);if((l=this.wsConnection)!=null&&l.isConnecting&&r)return this.logger("info","client:openConnection() - connection already in progress"),await r;if((u=this.wsConnection)!=null&&u.isHealthy&&this._hasConnectionID()){this.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists");return}this._setupConnectionIdPromise(),this.clientID=`${this.userID}--${Nr()}`;const o=this.connect();return this.wsPromiseSafe=Zn(o),await o},this.disconnectUser=async r=>{this.logger("info","client:disconnect() - Disconnecting the client"),delete this.user,delete this._user,delete this.userID,this.anonymous=!1,await this.closeConnection(r),Ul(this.updateNetworkConnectionStatus),this.tokenManager.reset(),this.connectionIdPromiseSafe=void 0,this.rejectConnectionId=void 0,this.resolveConnectionId=void 0},this.connectGuestUser=async r=>{this.guestUserCreatePromise=this.doAxiosRequest("post","/guest",{user:r},{publicEndpoint:!0});const o=await this.guestUserCreatePromise;return this.guestUserCreatePromise.finally(()=>this.guestUserCreatePromise=void 0),this.connectUser(o.user,o.access_token)},this.connectAnonymousUser=async(r,o)=>{var a;Ar(this.updateNetworkConnectionStatus),this._setupConnectionIdPromise(),this.anonymous=!0,await this.tokenManager.setTokenOrProvider(o,r,!0),this._setUser(r),(a=this.resolveConnectionId)==null||a.call(this)},this.on=(r,o)=>{var a;return this.listeners[r]||(this.listeners[r]=[]),this.logger("debug",`Adding listener for ${r} event`),(a=this.listeners[r])==null||a.push(o),()=>{this.off(r,o)}},this.off=(r,o)=>{var a;this.listeners[r]||(this.listeners[r]=[]),this.logger("debug",`Removing listener for ${r} event`),this.listeners[r]=(a=this.listeners[r])==null?void 0:a.filter(l=>l!==o)},this._setupConnectionIdPromise=()=>{this.connectionIdPromiseSafe=Zn(new Promise((r,o)=>{this.resolveConnectionId=r,this.rejectConnectionId=o}))},this._logApiRequest=(r,o,a,l)=>{Dr()==="trace"&&this.logger("trace",`client: ${r} - Request - ${o}`,{payload:a,config:l})},this._logApiResponse=(r,o,a)=>{Dr()==="trace"&&this.logger("trace",`client:${r} - Response - url: ${o} > status ${a.status}`,{response:a})},this._logApiError=(r,o,a)=>{this.logger("error",`client:${r} - Error - url: ${o}`,{url:o,error:a})},this.doAxiosRequest=async(r,o,a,l={})=>{var d,f;if(!l.publicEndpoint){await Promise.all([this.tokenManager.tokenReady(),this.guestUserCreatePromise]);try{await this.connectionIdPromise}catch{await((d=this.wsConnection)==null?void 0:d._waitForHealthy()),await this.connectionIdPromise}}const u=this._enrichAxiosOptions(l);try{let c;switch(this._logApiRequest(r,o,a,u),r){case"get":c=await this.axiosInstance.get(o,u);break;case"delete":c=await this.axiosInstance.delete(o,u);break;case"post":c=await this.axiosInstance.post(o,a,u);break;case"put":c=await this.axiosInstance.put(o,a,u);break;case"patch":c=await this.axiosInstance.patch(o,a,u);break;case"options":c=await this.axiosInstance.options(o,u);break;default:throw new Error("Invalid request type")}return this._logApiResponse(r,o,c),this.consecutiveFailures=0,this.handleResponse(c)}catch(c){if(c.client_request_id=(f=u.headers)==null?void 0:f["x-client-request-id"],this.consecutiveFailures+=1,c.response)return this._logApiError(r,o,c.response),c.response.data.code===mn.TOKEN_EXPIRED&&!this.tokenManager.isStatic()?(this.consecutiveFailures>1&&await Kt(rs(this.consecutiveFailures)),await this.tokenManager.loadToken(),await this.doAxiosRequest(r,o,a,l)):this.handleResponse(c.response);throw this._logApiError(r,o,c),c}},this.get=(r,o)=>this.doAxiosRequest("get",r,null,{params:o}),this.put=(r,o,a)=>this.doAxiosRequest("put",r,o,{params:a}),this.post=(r,o,a)=>this.doAxiosRequest("post",r,o,{params:a}),this.patch=(r,o,a)=>this.doAxiosRequest("patch",r,o,{params:a}),this.delete=(r,o)=>this.doAxiosRequest("delete",r,null,{params:o}),this.errorFromResponse=r=>{const{data:o,status:a}=r,l=new El;return l.message=`Stream error code ${o.code}: ${o.message}`,l.code=o.code,l.unrecoverable=o.unrecoverable,l.response=r,l.status=a,l},this.handleResponse=r=>{const o=r.data;if(lg(r))throw this.errorFromResponse(r);return o},this.dispatchEvent=r=>{if(this.logger("debug",`Dispatching event: ${r.type}`,r),!!this.listeners){for(const o of this.listeners.all||[])o(r);for(const o of this.listeners[r.type]||[])o(r)}},this.connect=async()=>{if(!this.userID||!this._user)throw Error("Call connectUser or connectAnonymousUser before starting the connection");if(!this.wsBaseURL)throw Error("Websocket base url not set");if(!this.clientID)throw Error("clientID is not set");return this.wsConnection=new ev(this),this.logger("info","StreamClient.connect: this.wsConnection.connect()"),await this.wsConnection.connect(this.defaultWSTimeout)},this.getUserAgent=()=>{if(!this.cachedUserAgent){const{clientAppIdentifier:r={}}=this.options,{sdkName:o="js",sdkVersion:a="1.20.0",...l}=r;this.cachedUserAgent=[`stream-video-${o}-v${a}`,...Object.entries(l).map(([u,d])=>`${u}=${d}`),"client_bundle=browser-esm"].join("|")}return this.cachedUserAgent},this._enrichAxiosOptions=(r={params:{},headers:{},config:{}})=>{var l;const o=r.publicEndpoint&&!this.user?void 0:this._getToken(),a=o?{Authorization:o}:void 0;return(l=r.headers)!=null&&l["x-client-request-id"]||(r.headers={...r.headers,"x-client-request-id":Nr()}),{params:{user_id:this.userID,connection_id:this._getConnectionID(),api_key:this.key,...r.params},headers:{...a,"stream-auth-type":r.publicEndpoint&&!this.user?"anonymous":this.getAuthType(),"X-Stream-Client":this.getUserAgent(),...r.headers},...r.config,...this.options.axiosRequestConfig}},this._getToken=()=>this.tokenManager?this.tokenManager.getToken():null,this.updateNetworkConnectionStatus=r=>{r.type==="offline"?(this.logger("debug","device went offline"),this.dispatchEvent({type:"network.changed",online:!1})):r.type==="online"&&(this.logger("debug","device went online"),this.dispatchEvent({type:"network.changed",online:!0}))},this.key=e,this.secret=n==null?void 0:n.secret;const s=n||{browser:typeof window<"u"};this.browser=s.browser||typeof window<"u",this.node=!this.browser,this.browser&&(this.locationHint=Ia(n==null?void 0:n.locationHintUrl,n==null?void 0:n.locationHintTimeout,n==null?void 0:n.locationHintMaxAttempts)),this.options={timeout:5e3,withCredentials:!1,...s},this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new Qb.Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.setBaseURL(this.options.baseURL||"https://video.stream-io-api.com/video"),this.axiosInstance=dd.create({...this.options,baseURL:this.baseURL}),this.wsConnection=null,this.wsPromiseSafe=null,this.connectUserTask=null,this.anonymous=!1,this.persistUserOnConnectionFailure=(i=this.options)==null?void 0:i.persistUserOnConnectionFailure,this.tokenManager=new sv(this.secret),this.consecutiveFailures=0,this.defaultWSTimeout=this.options.defaultWsTimeout??15e3,this.logger=Or(s.logger)?s.logger:()=>null}get connectionIdPromise(){var e;return(e=this.connectionIdPromiseSafe)==null?void 0:e.call(this)}get isConnectionIsPromisePending(){var e;return((e=this.connectionIdPromiseSafe)==null?void 0:e.checkPending())??!1}get wsPromise(){var e;return(e=this.wsPromiseSafe)==null?void 0:e.call(this)}}const ir=(t,e)=>`${t}/${e.id}`,rv=t=>{const e=(t==null?void 0:t.clientAppIdentifier)||{},n=Ug();return n&&(e.sdkName=zt[n.type].toLowerCase(),e.sdkVersion=`${n.major}.${n.minor}.${n.patch}`),e},ov=(t,e)=>{const n=rv(e),s=he(["coordinator"]);return new iv(t,{persistUserOnConnectionFailure:!0,...e,clientAppIdentifier:n,logger:s})},av=t=>{const{token:e,tokenProvider:n}=t;if(e&&n){let s=!1;return async function(){return s?n():(s=!0,e)}}return e||n};class Vt{constructor(e,n){this.effectsRegistered=!1,this.eventHandlersToUnregister=[],this.connectionConcurrencyTag=Symbol("connectionConcurrencyTag"),this.registerClientInstance=(o,a)=>{const l=ir(o,a);Vt._instances.has(l)&&this.logger("warn",`A StreamVideoClient already exists for ${a.id}; Prefer using getOrCreateInstance method`),Vt._instances.set(l,this)},this.registerEffects=()=>{this.effectsRegistered||(this.eventHandlersToUnregister.push(this.on("connection.changed",o=>{if(!o.online)return;const a=this.writeableStateStore.calls.filter(l=>l.watching).map(l=>l.cid);a.length<=0||(this.logger("info",`Rewatching calls ${a.join(", ")}`),this.queryCalls({watch:!0,filter_conditions:{cid:{$in:a}},sort:[{field:"cid",direction:1}]}).catch(l=>{this.logger("error","Failed to re-watch calls",l)}))})),this.eventHandlersToUnregister.push(this.on("call.created",o=>{var d;const{call:a,members:l}=o;if(((d=this.state.connectedUser)==null?void 0:d.id)===a.created_by.id){this.logger("warn","Received `call.created` sent by the current user");return}this.logger("info",`New call created and registered: ${a.cid}`);const u=new An({streamClient:this.streamClient,type:a.type,id:a.id,members:l,clientStore:this.writeableStateStore});u.state.updateFromCallResponse(a),this.writeableStateStore.registerCall(u)})),this.eventHandlersToUnregister.push(this.on("call.ring",async o=>{var d;const{call:a,members:l}=o;if(((d=this.state.connectedUser)==null?void 0:d.id)===a.created_by.id){this.logger("debug","Received `call.ring` sent by the current user so ignoring the event");return}const u=this.writeableStateStore.findCall(a.type,a.id);u?await u.updateFromRingingEvent(o):await new An({streamClient:this.streamClient,type:a.type,id:a.id,members:l,clientStore:this.writeableStateStore,ringing:!0}).get()})),this.effectsRegistered=!0)},this.connectUser=async(o,a)=>{if(o.type==="anonymous")return o.id="!anon",this.connectAnonymousUser(o,a);const l=await Qe(this.connectionConcurrencyTag,async()=>{const u=this.streamClient,{onConnectUserError:d,persistUserOnConnectionFailure:f}=u.options;let{maxConnectUserRetries:c=5}=u.options;c=Math.max(c,1);const h=[];for(let m=0;m<c;m++)try{return this.logger("trace",`Connecting user (${m})`,o),o.type==="guest"?await u.connectGuestUser(o):await u.connectUser(o,a)}catch(p){if(this.logger("warn",`Failed to connect a user (${m})`,p),h.push(p),m===c-1)throw d==null||d(p,h),p;f&&await u.disconnectUser(),await Kt(rs(m))}});return l!=null&&l.me&&this.writeableStateStore.setConnectedUser(l.me),this.registerEffects(),l},this.disconnectUser=async o=>{await Qe(this.connectionConcurrencyTag,async()=>{const{user:a,key:l}=this.streamClient;a&&(await this.streamClient.disconnectUser(o),a.id&&Vt._instances.delete(ir(l,a)),this.eventHandlersToUnregister.forEach(u=>u()),this.eventHandlersToUnregister=[],this.effectsRegistered=!1,this.writeableStateStore.setConnectedUser(void 0))})},this.on=(o,a)=>this.streamClient.on(o,a),this.off=(o,a)=>this.streamClient.off(o,a),this.call=(o,a)=>new An({streamClient:this.streamClient,id:a,type:o,clientStore:this.writeableStateStore}),this.createGuestUser=async o=>this.streamClient.doAxiosRequest("post","/guest",o,{publicEndpoint:!0}),this.queryCalls=async(o={})=>{const a=await this.streamClient.post("/calls",o),l=[];for(const u of a.calls){const d=new An({streamClient:this.streamClient,id:u.call.id,type:u.call.type,members:u.members,ownCapabilities:u.own_capabilities,watching:o.watch,clientStore:this.writeableStateStore});d.state.updateFromCallResponse(u.call),await d.applyDeviceConfig(u.call.settings,!1),o.watch&&(await d.setup(),this.writeableStateStore.registerCall(d)),l.push(d)}return{...a,calls:l}},this.queryCallStats=async(o={})=>this.streamClient.post("/call/stats",o),this.queryAggregateCallStats=async(o={})=>this.streamClient.post("/stats",o),this.edges=async()=>this.streamClient.get("/edges"),this.addDevice=async(o,a,l,u,d)=>await this.streamClient.post("/devices",{id:o,push_provider:a,voip_token:d,...u!=null?{user_id:u}:{},...l!=null?{push_provider_name:l}:{}}),this.addVoipDevice=async(o,a,l,u)=>await this.addDevice(o,a,l,u,!0),this.getDevices=async o=>await this.streamClient.get("/devices",o?{user_id:o}:{}),this.removeDevice=async(o,a)=>await this.streamClient.delete("/devices",{id:o,...a?{user_id:a}:{}}),this.onRingingCall=async o=>{let a=this.state.calls.find(l=>l.cid===o&&l.ringing);if(!a){const[l,u]=o.split(":");a=new An({streamClient:this.streamClient,type:l,id:u,clientStore:this.writeableStateStore,ringing:!0}),await a.get()}return a},this.connectAnonymousUser=async(o,a)=>Qe(this.connectionConcurrencyTag,()=>this.streamClient.connectAnonymousUser(o,a));const s=typeof e=="string"?e:e.apiKey,i=typeof e=="string"?n:e.options;i!=null&&i.enableTimerWorker&&cb();const r=(i==null?void 0:i.logger)||Vl;if(dg(r,(i==null?void 0:i.logLevel)||"warn"),this.logger=he(["client"]),this.streamClient=ov(s,i),this.writeableStateStore=new Tg,this.readOnlyStateStore=new wg(this.writeableStateStore),typeof e!="string"&&e.user){const o=e.user;o.type==="anonymous"&&(o.id="!anon"),o.id&&this.registerClientInstance(s,o);const a=av(e);this.connectUser(o,a).catch(l=>{this.logger("error","Failed to connect",l)})}}static getOrCreateInstance(e){const{apiKey:n,user:s,token:i,tokenProvider:r}=e;if(!s.id&&s.type!=="anonymous")throw new Error("user.id is required for a non-anonymous user");if(!i&&!r&&s.type!=="anonymous"&&s.type!=="guest")throw new Error("tokenProvider or token is required for a authenticated users");return Vt._instances.get(ir(n,s))||new Vt(e)}get state(){return this.readOnlyStateStore}}Vt._instances=new Map;const Z=t=>typeof t=="string",Dn=()=>{let t,e;const n=new Promise((s,i)=>{t=s,e=i});return n.resolve=t,n.reject=e,n},_a=t=>t==null?"":""+t,cv=(t,e,n)=>{t.forEach(s=>{e[s]&&(n[s]=e[s])})},lv=/###/g,xa=t=>t&&t.indexOf("###")>-1?t.replace(lv,"."):t,Pa=t=>!t||Z(t),$n=(t,e,n)=>{const s=Z(e)?e.split("."):e;let i=0;for(;i<s.length-1;){if(Pa(t))return{};const r=xa(s[i]);!t[r]&&n&&(t[r]=new n),Object.prototype.hasOwnProperty.call(t,r)?t=t[r]:t={},++i}return Pa(t)?{}:{obj:t,k:xa(s[i])}},Oa=(t,e,n)=>{const{obj:s,k:i}=$n(t,e,Object);if(s!==void 0||e.length===1){s[i]=n;return}let r=e[e.length-1],o=e.slice(0,e.length-1),a=$n(t,o,Object);for(;a.obj===void 0&&o.length;)r=`${o[o.length-1]}.${r}`,o=o.slice(0,o.length-1),a=$n(t,o,Object),a&&a.obj&&typeof a.obj[`${a.k}.${r}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${r}`]=n},uv=(t,e,n,s)=>{const{obj:i,k:r}=$n(t,e,Object);i[r]=i[r]||[],i[r].push(n)},si=(t,e)=>{const{obj:n,k:s}=$n(t,e);if(n)return n[s]},dv=(t,e,n)=>{const s=si(t,n);return s!==void 0?s:si(e,n)},cu=(t,e,n)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in t?Z(t[s])||t[s]instanceof String||Z(e[s])||e[s]instanceof String?n&&(t[s]=e[s]):cu(t[s],e[s],n):t[s]=e[s]);return t},fn=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var hv={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const fv=t=>Z(t)?t.replace(/[&<>"'\/]/g,e=>hv[e]):t;class pv{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const n=this.regExpMap.get(e);if(n!==void 0)return n;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const mv=[" ",",","?","!",";"],gv=new pv(20),bv=(t,e,n)=>{e=e||"",n=n||"";const s=mv.filter(o=>e.indexOf(o)<0&&n.indexOf(o)<0);if(s.length===0)return!0;const i=gv.getRegExp(`(${s.map(o=>o==="?"?"\\?":o).join("|")})`);let r=!i.test(t);if(!r){const o=t.indexOf(n);o>0&&!i.test(t.substring(0,o))&&(r=!0)}return r},Mr=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!t)return;if(t[e])return t[e];const s=e.split(n);let i=t;for(let r=0;r<s.length;){if(!i||typeof i!="object")return;let o,a="";for(let l=r;l<s.length;++l)if(l!==r&&(a+=n),a+=s[l],o=i[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&l<s.length-1)continue;r+=l-r+1;break}i=o}return i},ii=t=>t&&t.replace("_","-"),vv={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console&&console[t]&&console[t].apply(console,e)}};class ri{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,n)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=n.prefix||"i18next:",this.logger=e||vv,this.options=n,this.debug=n.debug}log(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"log","",!0)}warn(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"warn","",!0)}error(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"error","")}deprecate(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"warn","WARNING DEPRECATED: ",!0)}forward(e,n,s,i){return i&&!this.debug?null:(Z(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[n](e))}create(e){return new ri(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new ri(this.logger,e)}}var St=new ri;class Ni{constructor(){this.observers={}}on(e,n){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const i=this.observers[s].get(n)||0;this.observers[s].set(n,i+1)}),this}off(e,n){if(this.observers[e]){if(!n){delete this.observers[e];return}this.observers[e].delete(n)}}emit(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[a,l]=o;for(let u=0;u<l;u++)a(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[a,l]=o;for(let u=0;u<l;u++)a.apply(a,[e,...s])})}}class Na extends Ni{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const n=this.options.ns.indexOf(e);n>-1&&this.options.ns.splice(n,1)}getResource(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const r=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,o=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,n],s&&(Array.isArray(s)?a.push(...s):Z(s)&&r?a.push(...s.split(r)):a.push(s)));const l=si(this.data,a);return!l&&!n&&!s&&e.indexOf(".")>-1&&(e=a[0],n=a[1],s=a.slice(2).join(".")),l||!o||!Z(s)?l:Mr(this.data&&this.data[e]&&this.data[e][n],s,r)}addResource(e,n,s,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let a=[e,n];s&&(a=a.concat(o?s.split(o):s)),e.indexOf(".")>-1&&(a=e.split("."),i=n,n=a[1]),this.addNamespaces(n),Oa(this.data,a,i),r.silent||this.emit("added",e,n,s,i)}addResources(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const r in s)(Z(s[r])||Array.isArray(s[r]))&&this.addResource(e,n,r,s[r],{silent:!0});i.silent||this.emit("added",e,n,s)}addResourceBundle(e,n,s,i,r){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},a=[e,n];e.indexOf(".")>-1&&(a=e.split("."),i=s,s=n,n=a[1]),this.addNamespaces(n);let l=si(this.data,a)||{};o.skipCopy||(s=JSON.parse(JSON.stringify(s))),i?cu(l,s,r):l={...l,...s},Oa(this.data,a,l),o.silent||this.emit("added",e,n,s)}removeResourceBundle(e,n){this.hasResourceBundle(e,n)&&delete this.data[e][n],this.removeNamespaces(n),this.emit("removed",e,n)}hasResourceBundle(e,n){return this.getResource(e,n)!==void 0}getResourceBundle(e,n){return n||(n=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,n)}:this.getResource(e,n)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const n=this.getDataByLanguage(e);return!!(n&&Object.keys(n)||[]).find(i=>n[i]&&Object.keys(n[i]).length>0)}toJSON(){return this.data}}var lu={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,s,i){return t.forEach(r=>{this.processors[r]&&(e=this.processors[r].process(e,n,s,i))}),e}};const Aa={};class oi extends Ni{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),cv(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=St.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const s=this.resolve(e,n);return s&&s.res!==void 0}extractFromKey(e,n){let s=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let r=n.ns||this.options.defaultNS||[];const o=s&&e.indexOf(s)>-1,a=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!bv(e,s,i);if(o&&!a){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:Z(r)?[r]:r};const u=e.split(s);(s!==i||s===i&&this.options.ns.indexOf(u[0])>-1)&&(r=u.shift()),e=u.join(i)}return{key:e,namespaces:Z(r)?[r]:r}}translate(e,n,s){if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const i=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,r=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:o,namespaces:a}=this.extractFromKey(e[e.length-1],n),l=a[a.length-1],u=n.lng||this.language,d=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&u.toLowerCase()==="cimode"){if(d){const T=n.nsSeparator||this.options.nsSeparator;return i?{res:`${l}${T}${o}`,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:`${l}${T}${o}`}return i?{res:o,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:o}const f=this.resolve(e,n);let c=f&&f.res;const h=f&&f.usedKey||o,m=f&&f.exactUsedKey||o,p=Object.prototype.toString.apply(c),g=["[object Number]","[object Function]","[object RegExp]"],v=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,C=!this.i18nFormat||this.i18nFormat.handleAsObject,S=!Z(c)&&typeof c!="boolean"&&typeof c!="number";if(C&&c&&S&&g.indexOf(p)<0&&!(Z(v)&&Array.isArray(c))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const T=this.options.returnedObjectHandler?this.options.returnedObjectHandler(h,c,{...n,ns:a}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(f.res=T,f.usedParams=this.getUsedParamsDetails(n),f):T}if(r){const T=Array.isArray(c),w=T?[]:{},E=T?m:h;for(const _ in c)if(Object.prototype.hasOwnProperty.call(c,_)){const A=`${E}${r}${_}`;w[_]=this.translate(A,{...n,joinArrays:!1,ns:a}),w[_]===A&&(w[_]=c[_])}c=w}}else if(C&&Z(v)&&Array.isArray(c))c=c.join(v),c&&(c=this.extendTranslation(c,e,n,s));else{let T=!1,w=!1;const E=n.count!==void 0&&!Z(n.count),_=oi.hasDefaultValue(n),A=E?this.pluralResolver.getSuffix(u,n.count,n):"",q=n.ordinal&&E?this.pluralResolver.getSuffix(u,n.count,{ordinal:!1}):"",N=E&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),U=N&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${A}`]||n[`defaultValue${q}`]||n.defaultValue;!this.isValidLookup(c)&&_&&(T=!0,c=U),this.isValidLookup(c)||(w=!0,c=o);const D=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&w?void 0:c,R=_&&U!==c&&this.options.updateMissing;if(w||T||R){if(this.logger.log(R?"updateKey":"missingKey",u,l,o,R?U:c),r){const k=this.resolve(o,{...n,keySeparator:!1});k&&k.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let x=[];const $=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&$&&$[0])for(let k=0;k<$.length;k++)x.push($[k]);else this.options.saveMissingTo==="all"?x=this.languageUtils.toResolveHierarchy(n.lng||this.language):x.push(n.lng||this.language);const j=(k,V,X)=>{const xe=_&&X!==c?X:D;this.options.missingKeyHandler?this.options.missingKeyHandler(k,l,V,xe,R,n):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(k,l,V,xe,R,n),this.emit("missingKey",k,l,V,c)};this.options.saveMissing&&(this.options.saveMissingPlurals&&E?x.forEach(k=>{const V=this.pluralResolver.getSuffixes(k,n);N&&n[`defaultValue${this.options.pluralSeparator}zero`]&&V.indexOf(`${this.options.pluralSeparator}zero`)<0&&V.push(`${this.options.pluralSeparator}zero`),V.forEach(X=>{j([k],o+X,n[`defaultValue${X}`]||U)})}):j(x,o,U))}c=this.extendTranslation(c,e,n,f,s),w&&c===o&&this.options.appendNamespaceToMissingKey&&(c=`${l}:${o}`),(w||T)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?c=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${o}`:o,T?c:void 0):c=this.options.parseMissingKeyHandler(c))}return i?(f.res=c,f.usedParams=this.getUsedParamsDetails(n),f):c}extendTranslation(e,n,s,i,r){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const u=Z(e)&&(s&&s.interpolation&&s.interpolation.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(u){const c=e.match(this.interpolator.nestingRegexp);d=c&&c.length}let f=s.replace&&!Z(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(f={...this.options.interpolation.defaultVariables,...f}),e=this.interpolator.interpolate(e,f,s.lng||this.language||i.usedLng,s),u){const c=e.match(this.interpolator.nestingRegexp),h=c&&c.length;d<h&&(s.nest=!1)}!s.lng&&this.options.compatibilityAPI!=="v1"&&i&&i.res&&(s.lng=this.language||i.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var c=arguments.length,h=new Array(c),m=0;m<c;m++)h[m]=arguments[m];return r&&r[0]===h[0]&&!s.context?(o.logger.warn(`It seems you are nesting recursively key: ${h[0]} in key: ${n[0]}`),null):o.translate(...h,n)},s)),s.interpolation&&this.interpolator.reset()}const a=s.postProcess||this.options.postProcess,l=Z(a)?[a]:a;return e!=null&&l&&l.length&&s.applyPostProcessor!==!1&&(e=lu.handle(l,e,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s,i,r,o,a;return Z(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(s))return;const u=this.extractFromKey(l,n),d=u.key;i=d;let f=u.namespaces;this.options.fallbackNS&&(f=f.concat(this.options.fallbackNS));const c=n.count!==void 0&&!Z(n.count),h=c&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),m=n.context!==void 0&&(Z(n.context)||typeof n.context=="number")&&n.context!=="",p=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);f.forEach(g=>{this.isValidLookup(s)||(a=g,!Aa[`${p[0]}-${g}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(a)&&(Aa[`${p[0]}-${g}`]=!0,this.logger.warn(`key "${i}" for languages "${p.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(v=>{if(this.isValidLookup(s))return;o=v;const C=[d];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(C,d,v,g,n);else{let T;c&&(T=this.pluralResolver.getSuffix(v,n.count,n));const w=`${this.options.pluralSeparator}zero`,E=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(c&&(C.push(d+T),n.ordinal&&T.indexOf(E)===0&&C.push(d+T.replace(E,this.options.pluralSeparator)),h&&C.push(d+w)),m){const _=`${d}${this.options.contextSeparator}${n.context}`;C.push(_),c&&(C.push(_+T),n.ordinal&&T.indexOf(E)===0&&C.push(_+T.replace(E,this.options.pluralSeparator)),h&&C.push(_+w))}}let S;for(;S=C.pop();)this.isValidLookup(s)||(r=S,s=this.getResource(v,g,S,n))}))})}),{res:s,usedKey:i,exactUsedKey:r,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,n,s,i):this.resourceStore.getResource(e,n,s,i)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!Z(e.replace);let i=s?e.replace:e;if(s&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!s){i={...i};for(const r of n)delete i[r]}return i}static hasDefaultValue(e){const n="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&n===s.substring(0,n.length)&&e[s]!==void 0)return!0;return!1}}const rr=t=>t.charAt(0).toUpperCase()+t.slice(1);class Da{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=St.create("languageUtils")}getScriptPartFromCode(e){if(e=ii(e),!e||e.indexOf("-")<0)return null;const n=e.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(e){if(e=ii(e),!e||e.indexOf("-")<0)return e;const n=e.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(e){if(Z(e)&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let i=Intl.getCanonicalLocales(e)[0];if(i&&this.options.lowerCaseLng&&(i=i.toLowerCase()),i)return i}catch{}const n=["hans","hant","latn","cyrl","cans","mong","arab"];let s=e.split("-");return this.options.lowerCaseLng?s=s.map(i=>i.toLowerCase()):s.length===2?(s[0]=s[0].toLowerCase(),s[1]=s[1].toUpperCase(),n.indexOf(s[1].toLowerCase())>-1&&(s[1]=rr(s[1].toLowerCase()))):s.length===3&&(s[0]=s[0].toLowerCase(),s[1].length===2&&(s[1]=s[1].toUpperCase()),s[0]!=="sgn"&&s[2].length===2&&(s[2]=s[2].toUpperCase()),n.indexOf(s[1].toLowerCase())>-1&&(s[1]=rr(s[1].toLowerCase())),n.indexOf(s[2].toLowerCase())>-1&&(s[2]=rr(s[2].toLowerCase()))),s.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let n;return e.forEach(s=>{if(n)return;const i=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(i))&&(n=i)}),!n&&this.options.supportedLngs&&e.forEach(s=>{if(n)return;const i=this.getLanguagePartFromCode(s);if(this.isSupportedCode(i))return n=i;n=this.options.supportedLngs.find(r=>{if(r===i)return r;if(!(r.indexOf("-")<0&&i.indexOf("-")<0)&&(r.indexOf("-")>0&&i.indexOf("-")<0&&r.substring(0,r.indexOf("-"))===i||r.indexOf(i)===0&&i.length>1))return r})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(e,n){if(!e)return[];if(typeof e=="function"&&(e=e(n)),Z(e)&&(e=[e]),Array.isArray(e))return e;if(!n)return e.default||[];let s=e[n];return s||(s=e[this.getScriptPartFromCode(n)]),s||(s=e[this.formatLanguageCode(n)]),s||(s=e[this.getLanguagePartFromCode(n)]),s||(s=e.default),s||[]}toResolveHierarchy(e,n){const s=this.getFallbackCodes(n||this.options.fallbackLng||[],e),i=[],r=o=>{o&&(this.isSupportedCode(o)?i.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return Z(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&r(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&r(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&r(this.getLanguagePartFromCode(e))):Z(e)&&r(this.formatLanguageCode(e)),s.forEach(o=>{i.indexOf(o)<0&&r(this.formatLanguageCode(o))}),i}}let yv=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Sv={1:t=>+(t>1),2:t=>+(t!=1),3:t=>0,4:t=>t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,5:t=>t==0?0:t==1?1:t==2?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5,6:t=>t==1?0:t>=2&&t<=4?1:2,7:t=>t==1?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,8:t=>t==1?0:t==2?1:t!=8&&t!=11?2:3,9:t=>+(t>=2),10:t=>t==1?0:t==2?1:t<7?2:t<11?3:4,11:t=>t==1||t==11?0:t==2||t==12?1:t>2&&t<20?2:3,12:t=>+(t%10!=1||t%100==11),13:t=>+(t!==0),14:t=>t==1?0:t==2?1:t==3?2:3,15:t=>t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2,16:t=>t%10==1&&t%100!=11?0:t!==0?1:2,17:t=>t==1||t%10==1&&t%100!=11?0:1,18:t=>t==0?0:t==1?1:2,19:t=>t==1?0:t==0||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3,20:t=>t==1?0:t==0||t%100>0&&t%100<20?1:2,21:t=>t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0,22:t=>t==1?0:t==2?1:(t<0||t>10)&&t%10==0?2:3};const Cv=["v1","v2","v3"],Tv=["v4"],La={zero:0,one:1,two:2,few:3,many:4,other:5},wv=()=>{const t={};return yv.forEach(e=>{e.lngs.forEach(n=>{t[n]={numbers:e.nr,plurals:Sv[e.fc]}})}),t};class kv{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=n,this.logger=St.create("pluralResolver"),(!this.options.compatibilityJSON||Tv.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=wv(),this.pluralRulesCache={}}addRule(e,n){this.rules[e]=n}clearCache(){this.pluralRulesCache={}}getRule(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi()){const s=ii(e==="dev"?"en":e),i=n.ordinal?"ordinal":"cardinal",r=JSON.stringify({cleanedCode:s,type:i});if(r in this.pluralRulesCache)return this.pluralRulesCache[r];let o;try{o=new Intl.PluralRules(s,{type:i})}catch{if(!e.match(/-|_/))return;const l=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(l,n)}return this.pluralRulesCache[r]=o,o}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=this.getRule(e,n);return this.shouldUseIntlApi()?s&&s.resolvedOptions().pluralCategories.length>1:s&&s.numbers.length>1}getPluralFormsOfKey(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,s).map(i=>`${n}${i}`)}getSuffixes(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=this.getRule(e,n);return s?this.shouldUseIntlApi()?s.resolvedOptions().pluralCategories.sort((i,r)=>La[i]-La[r]).map(i=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i}`):s.numbers.map(i=>this.getSuffix(e,i,n)):[]}getSuffix(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=this.getRule(e,s);return i?this.shouldUseIntlApi()?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${i.select(n)}`:this.getSuffixRetroCompatible(i,n):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,n){const s=e.noAbs?e.plurals(n):e.plurals(Math.abs(n));let i=e.numbers[s];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(i===2?i="plural":i===1&&(i=""));const r=()=>this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString();return this.options.compatibilityJSON==="v1"?i===1?"":typeof i=="number"?`_plural_${i.toString()}`:r():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?r():this.options.prepend&&s.toString()?this.options.prepend+s.toString():s.toString()}shouldUseIntlApi(){return!Cv.includes(this.options.compatibilityJSON)}}const Ma=function(t,e,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,r=dv(t,e,n);return!r&&i&&Z(n)&&(r=Mr(t,n,s),r===void 0&&(r=Mr(e,n,s))),r},or=t=>t.replace(/\$/g,"$$$$");class Rv{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=St.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(n=>n),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:n,escapeValue:s,useRawValueToEscape:i,prefix:r,prefixEscaped:o,suffix:a,suffixEscaped:l,formatSeparator:u,unescapeSuffix:d,unescapePrefix:f,nestingPrefix:c,nestingPrefixEscaped:h,nestingSuffix:m,nestingSuffixEscaped:p,nestingOptionsSeparator:g,maxReplaces:v,alwaysFormat:C}=e.interpolation;this.escape=n!==void 0?n:fv,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=r?fn(r):o||"{{",this.suffix=a?fn(a):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=d?"":f||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=c?fn(c):h||fn("$t("),this.nestingSuffix=m?fn(m):p||fn(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=v||1e3,this.alwaysFormat=C!==void 0?C:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(n,s)=>n&&n.source===s?(n.lastIndex=0,n):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,n,s,i){let r,o,a;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=h=>{if(h.indexOf(this.formatSeparator)<0){const v=Ma(n,l,h,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(v,void 0,s,{...i,...n,interpolationkey:h}):v}const m=h.split(this.formatSeparator),p=m.shift().trim(),g=m.join(this.formatSeparator).trim();return this.format(Ma(n,l,p,this.options.keySeparator,this.options.ignoreJSONStructure),g,s,{...i,...n,interpolationkey:p})};this.resetRegExp();const d=i&&i.missingInterpolationHandler||this.options.missingInterpolationHandler,f=i&&i.interpolation&&i.interpolation.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:h=>or(h)},{regex:this.regexp,safeValue:h=>this.escapeValue?or(this.escape(h)):or(h)}].forEach(h=>{for(a=0;r=h.regex.exec(e);){const m=r[1].trim();if(o=u(m),o===void 0)if(typeof d=="function"){const g=d(e,r,i);o=Z(g)?g:""}else if(i&&Object.prototype.hasOwnProperty.call(i,m))o="";else if(f){o=r[0];continue}else this.logger.warn(`missed to pass in variable ${m} for interpolating ${e}`),o="";else!Z(o)&&!this.useRawValueToEscape&&(o=_a(o));const p=h.safeValue(o);if(e=e.replace(r[0],p),f?(h.regex.lastIndex+=o.length,h.regex.lastIndex-=r[0].length):h.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i,r,o;const a=(l,u)=>{const d=this.nestingOptionsSeparator;if(l.indexOf(d)<0)return l;const f=l.split(new RegExp(`${d}[ ]*{`));let c=`{${f[1]}`;l=f[0],c=this.interpolate(c,o);const h=c.match(/'/g),m=c.match(/"/g);(h&&h.length%2===0&&!m||m.length%2!==0)&&(c=c.replace(/'/g,'"'));try{o=JSON.parse(c),u&&(o={...u,...o})}catch(p){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,p),`${l}${d}${c}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,l};for(;i=this.nestingRegexp.exec(e);){let l=[];o={...s},o=o.replace&&!Z(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let u=!1;if(i[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(i[1])){const d=i[1].split(this.formatSeparator).map(f=>f.trim());i[1]=d.shift(),l=d,u=!0}if(r=n(a.call(this,i[1].trim(),o),o),r&&i[0]===e&&!Z(r))return r;Z(r)||(r=_a(r)),r||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),r=""),u&&(r=l.reduce((d,f)=>this.format(d,f,s.lng,{...s,interpolationkey:i[1].trim()}),r.trim())),e=e.replace(i[0],r),this.regexp.lastIndex=0}return e}}const Ev=t=>{let e=t.toLowerCase().trim();const n={};if(t.indexOf("(")>-1){const s=t.split("(");e=s[0].toLowerCase().trim();const i=s[1].substring(0,s[1].length-1);e==="currency"&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach(o=>{if(o){const[a,...l]=o.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),d=a.trim();n[d]||(n[d]=u),u==="false"&&(n[d]=!1),u==="true"&&(n[d]=!0),isNaN(u)||(n[d]=parseInt(u,10))}})}return{formatName:e,formatOptions:n}},pn=t=>{const e={};return(n,s,i)=>{let r=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(r={...r,[i.interpolationkey]:void 0});const o=s+JSON.stringify(r);let a=e[o];return a||(a=t(ii(s),i),e[o]=a),a(n)}};class Iv{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=St.create("formatter"),this.options=e,this.formats={number:pn((n,s)=>{const i=new Intl.NumberFormat(n,{...s});return r=>i.format(r)}),currency:pn((n,s)=>{const i=new Intl.NumberFormat(n,{...s,style:"currency"});return r=>i.format(r)}),datetime:pn((n,s)=>{const i=new Intl.DateTimeFormat(n,{...s});return r=>i.format(r)}),relativetime:pn((n,s)=>{const i=new Intl.RelativeTimeFormat(n,{...s});return r=>i.format(r,s.range||"day")}),list:pn((n,s)=>{const i=new Intl.ListFormat(n,{...s});return r=>i.format(r)})},this.init(e)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=n.interpolation.formatSeparator||","}add(e,n){this.formats[e.toLowerCase().trim()]=n}addCached(e,n){this.formats[e.toLowerCase().trim()]=pn(n)}format(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const r=n.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&r[0].indexOf(")")<0&&r.find(a=>a.indexOf(")")>-1)){const a=r.findIndex(l=>l.indexOf(")")>-1);r[0]=[r[0],...r.splice(1,a)].join(this.formatSeparator)}return r.reduce((a,l)=>{const{formatName:u,formatOptions:d}=Ev(l);if(this.formats[u]){let f=a;try{const c=i&&i.formatParams&&i.formatParams[i.interpolationkey]||{},h=c.locale||c.lng||i.locale||i.lng||s;f=this.formats[u](a,h,{...d,...i,...c})}catch(c){this.logger.warn(c)}return f}else this.logger.warn(`there was no format function for ${u}`);return a},e)}}const _v=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class xv extends Ni{constructor(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=n,this.services=s,this.languageUtils=s.languageUtils,this.options=i,this.logger=St.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(s,i.backend,i)}queueLoad(e,n,s,i){const r={},o={},a={},l={};return e.forEach(u=>{let d=!0;n.forEach(f=>{const c=`${u}|${f}`;!s.reload&&this.store.hasResourceBundle(u,f)?this.state[c]=2:this.state[c]<0||(this.state[c]===1?o[c]===void 0&&(o[c]=!0):(this.state[c]=1,d=!1,o[c]===void 0&&(o[c]=!0),r[c]===void 0&&(r[c]=!0),l[f]===void 0&&(l[f]=!0)))}),d||(a[u]=!0)}),(Object.keys(r).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(r),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(l)}}loaded(e,n,s){const i=e.split("|"),r=i[0],o=i[1];n&&this.emit("failedLoading",r,o,n),!n&&s&&this.store.addResourceBundle(r,o,s,void 0,void 0,{skipCopy:!0}),this.state[e]=n?-1:2,n&&s&&(this.state[e]=0);const a={};this.queue.forEach(l=>{uv(l.loaded,[r],o),_v(l,e),n&&l.errors.push(n),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{a[u]||(a[u]={});const d=l.loaded[u];d.length&&d.forEach(f=>{a[u][f]===void 0&&(a[u][f]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(l=>!l.done)}read(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:n,fcName:s,tried:i,wait:r,callback:o});return}this.readingCalls++;const a=(u,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const f=this.waitingReads.shift();this.read(f.lng,f.ns,f.fcName,f.tried,f.wait,f.callback)}if(u&&d&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,n,s,i+1,r*2,o)},r);return}o(u,d)},l=this.backend[s].bind(this.backend);if(l.length===2){try{const u=l(e,n);u&&typeof u.then=="function"?u.then(d=>a(null,d)).catch(a):a(null,u)}catch(u){a(u)}return}return l(e,n,a)}prepareLoading(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();Z(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Z(n)&&(n=[n]);const r=this.queueLoad(e,n,s,i);if(!r.toLoad.length)return r.pending.length||i(),null;r.toLoad.forEach(o=>{this.loadOne(o)})}load(e,n,s){this.prepareLoading(e,n,{},s)}reload(e,n,s){this.prepareLoading(e,n,{reload:!0},s)}loadOne(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e.split("|"),i=s[0],r=s[1];this.read(i,r,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${n}loading namespace ${r} for language ${i} failed`,o),!o&&a&&this.logger.log(`${n}loaded namespace ${r} for language ${i}`,a),this.loaded(e,o,a)})}saveMissing(e,n,s,i,r){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(n)){this.logger.warn(`did not save key "${s}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if(this.backend&&this.backend.create){const l={...o,isUpdate:r},u=this.backend.create.bind(this.backend);if(u.length<6)try{let d;u.length===5?d=u(e,n,s,i,l):d=u(e,n,s,i),d&&typeof d.then=="function"?d.then(f=>a(null,f)).catch(a):a(null,d)}catch(d){a(d)}else u(e,n,s,i,a,l)}!e||!e[0]||this.store.addResource(e[0],n,s,i)}}}const ja=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),Z(t[1])&&(e.defaultValue=t[1]),Z(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const n=t[3]||t[2];Object.keys(n).forEach(s=>{e[s]=n[s]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),Fa=t=>(Z(t.ns)&&(t.ns=[t.ns]),Z(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),Z(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs&&t.supportedLngs.indexOf("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),t),Ss=()=>{},Pv=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(n=>{typeof t[n]=="function"&&(t[n]=t[n].bind(t))})};class Qn extends Ni{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(super(),this.options=Fa(e),this.services={},this.logger=St,this.modules={external:[]},Pv(this),n&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,n),this;setTimeout(()=>{this.init(e,n)},0)}}init(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof n=="function"&&(s=n,n={}),!n.defaultNS&&n.defaultNS!==!1&&n.ns&&(Z(n.ns)?n.defaultNS=n.ns:n.ns.indexOf("translation")<0&&(n.defaultNS=n.ns[0]));const i=ja();this.options={...i,...this.options,...Fa(n)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...i.interpolation,...this.options.interpolation}),n.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=n.keySeparator),n.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=n.nsSeparator);const r=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?St.init(r(this.modules.logger),this.options):St.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:typeof Intl<"u"&&(d=Iv);const f=new Da(this.options);this.store=new Na(this.options.resources,this.options);const c=this.services;c.logger=St,c.resourceStore=this.store,c.languageUtils=f,c.pluralResolver=new kv(f,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),d&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(c.formatter=r(d),c.formatter.init(c,this.options),this.options.interpolation.format=c.formatter.format.bind(c.formatter)),c.interpolator=new Rv(this.options),c.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},c.backendConnector=new xv(r(this.modules.backend),c.resourceStore,c,this.options),c.backendConnector.on("*",function(h){for(var m=arguments.length,p=new Array(m>1?m-1:0),g=1;g<m;g++)p[g-1]=arguments[g];e.emit(h,...p)}),this.modules.languageDetector&&(c.languageDetector=r(this.modules.languageDetector),c.languageDetector.init&&c.languageDetector.init(c,this.options.detection,this.options)),this.modules.i18nFormat&&(c.i18nFormat=r(this.modules.i18nFormat),c.i18nFormat.init&&c.i18nFormat.init(this)),this.translator=new oi(this.services,this.options),this.translator.on("*",function(h){for(var m=arguments.length,p=new Array(m>1?m-1:0),g=1;g<m;g++)p[g-1]=arguments[g];e.emit(h,...p)}),this.modules.external.forEach(h=>{h.init&&h.init(this)})}if(this.format=this.options.interpolation.format,s||(s=Ss),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=function(){return e.store[d](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=function(){return e.store[d](...arguments),e}});const l=Dn(),u=()=>{const d=(f,c)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(c),s(f,c)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),l}loadResources(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ss;const i=Z(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if(i&&i.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const r=[],o=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(u=>{u!=="cimode"&&r.indexOf(u)<0&&r.push(u)})};i?o(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>o(l)),this.options.preload&&this.options.preload.forEach(a=>o(a)),this.services.backendConnector.load(r,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(a)})}else s(null)}reloadResources(e,n,s){const i=Dn();return typeof e=="function"&&(s=e,e=void 0),typeof n=="function"&&(s=n,n=void 0),e||(e=this.languages),n||(n=this.options.ns),s||(s=Ss),this.services.backendConnector.reload(e,n,r=>{i.resolve(),s(r)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&lu.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let n=0;n<this.languages.length;n++){const s=this.languages[n];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}}changeLanguage(e,n){var s=this;this.isLanguageChangingTo=e;const i=Dn();this.emit("languageChanging",e);const r=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},o=(l,u)=>{u?(r(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,i.resolve(function(){return s.t(...arguments)}),n&&n(l,function(){return s.t(...arguments)})},a=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const u=Z(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);u&&(this.language||r(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(u)),this.loadResources(u,d=>{o(d,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),i}getFixedT(e,n,s){var i=this;const r=function(o,a){let l;if(typeof a!="object"){for(var u=arguments.length,d=new Array(u>2?u-2:0),f=2;f<u;f++)d[f-2]=arguments[f];l=i.options.overloadTranslationOptionHandler([o,a].concat(d))}else l={...a};l.lng=l.lng||r.lng,l.lngs=l.lngs||r.lngs,l.ns=l.ns||r.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||s||r.keyPrefix);const c=i.options.keySeparator||".";let h;return l.keyPrefix&&Array.isArray(o)?h=o.map(m=>`${l.keyPrefix}${c}${m}`):h=l.keyPrefix?`${l.keyPrefix}${c}${o}`:o,i.t(h,l)};return Z(e)?r.lng=e:r.lngs=e,r.ns=n,r.keyPrefix=s,r}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=n.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,r=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const o=(a,l)=>{const u=this.services.backendConnector.state[`${a}|${l}`];return u===-1||u===0||u===2};if(n.precheck){const a=n.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(s,e)&&(!i||o(r,e)))}loadNamespaces(e,n){const s=Dn();return this.options.ns?(Z(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{s.resolve(),n&&n(i)}),s):(n&&n(),Promise.resolve())}loadLanguages(e,n){const s=Dn();Z(e)&&(e=[e]);const i=this.options.preload||[],r=e.filter(o=>i.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return r.length?(this.options.preload=i.concat(r),this.loadResources(o=>{s.resolve(),n&&n(o)}),s):(n&&n(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=this.services&&this.services.languageUtils||new Da(ja());return n.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return new Qn(e,n)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ss;const s=e.forkResourceStore;s&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},r=new Qn(i);return(e.debug!==void 0||e.prefix!==void 0)&&(r.logger=r.logger.clone(e)),["store","services","language"].forEach(a=>{r[a]=this[a]}),r.services={...this.services},r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},s&&(r.store=new Na(this.store.data,i),r.services.resourceStore=r.store),r.translator=new oi(r.services,i),r.translator.on("*",function(a){for(var l=arguments.length,u=new Array(l>1?l-1:0),d=1;d<l;d++)u[d-1]=arguments[d];r.emit(a,...u)}),r.init(i,n),r.translator.options=i,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const We=Qn.createInstance();We.createInstance=Qn.createInstance;We.createInstance;We.dir;We.init;We.loadResources;We.reloadResources;We.use;We.changeLanguage;We.getFixedT;We.t;We.exists;We.setDefaultNamespace;We.hasLoadedNamespace;We.loadNamespaces;We.loadLanguages;const uu=y.createContext(void 0),Ov=t=>{const{call:e,children:n}=t;return b.jsx(uu.Provider,{value:e,children:n})},Ne=()=>y.useContext(uu),jr="stream-video",ar={debug:!1,currentLanguage:"en",fallbackLanguage:!1},Nv=(t,e)=>Object.entries(t).reduce((n,[s,i])=>(n[s]={[e]:i},n),{}),Av=Nv({},jr),yo=t=>t;class Dv{constructor(e={}){this.t=yo,this.init=async()=>{try{this.t=await this.i18nInstance.init()}catch(o){console.error(`Failed to initialize translations: ${JSON.stringify(o)}`)}return this},this.changeLanguage=async(o,a)=>{if(!this._checkIsInitialized())return;const l=typeof window<"u"&&window.navigator?window.navigator.language:void 0;await this.i18nInstance.changeLanguage(o||l),a==null||a(this.currentLanguage)},this.registerTranslationsForLanguage=({lng:o,translations:a})=>{this._checkIsInitialized()&&this.i18nInstance.addResourceBundle(o,jr,a,!0,!0)},this._checkIsInitialized=()=>(this.i18nInstance.isInitialized||console.warn("I18n instance is not initialized. Call yourStreamI18nInstance.init()."),this.i18nInstance.isInitialized);const{debug:n=ar.debug,currentLanguage:s=ar.currentLanguage,fallbackLanguage:i=ar.fallbackLanguage,translationsOverrides:r}=e;this.i18nInstance=We.createInstance({debug:n,defaultNS:jr,fallbackLng:i,interpolation:{escapeValue:!1},keySeparator:!1,lng:s,nsSeparator:!1,parseMissingKeyHandler:o=>o,resources:Av}),r&&this.i18nInstance.on("initialized",()=>{Object.entries(r).forEach(([o,a])=>{this.registerTranslationsForLanguage({lng:o,translations:a})})})}get currentLanguage(){return this._checkIsInitialized(),this.i18nInstance.language}get isInitialized(){return this.i18nInstance.isInitialized}}const du=y.createContext({t:yo}),Lv=({children:t,...e})=>{const{i18n:n,t:s}=Mv(e);return b.jsx(du.Provider,{value:{t:s,i18n:n},children:t})},Mv=({i18nInstance:t,language:e,fallbackLanguage:n,translationsOverrides:s})=>{const[i]=y.useState(()=>t||new Dv({currentLanguage:e,fallbackLanguage:n,translationsOverrides:s})),[r,o]=y.useState(()=>yo);return y.useEffect(()=>{const{isInitialized:a}=i;if(!a){i.init().then(l=>o(()=>l.i18nInstance.t));return}e&&(i==null?void 0:i.currentLanguage)!==e&&i.changeLanguage(e).catch(l=>{console.log("Error while changing language",l)})},[i,t,e,s]),{i18n:i,t:r}},Ue=()=>y.useContext(du),jv=y.createContext(void 0),Fv=({children:t,client:e,i18nInstance:n,language:s,translationsOverrides:i})=>b.jsx(jv.Provider,{value:e,children:b.jsx(Lv,{i18nInstance:n,language:s,translationsOverrides:i,children:t})}),Uv=()=>{var t;return typeof navigator>"u"?!1:((t=navigator.product)==null?void 0:t.toLowerCase())==="reactnative"},G=(t,e)=>{const[n,s]=y.useState(()=>{try{return va.getCurrentValue(t)}catch(i){if(typeof e>"u")throw i;return e}});return y.useEffect(()=>va.createSubscription(t,s,i=>{console.log("An error occurred while reading an observable",i),e&&s(e)}),[e,t]),n},Ua=Object.freeze([]),ce=()=>{const t=Ne();return t?t.state:(console.warn('You are using useCallState() outside a Call context. Please wrap your component in <StreamCall /> and provide a "call" instance.'),new Wl)},hu=()=>{const{recording$:t}=ce();return G(t)},$v=()=>{const{egress$:t}=ce(),e=G(t);return e?e.broadcasting:!1},Vv=()=>{const{backstage$:t}=ce();return!G(t)},Bv=()=>{const{blockedUserIds$:t}=ce();return G(t)},Hv=()=>{const{createdAt$:t}=ce();return G(t)},qv=()=>{const{endedAt$:t}=ce();return G(t)},Wv=()=>{const{startsAt$:t}=ce();return G(t)},Gv=()=>{const{updatedAt$:t}=ce();return G(t)},Kv=()=>{const{createdBy$:t}=ce();return G(t)},Jv=()=>{const{custom$:t}=ce();return G(t)},zv=()=>{const{egress$:t}=ce();return G(t)},Yv=()=>{const{ingress$:t}=ce();return G(t)},Xv=()=>{const{session$:t}=ce();return G(t)},Zv=()=>{const{settings$:t}=ce();return G(t)},Qv=()=>{const{transcribing$:t}=ce();return G(t)},ey=()=>{const{endedBy$:t}=ce();return G(t)},ty=()=>{const{hasOngoingScreenShare$:t}=ce();return G(t)},ny=()=>{const{callStatsReport$:t}=ce();return G(t)},sy=()=>{const{dominantSpeaker$:t}=ce();return G(t)},iy=()=>{const{members$:t}=ce();return G(t)},ry=()=>{const{callingState$:t}=ce();return G(t)},oy=()=>{const{startedAt$:t}=ce();return G(t)},ay=({sortBy:t}={})=>{const{participants$:e}=ce(),n=G(e);return y.useMemo(()=>t?[...n].sort(t):n,[n,t])},cy=()=>{const{localParticipant$:t}=ce();return G(t)},ly=()=>{const{remoteParticipants$:t}=ce();return G(t)},uy=()=>{const{participantCount$:t}=ce();return G(t)},dy=()=>{const{anonymousParticipantCount$:t}=ce();return G(t)},hy=()=>{const{thumbnails$:t}=ce();return G(t)},fu=()=>{const{ownCapabilities$:t}=ce();return G(t)},fy=(...t)=>{const e=fu();return t.every(n=>e==null?void 0:e.includes(n))},py=()=>{const t=Ne(),{camera:e}=t,{state:n}=e,s=G(n.direction$),i=G(n.mediaStream$),r=G(n.selectedDevice$),{getDevices:o}=Co(e),a=G(n.hasBrowserPermission$),l=G(n.isPromptingPermission$);return{camera:e,direction:s,mediaStream:i,get devices(){return o()},hasBrowserPermission:a,isPromptingPermission:l,selectedDevice:r,...So(G(n.status$),G(n.optimisticStatus$))}},my=()=>{const t=Ne(),{microphone:e}=t,{state:n}=e,s=G(n.mediaStream$),i=G(n.selectedDevice$),{getDevices:r}=Co(e),o=G(n.hasBrowserPermission$),a=G(n.isPromptingPermission$),l=G(n.speakingWhileMuted$);return{microphone:e,mediaStream:s,get devices(){return r()},selectedDevice:i,hasBrowserPermission:o,isPromptingPermission:a,isSpeakingWhileMuted:l,...So(G(n.status$),G(n.optimisticStatus$))}},gy=()=>{if(Uv())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");const t=Ne(),{speaker:e}=t,{getDevices:n}=Co(e),s=G(e.state.selectedDevice$);return{speaker:e,get devices(){return n()},selectedDevice:s,isDeviceSelectionSupported:e.state.isDeviceSelectionSupported}},by=()=>{const t=Ne(),{screenShare:e}=t;return{screenShare:e,mediaStream:G(e.state.mediaStream$),...So(G(e.state.status$),G(e.state.optimisticStatus$))}},vy=()=>{const t=Ne();return G(t.dynascaleManager.incomingVideoSettings$)},yy=()=>{const{closedCaptions$:t}=ce();return G(t)},Sy=()=>{const{captioning$:t}=ce();return G(t)};function So(t,e){const n=e??t;return{status:t,optimisticStatus:n,isEnabled:t==="enabled",isMute:t!=="enabled",optimisticIsMute:n!=="enabled",isTogglePending:n!==t}}function Co(t){const e=y.useMemo(()=>Gs(Ua),[]),[n,s]=y.useState(e),i=G(n,Ua);return{getDevices:()=>(n===e&&s(t.listDevices()),i)}}var Cy=Object.freeze({__proto__:null,useAnonymousParticipantCount:dy,useCallBlockedUserIds:Bv,useCallCallingState:ry,useCallClosedCaptions:yy,useCallCreatedAt:Hv,useCallCreatedBy:Kv,useCallCustomData:Jv,useCallEgress:zv,useCallEndedAt:qv,useCallEndedBy:ey,useCallIngress:Yv,useCallMembers:iy,useCallSession:Xv,useCallSettings:Zv,useCallStartedAt:oy,useCallStartsAt:Wv,useCallState:ce,useCallStatsReport:ny,useCallThumbnail:hy,useCallUpdatedAt:Gv,useCameraState:py,useDominantSpeaker:sy,useHasOngoingScreenShare:ty,useHasPermissions:fy,useIncomingVideoSettings:vy,useIsCallCaptioningInProgress:Sy,useIsCallHLSBroadcastingInProgress:$v,useIsCallLive:Vv,useIsCallRecordingInProgress:hu,useIsCallTranscribingInProgress:Qv,useLocalParticipant:cy,useMicrophoneState:my,useOwnCapabilities:fu,useParticipantCount:uy,useParticipants:ay,useRemoteParticipants:ly,useScreenShareState:by,useSpeakerState:gy});const Ty=()=>{const t=Ne(),e=hu(),[n,s]=y.useState(!1);return y.useEffect(()=>{s(r=>r&&!1)},[e]),{toggleCallRecording:y.useCallback(async()=>{try{s(!0),e?await(t==null?void 0:t.stopRecording()):await(t==null?void 0:t.startRecording())}catch(r){throw console.error("Failed start recording",r),r}},[t,e]),isAwaitingResponse:n,isCallRecordingInProgress:e}},rt=()=>Cy,Ze=({canRequestOnly:t,hasPermissionsOnly:e,requiredGrants:n,requireAll:s=!0,children:i})=>{const r=Ne(),{useCallSettings:o,useOwnCapabilities:a}=rt(),l=a(),u=o(),d=n[s?"every":"some"](c=>l==null?void 0:l.includes(c));if(e)return d?b.jsx(b.Fragment,{children:i}):null;const f=n.some(c=>r==null?void 0:r.permissionsContext.canRequest(c,u));return t?f?b.jsx(b.Fragment,{children:i}):null:d||f?b.jsx(b.Fragment,{children:i}):null};function Ai(){return typeof window<"u"}function Qt(t){return To(t)?(t.nodeName||"").toLowerCase():"#document"}function st(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Et(t){var e;return(e=(To(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function To(t){return Ai()?t instanceof Node||t instanceof st(t).Node:!1}function _e(t){return Ai()?t instanceof Element||t instanceof st(t).Element:!1}function Pe(t){return Ai()?t instanceof HTMLElement||t instanceof st(t).HTMLElement:!1}function Fr(t){return!Ai()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof st(t).ShadowRoot}const wy=new Set(["inline","contents"]);function os(t){const{overflow:e,overflowX:n,overflowY:s,display:i}=it(t);return/auto|scroll|overlay|hidden|clip/.test(e+s+n)&&!wy.has(i)}const ky=new Set(["table","td","th"]);function Ry(t){return ky.has(Qt(t))}const Ey=[":popover-open",":modal"];function Di(t){return Ey.some(e=>{try{return t.matches(e)}catch{return!1}})}const Iy=["transform","translate","scale","rotate","perspective"],_y=["transform","translate","scale","rotate","perspective","filter"],xy=["paint","layout","strict","content"];function wo(t){const e=Li(),n=_e(t)?it(t):t;return Iy.some(s=>n[s]?n[s]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||_y.some(s=>(n.willChange||"").includes(s))||xy.some(s=>(n.contain||"").includes(s))}function Py(t){let e=jt(t);for(;Pe(e)&&!Dt(e);){if(wo(e))return e;if(Di(e))return null;e=jt(e)}return null}function Li(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Oy=new Set(["html","body","#document"]);function Dt(t){return Oy.has(Qt(t))}function it(t){return st(t).getComputedStyle(t)}function Mi(t){return _e(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function jt(t){if(Qt(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Fr(t)&&t.host||Et(t);return Fr(e)?e.host:e}function pu(t){const e=jt(t);return Dt(e)?t.ownerDocument?t.ownerDocument.body:t.body:Pe(e)&&os(e)?e:pu(e)}function Jt(t,e,n){var s;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=pu(t),r=i===((s=t.ownerDocument)==null?void 0:s.body),o=st(i);if(r){const a=Ur(o);return e.concat(o,o.visualViewport||[],os(i)?i:[],a&&n?Jt(a):[])}return e.concat(i,Jt(i,[],n))}function Ur(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}const Yt=Math.min,nt=Math.max,ai=Math.round,gn=Math.floor,Tt=t=>({x:t,y:t}),Ny={left:"right",right:"left",bottom:"top",top:"bottom"},Ay={start:"end",end:"start"};function $r(t,e,n){return nt(t,Yt(e,n))}function xn(t,e){return typeof t=="function"?t(e):t}function Xt(t){return t.split("-")[0]}function Pn(t){return t.split("-")[1]}function mu(t){return t==="x"?"y":"x"}function ko(t){return t==="y"?"height":"width"}const Dy=new Set(["top","bottom"]);function At(t){return Dy.has(Xt(t))?"y":"x"}function Ro(t){return mu(At(t))}function Ly(t,e,n){n===void 0&&(n=!1);const s=Pn(t),i=Ro(t),r=ko(i);let o=i==="x"?s===(n?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=ci(o)),[o,ci(o)]}function My(t){const e=ci(t);return[Vr(t),e,Vr(e)]}function Vr(t){return t.replace(/start|end/g,e=>Ay[e])}const $a=["left","right"],Va=["right","left"],jy=["top","bottom"],Fy=["bottom","top"];function Uy(t,e,n){switch(t){case"top":case"bottom":return n?e?Va:$a:e?$a:Va;case"left":case"right":return e?jy:Fy;default:return[]}}function $y(t,e,n,s){const i=Pn(t);let r=Uy(Xt(t),n==="start",s);return i&&(r=r.map(o=>o+"-"+i),e&&(r=r.concat(r.map(Vr)))),r}function ci(t){return t.replace(/left|right|bottom|top/g,e=>Ny[e])}function Vy(t){return{top:0,right:0,bottom:0,left:0,...t}}function gu(t){return typeof t!="number"?Vy(t):{top:t,right:t,bottom:t,left:t}}function li(t){const{x:e,y:n,width:s,height:i}=t;return{width:s,height:i,top:n,left:e,right:e+s,bottom:n+i,x:e,y:n}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var By=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],ui=By.join(","),bu=typeof Element>"u",In=bu?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,di=!bu&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},hi=function t(e,n){var s;n===void 0&&(n=!0);var i=e==null||(s=e.getAttribute)===null||s===void 0?void 0:s.call(e,"inert"),r=i===""||i==="true",o=r||n&&e&&t(e.parentNode);return o},Hy=function(e){var n,s=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return s===""||s==="true"},vu=function(e,n,s){if(hi(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(ui));return n&&In.call(e,ui)&&i.unshift(e),i=i.filter(s),i},yu=function t(e,n,s){for(var i=[],r=Array.from(e);r.length;){var o=r.shift();if(!hi(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,u=t(l,!0,s);s.flatten?i.push.apply(i,u):i.push({scopeParent:o,candidates:u})}else{var d=In.call(o,ui);d&&s.filter(o)&&(n||!e.includes(o))&&i.push(o);var f=o.shadowRoot||typeof s.getShadowRoot=="function"&&s.getShadowRoot(o),c=!hi(f,!1)&&(!s.shadowRootFilter||s.shadowRootFilter(o));if(f&&c){var h=t(f===!0?o.children:f.children,!0,s);s.flatten?i.push.apply(i,h):i.push({scopeParent:o,candidates:h})}else r.unshift.apply(r,o.children)}}return i},Su=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Cu=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Hy(e))&&!Su(e)?0:e.tabIndex},qy=function(e,n){var s=Cu(e);return s<0&&n&&!Su(e)?0:s},Wy=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},Tu=function(e){return e.tagName==="INPUT"},Gy=function(e){return Tu(e)&&e.type==="hidden"},Ky=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(s){return s.tagName==="SUMMARY"});return n},Jy=function(e,n){for(var s=0;s<e.length;s++)if(e[s].checked&&e[s].form===n)return e[s]},zy=function(e){if(!e.name)return!0;var n=e.form||di(e),s=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=s(window.CSS.escape(e.name));else try{i=s(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var r=Jy(i,e.form);return!r||r===e},Yy=function(e){return Tu(e)&&e.type==="radio"},Xy=function(e){return Yy(e)&&!zy(e)},Zy=function(e){var n,s=e&&di(e),i=(n=s)===null||n===void 0?void 0:n.host,r=!1;if(s&&s!==e){var o,a,l;for(r=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!r&&i;){var u,d,f;s=di(i),i=(u=s)===null||u===void 0?void 0:u.host,r=!!((d=i)!==null&&d!==void 0&&(f=d.ownerDocument)!==null&&f!==void 0&&f.contains(i))}}return r},Ba=function(e){var n=e.getBoundingClientRect(),s=n.width,i=n.height;return s===0&&i===0},Qy=function(e,n){var s=n.displayCheck,i=n.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var r=In.call(e,"details>summary:first-of-type"),o=r?e.parentElement:e;if(In.call(o,"details:not([open]) *"))return!0;if(!s||s==="full"||s==="legacy-full"){if(typeof i=="function"){for(var a=e;e;){var l=e.parentElement,u=di(e);if(l&&!l.shadowRoot&&i(l)===!0)return Ba(e);e.assignedSlot?e=e.assignedSlot:!l&&u!==e.ownerDocument?e=u.host:e=l}e=a}if(Zy(e))return!e.getClientRects().length;if(s!=="legacy-full")return!0}else if(s==="non-zero-area")return Ba(e);return!1},eS=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var s=0;s<n.children.length;s++){var i=n.children.item(s);if(i.tagName==="LEGEND")return In.call(n,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}n=n.parentElement}return!1},Br=function(e,n){return!(n.disabled||hi(n)||Gy(n)||Qy(n,e)||Ky(n)||eS(n))},Hr=function(e,n){return!(Xy(n)||Cu(n)<0||!Br(e,n))},tS=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},nS=function t(e){var n=[],s=[];return e.forEach(function(i,r){var o=!!i.scopeParent,a=o?i.scopeParent:i,l=qy(a,o),u=o?t(i.candidates):a;l===0?o?n.push.apply(n,u):n.push(a):s.push({documentOrder:r,tabIndex:l,item:i,isScope:o,content:u})}),s.sort(Wy).reduce(function(i,r){return r.isScope?i.push.apply(i,r.content):i.push(r.content),i},[]).concat(n)},ji=function(e,n){n=n||{};var s;return n.getShadowRoot?s=yu([e],n.includeContainer,{filter:Hr.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:tS}):s=vu(e,n.includeContainer,Hr.bind(null,n)),nS(s)},sS=function(e,n){n=n||{};var s;return n.getShadowRoot?s=yu([e],n.includeContainer,{filter:Br.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):s=vu(e,n.includeContainer,Br.bind(null,n)),s},wu=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return In.call(e,ui)===!1?!1:Hr(n,e)};function ku(){const t=navigator.userAgentData;return t!=null&&t.platform?t.platform:navigator.platform}function Ru(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map(e=>{let{brand:n,version:s}=e;return n+"/"+s}).join(" "):navigator.userAgent}function iS(){return/apple/i.test(navigator.vendor)}function qr(){const t=/android/i;return t.test(ku())||t.test(Ru())}function rS(){return Ru().includes("jsdom/")}const Ha="data-floating-ui-focusable",oS="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])",cr="ArrowLeft",lr="ArrowRight",aS="ArrowUp",cS="ArrowDown";function Bt(t){let e=t.activeElement;for(;((n=e)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;e=e.shadowRoot.activeElement}return e}function Xe(t,e){if(!t||!e)return!1;const n=e.getRootNode==null?void 0:e.getRootNode();if(t.contains(e))return!0;if(n&&Fr(n)){let s=e;for(;s;){if(t===s)return!0;s=s.parentNode||s.host}}return!1}function Ht(t){return"composedPath"in t?t.composedPath()[0]:t.target}function ur(t,e){if(e==null)return!1;if("composedPath"in t)return t.composedPath().includes(e);const n=t;return n.target!=null&&e.contains(n.target)}function lS(t){return t.matches("html,body")}function at(t){return(t==null?void 0:t.ownerDocument)||document}function Eu(t){return Pe(t)&&t.matches(oS)}function Wr(t){return t?t.getAttribute("role")==="combobox"&&Eu(t):!1}function fi(t){return t?t.hasAttribute(Ha)?t:t.querySelector("["+Ha+"]")||t:null}function nn(t,e,n){return n===void 0&&(n=!0),t.filter(i=>{var r;return i.parentId===e&&(!n||((r=i.context)==null?void 0:r.open))}).flatMap(i=>[i,...nn(t,i.id,n)])}function uS(t,e){let n,s=-1;function i(r,o){o>s&&(n=r,s=o),nn(t,r).forEach(l=>{i(l.id,o+1)})}return i(e,0),t.find(r=>r.id===n)}function qa(t,e){var n;let s=[],i=(n=t.find(r=>r.id===e))==null?void 0:n.parentId;for(;i;){const r=t.find(o=>o.id===i);i=r==null?void 0:r.parentId,r&&(s=s.concat(r))}return s}function je(t){t.preventDefault(),t.stopPropagation()}function dS(t){return"nativeEvent"in t}function Iu(t){return t.mozInputSource===0&&t.isTrusted?!0:qr()&&t.pointerType?t.type==="click"&&t.buttons===1:t.detail===0&&!t.pointerType}function _u(t){return rS()?!1:!qr()&&t.width===0&&t.height===0||qr()&&t.width===1&&t.height===1&&t.pressure===0&&t.detail===0&&t.pointerType==="mouse"||t.width<1&&t.height<1&&t.pressure===0&&t.detail===0&&t.pointerType==="touch"}function Wa(t,e){return["mouse","pen"].includes(t)}var hS=typeof document<"u",fS=function(){},be=hS?y.useLayoutEffect:fS;const pS={...Sc};function yt(t){const e=y.useRef(t);return be(()=>{e.current=t}),e}const mS=pS.useInsertionEffect,gS=mS||(t=>t());function Fe(t){const e=y.useRef(()=>{});return gS(()=>{e.current=t}),y.useCallback(function(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return e.current==null?void 0:e.current(...s)},[])}function Cs(t,e,n){return Math.floor(t/e)!==n}function Vn(t,e){return e<0||e>=t.current.length}function dr(t,e){return Be(t,{disabledIndices:e})}function Ga(t,e){return Be(t,{decrement:!0,startingIndex:t.current.length,disabledIndices:e})}function Be(t,e){let{startingIndex:n=-1,decrement:s=!1,disabledIndices:i,amount:r=1}=e===void 0?{}:e,o=n;do o+=s?-r:r;while(o>=0&&o<=t.current.length-1&&Ds(t,o,i));return o}function bS(t,e){let{event:n,orientation:s,loop:i,rtl:r,cols:o,disabledIndices:a,minIndex:l,maxIndex:u,prevIndex:d,stopEvent:f=!1}=e,c=d;if(n.key===aS){if(f&&je(n),d===-1)c=u;else if(c=Be(t,{startingIndex:c,amount:o,decrement:!0,disabledIndices:a}),i&&(d-o<l||c<0)){const h=d%o,m=u%o,p=u-(m-h);m===h?c=u:c=m>h?p:p-o}Vn(t,c)&&(c=d)}if(n.key===cS&&(f&&je(n),d===-1?c=l:(c=Be(t,{startingIndex:d,amount:o,disabledIndices:a}),i&&d+o>u&&(c=Be(t,{startingIndex:d%o-o,amount:o,disabledIndices:a}))),Vn(t,c)&&(c=d)),s==="both"){const h=gn(d/o);n.key===(r?cr:lr)&&(f&&je(n),d%o!==o-1?(c=Be(t,{startingIndex:d,disabledIndices:a}),i&&Cs(c,o,h)&&(c=Be(t,{startingIndex:d-d%o-1,disabledIndices:a}))):i&&(c=Be(t,{startingIndex:d-d%o-1,disabledIndices:a})),Cs(c,o,h)&&(c=d)),n.key===(r?lr:cr)&&(f&&je(n),d%o!==0?(c=Be(t,{startingIndex:d,decrement:!0,disabledIndices:a}),i&&Cs(c,o,h)&&(c=Be(t,{startingIndex:d+(o-d%o),decrement:!0,disabledIndices:a}))):i&&(c=Be(t,{startingIndex:d+(o-d%o),decrement:!0,disabledIndices:a})),Cs(c,o,h)&&(c=d));const m=gn(u/o)===h;Vn(t,c)&&(i&&m?c=n.key===(r?lr:cr)?u:Be(t,{startingIndex:d-d%o-1,disabledIndices:a}):c=d)}return c}function vS(t,e,n){const s=[];let i=0;return t.forEach((r,o)=>{let{width:a,height:l}=r,u=!1;for(n&&(i=0);!u;){const d=[];for(let f=0;f<a;f++)for(let c=0;c<l;c++)d.push(i+f+c*e);i%e+a<=e&&d.every(f=>s[f]==null)?(d.forEach(f=>{s[f]=o}),u=!0):i++}}),[...s]}function yS(t,e,n,s,i){if(t===-1)return-1;const r=n.indexOf(t),o=e[t];switch(i){case"tl":return r;case"tr":return o?r+o.width-1:r;case"bl":return o?r+(o.height-1)*s:r;case"br":return n.lastIndexOf(t)}}function SS(t,e){return e.flatMap((n,s)=>t.includes(n)?[s]:[])}function Ds(t,e,n){if(typeof n=="function")return n(e);if(n)return n.includes(e);const s=t.current[e];return s==null||s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true"}const as=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function xu(t,e){const n=ji(t,as()),s=n.length;if(s===0)return;const i=Bt(at(t)),r=n.indexOf(i),o=r===-1?e===1?0:s-1:r+e;return n[o]}function Pu(t){return xu(at(t).body,1)||t}function Ou(t){return xu(at(t).body,-1)||t}function Bn(t,e){const n=e||t.currentTarget,s=t.relatedTarget;return!s||!Xe(n,s)}function CS(t){ji(t,as()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function Ka(t){t.querySelectorAll("[data-tabindex]").forEach(n=>{const s=n.dataset.tabindex;delete n.dataset.tabindex,s?n.setAttribute("tabindex",s):n.removeAttribute("tabindex")})}function Ja(t,e,n){let{reference:s,floating:i}=t;const r=At(e),o=Ro(e),a=ko(o),l=Xt(e),u=r==="y",d=s.x+s.width/2-i.width/2,f=s.y+s.height/2-i.height/2,c=s[a]/2-i[a]/2;let h;switch(l){case"top":h={x:d,y:s.y-i.height};break;case"bottom":h={x:d,y:s.y+s.height};break;case"right":h={x:s.x+s.width,y:f};break;case"left":h={x:s.x-i.width,y:f};break;default:h={x:s.x,y:s.y}}switch(Pn(e)){case"start":h[o]-=c*(n&&u?-1:1);break;case"end":h[o]+=c*(n&&u?-1:1);break}return h}const TS=async(t,e,n)=>{const{placement:s="bottom",strategy:i="absolute",middleware:r=[],platform:o}=n,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let u=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:d,y:f}=Ja(u,s,l),c=s,h={},m=0;for(let p=0;p<a.length;p++){const{name:g,fn:v}=a[p],{x:C,y:S,data:T,reset:w}=await v({x:d,y:f,initialPlacement:s,placement:c,strategy:i,middlewareData:h,rects:u,platform:o,elements:{reference:t,floating:e}});d=C??d,f=S??f,h={...h,[g]:{...h[g],...T}},w&&m<=50&&(m++,typeof w=="object"&&(w.placement&&(c=w.placement),w.rects&&(u=w.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):w.rects),{x:d,y:f}=Ja(u,c,l)),p=-1)}return{x:d,y:f,placement:c,strategy:i,middlewareData:h}};async function Eo(t,e){var n;e===void 0&&(e={});const{x:s,y:i,platform:r,rects:o,elements:a,strategy:l}=t,{boundary:u="clippingAncestors",rootBoundary:d="viewport",elementContext:f="floating",altBoundary:c=!1,padding:h=0}=xn(e,t),m=gu(h),g=a[c?f==="floating"?"reference":"floating":f],v=li(await r.getClippingRect({element:(n=await(r.isElement==null?void 0:r.isElement(g)))==null||n?g:g.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:u,rootBoundary:d,strategy:l})),C=f==="floating"?{x:s,y:i,width:o.floating.width,height:o.floating.height}:o.reference,S=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),T=await(r.isElement==null?void 0:r.isElement(S))?await(r.getScale==null?void 0:r.getScale(S))||{x:1,y:1}:{x:1,y:1},w=li(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:C,offsetParent:S,strategy:l}):C);return{top:(v.top-w.top+m.top)/T.y,bottom:(w.bottom-v.bottom+m.bottom)/T.y,left:(v.left-w.left+m.left)/T.x,right:(w.right-v.right+m.right)/T.x}}const wS=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:s,placement:i,rects:r,platform:o,elements:a,middlewareData:l}=e,{element:u,padding:d=0}=xn(t,e)||{};if(u==null)return{};const f=gu(d),c={x:n,y:s},h=Ro(i),m=ko(h),p=await o.getDimensions(u),g=h==="y",v=g?"top":"left",C=g?"bottom":"right",S=g?"clientHeight":"clientWidth",T=r.reference[m]+r.reference[h]-c[h]-r.floating[m],w=c[h]-r.reference[h],E=await(o.getOffsetParent==null?void 0:o.getOffsetParent(u));let _=E?E[S]:0;(!_||!await(o.isElement==null?void 0:o.isElement(E)))&&(_=a.floating[S]||r.floating[m]);const A=T/2-w/2,q=_/2-p[m]/2-1,N=Yt(f[v],q),U=Yt(f[C],q),L=N,D=_-p[m]-U,R=_/2-p[m]/2+A,x=$r(L,R,D),$=!l.arrow&&Pn(i)!=null&&R!==x&&r.reference[m]/2-(R<L?N:U)-p[m]/2<0,j=$?R<L?R-L:R-D:0;return{[h]:c[h]+j,data:{[h]:x,centerOffset:R-x-j,...$&&{alignmentOffset:j}},reset:$}}}),kS=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,s;const{placement:i,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:u}=e,{mainAxis:d=!0,crossAxis:f=!0,fallbackPlacements:c,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...g}=xn(t,e);if((n=r.arrow)!=null&&n.alignmentOffset)return{};const v=Xt(i),C=At(a),S=Xt(a)===a,T=await(l.isRTL==null?void 0:l.isRTL(u.floating)),w=c||(S||!p?[ci(a)]:My(a)),E=m!=="none";!c&&E&&w.push(...$y(a,p,m,T));const _=[a,...w],A=await Eo(e,g),q=[];let N=((s=r.flip)==null?void 0:s.overflows)||[];if(d&&q.push(A[v]),f){const R=Ly(i,o,T);q.push(A[R[0]],A[R[1]])}if(N=[...N,{placement:i,overflows:q}],!q.every(R=>R<=0)){var U,L;const R=(((U=r.flip)==null?void 0:U.index)||0)+1,x=_[R];if(x&&(!(f==="alignment"?C!==At(x):!1)||N.every(k=>At(k.placement)===C?k.overflows[0]>0:!0)))return{data:{index:R,overflows:N},reset:{placement:x}};let $=(L=N.filter(j=>j.overflows[0]<=0).sort((j,k)=>j.overflows[1]-k.overflows[1])[0])==null?void 0:L.placement;if(!$)switch(h){case"bestFit":{var D;const j=(D=N.filter(k=>{if(E){const V=At(k.placement);return V===C||V==="y"}return!0}).map(k=>[k.placement,k.overflows.filter(V=>V>0).reduce((V,X)=>V+X,0)]).sort((k,V)=>k[1]-V[1])[0])==null?void 0:D[0];j&&($=j);break}case"initialPlacement":$=a;break}if(i!==$)return{reset:{placement:$}}}return{}}}},RS=new Set(["left","top"]);async function ES(t,e){const{placement:n,platform:s,elements:i}=t,r=await(s.isRTL==null?void 0:s.isRTL(i.floating)),o=Xt(n),a=Pn(n),l=At(n)==="y",u=RS.has(o)?-1:1,d=r&&l?-1:1,f=xn(e,t);let{mainAxis:c,crossAxis:h,alignmentAxis:m}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return a&&typeof m=="number"&&(h=a==="end"?m*-1:m),l?{x:h*d,y:c*u}:{x:c*u,y:h*d}}const IS=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,s;const{x:i,y:r,placement:o,middlewareData:a}=e,l=await ES(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:i+l.x,y:r+l.y,data:{...l,placement:o}}}}},_S=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:s,placement:i}=e,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:v,y:C}=g;return{x:v,y:C}}},...l}=xn(t,e),u={x:n,y:s},d=await Eo(e,l),f=At(Xt(i)),c=mu(f);let h=u[c],m=u[f];if(r){const g=c==="y"?"top":"left",v=c==="y"?"bottom":"right",C=h+d[g],S=h-d[v];h=$r(C,h,S)}if(o){const g=f==="y"?"top":"left",v=f==="y"?"bottom":"right",C=m+d[g],S=m-d[v];m=$r(C,m,S)}const p=a.fn({...e,[c]:h,[f]:m});return{...p,data:{x:p.x-n,y:p.y-s,enabled:{[c]:r,[f]:o}}}}}},xS=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,s;const{placement:i,rects:r,platform:o,elements:a}=e,{apply:l=()=>{},...u}=xn(t,e),d=await Eo(e,u),f=Xt(i),c=Pn(i),h=At(i)==="y",{width:m,height:p}=r.floating;let g,v;f==="top"||f==="bottom"?(g=f,v=c===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(v=f,g=c==="end"?"top":"bottom");const C=p-d.top-d.bottom,S=m-d.left-d.right,T=Yt(p-d[g],C),w=Yt(m-d[v],S),E=!e.middlewareData.shift;let _=T,A=w;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(A=S),(s=e.middlewareData.shift)!=null&&s.enabled.y&&(_=C),E&&!c){const N=nt(d.left,0),U=nt(d.right,0),L=nt(d.top,0),D=nt(d.bottom,0);h?A=m-2*(N!==0||U!==0?N+U:nt(d.left,d.right)):_=p-2*(L!==0||D!==0?L+D:nt(d.top,d.bottom))}await l({...e,availableWidth:A,availableHeight:_});const q=await o.getDimensions(a.floating);return m!==q.width||p!==q.height?{reset:{rects:!0}}:{}}}};function Nu(t){const e=it(t);let n=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const i=Pe(t),r=i?t.offsetWidth:n,o=i?t.offsetHeight:s,a=ai(n)!==r||ai(s)!==o;return a&&(n=r,s=o),{width:n,height:s,$:a}}function Io(t){return _e(t)?t:t.contextElement}function yn(t){const e=Io(t);if(!Pe(e))return Tt(1);const n=e.getBoundingClientRect(),{width:s,height:i,$:r}=Nu(e);let o=(r?ai(n.width):n.width)/s,a=(r?ai(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const PS=Tt(0);function Au(t){const e=st(t);return!Li()||!e.visualViewport?PS:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function OS(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==st(t)?!1:e}function on(t,e,n,s){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),r=Io(t);let o=Tt(1);e&&(s?_e(s)&&(o=yn(s)):o=yn(t));const a=OS(r,n,s)?Au(r):Tt(0);let l=(i.left+a.x)/o.x,u=(i.top+a.y)/o.y,d=i.width/o.x,f=i.height/o.y;if(r){const c=st(r),h=s&&_e(s)?st(s):s;let m=c,p=Ur(m);for(;p&&s&&h!==m;){const g=yn(p),v=p.getBoundingClientRect(),C=it(p),S=v.left+(p.clientLeft+parseFloat(C.paddingLeft))*g.x,T=v.top+(p.clientTop+parseFloat(C.paddingTop))*g.y;l*=g.x,u*=g.y,d*=g.x,f*=g.y,l+=S,u+=T,m=st(p),p=Ur(m)}}return li({width:d,height:f,x:l,y:u})}function Fi(t,e){const n=Mi(t).scrollLeft;return e?e.left+n:on(Et(t)).left+n}function Du(t,e){const n=t.getBoundingClientRect(),s=n.left+e.scrollLeft-Fi(t,n),i=n.top+e.scrollTop;return{x:s,y:i}}function NS(t){let{elements:e,rect:n,offsetParent:s,strategy:i}=t;const r=i==="fixed",o=Et(s),a=e?Di(e.floating):!1;if(s===o||a&&r)return n;let l={scrollLeft:0,scrollTop:0},u=Tt(1);const d=Tt(0),f=Pe(s);if((f||!f&&!r)&&((Qt(s)!=="body"||os(o))&&(l=Mi(s)),Pe(s))){const h=on(s);u=yn(s),d.x=h.x+s.clientLeft,d.y=h.y+s.clientTop}const c=o&&!f&&!r?Du(o,l):Tt(0);return{width:n.width*u.x,height:n.height*u.y,x:n.x*u.x-l.scrollLeft*u.x+d.x+c.x,y:n.y*u.y-l.scrollTop*u.y+d.y+c.y}}function AS(t){return Array.from(t.getClientRects())}function DS(t){const e=Et(t),n=Mi(t),s=t.ownerDocument.body,i=nt(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),r=nt(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let o=-n.scrollLeft+Fi(t);const a=-n.scrollTop;return it(s).direction==="rtl"&&(o+=nt(e.clientWidth,s.clientWidth)-i),{width:i,height:r,x:o,y:a}}const za=25;function LS(t,e){const n=st(t),s=Et(t),i=n.visualViewport;let r=s.clientWidth,o=s.clientHeight,a=0,l=0;if(i){r=i.width,o=i.height;const d=Li();(!d||d&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}const u=Fi(s);if(u<=0){const d=s.ownerDocument,f=d.body,c=getComputedStyle(f),h=d.compatMode==="CSS1Compat"&&parseFloat(c.marginLeft)+parseFloat(c.marginRight)||0,m=Math.abs(s.clientWidth-f.clientWidth-h);m<=za&&(r-=m)}else u<=za&&(r+=u);return{width:r,height:o,x:a,y:l}}const MS=new Set(["absolute","fixed"]);function jS(t,e){const n=on(t,!0,e==="fixed"),s=n.top+t.clientTop,i=n.left+t.clientLeft,r=Pe(t)?yn(t):Tt(1),o=t.clientWidth*r.x,a=t.clientHeight*r.y,l=i*r.x,u=s*r.y;return{width:o,height:a,x:l,y:u}}function Ya(t,e,n){let s;if(e==="viewport")s=LS(t,n);else if(e==="document")s=DS(Et(t));else if(_e(e))s=jS(e,n);else{const i=Au(t);s={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return li(s)}function Lu(t,e){const n=jt(t);return n===e||!_e(n)||Dt(n)?!1:it(n).position==="fixed"||Lu(n,e)}function FS(t,e){const n=e.get(t);if(n)return n;let s=Jt(t,[],!1).filter(a=>_e(a)&&Qt(a)!=="body"),i=null;const r=it(t).position==="fixed";let o=r?jt(t):t;for(;_e(o)&&!Dt(o);){const a=it(o),l=wo(o);!l&&a.position==="fixed"&&(i=null),(r?!l&&!i:!l&&a.position==="static"&&!!i&&MS.has(i.position)||os(o)&&!l&&Lu(t,o))?s=s.filter(d=>d!==o):i=a,o=jt(o)}return e.set(t,s),s}function US(t){let{element:e,boundary:n,rootBoundary:s,strategy:i}=t;const o=[...n==="clippingAncestors"?Di(e)?[]:FS(e,this._c):[].concat(n),s],a=o[0],l=o.reduce((u,d)=>{const f=Ya(e,d,i);return u.top=nt(f.top,u.top),u.right=Yt(f.right,u.right),u.bottom=Yt(f.bottom,u.bottom),u.left=nt(f.left,u.left),u},Ya(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function $S(t){const{width:e,height:n}=Nu(t);return{width:e,height:n}}function VS(t,e,n){const s=Pe(e),i=Et(e),r=n==="fixed",o=on(t,!0,r,e);let a={scrollLeft:0,scrollTop:0};const l=Tt(0);function u(){l.x=Fi(i)}if(s||!s&&!r)if((Qt(e)!=="body"||os(i))&&(a=Mi(e)),s){const h=on(e,!0,r,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else i&&u();r&&!s&&i&&u();const d=i&&!s&&!r?Du(i,a):Tt(0),f=o.left+a.scrollLeft-l.x-d.x,c=o.top+a.scrollTop-l.y-d.y;return{x:f,y:c,width:o.width,height:o.height}}function hr(t){return it(t).position==="static"}function Xa(t,e){if(!Pe(t)||it(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Et(t)===n&&(n=n.ownerDocument.body),n}function Mu(t,e){const n=st(t);if(Di(t))return n;if(!Pe(t)){let i=jt(t);for(;i&&!Dt(i);){if(_e(i)&&!hr(i))return i;i=jt(i)}return n}let s=Xa(t,e);for(;s&&Ry(s)&&hr(s);)s=Xa(s,e);return s&&Dt(s)&&hr(s)&&!wo(s)?n:s||Py(t)||n}const BS=async function(t){const e=this.getOffsetParent||Mu,n=this.getDimensions,s=await n(t.floating);return{reference:VS(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function HS(t){return it(t).direction==="rtl"}const qS={convertOffsetParentRelativeRectToViewportRelativeRect:NS,getDocumentElement:Et,getClippingRect:US,getOffsetParent:Mu,getElementRects:BS,getClientRects:AS,getDimensions:$S,getScale:yn,isElement:_e,isRTL:HS};function ju(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function WS(t,e){let n=null,s;const i=Et(t);function r(){var a;clearTimeout(s),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),r();const u=t.getBoundingClientRect(),{left:d,top:f,width:c,height:h}=u;if(a||e(),!c||!h)return;const m=gn(f),p=gn(i.clientWidth-(d+c)),g=gn(i.clientHeight-(f+h)),v=gn(d),S={rootMargin:-m+"px "+-p+"px "+-g+"px "+-v+"px",threshold:nt(0,Yt(1,l))||1};let T=!0;function w(E){const _=E[0].intersectionRatio;if(_!==l){if(!T)return o();_?o(!1,_):s=setTimeout(()=>{o(!1,1e-7)},1e3)}_===1&&!ju(u,t.getBoundingClientRect())&&o(),T=!1}try{n=new IntersectionObserver(w,{...S,root:i.ownerDocument})}catch{n=new IntersectionObserver(w,S)}n.observe(t)}return o(!0),r}function Fu(t,e,n,s){s===void 0&&(s={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=s,u=Io(t),d=i||r?[...u?Jt(u):[],...Jt(e)]:[];d.forEach(v=>{i&&v.addEventListener("scroll",n,{passive:!0}),r&&v.addEventListener("resize",n)});const f=u&&a?WS(u,n):null;let c=-1,h=null;o&&(h=new ResizeObserver(v=>{let[C]=v;C&&C.target===u&&h&&(h.unobserve(e),cancelAnimationFrame(c),c=requestAnimationFrame(()=>{var S;(S=h)==null||S.observe(e)})),n()}),u&&!l&&h.observe(u),h.observe(e));let m,p=l?on(t):null;l&&g();function g(){const v=on(t);p&&!ju(p,v)&&n(),p=v,m=requestAnimationFrame(g)}return n(),()=>{var v;d.forEach(C=>{i&&C.removeEventListener("scroll",n),r&&C.removeEventListener("resize",n)}),f==null||f(),(v=h)==null||v.disconnect(),h=null,l&&cancelAnimationFrame(m)}}const GS=IS,KS=_S,JS=kS,zS=xS,Za=wS,YS=(t,e,n)=>{const s=new Map,i={platform:qS,...n},r={...i.platform,_c:s};return TS(t,e,{...i,platform:r})};var XS=typeof document<"u",ZS=function(){},Ls=XS?y.useLayoutEffect:ZS;function pi(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,s,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(s=n;s--!==0;)if(!pi(t[s],e[s]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(s=n;s--!==0;)if(!{}.hasOwnProperty.call(e,i[s]))return!1;for(s=n;s--!==0;){const r=i[s];if(!(r==="_owner"&&t.$$typeof)&&!pi(t[r],e[r]))return!1}return!0}return t!==t&&e!==e}function Uu(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Qa(t,e){const n=Uu(t);return Math.round(e*n)/n}function fr(t){const e=y.useRef(t);return Ls(()=>{e.current=t}),e}function QS(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:s=[],platform:i,elements:{reference:r,floating:o}={},transform:a=!0,whileElementsMounted:l,open:u}=t,[d,f]=y.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[c,h]=y.useState(s);pi(c,s)||h(s);const[m,p]=y.useState(null),[g,v]=y.useState(null),C=y.useCallback(k=>{k!==E.current&&(E.current=k,p(k))},[]),S=y.useCallback(k=>{k!==_.current&&(_.current=k,v(k))},[]),T=r||m,w=o||g,E=y.useRef(null),_=y.useRef(null),A=y.useRef(d),q=l!=null,N=fr(l),U=fr(i),L=fr(u),D=y.useCallback(()=>{if(!E.current||!_.current)return;const k={placement:e,strategy:n,middleware:c};U.current&&(k.platform=U.current),YS(E.current,_.current,k).then(V=>{const X={...V,isPositioned:L.current!==!1};R.current&&!pi(A.current,X)&&(A.current=X,Tc.flushSync(()=>{f(X)}))})},[c,e,n,U,L]);Ls(()=>{u===!1&&A.current.isPositioned&&(A.current.isPositioned=!1,f(k=>({...k,isPositioned:!1})))},[u]);const R=y.useRef(!1);Ls(()=>(R.current=!0,()=>{R.current=!1}),[]),Ls(()=>{if(T&&(E.current=T),w&&(_.current=w),T&&w){if(N.current)return N.current(T,w,D);D()}},[T,w,D,N,q]);const x=y.useMemo(()=>({reference:E,floating:_,setReference:C,setFloating:S}),[C,S]),$=y.useMemo(()=>({reference:T,floating:w}),[T,w]),j=y.useMemo(()=>{const k={position:n,left:0,top:0};if(!$.floating)return k;const V=Qa($.floating,d.x),X=Qa($.floating,d.y);return a?{...k,transform:"translate("+V+"px, "+X+"px)",...Uu($.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:V,top:X}},[n,a,$.floating,d.x,d.y]);return y.useMemo(()=>({...d,update:D,refs:x,elements:$,floatingStyles:j}),[d,D,x,$,j])}const eC=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:s,padding:i}=typeof t=="function"?t(n):t;return s&&e(s)?s.current!=null?Za({element:s.current,padding:i}).fn(n):{}:s?Za({element:s,padding:i}).fn(n):{}}}},tC=(t,e)=>({...GS(t),options:[t,e]}),nC=(t,e)=>({...KS(t),options:[t,e]}),$u=(t,e)=>({...JS(t),options:[t,e]}),sC=(t,e)=>({...zS(t),options:[t,e]}),iC=(t,e)=>({...eC(t),options:[t,e]});function rC(t,e){const n=t.compareDocumentPosition(e);return n&Node.DOCUMENT_POSITION_FOLLOWING||n&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:n&Node.DOCUMENT_POSITION_PRECEDING||n&Node.DOCUMENT_POSITION_CONTAINS?1:0}const Vu=y.createContext({register:()=>{},unregister:()=>{},map:new Map,elementsRef:{current:[]}});function oC(t){const{children:e,elementsRef:n,labelsRef:s}=t,[i,r]=y.useState(()=>new Set),o=y.useCallback(u=>{r(d=>new Set(d).add(u))},[]),a=y.useCallback(u=>{r(d=>{const f=new Set(d);return f.delete(u),f})},[]),l=y.useMemo(()=>{const u=new Map;return Array.from(i.keys()).sort(rC).forEach((f,c)=>{u.set(f,c)}),u},[i]);return b.jsx(Vu.Provider,{value:y.useMemo(()=>({register:o,unregister:a,map:l,elementsRef:n,labelsRef:s}),[o,a,l,n,s]),children:e})}function aC(t){t===void 0&&(t={});const{label:e}=t,{register:n,unregister:s,map:i,elementsRef:r,labelsRef:o}=y.useContext(Vu),[a,l]=y.useState(null),u=y.useRef(null),d=y.useCallback(f=>{if(u.current=f,a!==null&&(r.current[a]=f,o)){var c;const h=e!==void 0;o.current[a]=h?e:(c=f==null?void 0:f.textContent)!=null?c:null}},[a,r,o,e]);return be(()=>{const f=u.current;if(f)return n(f),()=>{s(f)}},[n,s]),be(()=>{const f=u.current?i.get(u.current):null;f!=null&&l(f)},[i]),y.useMemo(()=>({ref:d,index:a??-1}),[a,d])}const cC="data-floating-ui-focusable",ec="active",tc="selected",cs="ArrowLeft",ls="ArrowRight",Bu="ArrowUp",Ui="ArrowDown",lC={...Sc};let nc=!1,uC=0;const sc=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+uC++;function dC(){const[t,e]=y.useState(()=>nc?sc():void 0);return be(()=>{t==null&&e(sc())},[]),y.useEffect(()=>{nc=!0},[]),t}const hC=lC.useId,$i=hC||dC,fC=y.forwardRef(function(e,n){const{context:{placement:s,elements:{floating:i},middlewareData:{arrow:r,shift:o}},width:a=14,height:l=7,tipRadius:u=0,strokeWidth:d=0,staticOffset:f,stroke:c,d:h,style:{transform:m,...p}={},...g}=e,v=$i(),[C,S]=y.useState(!1);if(be(()=>{if(!i)return;it(i).direction==="rtl"&&S(!0)},[i]),!i)return null;const[T,w]=s.split("-"),E=T==="top"||T==="bottom";let _=f;(E&&o!=null&&o.x||!E&&o!=null&&o.y)&&(_=null);const A=d*2,q=A/2,N=a/2*(u/-8+1),U=l/2*u/4,L=!!h,D=_&&w==="end"?"bottom":"top";let R=_&&w==="end"?"right":"left";_&&C&&(R=w==="end"?"left":"right");const x=(r==null?void 0:r.x)!=null?_||r.x:"",$=(r==null?void 0:r.y)!=null?_||r.y:"",j=h||"M0,0"+(" H"+a)+(" L"+(a-N)+","+(l-U))+(" Q"+a/2+","+l+" "+N+","+(l-U))+" Z",k={top:L?"rotate(180deg)":"",left:L?"rotate(90deg)":"rotate(-90deg)",bottom:L?"":"rotate(180deg)",right:L?"rotate(-90deg)":"rotate(90deg)"}[T];return b.jsxs("svg",{...g,"aria-hidden":!0,ref:n,width:L?a:a+A,height:a,viewBox:"0 0 "+a+" "+(l>a?l:a),style:{position:"absolute",pointerEvents:"none",[R]:x,[D]:$,[T]:E||L?"100%":"calc(100% - "+A/2+"px)",transform:[k,m].filter(V=>!!V).join(" "),...p},children:[A>0&&b.jsx("path",{clipPath:"url(#"+v+")",fill:"none",stroke:c,strokeWidth:A+(h?0:1),d:j}),b.jsx("path",{stroke:A&&!h?g.fill:"none",d:j}),b.jsx("clipPath",{id:v,children:b.jsx("rect",{x:-q,y:q*(L?-1:1),width:a+A,height:a})})]})});function pC(){const t=new Map;return{emit(e,n){var s;(s=t.get(e))==null||s.forEach(i=>i(n))},on(e,n){t.has(e)||t.set(e,new Set),t.get(e).add(n)},off(e,n){var s;(s=t.get(e))==null||s.delete(n)}}}const mC=y.createContext(null),gC=y.createContext(null),_o=()=>{var t;return((t=y.useContext(mC))==null?void 0:t.id)||null},Vi=()=>y.useContext(gC);function es(t){return"data-floating-ui-"+t}function Gr(t){t.current!==-1&&(clearTimeout(t.current),t.current=-1)}let ic=0;function tn(t,e){e===void 0&&(e={});const{preventScroll:n=!1,cancelPrevious:s=!0,sync:i=!1}=e;s&&cancelAnimationFrame(ic);const r=()=>t==null?void 0:t.focus({preventScroll:n});i?r():ic=requestAnimationFrame(r)}function bC(t){return(t==null?void 0:t.ownerDocument)||document}const Sn={inert:new WeakMap,"aria-hidden":new WeakMap,none:new WeakMap};function rc(t){return t==="inert"?Sn.inert:t==="aria-hidden"?Sn["aria-hidden"]:Sn.none}let Ts=new WeakSet,ws={},pr=0;const vC=()=>typeof HTMLElement<"u"&&"inert"in HTMLElement.prototype,Hu=t=>t&&(t.host||Hu(t.parentNode)),yC=(t,e)=>e.map(n=>{if(t.contains(n))return n;const s=Hu(n);return t.contains(s)?s:null}).filter(n=>n!=null);function SC(t,e,n,s){const i="data-floating-ui-inert",r=s?"inert":n?"aria-hidden":null,o=yC(e,t),a=new Set,l=new Set(o),u=[];ws[i]||(ws[i]=new WeakMap);const d=ws[i];o.forEach(f),c(e),a.clear();function f(h){!h||a.has(h)||(a.add(h),h.parentNode&&f(h.parentNode))}function c(h){!h||l.has(h)||[].forEach.call(h.children,m=>{if(Qt(m)!=="script")if(a.has(m))c(m);else{const p=r?m.getAttribute(r):null,g=p!==null&&p!=="false",v=rc(r),C=(v.get(m)||0)+1,S=(d.get(m)||0)+1;v.set(m,C),d.set(m,S),u.push(m),C===1&&g&&Ts.add(m),S===1&&m.setAttribute(i,""),!g&&r&&m.setAttribute(r,r==="inert"?"":"true")}})}return pr++,()=>{u.forEach(h=>{const m=rc(r),g=(m.get(h)||0)-1,v=(d.get(h)||0)-1;m.set(h,g),d.set(h,v),g||(!Ts.has(h)&&r&&h.removeAttribute(r),Ts.delete(h)),v||h.removeAttribute(i)}),pr--,pr||(Sn.inert=new WeakMap,Sn["aria-hidden"]=new WeakMap,Sn.none=new WeakMap,Ts=new WeakSet,ws={})}}function oc(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);const s=bC(t[0]).body;return SC(t.concat(Array.from(s.querySelectorAll('[aria-live],[role="status"],output'))),s,e,n)}const Bi={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0},mi=y.forwardRef(function(e,n){const[s,i]=y.useState();be(()=>{iS()&&i("button")},[]);const r={ref:n,tabIndex:0,role:s,"aria-hidden":s?void 0:!0,[es("focus-guard")]:"",style:Bi};return b.jsx("span",{...e,...r})}),qu=y.createContext(null),ac=es("portal");function CC(t){t===void 0&&(t={});const{id:e,root:n}=t,s=$i(),i=Wu(),[r,o]=y.useState(null),a=y.useRef(null);return be(()=>()=>{r==null||r.remove(),queueMicrotask(()=>{a.current=null})},[r]),be(()=>{if(!s||a.current)return;const l=e?document.getElementById(e):null;if(!l)return;const u=document.createElement("div");u.id=s,u.setAttribute(ac,""),l.appendChild(u),a.current=u,o(u)},[e,s]),be(()=>{if(n===null||!s||a.current)return;let l=n||(i==null?void 0:i.portalNode);l&&!To(l)&&(l=l.current),l=l||document.body;let u=null;e&&(u=document.createElement("div"),u.id=e,l.appendChild(u));const d=document.createElement("div");d.id=s,d.setAttribute(ac,""),l=u||l,l.appendChild(d),a.current=d,o(d)},[e,n,s,i]),r}function TC(t){const{children:e,id:n,root:s,preserveTabOrder:i=!0}=t,r=CC({id:n,root:s}),[o,a]=y.useState(null),l=y.useRef(null),u=y.useRef(null),d=y.useRef(null),f=y.useRef(null),c=o==null?void 0:o.modal,h=o==null?void 0:o.open,m=!!o&&!o.modal&&o.open&&i&&!!(s||r);return y.useEffect(()=>{if(!r||!i||c)return;function p(g){r&&Bn(g)&&(g.type==="focusin"?Ka:CS)(r)}return r.addEventListener("focusin",p,!0),r.addEventListener("focusout",p,!0),()=>{r.removeEventListener("focusin",p,!0),r.removeEventListener("focusout",p,!0)}},[r,i,c]),y.useEffect(()=>{r&&(h||Ka(r))},[h,r]),b.jsxs(qu.Provider,{value:y.useMemo(()=>({preserveTabOrder:i,beforeOutsideRef:l,afterOutsideRef:u,beforeInsideRef:d,afterInsideRef:f,portalNode:r,setFocusManagerState:a}),[i,r]),children:[m&&r&&b.jsx(mi,{"data-type":"outside",ref:l,onFocus:p=>{if(Bn(p,r)){var g;(g=d.current)==null||g.focus()}else{const v=o?o.domReference:null,C=Ou(v);C==null||C.focus()}}}),m&&r&&b.jsx("span",{"aria-owns":r.id,style:Bi}),r&&Tc.createPortal(e,r),m&&r&&b.jsx(mi,{"data-type":"outside",ref:u,onFocus:p=>{if(Bn(p,r)){var g;(g=f.current)==null||g.focus()}else{const v=o?o.domReference:null,C=Pu(v);C==null||C.focus(),o!=null&&o.closeOnFocusOut&&(o==null||o.onOpenChange(!1,p.nativeEvent,"focus-out"))}}})]})}const Wu=()=>y.useContext(qu);function cc(t){return y.useMemo(()=>e=>{t.forEach(n=>{n&&(n.current=e)})},t)}const wC=20;let qt=[];function xo(){qt=qt.filter(t=>t.isConnected)}function kC(t){xo(),t&&Qt(t)!=="body"&&(qt.push(t),qt.length>wC&&(qt=qt.slice(-20)))}function lc(){return xo(),qt[qt.length-1]}function RC(t){const e=as();return wu(t,e)?t:ji(t,e)[0]||t}function uc(t,e){var n;if(!e.current.includes("floating")&&!((n=t.getAttribute("role"))!=null&&n.includes("dialog")))return;const s=as(),r=sS(t,s).filter(a=>{const l=a.getAttribute("data-tabindex")||"";return wu(a,s)||a.hasAttribute("data-tabindex")&&!l.startsWith("-")}),o=t.getAttribute("tabindex");e.current.includes("floating")||r.length===0?o!=="0"&&t.setAttribute("tabindex","0"):(o!=="-1"||t.hasAttribute("data-tabindex")&&t.getAttribute("data-tabindex")!=="-1")&&(t.setAttribute("tabindex","-1"),t.setAttribute("data-tabindex","-1"))}const EC=y.forwardRef(function(e,n){return b.jsx("button",{...e,type:"button",ref:n,tabIndex:-1,style:Bi})});function IC(t){const{context:e,children:n,disabled:s=!1,order:i=["content"],guards:r=!0,initialFocus:o=0,returnFocus:a=!0,restoreFocus:l=!1,modal:u=!0,visuallyHiddenDismiss:d=!1,closeOnFocusOut:f=!0,outsideElementsInert:c=!1,getInsideElements:h=()=>[]}=t,{open:m,onOpenChange:p,events:g,dataRef:v,elements:{domReference:C,floating:S}}=e,T=Fe(()=>{var Q;return(Q=v.current.floatingContext)==null?void 0:Q.nodeId}),w=Fe(h),E=typeof o=="number"&&o<0,_=Wr(C)&&E,A=vC(),q=A?r:!0,N=!q||A&&c,U=yt(i),L=yt(o),D=yt(a),R=Vi(),x=Wu(),$=y.useRef(null),j=y.useRef(null),k=y.useRef(!1),V=y.useRef(!1),X=y.useRef(-1),xe=y.useRef(-1),Ae=x!=null,ne=fi(S),ke=Fe(function(Q){return Q===void 0&&(Q=ne),Q?ji(Q,as()):[]}),fe=Fe(Q=>{const ie=ke(Q);return U.current.map(ee=>C&&ee==="reference"?C:ne&&ee==="floating"?ne:ie).filter(Boolean).flat()});y.useEffect(()=>{if(s||!u)return;function Q(ee){if(ee.key==="Tab"){Xe(ne,Bt(at(ne)))&&ke().length===0&&!_&&je(ee);const le=fe(),ye=Ht(ee);U.current[0]==="reference"&&ye===C&&(je(ee),ee.shiftKey?tn(le[le.length-1]):tn(le[1])),U.current[1]==="floating"&&ye===ne&&ee.shiftKey&&(je(ee),tn(le[0]))}}const ie=at(ne);return ie.addEventListener("keydown",Q),()=>{ie.removeEventListener("keydown",Q)}},[s,C,ne,u,U,_,ke,fe]),y.useEffect(()=>{if(s||!S)return;function Q(ie){const ee=Ht(ie),ye=ke().indexOf(ee);ye!==-1&&(X.current=ye)}return S.addEventListener("focusin",Q),()=>{S.removeEventListener("focusin",Q)}},[s,S,ke]),y.useEffect(()=>{if(s||!f)return;function Q(){V.current=!0,setTimeout(()=>{V.current=!1})}function ie(ye){const oe=ye.relatedTarget,Re=ye.currentTarget,Te=Ht(ye);queueMicrotask(()=>{const De=T(),et=!(Xe(C,oe)||Xe(S,oe)||Xe(oe,S)||Xe(x==null?void 0:x.portalNode,oe)||oe!=null&&oe.hasAttribute(es("focus-guard"))||R&&(nn(R.nodesRef.current,De).find(H=>{var K,F;return Xe((K=H.context)==null?void 0:K.elements.floating,oe)||Xe((F=H.context)==null?void 0:F.elements.domReference,oe)})||qa(R.nodesRef.current,De).find(H=>{var K,F,ae;return[(K=H.context)==null?void 0:K.elements.floating,fi((F=H.context)==null?void 0:F.elements.floating)].includes(oe)||((ae=H.context)==null?void 0:ae.elements.domReference)===oe})));if(Re===C&&ne&&uc(ne,U),l&&Re!==C&&!(Te!=null&&Te.isConnected)&&Bt(at(ne))===at(ne).body){Pe(ne)&&ne.focus();const H=X.current,K=ke(),F=K[H]||K[K.length-1]||ne;Pe(F)&&F.focus()}if(v.current.insideReactTree){v.current.insideReactTree=!1;return}(_||!u)&&oe&&et&&!V.current&&oe!==lc()&&(k.current=!0,p(!1,ye,"focus-out"))})}const ee=!!(!R&&x);function le(){Gr(xe),v.current.insideReactTree=!0,xe.current=window.setTimeout(()=>{v.current.insideReactTree=!1})}if(S&&Pe(C))return C.addEventListener("focusout",ie),C.addEventListener("pointerdown",Q),S.addEventListener("focusout",ie),ee&&S.addEventListener("focusout",le,!0),()=>{C.removeEventListener("focusout",ie),C.removeEventListener("pointerdown",Q),S.removeEventListener("focusout",ie),ee&&S.removeEventListener("focusout",le,!0)}},[s,C,S,ne,u,R,x,p,f,l,ke,_,T,U,v]);const Ce=y.useRef(null),$e=y.useRef(null),Ut=cc([Ce,x==null?void 0:x.beforeInsideRef]),It=cc([$e,x==null?void 0:x.afterInsideRef]);y.useEffect(()=>{var Q,ie;if(s||!S)return;const ee=Array.from((x==null||(Q=x.portalNode)==null?void 0:Q.querySelectorAll("["+es("portal")+"]"))||[]),ye=(ie=(R?qa(R.nodesRef.current,T()):[]).find(Te=>{var De;return Wr(((De=Te.context)==null?void 0:De.elements.domReference)||null)}))==null||(ie=ie.context)==null?void 0:ie.elements.domReference,oe=[S,ye,...ee,...w(),$.current,j.current,Ce.current,$e.current,x==null?void 0:x.beforeOutsideRef.current,x==null?void 0:x.afterOutsideRef.current,U.current.includes("reference")||_?C:null].filter(Te=>Te!=null),Re=u||_?oc(oe,!N,N):oc(oe);return()=>{Re()}},[s,C,S,u,U,x,_,q,N,R,T,w]),be(()=>{if(s||!Pe(ne))return;const Q=at(ne),ie=Bt(Q);queueMicrotask(()=>{const ee=fe(ne),le=L.current,ye=(typeof le=="number"?ee[le]:le.current)||ne,oe=Xe(ne,ie);!E&&!oe&&m&&tn(ye,{preventScroll:ye===ne})})},[s,m,ne,E,fe,L]),be(()=>{if(s||!ne)return;const Q=at(ne),ie=Bt(Q);kC(ie);function ee(oe){let{reason:Re,event:Te,nested:De}=oe;if(["hover","safe-polygon"].includes(Re)&&Te.type==="mouseleave"&&(k.current=!0),Re==="outside-press")if(De)k.current=!1;else if(Iu(Te)||_u(Te))k.current=!1;else{let et=!1;document.createElement("div").focus({get preventScroll(){return et=!0,!1}}),et?k.current=!1:k.current=!0}}g.on("openchange",ee);const le=Q.createElement("span");le.setAttribute("tabindex","-1"),le.setAttribute("aria-hidden","true"),Object.assign(le.style,Bi),Ae&&C&&C.insertAdjacentElement("afterend",le);function ye(){if(typeof D.current=="boolean"){const oe=C||lc();return oe&&oe.isConnected?oe:le}return D.current.current||le}return()=>{g.off("openchange",ee);const oe=Bt(Q),Re=Xe(S,oe)||R&&nn(R.nodesRef.current,T(),!1).some(De=>{var et;return Xe((et=De.context)==null?void 0:et.elements.floating,oe)}),Te=ye();queueMicrotask(()=>{const De=RC(Te);D.current&&!k.current&&Pe(De)&&(!(De!==oe&&oe!==Q.body)||Re)&&De.focus({preventScroll:!0}),le.remove()})}},[s,S,ne,D,v,g,R,Ae,C,T]),y.useEffect(()=>(queueMicrotask(()=>{k.current=!1}),()=>{queueMicrotask(xo)}),[s]),be(()=>{if(!s&&x)return x.setFocusManagerState({modal:u,closeOnFocusOut:f,open:m,onOpenChange:p,domReference:C}),()=>{x.setFocusManagerState(null)}},[s,x,u,m,p,f,C]),be(()=>{s||ne&&uc(ne,U)},[s,ne,U]);function ot(Q){return s||!d||!u?null:b.jsx(EC,{ref:Q==="start"?$:j,onClick:ie=>p(!1,ie.nativeEvent),children:typeof d=="string"?d:"Dismiss"})}const _t=!s&&q&&(u?!_:!0)&&(Ae||u);return b.jsxs(b.Fragment,{children:[_t&&b.jsx(mi,{"data-type":"inside",ref:Ut,onFocus:Q=>{if(u){const ee=fe();tn(i[0]==="reference"?ee[0]:ee[ee.length-1])}else if(x!=null&&x.preserveTabOrder&&x.portalNode)if(k.current=!1,Bn(Q,x.portalNode)){const ee=Pu(C);ee==null||ee.focus()}else{var ie;(ie=x.beforeOutsideRef.current)==null||ie.focus()}}}),!_&&ot("start"),n,ot("end"),_t&&b.jsx(mi,{"data-type":"inside",ref:It,onFocus:Q=>{if(u)tn(fe()[0]);else if(x!=null&&x.preserveTabOrder&&x.portalNode)if(f&&(k.current=!0),Bn(Q,x.portalNode)){const ee=Ou(C);ee==null||ee.focus()}else{var ie;(ie=x.afterOutsideRef.current)==null||ie.focus()}}})]})}let ks=0;const dc="--floating-ui-scrollbar-width";function _C(){const t=ku(),e=/iP(hone|ad|od)|iOS/.test(t)||t==="MacIntel"&&navigator.maxTouchPoints>1,n=document.body.style,i=Math.round(document.documentElement.getBoundingClientRect().left)+document.documentElement.scrollLeft?"paddingLeft":"paddingRight",r=window.innerWidth-document.documentElement.clientWidth,o=n.left?parseFloat(n.left):window.scrollX,a=n.top?parseFloat(n.top):window.scrollY;if(n.overflow="hidden",n.setProperty(dc,r+"px"),r&&(n[i]=r+"px"),e){var l,u;const d=((l=window.visualViewport)==null?void 0:l.offsetLeft)||0,f=((u=window.visualViewport)==null?void 0:u.offsetTop)||0;Object.assign(n,{position:"fixed",top:-(a-Math.floor(f))+"px",left:-(o-Math.floor(d))+"px",right:"0"})}return()=>{Object.assign(n,{overflow:"",[i]:""}),n.removeProperty(dc),e&&(Object.assign(n,{position:"",top:"",left:"",right:""}),window.scrollTo(o,a))}}let hc=()=>{};const xC=y.forwardRef(function(e,n){const{lockScroll:s=!1,...i}=e;return be(()=>{if(s)return ks++,ks===1&&(hc=_C()),()=>{ks--,ks===0&&hc()}},[s]),b.jsx("div",{ref:n,...i,style:{position:"fixed",overflow:"auto",top:0,right:0,bottom:0,left:0,...i.style}})});function fc(t){return Pe(t.target)&&t.target.tagName==="BUTTON"}function PC(t){return Pe(t.target)&&t.target.tagName==="A"}function pc(t){return Eu(t)}function OC(t,e){e===void 0&&(e={});const{open:n,onOpenChange:s,dataRef:i,elements:{domReference:r}}=t,{enabled:o=!0,event:a="click",toggle:l=!0,ignoreMouse:u=!1,keyboardHandlers:d=!0,stickIfOpen:f=!0}=e,c=y.useRef(),h=y.useRef(!1),m=y.useMemo(()=>({onPointerDown(p){c.current=p.pointerType},onMouseDown(p){const g=c.current;p.button===0&&a!=="click"&&(Wa(g)&&u||(n&&l&&(!(i.current.openEvent&&f)||i.current.openEvent.type==="mousedown")?s(!1,p.nativeEvent,"click"):(p.preventDefault(),s(!0,p.nativeEvent,"click"))))},onClick(p){const g=c.current;if(a==="mousedown"&&c.current){c.current=void 0;return}Wa(g)&&u||(n&&l&&(!(i.current.openEvent&&f)||i.current.openEvent.type==="click")?s(!1,p.nativeEvent,"click"):s(!0,p.nativeEvent,"click"))},onKeyDown(p){c.current=void 0,!(p.defaultPrevented||!d||fc(p))&&(p.key===" "&&!pc(r)&&(p.preventDefault(),h.current=!0),!PC(p)&&p.key==="Enter"&&s(!(n&&l),p.nativeEvent,"click"))},onKeyUp(p){p.defaultPrevented||!d||fc(p)||pc(r)||p.key===" "&&h.current&&(h.current=!1,s(!(n&&l),p.nativeEvent,"click"))}}),[i,r,a,u,d,s,n,f,l]);return y.useMemo(()=>o?{reference:m}:{},[o,m])}const NC={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},AC={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},mc=t=>{var e,n;return{escapeKey:typeof t=="boolean"?t:(e=t==null?void 0:t.escapeKey)!=null?e:!1,outsidePress:typeof t=="boolean"?t:(n=t==null?void 0:t.outsidePress)!=null?n:!0}};function DC(t,e){e===void 0&&(e={});const{open:n,onOpenChange:s,elements:i,dataRef:r}=t,{enabled:o=!0,escapeKey:a=!0,outsidePress:l=!0,outsidePressEvent:u="pointerdown",referencePress:d=!1,referencePressEvent:f="pointerdown",ancestorScroll:c=!1,bubbles:h,capture:m}=e,p=Vi(),g=Fe(typeof l=="function"?l:()=>!1),v=typeof l=="function"?g:l,C=y.useRef(!1),{escapeKey:S,outsidePress:T}=mc(h),{escapeKey:w,outsidePress:E}=mc(m),_=y.useRef(!1),A=Fe(R=>{var x;if(!n||!o||!a||R.key!=="Escape"||_.current)return;const $=(x=r.current.floatingContext)==null?void 0:x.nodeId,j=p?nn(p.nodesRef.current,$):[];if(!S&&(R.stopPropagation(),j.length>0)){let k=!0;if(j.forEach(V=>{var X;if((X=V.context)!=null&&X.open&&!V.context.dataRef.current.__escapeKeyBubbles){k=!1;return}}),!k)return}s(!1,dS(R)?R.nativeEvent:R,"escape-key")}),q=Fe(R=>{var x;const $=()=>{var j;A(R),(j=Ht(R))==null||j.removeEventListener("keydown",$)};(x=Ht(R))==null||x.addEventListener("keydown",$)}),N=Fe(R=>{var x;const $=r.current.insideReactTree;r.current.insideReactTree=!1;const j=C.current;if(C.current=!1,u==="click"&&j||$||typeof v=="function"&&!v(R))return;const k=Ht(R),V="["+es("inert")+"]",X=at(i.floating).querySelectorAll(V);let xe=_e(k)?k:null;for(;xe&&!Dt(xe);){const fe=jt(xe);if(Dt(fe)||!_e(fe))break;xe=fe}if(X.length&&_e(k)&&!lS(k)&&!Xe(k,i.floating)&&Array.from(X).every(fe=>!Xe(xe,fe)))return;if(Pe(k)&&D){const fe=Dt(k),Ce=it(k),$e=/auto|scroll/,Ut=fe||$e.test(Ce.overflowX),It=fe||$e.test(Ce.overflowY),ot=Ut&&k.clientWidth>0&&k.scrollWidth>k.clientWidth,_t=It&&k.clientHeight>0&&k.scrollHeight>k.clientHeight,Q=Ce.direction==="rtl",ie=_t&&(Q?R.offsetX<=k.offsetWidth-k.clientWidth:R.offsetX>k.clientWidth),ee=ot&&R.offsetY>k.clientHeight;if(ie||ee)return}const Ae=(x=r.current.floatingContext)==null?void 0:x.nodeId,ne=p&&nn(p.nodesRef.current,Ae).some(fe=>{var Ce;return ur(R,(Ce=fe.context)==null?void 0:Ce.elements.floating)});if(ur(R,i.floating)||ur(R,i.domReference)||ne)return;const ke=p?nn(p.nodesRef.current,Ae):[];if(ke.length>0){let fe=!0;if(ke.forEach(Ce=>{var $e;if(($e=Ce.context)!=null&&$e.open&&!Ce.context.dataRef.current.__outsidePressBubbles){fe=!1;return}}),!fe)return}s(!1,R,"outside-press")}),U=Fe(R=>{var x;const $=()=>{var j;N(R),(j=Ht(R))==null||j.removeEventListener(u,$)};(x=Ht(R))==null||x.addEventListener(u,$)});y.useEffect(()=>{if(!n||!o)return;r.current.__escapeKeyBubbles=S,r.current.__outsidePressBubbles=T;let R=-1;function x(X){s(!1,X,"ancestor-scroll")}function $(){window.clearTimeout(R),_.current=!0}function j(){R=window.setTimeout(()=>{_.current=!1},Li()?5:0)}const k=at(i.floating);a&&(k.addEventListener("keydown",w?q:A,w),k.addEventListener("compositionstart",$),k.addEventListener("compositionend",j)),v&&k.addEventListener(u,E?U:N,E);let V=[];return c&&(_e(i.domReference)&&(V=Jt(i.domReference)),_e(i.floating)&&(V=V.concat(Jt(i.floating))),!_e(i.reference)&&i.reference&&i.reference.contextElement&&(V=V.concat(Jt(i.reference.contextElement)))),V=V.filter(X=>{var xe;return X!==((xe=k.defaultView)==null?void 0:xe.visualViewport)}),V.forEach(X=>{X.addEventListener("scroll",x,{passive:!0})}),()=>{a&&(k.removeEventListener("keydown",w?q:A,w),k.removeEventListener("compositionstart",$),k.removeEventListener("compositionend",j)),v&&k.removeEventListener(u,E?U:N,E),V.forEach(X=>{X.removeEventListener("scroll",x)}),window.clearTimeout(R)}},[r,i,a,v,u,n,s,c,o,S,T,A,w,q,N,E,U]),y.useEffect(()=>{r.current.insideReactTree=!1},[r,v,u]);const L=y.useMemo(()=>({onKeyDown:A,...d&&{[NC[f]]:R=>{s(!1,R.nativeEvent,"reference-press")},...f!=="click"&&{onClick(R){s(!1,R.nativeEvent,"reference-press")}}}}),[A,s,d,f]),D=y.useMemo(()=>({onKeyDown:A,onMouseDown(){C.current=!0},onMouseUp(){C.current=!0},[AC[u]]:()=>{r.current.insideReactTree=!0}}),[A,u,r]);return y.useMemo(()=>o?{reference:L,floating:D}:{},[o,L,D])}function LC(t){const{open:e=!1,onOpenChange:n,elements:s}=t,i=$i(),r=y.useRef({}),[o]=y.useState(()=>pC()),a=_o()!=null,[l,u]=y.useState(s.reference),d=Fe((h,m,p)=>{r.current.openEvent=h?m:void 0,o.emit("openchange",{open:h,event:m,reason:p,nested:a}),n==null||n(h,m,p)}),f=y.useMemo(()=>({setPositionReference:u}),[]),c=y.useMemo(()=>({reference:l||s.reference||null,floating:s.floating||null,domReference:s.reference}),[l,s.reference,s.floating]);return y.useMemo(()=>({dataRef:r,open:e,onOpenChange:d,elements:c,events:o,floatingId:i,refs:f}),[e,d,c,o,i,f])}function Gu(t){t===void 0&&(t={});const{nodeId:e}=t,n=LC({...t,elements:{reference:null,floating:null,...t.elements}}),s=t.rootContext||n,i=s.elements,[r,o]=y.useState(null),[a,l]=y.useState(null),d=(i==null?void 0:i.domReference)||r,f=y.useRef(null),c=Vi();be(()=>{d&&(f.current=d)},[d]);const h=QS({...t,elements:{...i,...a&&{reference:a}}}),m=y.useCallback(S=>{const T=_e(S)?{getBoundingClientRect:()=>S.getBoundingClientRect(),getClientRects:()=>S.getClientRects(),contextElement:S}:S;l(T),h.refs.setReference(T)},[h.refs]),p=y.useCallback(S=>{(_e(S)||S===null)&&(f.current=S,o(S)),(_e(h.refs.reference.current)||h.refs.reference.current===null||S!==null&&!_e(S))&&h.refs.setReference(S)},[h.refs]),g=y.useMemo(()=>({...h.refs,setReference:p,setPositionReference:m,domReference:f}),[h.refs,p,m]),v=y.useMemo(()=>({...h.elements,domReference:d}),[h.elements,d]),C=y.useMemo(()=>({...h,...s,refs:g,elements:v,nodeId:e}),[h,g,v,e,s]);return be(()=>{s.dataRef.current.floatingContext=C;const S=c==null?void 0:c.nodesRef.current.find(T=>T.id===e);S&&(S.context=C)}),y.useMemo(()=>({...h,context:C,refs:g,elements:v}),[h,g,v,C])}function mr(t,e,n){const s=new Map,i=n==="item";let r=t;if(i&&t){const{[ec]:o,[tc]:a,...l}=t;r=l}return{...n==="floating"&&{tabIndex:-1,[cC]:""},...r,...e.map(o=>{const a=o?o[n]:null;return typeof a=="function"?t?a(t):null:a}).concat(t).reduce((o,a)=>(a&&Object.entries(a).forEach(l=>{let[u,d]=l;if(!(i&&[ec,tc].includes(u)))if(u.indexOf("on")===0){if(s.has(u)||s.set(u,[]),typeof d=="function"){var f;(f=s.get(u))==null||f.push(d),o[u]=function(){for(var c,h=arguments.length,m=new Array(h),p=0;p<h;p++)m[p]=arguments[p];return(c=s.get(u))==null?void 0:c.map(g=>g(...m)).find(g=>g!==void 0)}}}else o[u]=d}),o),{})}}function MC(t){t===void 0&&(t=[]);const e=t.map(a=>a==null?void 0:a.reference),n=t.map(a=>a==null?void 0:a.floating),s=t.map(a=>a==null?void 0:a.item),i=y.useCallback(a=>mr(a,t,"reference"),e),r=y.useCallback(a=>mr(a,t,"floating"),n),o=y.useCallback(a=>mr(a,t,"item"),s);return y.useMemo(()=>({getReferenceProps:i,getFloatingProps:r,getItemProps:o}),[i,r,o])}const jC="Escape";function Hi(t,e,n){switch(t){case"vertical":return e;case"horizontal":return n;default:return e||n}}function Rs(t,e){return Hi(e,t===Bu||t===Ui,t===cs||t===ls)}function gr(t,e,n){return Hi(e,t===Ui,n?t===cs:t===ls)||t==="Enter"||t===" "||t===""}function gc(t,e,n){return Hi(e,n?t===cs:t===ls,t===Ui)}function bc(t,e,n,s){const i=n?t===ls:t===cs,r=t===Bu;return e==="both"||e==="horizontal"&&s&&s>1?t===jC:Hi(e,i,r)}function FC(t,e){const{open:n,onOpenChange:s,elements:i,floatingId:r}=t,{listRef:o,activeIndex:a,onNavigate:l=()=>{},enabled:u=!0,selectedIndex:d=null,allowEscape:f=!1,loop:c=!1,nested:h=!1,rtl:m=!1,virtual:p=!1,focusItemOnOpen:g="auto",focusItemOnHover:v=!0,openOnArrowKeyDown:C=!0,disabledIndices:S=void 0,orientation:T="vertical",parentOrientation:w,cols:E=1,scrollItemIntoView:_=!0,virtualItemRef:A,itemSizes:q,dense:N=!1}=e,U=fi(i.floating),L=yt(U),D=_o(),R=Vi();be(()=>{t.dataRef.current.orientation=T},[t,T]);const x=Fe(()=>{l(k.current===-1?null:k.current)}),$=Wr(i.domReference),j=y.useRef(g),k=y.useRef(d??-1),V=y.useRef(null),X=y.useRef(!0),xe=y.useRef(x),Ae=y.useRef(!!i.floating),ne=y.useRef(n),ke=y.useRef(!1),fe=y.useRef(!1),Ce=yt(S),$e=yt(n),Ut=yt(_),It=yt(d),[ot,_t]=y.useState(),[Q,ie]=y.useState(),ee=Fe(()=>{function H(B){if(p){var W;(W=B.id)!=null&&W.endsWith("-fui-option")&&(B.id=r+"-"+Math.random().toString(16).slice(2,10)),_t(B.id),R==null||R.events.emit("virtualfocus",B),A&&(A.current=B)}else tn(B,{sync:ke.current,preventScroll:!0})}const K=o.current[k.current],F=fe.current;K&&H(K),(ke.current?B=>B():requestAnimationFrame)(()=>{const B=o.current[k.current]||K;if(!B)return;K||H(B);const W=Ut.current;W&&ye&&(F||!X.current)&&(B.scrollIntoView==null||B.scrollIntoView(typeof W=="boolean"?{block:"nearest",inline:"nearest"}:W))})});be(()=>{u&&(n&&i.floating?j.current&&d!=null&&(fe.current=!0,k.current=d,x()):Ae.current&&(k.current=-1,xe.current()))},[u,n,i.floating,d,x]),be(()=>{if(u&&n&&i.floating)if(a==null){if(ke.current=!1,It.current!=null)return;if(Ae.current&&(k.current=-1,ee()),(!ne.current||!Ae.current)&&j.current&&(V.current!=null||j.current===!0&&V.current==null)){let H=0;const K=()=>{o.current[0]==null?(H<2&&(H?requestAnimationFrame:queueMicrotask)(K),H++):(k.current=V.current==null||gr(V.current,T,m)||h?dr(o,Ce.current):Ga(o,Ce.current),V.current=null,x())};K()}}else Vn(o,a)||(k.current=a,ee(),fe.current=!1)},[u,n,i.floating,a,It,h,o,T,m,x,ee,Ce]),be(()=>{var H;if(!u||i.floating||!R||p||!Ae.current)return;const K=R.nodesRef.current,F=(H=K.find(W=>W.id===D))==null||(H=H.context)==null?void 0:H.elements.floating,ae=Bt(at(i.floating)),B=K.some(W=>W.context&&Xe(W.context.elements.floating,ae));F&&!B&&X.current&&F.focus({preventScroll:!0})},[u,i.floating,R,D,p]),be(()=>{if(!u||!R||!p||D)return;function H(K){ie(K.id),A&&(A.current=K)}return R.events.on("virtualfocus",H),()=>{R.events.off("virtualfocus",H)}},[u,R,p,D,A]),be(()=>{xe.current=x,ne.current=n,Ae.current=!!i.floating}),be(()=>{n||(V.current=null,j.current=g)},[n,g]);const le=a!=null,ye=y.useMemo(()=>{function H(F){if(!$e.current)return;const ae=o.current.indexOf(F);ae!==-1&&k.current!==ae&&(k.current=ae,x())}return{onFocus(F){let{currentTarget:ae}=F;ke.current=!0,H(ae)},onClick:F=>{let{currentTarget:ae}=F;return ae.focus({preventScroll:!0})},onMouseMove(F){let{currentTarget:ae}=F;ke.current=!0,fe.current=!1,v&&H(ae)},onPointerLeave(F){let{pointerType:ae}=F;if(!(!X.current||ae==="touch")&&(ke.current=!0,!!v&&(k.current=-1,x(),!p))){var B;(B=L.current)==null||B.focus({preventScroll:!0})}}}},[$e,L,v,o,x,p]),oe=y.useCallback(()=>{var H;return w??(R==null||(H=R.nodesRef.current.find(K=>K.id===D))==null||(H=H.context)==null||(H=H.dataRef)==null?void 0:H.current.orientation)},[D,R,w]),Re=Fe(H=>{if(X.current=!1,ke.current=!0,H.which===229||!$e.current&&H.currentTarget===L.current)return;if(h&&bc(H.key,T,m,E)){Rs(H.key,oe())||je(H),s(!1,H.nativeEvent,"list-navigation"),Pe(i.domReference)&&(p?R==null||R.events.emit("virtualfocus",i.domReference):i.domReference.focus());return}const K=k.current,F=dr(o,S),ae=Ga(o,S);if($||(H.key==="Home"&&(je(H),k.current=F,x()),H.key==="End"&&(je(H),k.current=ae,x())),E>1){const B=q||Array.from({length:o.current.length},()=>({width:1,height:1})),W=vS(B,E,N),Y=W.findIndex(Se=>Se!=null&&!Ds(o,Se,S)),ue=W.reduce((Se,re,J)=>re!=null&&!Ds(o,re,S)?J:Se,-1),Ge=W[bS({current:W.map(Se=>Se!=null?o.current[Se]:null)},{event:H,orientation:T,loop:c,rtl:m,cols:E,disabledIndices:SS([...(typeof S!="function"?S:null)||o.current.map((Se,re)=>Ds(o,re,S)?re:void 0),void 0],W),minIndex:Y,maxIndex:ue,prevIndex:yS(k.current>ae?F:k.current,B,W,E,H.key===Ui?"bl":H.key===(m?cs:ls)?"tr":"tl"),stopEvent:!0})];if(Ge!=null&&(k.current=Ge,x()),T==="both")return}if(Rs(H.key,T)){if(je(H),n&&!p&&Bt(H.currentTarget.ownerDocument)===H.currentTarget){k.current=gr(H.key,T,m)?F:ae,x();return}gr(H.key,T,m)?c?k.current=K>=ae?f&&K!==o.current.length?-1:F:Be(o,{startingIndex:K,disabledIndices:S}):k.current=Math.min(ae,Be(o,{startingIndex:K,disabledIndices:S})):c?k.current=K<=F?f&&K!==-1?o.current.length:ae:Be(o,{startingIndex:K,decrement:!0,disabledIndices:S}):k.current=Math.max(F,Be(o,{startingIndex:K,decrement:!0,disabledIndices:S})),Vn(o,k.current)&&(k.current=-1),x()}}),Te=y.useMemo(()=>p&&n&&le&&{"aria-activedescendant":Q||ot},[p,n,le,Q,ot]),De=y.useMemo(()=>({"aria-orientation":T==="both"?void 0:T,...$?{}:Te,onKeyDown:Re,onPointerMove(){X.current=!0}}),[Te,Re,T,$]),et=y.useMemo(()=>{function H(F){g==="auto"&&Iu(F.nativeEvent)&&(j.current=!0)}function K(F){j.current=g,g==="auto"&&_u(F.nativeEvent)&&(j.current=!0)}return{...Te,onKeyDown(F){X.current=!1;const ae=F.key.startsWith("Arrow"),B=["Home","End"].includes(F.key),W=ae||B,Y=gc(F.key,T,m),ue=bc(F.key,T,m,E),Ge=gc(F.key,oe(),m),Se=Rs(F.key,T),re=(h?Ge:Se)||F.key==="Enter"||F.key.trim()==="";if(p&&n){const en=R==null?void 0:R.nodesRef.current.find(ds=>ds.parentId==null),$t=R&&en?uS(R.nodesRef.current,en.id):null;if(W&&$t&&A){const ds=new KeyboardEvent("keydown",{key:F.key,bubbles:!0});if(Y||ue){var J,tt;const ld=((J=$t.context)==null?void 0:J.elements.domReference)===F.currentTarget,jo=ue&&!ld?(tt=$t.context)==null?void 0:tt.elements.domReference:Y?o.current.find(Fo=>(Fo==null?void 0:Fo.id)===ot):null;jo&&(je(F),jo.dispatchEvent(ds),ie(void 0))}if((Se||B)&&$t.context&&$t.context.open&&$t.parentId&&F.currentTarget!==$t.context.elements.domReference){var hn;je(F),(hn=$t.context.elements.domReference)==null||hn.dispatchEvent(ds);return}}return Re(F)}if(!(!n&&!C&&ae)){if(re){const en=Rs(F.key,oe());V.current=h&&en?null:F.key}if(h){Ge&&(je(F),n?(k.current=dr(o,Ce.current),x()):s(!0,F.nativeEvent,"list-navigation"));return}Se&&(d!=null&&(k.current=d),je(F),!n&&C?s(!0,F.nativeEvent,"list-navigation"):Re(F),n&&x())}},onFocus(){n&&!p&&(k.current=-1,x())},onPointerDown:K,onPointerEnter:K,onMouseDown:H,onClick:H}},[ot,Te,E,Re,Ce,g,o,h,x,s,n,C,T,oe,m,d,R,p,A]);return y.useMemo(()=>u?{reference:et,floating:De,item:ye}:{},[u,et,De,ye])}const UC=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function $C(t,e){var n,s;e===void 0&&(e={});const{open:i,elements:r,floatingId:o}=t,{enabled:a=!0,role:l="dialog"}=e,u=$i(),d=((n=r.domReference)==null?void 0:n.id)||u,f=y.useMemo(()=>{var C;return((C=fi(r.floating))==null?void 0:C.id)||o},[r.floating,o]),c=(s=UC.get(l))!=null?s:l,m=_o()!=null,p=y.useMemo(()=>c==="tooltip"||l==="label"?{["aria-"+(l==="label"?"labelledby":"describedby")]:i?f:void 0}:{"aria-expanded":i?"true":"false","aria-haspopup":c==="alertdialog"?"dialog":c,"aria-controls":i?f:void 0,...c==="listbox"&&{role:"combobox"},...c==="menu"&&{id:d},...c==="menu"&&m&&{role:"menuitem"},...l==="select"&&{"aria-autocomplete":"none"},...l==="combobox"&&{"aria-autocomplete":"list"}},[c,f,m,i,d,l]),g=y.useMemo(()=>{const C={id:f,...c&&{role:c}};return c==="tooltip"||l==="label"?C:{...C,...c==="menu"&&{"aria-labelledby":d}}},[c,f,d,l]),v=y.useCallback(C=>{let{active:S,selected:T}=C;const w={role:"option",...S&&{id:f+"-fui-option"}};switch(l){case"select":case"combobox":return{...w,"aria-selected":T}}return{}},[f,l]);return y.useMemo(()=>a?{reference:p,floating:g,item:v}:{},[a,p,g,v])}function VC(t,e){var n;const{open:s,dataRef:i}=t,{listRef:r,activeIndex:o,onMatch:a,onTypingChange:l,enabled:u=!0,findMatch:d=null,resetMs:f=750,ignoreKeys:c=[],selectedIndex:h=null}=e,m=y.useRef(-1),p=y.useRef(""),g=y.useRef((n=h??o)!=null?n:-1),v=y.useRef(null),C=Fe(a),S=Fe(l),T=yt(d),w=yt(c);be(()=>{s&&(Gr(m),v.current=null,p.current="")},[s]),be(()=>{if(s&&p.current===""){var N;g.current=(N=h??o)!=null?N:-1}},[s,h,o]);const E=Fe(N=>{N?i.current.typing||(i.current.typing=N,S(N)):i.current.typing&&(i.current.typing=N,S(N))}),_=Fe(N=>{function U($,j,k){const V=T.current?T.current(j,k):j.find(X=>(X==null?void 0:X.toLocaleLowerCase().indexOf(k.toLocaleLowerCase()))===0);return V?$.indexOf(V):-1}const L=r.current;if(p.current.length>0&&p.current[0]!==" "&&(U(L,L,p.current)===-1?E(!1):N.key===" "&&je(N)),L==null||w.current.includes(N.key)||N.key.length!==1||N.ctrlKey||N.metaKey||N.altKey)return;s&&N.key!==" "&&(je(N),E(!0)),L.every($=>{var j,k;return $?((j=$[0])==null?void 0:j.toLocaleLowerCase())!==((k=$[1])==null?void 0:k.toLocaleLowerCase()):!0})&&p.current===N.key&&(p.current="",g.current=v.current),p.current+=N.key,Gr(m),m.current=window.setTimeout(()=>{p.current="",g.current=v.current,E(!1)},f);const R=g.current,x=U(L,[...L.slice((R||0)+1),...L.slice(0,(R||0)+1)],p.current);x!==-1?(C(x),v.current=x):N.key!==" "&&(p.current="",E(!1))}),A=y.useMemo(()=>({onKeyDown:_}),[_]),q=y.useMemo(()=>({onKeyDown:_,onKeyUp(N){N.key===" "&&E(!1)}}),[_,E]);return y.useMemo(()=>u?{reference:A,floating:q}:{},[u,A,q])}const ts=({participant:t,trackType:e="audioTrack",...n})=>{const s=Ne(),[i,r]=y.useState(null),{userId:o,sessionId:a}=t;return y.useEffect(()=>{if(!s||!i)return;const l=s.bindAudioElement(i,a,e);return()=>{l==null||l()}},[s,a,i,e]),b.jsx("audio",{autoPlay:!0,...n,ref:r,"data-user-id":o,"data-session-id":a,"data-track-type":e})};ts.displayName="Audio";const Ku=t=>{const{participants:e,audioProps:n}=t;return b.jsx(b.Fragment,{children:e.map(s=>{if(s.isLocalParticipant)return null;const{audioStream:i,screenShareAudioStream:r,sessionId:o}=s,l=Nt(s)&&i&&b.jsx(ts,{...n,trackType:"audioTrack",participant:s}),d=ki(s)&&r&&b.jsx(ts,{...n,trackType:"screenShareAudioTrack",participant:s});return b.jsxs(y.Fragment,{children:[l,d]},o)})})};Ku.displayName="ParticipantsAudio";const Ju=y.createContext(void 0),qi=()=>y.useContext(Ju),Po=({middleware:t=[],placement:e,strategy:n,offset:s=10})=>{const{refs:i,x:r,y:o,update:a,elements:{domReference:l,floating:u},context:d}=Gu({placement:e,strategy:n,middleware:[tC(s),nC(),$u(),sC({padding:10,apply:({availableHeight:f,elements:c})=>{Object.assign(c.floating.style,{maxHeight:`${f}px`})}}),...t]});return y.useEffect(()=>{if(!l||!u)return;const f=Fu(l,u,a);return()=>f()},[l,u,a]),{refs:i,x:r,y:o,domReference:l,floating:u,strategy:n,context:d}},zu=10,BC=(t,e=zu)=>{const[n,s]=y.useState(null);return y.useEffect(()=>{if(!t)return;const i=()=>{const o=t;if(!(o.scrollHeight>o.clientHeight))return s(null);if(o.scrollTop<=e)return s("top");if(Math.abs(o.scrollHeight-o.scrollTop-o.clientHeight)<=e)return s("bottom");s("between")},r=new ResizeObserver(i);return r.observe(t),t.addEventListener("scroll",i),()=>{t.removeEventListener("scroll",i),r.disconnect()}},[t,e]),n},HC=(t,e=zu)=>{const[n,s]=y.useState(null);return y.useEffect(()=>{if(!t)return;const i=()=>{const o=t;if(!(o.scrollWidth>o.clientWidth))return s(null);if(o.scrollLeft<=e)return s("start");if(Math.abs(o.scrollWidth-o.scrollLeft-o.clientWidth)<=e)return s("end");s("between")},r=new ResizeObserver(i);return r.observe(t),t.addEventListener("scroll",i),()=>{t.removeEventListener("scroll",i),r.disconnect()}},[t,e]),n},Oo=t=>{const e=Ne(),{useHasPermissions:n}=rt(),s=n(t),[i,r]=y.useState(!1);return y.useEffect(()=>{s&&r(!1)},[s]),{requestPermission:y.useCallback(async()=>{if(s)return!0;const a=!!(e!=null&&e.permissionsContext.canRequest(t));if(i||!a)return!1;r(!0);try{await(e==null?void 0:e.requestPermissions({permissions:[t]}))}catch(l){throw r(!1),new Error(`requestPermission failed: ${l}`)}return!1},[e,s,i,t]),hasPermission:s,canRequestPermission:!!(e!=null&&e.permissionsContext.canRequest(t)),isAwaitingPermission:i}};function Yu(t,e){const{t:n}=Ue();return y.useMemo(()=>{let s=null,i=null;const r=t.map((o,a)=>{const l=o.deviceId===e,u={deviceId:o.deviceId,label:o.label,isSelected:l};return l&&(s=u,i=a),u});if(s===null||i===null){const o={deviceId:"default",label:n("Default"),isSelected:!0};s=o,i=0,r.unshift(o)}return{deviceList:r,selectedDeviceInfo:s,selectedIndex:i}},[t,e,n])}var Cn;(function(t){t.PORTAL="portal",t.MENU="menu"})(Cn||(Cn={}));const Xu=y.createContext({}),No=()=>y.useContext(Xu),qC=({children:t,refs:e})=>{const n=y.useMemo(()=>`str-video-portal-${Math.random().toString(36).substring(2,9)}`,[]);return b.jsxs(b.Fragment,{children:[b.jsx("div",{id:n,className:"str-video__portal"}),b.jsx(xC,{children:b.jsx(TC,{id:n,children:b.jsx("div",{className:"str-video__portal-content",ref:e.setFloating,children:t})})})]})},Ao=({ToggleButton:t,placement:e="top-start",strategy:n="absolute",offset:s,visualType:i=Cn.MENU,children:r,onToggle:o})=>{const[a,l]=y.useState(!1),u=y.useRef(o);u.current=o;const{floating:d,domReference:f,refs:c,x:h,y:m}=Po({placement:e,strategy:n,offset:s});return y.useEffect(()=>{const p=f==null?void 0:f.ownerDocument,g=C=>{var S,T;!d&&(f!=null&&f.contains(C.target))?(l(!0),(S=u.current)==null||S.call(u,!0)):d&&!(d!=null&&d.contains(C.target))&&(l(!1),(T=u.current)==null||T.call(u,!1))},v=C=>{var S;C.key&&C.key.toLowerCase()==="escape"&&!C.altKey&&!C.ctrlKey&&(l(!1),(S=u.current)==null||S.call(u,!1))};return p==null||p.addEventListener("click",g,{capture:!0}),p==null||p.addEventListener("keydown",v),()=>{p==null||p.removeEventListener("click",g,{capture:!0}),p==null||p.removeEventListener("keydown",v)}},[d,f]),b.jsxs(b.Fragment,{children:[a&&b.jsx(Xu.Provider,{value:{close:()=>l(!1)},children:i===Cn.PORTAL?b.jsx(qC,{refs:c,children:r}):i===Cn.MENU?b.jsx("div",{className:"str-video__menu-container",ref:c.setFloating,style:{position:n,top:m??0,left:h??0,overflowY:"auto"},role:"menu",children:r}):null}),b.jsx(t,{menuShown:a,ref:c.setReference})]})},WC=({children:t,onItemClick:e})=>{const n=y.useRef(null);return b.jsx("ul",{className:"str-video__generic-menu",ref:n,onClick:s=>{var i;e&&s.target!==n.current&&((i=n.current)!=null&&i.contains(s.target))&&e(s)},children:t})},Ve=({children:t,...e})=>b.jsx("li",{className:"str-video__generic-menu--item",children:b.jsx("button",{...e,children:t})}),Ie=({className:t,icon:e})=>b.jsx("span",{className:Oe("str-video__icon",e&&`str-video__icon--${e}`,t)});function Zu(t){const[e,n]=y.useState(document.pictureInPictureElement===t);return!t&&e&&n(!1),y.useEffect(()=>{if(!t)return;const s=()=>{n(document.pictureInPictureElement===t)};return t.addEventListener("enterpictureinpicture",s),t.addEventListener("leavepictureinpicture",s),()=>{t.removeEventListener("enterpictureinpicture",s),t.removeEventListener("leavepictureinpicture",s)}},[t]),e}const GC=()=>{const{participant:t,participantViewElement:e,videoElement:n}=qi(),[s,i]=y.useState(!!document.fullscreenElement),r=Ne(),o=Zu(n??void 0),{t:a}=Ue(),{pin:l,sessionId:u,userId:d}=t,f=Nt(t),c=pt(t),h=mt(t),m=ki(t),p=()=>r==null?void 0:r.blockUser(d),g=()=>r==null?void 0:r.muteUser(d,"audio"),v=()=>r==null?void 0:r.muteUser(d,"video"),C=()=>r==null?void 0:r.muteUser(d,"screenshare"),S=()=>r==null?void 0:r.muteUser(d,"screenshare_audio"),T=L=>()=>{r==null||r.updateUserPermissions({user_id:d,grant_permissions:[L]})},w=L=>()=>{r==null||r.updateUserPermissions({user_id:d,revoke_permissions:[L]})},E=()=>{l?r==null||r.unpin(u):r==null||r.pin(u)},_=()=>{r==null||r.pinForEveryone({user_id:d,session_id:u}).catch(L=>{console.error(`Failed to pin participant ${d}`,L)})},A=()=>{r==null||r.unpinForEveryone({user_id:d,session_id:u}).catch(L=>{console.error(`Failed to unpin participant ${d}`,L)})},q=()=>s?document.exitFullscreen().catch(console.error):e==null?void 0:e.requestFullscreen().catch(console.error);y.useEffect(()=>{const L=()=>{i(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",L),()=>{document.removeEventListener("fullscreenchange",L)}},[]);const N=()=>n&&!o?n.requestPictureInPicture().catch(console.error):document.exitPictureInPicture().catch(console.error),{close:U}=No()||{};return b.jsxs(WC,{onItemClick:U,children:[b.jsxs(Ve,{onClick:E,disabled:l&&!l.isLocalPin,children:[b.jsx(Ie,{icon:"pin"}),a(l?"Unpin":"Pin")]}),b.jsxs(Ze,{requiredGrants:[z.PIN_FOR_EVERYONE],children:[b.jsxs(Ve,{onClick:_,disabled:l&&!l.isLocalPin,children:[b.jsx(Ie,{icon:"pin"}),a("Pin for everyone")]}),b.jsxs(Ve,{onClick:A,disabled:!l||l.isLocalPin,children:[b.jsx(Ie,{icon:"pin"}),a("Unpin for everyone")]})]}),b.jsx(Ze,{requiredGrants:[z.BLOCK_USERS],children:b.jsxs(Ve,{onClick:p,children:[b.jsx(Ie,{icon:"not-allowed"}),a("Block")]})}),b.jsxs(Ze,{requiredGrants:[z.MUTE_USERS],children:[c&&b.jsxs(Ve,{onClick:v,children:[b.jsx(Ie,{icon:"camera-off-outline"}),a("Turn off video")]}),h&&b.jsxs(Ve,{onClick:C,children:[b.jsx(Ie,{icon:"screen-share-off"}),a("Turn off screen share")]}),f&&b.jsxs(Ve,{onClick:g,children:[b.jsx(Ie,{icon:"no-audio"}),a("Mute audio")]}),m&&b.jsxs(Ve,{onClick:S,children:[b.jsx(Ie,{icon:"no-audio"}),a("Mute screen share audio")]})]}),e&&typeof e.requestFullscreen<"u"&&b.jsx(Ve,{onClick:q,children:a("{{ direction }} fullscreen",{direction:a(s?"Leave":"Enter")})}),n&&document.pictureInPictureEnabled&&b.jsx(Ve,{onClick:N,children:a("{{ direction }} picture-in-picture",{direction:a(o?"Leave":"Enter")})}),b.jsxs(Ze,{requiredGrants:[z.UPDATE_CALL_PERMISSIONS],children:[b.jsx(Ve,{onClick:T(z.SEND_AUDIO),children:a("Allow audio")}),b.jsx(Ve,{onClick:T(z.SEND_VIDEO),children:a("Allow video")}),b.jsx(Ve,{onClick:T(z.SCREENSHARE),children:a("Allow screen sharing")}),b.jsx(Ve,{onClick:w(z.SEND_AUDIO),children:a("Disable audio")}),b.jsx(Ve,{onClick:w(z.SEND_VIDEO),children:a("Disable video")}),b.jsx(Ve,{onClick:w(z.SCREENSHARE),children:a("Disable screen sharing")})]})]})},Qu=t=>t===null?!1:!y.isValidElement(t),ed=(t,e)=>{if(t){if(typeof t=="function")return t(e);t.current=e}};y.forwardRef(function({stream:e,...n},s){const[i,r]=y.useState(null);return y.useEffect(()=>{if(!(!i||!e)&&e!==i.srcObject)return i.srcObject=e,(Ca.isSafari()||Ca.isFirefox())&&setTimeout(()=>{i.srcObject=e,i.play().catch(o=>{console.error("Failed to play stream",o)})},0),()=>{i.pause(),i.srcObject=null}},[e,i]),b.jsx("video",{autoPlay:!0,playsInline:!0,...n,ref:o=>{ed(s,o),r(o)}})});const td=y.forwardRef(function({participant:e,style:n,children:s},i){const[r,o]=y.useState(!1),a=e.name||e.userId;return b.jsxs("div",{className:"str-video__video-placeholder",style:n,ref:i,children:[(!e.image||r)&&(a?b.jsx(KC,{name:a}):b.jsx("div",{className:"str-video__video-placeholder__no-video-label",children:s})),e.image&&!r&&b.jsx("img",{onError:()=>o(!0),alt:a,className:"str-video__video-placeholder__avatar",src:e.image})]})}),KC=t=>{const{name:e}=t,n=e.split(" ").slice(0,2).map(s=>s[0]).join("");return b.jsx("div",{className:"str-video__video-placeholder__initials-fallback",children:n})},JC=y.forwardRef(function(e,n){const{t:s}=Ue();return b.jsx(td,{ref:n,...e,children:s("Video is disabled")})}),zC=y.forwardRef(function(e,n){const{t:s}=Ue();return b.jsx(td,{ref:n,...e,children:s("Video is playing in a popup")})}),nd=({enabled:t=!0,mirror:e,trackType:n,participant:s,className:i,VideoPlaceholder:r=JC,PictureInPicturePlaceholder:o=zC,refs:a,...l})=>{const{sessionId:u,videoStream:d,screenShareStream:f,viewportVisibilityState:c,isLocalParticipant:h,userId:m}=s,p=Ne(),[g,v]=y.useState(null),[C,S]=y.useState(!0),[T,w]=y.useState(!0),E=Zu(g??void 0),_=n==="videoTrack"?d:n==="screenShareTrack"?f:void 0;if(y.useLayoutEffect(()=>{if(!p||!g||n==="none")return;const D=p.bindVideoElement(g,u,n);return()=>{D==null||D()}},[p,n,u,g]),y.useEffect(()=>{if(!_||!g)return;const[D]=_.getVideoTracks();if(!D)return;const R=()=>{S(g.paused);const{width:x=0,height:$=0}=D.getSettings();w(x>=$)};return S(g.paused),g.addEventListener("play",R),g.addEventListener("pause",R),D.addEventListener("unmute",R),()=>{g.removeEventListener("play",R),g.removeEventListener("pause",R),D.removeEventListener("unmute",R),S(!0)}},[_,g]),!p)return null;const A=n==="videoTrack"?pt(s):n==="screenShareTrack"?mt(s):!1,q=n==="none"||(c==null?void 0:c[n])===we.INVISIBLE,N=!t||!A||q,U=e===void 0?h&&n==="videoTrack":e,L=n==="screenShareTrack";return b.jsxs(b.Fragment,{children:[!N&&b.jsx("video",{...l,className:Oe("str-video__video",i,{"str-video__video--not-playing":C,"str-video__video--tall":!T,"str-video__video--mirror":U,"str-video__video--screen-share":L}),"data-user-id":m,"data-session-id":u,ref:D=>{var R;v(D),(R=a==null?void 0:a.setVideoElement)==null||R.call(a,D)}}),E&&o&&b.jsx(o,{style:{position:"absolute"},participant:s}),(N||C)&&r&&b.jsx(r,{style:{position:"absolute"},participant:s,ref:a==null?void 0:a.setVideoPlaceholderElement})]})};nd.displayName="Video";const YC=({trackedElement:t,dynascaleManager:e,sessionId:n,trackType:s})=>{const i=Ne(),r=e??(i==null?void 0:i.dynascaleManager);y.useEffect(()=>{if(!t||!r||!i||s==="none")return;const o=r.trackElementVisibility(t,n,s);return()=>{o()}},[t,r,i,n,s])};y.createContext(void 0);const gt=y.forwardRef(function(e,n){const{icon:s,enabled:i,variant:r,onClick:o,className:a,...l}=e;return b.jsx("button",{className:Oe("str-video__call-controls__button",a,{[`str-video__call-controls__button--variant-${r}`]:r,"str-video__call-controls__button--enabled":i}),onClick:u=>{u.preventDefault(),o==null||o(u)},ref:n,...l,children:b.jsx(Ie,{icon:s})})}),dn=y.forwardRef(function({disabled:e,caption:n,children:s,className:i,active:r,Menu:o,menuPlacement:a,menuOffset:l,title:u,ToggleMenuButton:d=XC,variant:f,onClick:c,onMenuToggle:h,...m},p){return b.jsxs("div",{className:Oe("str-video__composite-button",i,{"str-video__composite-button--caption":n,"str-video__composite-button--menu":o}),title:u,ref:p,children:[b.jsxs("div",{className:Oe("str-video__composite-button__button-group",{"str-video__composite-button__button-group--active":r,"str-video__composite-button__button-group--active-primary":r&&f==="primary","str-video__composite-button__button-group--active-secondary":r&&f==="secondary","str-video__composite-button__button-group--disabled":e}),children:[b.jsx("button",{type:"button",className:"str-video__composite-button__button",onClick:g=>{g.preventDefault(),c==null||c(g)},disabled:e,...m,children:s}),o&&b.jsx(Ao,{offset:l,placement:a,ToggleButton:d,onToggle:h,children:Qu(o)?b.jsx(o,{}):o})]}),n&&b.jsx("div",{className:"str-video__composite-button__caption",children:n})]})}),XC=y.forwardRef(function({menuShown:e},n){return b.jsx(gt,{className:Oe("str-video__menu-toggle-button",{"str-video__menu-toggle-button--active":e}),icon:e?"caret-down":"caret-up",ref:n})}),gi=t=>{const{isVisible:e,message:n,children:s,visibilityTimeout:i,resetIsVisible:r,placement:o="top",iconClassName:a="str-video__notification__icon",close:l}=t,{refs:u,x:d,y:f,strategy:c}=Po({placement:o,strategy:"absolute"});return y.useEffect(()=>{if(!e||!i||!r)return;const h=setTimeout(()=>{r()},i);return()=>clearTimeout(h)},[e,r,i]),b.jsxs("div",{ref:u.setReference,children:[e&&b.jsxs("div",{className:"str-video__notification",ref:u.setFloating,style:{position:c,top:f??0,left:d??0,overflowY:"auto"},children:[a&&b.jsx("i",{className:a}),b.jsx("span",{className:"str-video__notification__message",children:n}),l?b.jsx("i",{className:"str-video__icon str-video__icon--close str-video__notification__close",onClick:l}):null]}),s]})},Do=t=>{const{permission:e,isAwaitingApproval:n,messageApproved:s,messageAwaitingApproval:i,messageRevoked:r,visibilityTimeout:o=3500,children:a}=t,{useHasPermissions:l}=rt(),u=l(e),d=y.useRef(u),[f,c]=y.useState();y.useEffect(()=>{u&&!d.current?(c("granted"),d.current=!0):!u&&d.current&&(c("revoked"),d.current=!1)},[u]);const h=y.useCallback(()=>c(void 0),[]);return n?b.jsx(gi,{isVisible:n&&!u,message:i,children:a}):b.jsx(gi,{isVisible:!!f,visibilityTimeout:o,resetIsVisible:h,message:f==="granted"?s:r,children:a})},ZC=({children:t,text:e,placement:n})=>{const{useMicrophoneState:s}=rt(),{isSpeakingWhileMuted:i}=s(),{t:r}=Ue(),o=e??r("You are muted. Unmute to speak.");return b.jsx(gi,{message:o,isVisible:i,placement:n||"top-start",children:t})},QC=({className:t,type:e="spinner",text:n,tooltip:s})=>b.jsxs("div",{className:Oe("str-video__loading-indicator",t),title:s,children:[b.jsx("div",{className:Oe("str-video__loading-indicator__icon",e)}),n&&b.jsx("p",{className:"str-video__loading-indicator-text",children:n})]}),eT=({children:t,referenceElement:e,tooltipClassName:n,tooltipPlacement:s="top",visible:i=!1})=>{const r=y.useRef(null),{refs:o,x:a,y:l,strategy:u,context:d}=Po({placement:s,strategy:"absolute",middleware:[iC({element:r})]});return y.useEffect(()=>{o.setReference(e)},[e,o]),i?b.jsxs("div",{className:Oe("str-video__tooltip",n),ref:o.setFloating,style:{position:u,top:l??0,left:a??0},children:[b.jsx(fC,{ref:r,context:d,fill:"var(--str-video__tooltip--background-color)"}),t]}):null},tT=({onMouseEnter:t,onMouseLeave:e}={})=>{const[n,s]=y.useState(!1),i=y.useCallback(o=>{s(!0),t==null||t(o)},[t]),r=y.useCallback(o=>{s(!1),e==null||e(o)},[e]);return{handleMouseEnter:i,handleMouseLeave:r,tooltipVisible:n}},us=({title:t,tooltipClassName:e,tooltipPlacement:n,tooltipDisabled:s,...i})=>{const{handleMouseEnter:r,handleMouseLeave:o,tooltipVisible:a}=tT(),[l,u]=y.useState(null),d=!s&&!!t&&a;return b.jsxs(b.Fragment,{children:[b.jsx(eT,{referenceElement:l,visible:d,tooltipClassName:e,tooltipPlacement:n,children:t||""}),b.jsx("div",{ref:u,onMouseEnter:r,onMouseLeave:o,...i})]})};y.forwardRef(function(e,n){return b.jsx(dn,{ref:n,active:!0,variant:"secondary","data-testid":"recording-stop-button",children:b.jsx(Ie,{icon:"recording-off"})})});const nT=({caption:t})=>{const{t:e}=Ue(),{toggleCallRecording:n,isAwaitingResponse:s,isCallRecordingInProgress:i}=Ty();let r=t??e("Record call");return s&&(r=e(i?"Waiting for recording to stop...":"Waiting for recording to start...")),b.jsx(Ze,{requiredGrants:[z.START_RECORD_CALL,z.STOP_RECORD_CALL],children:b.jsx(dn,{active:i,caption:t,variant:"secondary","data-testid":i?"recording-stop-button":"recording-start-button",title:r,onClick:s?void 0:n,children:s?b.jsx(QC,{}):b.jsx(Ie,{icon:i?"recording-on":"recording-off"})})})},sd={":like:":"👍",":raise-hand:":"✋",":fireworks:":"🎉",":dislike:":"👎",":heart:":"❤️",":smile:":"😀"},sT=({participant:{reaction:t,sessionId:e},hideAfterTimeoutInMs:n=5500,emojiReactionMap:s=sd})=>{const i=Ne();if(y.useEffect(()=>{if(!i||!t)return;const o=setTimeout(()=>{i.resetReaction(e)},n);return()=>{clearTimeout(o)}},[i,n,t,e]),!t)return null;const{emoji_code:r}=t;return b.jsx("div",{className:"str-video__reaction",children:b.jsx("span",{className:"str-video__reaction__emoji",children:r&&s[r]})})},iT=[{type:"reaction",emoji_code:":like:"},{type:"raised-hand",emoji_code:":raise-hand:"},{type:"reaction",emoji_code:":fireworks:"},{type:"reaction",emoji_code:":dislike:"},{type:"reaction",emoji_code:":heart:"},{type:"reaction",emoji_code:":smile:"}],rT=({reactions:t=iT})=>b.jsx(Ze,{requiredGrants:[z.CREATE_REACTION],children:b.jsx(Ao,{placement:"top",ToggleButton:oT,visualType:Cn.MENU,children:b.jsx(aT,{reactions:t})})}),oT=y.forwardRef(function({menuShown:e},n){const{t:s}=Ue();return b.jsx(us,{title:s("Reactions"),tooltipDisabled:e,children:b.jsx(dn,{ref:n,active:e,variant:"primary",children:b.jsx(Ie,{icon:"reactions"})})})}),aT=({reactions:t,layout:e="horizontal"})=>{const n=Ne(),{close:s}=No();return b.jsx("div",{className:Oe("str-video__reactions-menu",{"str-video__reactions-menu--horizontal":e==="horizontal","str-video__reactions-menu--vertical":e==="vertical"}),children:t.map(i=>b.jsx("button",{type:"button",className:"str-video__reactions-menu__button",onClick:()=>{n==null||n.sendReaction(i),s==null||s()},children:i.emoji_code&&sd[i.emoji_code]},i.emoji_code))})},Lo=(t,e)=>{const n=he(["react-sdk"]);return async()=>{try{await e()}catch(s){if(t.onError){t.onError(s);return}cT(s)||n("error","Call control handler failed",s)}}};function cT(t){return t instanceof DOMException&&t.name==="NotAllowedError"}const lT=t=>{const{t:e}=Ue(),{caption:n}=t,{useHasOngoingScreenShare:s,useScreenShareState:i,useCallSettings:r}=rt(),o=s(),{hasPermission:a,requestPermission:l,isAwaitingPermission:u}=Oo(z.SCREENSHARE),d=r(),f=d==null?void 0:d.screensharing.enabled,{screenShare:c,optimisticIsMute:h}=i(),m=!h,p=!m&&(o||f===!1),g=Lo(t,async()=>{a?await c.toggle():await l()});return b.jsx(Ze,{requiredGrants:[z.SCREENSHARE],children:b.jsx(Do,{permission:z.SCREENSHARE,isAwaitingApproval:u,messageApproved:e("You can now share your screen."),messageAwaitingApproval:e("Awaiting for an approval to share screen."),messageRevoked:e("You can no longer share your screen."),children:b.jsx(us,{title:n??e("Share screen"),children:b.jsx(dn,{active:o||m,caption:n,variant:"primary","data-testid":o?"screen-share-stop-button":"screen-share-start-button",disabled:p,onClick:g,children:b.jsx(Ie,{icon:o?"screen-share-on":"screen-share-off"})})})})})},id=y.createContext({}),uT=t=>{const{children:e,icon:n,defaultSelectedLabel:s,defaultSelectedIndex:i,handleSelect:r}=t,[o,a]=y.useState(!1),[l,u]=y.useState(null),[d,f]=y.useState(i),[c,h]=y.useState(s),{refs:m,context:p}=Gu({placement:"bottom-start",open:o,onOpenChange:a,whileElementsMounted:Fu,middleware:[$u()]}),g=y.useRef([]),v=y.useRef([]),C=y.useCallback(D=>{f(D),r(D||0),a(!1),D!==null&&h(v.current[D])},[r]),S=D=>{o?u(D):C(D)},T=FC(p,{listRef:g,activeIndex:l,selectedIndex:d,onNavigate:u}),w=VC(p,{listRef:v,activeIndex:l,selectedIndex:d,onMatch:S}),E=OC(p),_=DC(p),A=$C(p,{role:"listbox"}),{getReferenceProps:q,getFloatingProps:N,getItemProps:U}=MC([T,w,E,_,A]),L=y.useMemo(()=>({activeIndex:l,selectedIndex:d,getItemProps:U,handleSelect:C}),[l,d,U,C]);return b.jsxs("div",{className:"str-video__dropdown",children:[b.jsxs("div",{className:"str-video__dropdown-selected",ref:m.setReference,tabIndex:0,...q(),children:[b.jsxs("label",{className:"str-video__dropdown-selected__label",children:[n&&b.jsx(Ie,{className:"str-video__dropdown-selected__icon",icon:n}),c]}),b.jsx(Ie,{className:"str-video__dropdown-selected__chevron",icon:o?"chevron-up":"chevron-down"})]}),b.jsx(id.Provider,{value:L,children:o&&b.jsx(IC,{context:p,modal:!1,children:b.jsx("div",{className:"str-video__dropdown-list",ref:m.setFloating,...N(),children:b.jsx(oC,{elementsRef:g,labelsRef:v,children:e})})})})]})},dT=t=>{const{selected:e,label:n,icon:s}=t,{getItemProps:i,handleSelect:r}=y.useContext(id),{ref:o,index:a}=aC();return b.jsxs("div",{className:Oe("str-video__dropdown-option",{"str-video__dropdown-option--selected":e}),ref:o,...i({onClick:()=>r(a)}),children:[s&&b.jsx(Ie,{className:"str-video__dropdown-icon",icon:s}),b.jsx("span",{className:"str-video__dropdown-label",children:n})]})},hT=t=>{const{children:e,icon:n,handleSelect:s,defaultSelectedLabel:i,defaultSelectedIndex:r}=t;return b.jsx(uT,{icon:n,handleSelect:s,defaultSelectedIndex:r,defaultSelectedLabel:i,children:e})},fT=({disabled:t,id:e,label:n,onChange:s,name:i,selected:r,defaultChecked:o,value:a})=>b.jsxs("label",{className:Oe("str-video__device-settings__option",{"str-video__device-settings__option--selected":r,"str-video__device-settings__option--disabled":t}),htmlFor:e,children:[b.jsx("input",{type:"radio",name:i,onChange:s,value:a,id:e,checked:r,defaultChecked:o,disabled:t}),n]}),pT=t=>{const{devices:e=[],selectedDeviceId:n,title:s,type:i,onChange:r}=t,{close:o}=No(),{deviceList:a}=Yu(e,n);return b.jsxs("div",{className:"str-video__device-settings__device-kind",children:[s&&b.jsx("div",{className:"str-video__device-settings__device-selector-title",children:s}),a.map(l=>b.jsx(fT,{id:`${i}--${l.deviceId}`,value:l.deviceId,label:l.label,onChange:u=>{const d=u.target.value;d!=="default"&&(r==null||r(d)),o==null||o()},name:i,selected:l.isSelected},l.deviceId))]})},mT=t=>{const{devices:e=[],selectedDeviceId:n,title:s,onChange:i,icon:r}=t,{deviceList:o,selectedDeviceInfo:a,selectedIndex:l}=Yu(e,n),u=y.useCallback(d=>{const f=o[d].deviceId;f!=="default"&&(i==null||i(f))},[o,i]);return b.jsxs("div",{className:"str-video__device-settings__device-kind",children:[b.jsx("div",{className:"str-video__device-settings__device-selector-title",children:s}),b.jsx(hT,{icon:r,defaultSelectedIndex:l,defaultSelectedLabel:a.label,handleSelect:u,children:o.map(d=>b.jsx(dT,{icon:r,label:d.label,selected:d.isSelected},d.deviceId))})]})},rd=t=>{const{visualType:e="list",icon:n,...s}=t;return e==="list"?b.jsx(pT,{...s}):b.jsx(mT,{...s,icon:n})},gT=({title:t,visualType:e})=>{const{useMicrophoneState:n}=rt(),{microphone:s,selectedDevice:i,devices:r}=n();return b.jsx(rd,{devices:r||[],selectedDeviceId:i,type:"audioinput",onChange:async o=>{await s.select(o)},title:t,visualType:e,icon:"mic"})},bT=({title:t,visualType:e})=>{const{useCameraState:n}=rt(),{camera:s,devices:i,selectedDevice:r}=n();return b.jsx(rd,{devices:i||[],type:"videoinput",selectedDeviceId:r,onChange:async o=>{await s.select(o)},title:t,visualType:e,icon:"camera"})};y.forwardRef(function({menuShown:e},n){const{t:s}=Ue();return b.jsx(gt,{className:Oe("str-video__device-settings__button",{"str-video__device-settings__button--active":e}),title:s("Toggle device menu"),icon:"device-settings",ref:n})});const vT=t=>{const{t:e}=Ue(),{caption:n,Menu:s=b.jsx(gT,{visualType:"list"}),menuPlacement:i="top",onMenuToggle:r,...o}=t,{hasPermission:a,requestPermission:l,isAwaitingPermission:u}=Oo(z.SEND_AUDIO),{useMicrophoneState:d}=rt(),{microphone:f,optimisticIsMute:c,hasBrowserPermission:h,isPromptingPermission:m}=d(),[p,g]=y.useState(!1),v=Lo(t,async()=>{a?await f.toggle():await l()});return b.jsx(Ze,{requiredGrants:[z.SEND_AUDIO],children:b.jsx(Do,{permission:z.SEND_AUDIO,isAwaitingApproval:u,messageApproved:e("You can now speak."),messageAwaitingApproval:e("Awaiting for an approval to speak."),messageRevoked:e("You can no longer speak."),children:b.jsx(us,{title:a?h?n??e("Mic"):e("Check your browser mic permissions"):e("You have no permission to share your audio"),tooltipDisabled:p,children:b.jsxs(dn,{active:c,caption:n,variant:"secondary",disabled:!h||!a,"data-testid":c?"audio-unmute-button":"audio-mute-button",onClick:v,Menu:s,menuPlacement:i,menuOffset:16,...o,onMenuToggle:C=>{g(C),r==null||r(C)},children:[b.jsx(Ie,{icon:c?"mic-off":"mic"}),(!h||!a)&&b.jsx("span",{className:"str-video__no-media-permission",children:"!"}),m&&b.jsx("span",{className:"str-video__pending-permission",title:e("Waiting for permission"),children:"?"})]})})})})},yT=t=>{const{t:e}=Ue(),{caption:n,Menu:s=b.jsx(bT,{visualType:"list"}),menuPlacement:i="top",onMenuToggle:r,...o}=t,{hasPermission:a,requestPermission:l,isAwaitingPermission:u}=Oo(z.SEND_VIDEO),{useCameraState:d,useCallSettings:f}=rt(),{camera:c,optimisticIsMute:h,hasBrowserPermission:m,isPromptingPermission:p}=d(),g=f(),v=g==null?void 0:g.video.enabled,[C,S]=y.useState(!1),T=Lo(t,async()=>{a?await c.toggle():await l()});return b.jsx(Ze,{requiredGrants:[z.SEND_VIDEO],children:b.jsx(Do,{permission:z.SEND_VIDEO,isAwaitingApproval:u,messageApproved:e("You can now share your video."),messageAwaitingApproval:e("Awaiting for an approval to share your video."),messageRevoked:e("You can no longer share your video."),children:b.jsx(us,{title:a?m?v?n||e("Video"):e("Video publishing is disabled by the system"):e("Check your browser video permissions"):e("You have no permission to share your video"),tooltipDisabled:C,children:b.jsxs(dn,{active:h,caption:n,variant:"secondary",disabled:!m||!a||!v,"data-testid":h?"video-unmute-button":"video-mute-button",onClick:T,Menu:s,menuPlacement:i,menuOffset:16,...o,onMenuToggle:w=>{S(w),r==null||r(w)},children:[b.jsx(Ie,{icon:h?"camera-off":"camera"}),(!m||!a||!v)&&b.jsx("span",{className:"str-video__no-media-permission",children:"!"}),p&&b.jsx("span",{className:"str-video__pending-permission",title:e("Waiting for permission"),children:"?"})]})})})})};y.forwardRef(function({menuShown:e},n){const{t:s}=Ue();return b.jsx(us,{title:s("Leave call"),tooltipDisabled:e,children:b.jsx(gt,{icon:e?"close":"call-end",variant:e?"active":"danger","data-testid":"leave-call-button",ref:n})})});const ST=({disabled:t,caption:e,onClick:n,onLeave:s})=>{const i=Ne(),{t:r}=Ue(),o=y.useCallback(async a=>{n?n(a):i&&(await i.leave(),s==null||s())},[n,s,i]);return b.jsx(gt,{disabled:t,icon:"call-end",variant:"danger",title:e??r("Leave call"),"data-testid":"cancel-call-button",onClick:o})},CT=({onLeave:t})=>b.jsxs("div",{className:"str-video__call-controls",children:[b.jsx(Ze,{requiredGrants:[z.SEND_AUDIO],children:b.jsx(ZC,{children:b.jsx(vT,{})})}),b.jsx(Ze,{requiredGrants:[z.SEND_VIDEO],children:b.jsx(yT,{})}),b.jsx(Ze,{requiredGrants:[z.CREATE_REACTION],children:b.jsx(rT,{})}),b.jsx(Ze,{requiredGrants:[z.SCREENSHARE],children:b.jsx(lT,{})}),b.jsx(Ze,{requiredGrants:[z.START_RECORD_CALL,z.STOP_RECORD_CALL],children:b.jsx(nT,{})}),b.jsx(ST,{onLeave:t})]});y.lazy(()=>hd(()=>import("./latency-chart-Bj5OSYzg.es-CmGwxH8B.js"),__vite__mapDeps([0,1,2])));var vc;(function(t){t.GOOD="Good",t.OK="Ok",t.BAD="Bad"})(vc||(vc={}));y.forwardRef(function(e,n){const{t:s}=Ue(),{caption:i,menuShown:r}=e;return b.jsx(dn,{ref:n,active:r,caption:i,title:i||s("Statistics"),"data-testid":"stats-button",children:b.jsx(Ie,{icon:"stats"})})});y.forwardRef(function(e,n){return b.jsx(gt,{enabled:e.menuShown,icon:"ellipsis",ref:n})});y.forwardRef(function(e,n){return b.jsx(gt,{enabled:e.menuShown,icon:"filter",ref:n})});y.createContext(null);M.JOINING+"",M.RINGING+"",M.MIGRATING+"",M.RECONNECTING+"",M.RECONNECTING_FAILED+"",M.OFFLINE+"",M.IDLE+"",M.UNKNOWN+"",M.JOINED+"",M.LEFT+"";y.forwardRef(function(e,n){const{permissionRequests:s,handleUpdatePermission:i,...r}=e,{t:o}=Ue();return b.jsx("div",{className:"str-video__permission-requests-list",ref:n,...r,children:s.map((a,l)=>{const{user:u,permissions:d}=a;return b.jsx(y.Fragment,{children:d.map(f=>b.jsxs("div",{className:"str-video__permission-request",children:[b.jsx("div",{className:"str-video__permission-request__message",children:TT(u.name||u.id,f,o)}),b.jsx(br,{className:"str-video__permission-request__button--allow",type:"button",onClick:i(a,"grant"),children:o("Allow")}),b.jsx(br,{className:"str-video__permission-request__button--reject",type:"button",onClick:i(a,"revoke"),children:o("Revoke")}),b.jsx(br,{className:"str-video__permission-request__button--reject",type:"button",onClick:i(a,"dismiss"),children:o("Dismiss")})]},f))},`${u.id}/${l}`)})})});const br=t=>{const{className:e,...n}=t;return b.jsx("button",{className:Oe("str-video__permission-request__button",e),...n})},TT=(t,e,n)=>{switch(e){case z.SEND_AUDIO:return n("{{ userName }} is requesting to speak",{userName:t});case z.SEND_VIDEO:return n("{{ userName }} is requesting to share their camera",{userName:t});case z.SCREENSHARE:return n("{{ userName }} is requesting to present their screen",{userName:t});default:return n("{{ userName }} is requesting permission: {{ permission }}",{userName:t,permission:e})}},wT=({as:t="div",className:e,children:n,...s})=>b.jsx(t,{...s,className:Oe("str-video",e),children:n}),kT=y.forwardRef(function(e,n){return b.jsx(gt,{enabled:e.menuShown,icon:"ellipsis",ref:n})}),RT=()=>{const t=Ne(),{t:e}=Ue(),n=()=>{t==null||t.screenShare.disable()};return b.jsxs("div",{className:"str-video__screen-share-overlay",children:[b.jsx(Ie,{icon:"screen-share-off"}),b.jsx("span",{className:"str-video__screen-share-overlay__title",children:e("You are presenting your screen")}),b.jsxs("button",{onClick:n,className:"str-video__screen-share-overlay__button",children:[b.jsx(Ie,{icon:"close"})," ",e("Stop Screen Sharing")]})]})},Mo=({indicatorsVisible:t=!0,menuPlacement:e="bottom-start",showMenuButton:n=!0,ParticipantActionsContextMenu:s=GC})=>{const{participant:i,trackType:r}=qi(),o=mt(i);return i.isLocalParticipant&&o&&r==="screenShareTrack"?b.jsxs(b.Fragment,{children:[b.jsx(RT,{}),b.jsx(yc,{indicatorsVisible:t})]}):b.jsxs(b.Fragment,{children:[n&&b.jsx(Ao,{strategy:"fixed",placement:e,ToggleButton:kT,children:b.jsx(s,{})}),b.jsx(sT,{participant:i}),b.jsx(yc,{indicatorsVisible:t})]})},yc=({indicatorsVisible:t=!0})=>{const{participant:e}=qi(),{isLocalParticipant:n,connectionQuality:s,pin:i,sessionId:r,name:o,userId:a}=e,l=Ne(),{t:u}=Ue(),d=!!s&&Pr.ConnectionQuality[s].toLowerCase(),f=Nt(e),c=pt(e),h=!!i&&i.isLocalPin;return b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"str-video__participant-details",children:b.jsxs("span",{className:"str-video__participant-details__name",children:[o||a,t&&!f&&b.jsx("span",{className:"str-video__participant-details__name--audio-muted"}),t&&!c&&b.jsx("span",{className:"str-video__participant-details__name--video-muted"}),t&&h&&b.jsx("span",{title:u("Unpin"),onClick:()=>l==null?void 0:l.unpin(r),className:"str-video__participant-details__name--pinned"}),t&&b.jsx(ET,{})]})}),t&&b.jsx(gi,{isVisible:n&&s===Pr.ConnectionQuality.POOR,message:u("Poor connection quality"),children:d&&b.jsx("span",{className:Oe("str-video__participant-details__connection-quality",`str-video__participant-details__connection-quality--${d}`),title:d})})]})},ET=()=>{const{participant:t}=qi(),{isSpeaking:e,isDominantSpeaker:n}=t;return b.jsxs("span",{className:Oe("str-video__speech-indicator",e&&"str-video__speech-indicator--speaking",n&&"str-video__speech-indicator--dominant"),children:[b.jsx("span",{className:"str-video__speech-indicator__bar"}),b.jsx("span",{className:"str-video__speech-indicator__bar"}),b.jsx("span",{className:"str-video__speech-indicator__bar"})]})},Ms=y.forwardRef(function({participant:e,trackType:n="videoTrack",mirror:s,muteAudio:i,refs:{setVideoElement:r,setVideoPlaceholderElement:o}={},className:a,VideoPlaceholder:l,PictureInPicturePlaceholder:u,ParticipantViewUI:d=Mo},f){const{isLocalParticipant:c,isSpeaking:h,isDominantSpeaker:m,sessionId:p}=e,g=Nt(e),v=pt(e),C=ki(e),[S,T]=y.useState(null),[w,E]=y.useState(null),[_,A]=y.useState(null);YC({sessionId:p,trackedElement:S,trackType:n});const{useIncomingVideoSettings:q}=rt(),{isParticipantVideoEnabled:N}=q(),U=y.useMemo(()=>({participant:e,participantViewElement:S,videoElement:w,videoPlaceholderElement:_,trackType:n}),[w,_,e,S,n]),L=y.useMemo(()=>({setVideoElement:D=>{r==null||r(D),E(D)},setVideoPlaceholderElement:D=>{o==null||o(D),A(D)}}),[r,o]);return b.jsx("div",{"data-testid":"participant-view",ref:D=>{ed(f,D),T(D)},className:Oe("str-video__participant-view",m&&"str-video__participant-view--dominant-speaker",h&&"str-video__participant-view--speaking",!v&&"str-video__participant-view--no-video",!g&&"str-video__participant-view--no-audio",a),children:b.jsxs(Ju.Provider,{value:U,children:[!c&&!i&&b.jsxs(b.Fragment,{children:[g&&b.jsx(ts,{participant:e,trackType:"audioTrack"}),C&&b.jsx(ts,{participant:e,trackType:"screenShareAudioTrack"})]}),b.jsx(nd,{VideoPlaceholder:l,PictureInPicturePlaceholder:u,participant:e,trackType:n,refs:L,enabled:c||n!=="videoTrack"||N(e.sessionId),mirror:s,autoPlay:!0}),Qu(d)?b.jsx(d,{}):d]})})});Ms.displayName="ParticipantView";const od=Ov;od.displayName="StreamCall";var IT="Joining",_T="Mic",xT="Ringing",PT="Speakers",OT="Video",NT="Live",AT="Reactions",DT="Statistics",LT="Invite",MT="Join",jT="You",FT="Me",UT="Unknown",$T="Default",VT="Refresh",BT="Allow",HT="Revoke",qT="Dismiss",WT="Pinned",GT="Unpin",KT="Pin",JT="Block",zT="Enter",YT="Leave",XT="Participants",ZT=", and ({{ count }}) anonymous",QT={Joining:IT,Mic:_T,"No internet connection":"No internet connection","Re-connecting":"Re-connecting",Ringing:xT,"Screen Share":"Screen Share","Select a Camera":"Select a Camera","Select a Mic":"Select a Mic","Select Speakers":"Select Speakers",Speakers:PT,Video:OT,"You are muted. Unmute to speak.":"You are muted. Unmute to speak.",Live:NT,"You can now speak.":"You can now speak.","Awaiting for an approval to speak.":"Awaiting for an approval to speak.","You can no longer speak.":"You can no longer speak.","You can now share your video.":"You can now share your video.","Awaiting for an approval to share your video.":"Awaiting for an approval to share your video.","You can no longer share your video.":"You can no longer share your video.","Waiting for recording to stop...":"Waiting for recording to stop...","Waiting for recording to start...":"Waiting for recording to start...","Record call":"Record call",Reactions:AT,Statistics:DT,"You can now share your screen.":"You can now share your screen.","Awaiting for an approval to share screen.":"Awaiting for an approval to share screen.","You can no longer share your screen.":"You can no longer share your screen.","Share screen":"Share screen","Incoming Call...":"Incoming Call...","Calling...":"Calling...","Mute All":"Mute All",Invite:LT,Join:MT,You:jT,Me:FT,Unknown:UT,"Toggle device menu":"Toggle device menu",Default:$T,"Call Recordings":"Call Recordings",Refresh:VT,"Check your browser video permissions":"Check your browser video permissions","Video publishing is disabled by the system":"Video publishing is disabled by the system","You have no permission to share your video":"You have no permission to share your video","You have no permission to share your audio":"You have no permission to share your audio","You are presenting your screen":"You are presenting your screen","Stop Screen Sharing":"Stop Screen Sharing",Allow:BT,Revoke:HT,Dismiss:qT,"Microphone on":"Microphone on","Microphone off":"Microphone off","Camera on":"Camera on","Camera off":"Camera off","No camera found":"No camera found","Video is disabled":"Video is disabled",Pinned:WT,Unpin:GT,Pin:KT,"Pin for everyone":"Pin for everyone","Unpin for everyone":"Unpin for everyone",Block:JT,"Turn off video":"Turn off video","Turn off screen share":"Turn off screen share","Mute audio":"Mute audio","Mute screen share audio":"Mute screen share audio","Allow audio":"Allow audio","Allow video":"Allow video","Allow screen sharing":"Allow screen sharing","Disable audio":"Disable audio","Disable video":"Disable video","Disable screen sharing":"Disable screen sharing",Enter:zT,Leave:YT,"Leave call":"Leave call","End call for all":"End call for all","{{ direction }} fullscreen":"{{ direction }} fullscreen","{{ direction }} picture-in-picture":"{{ direction }} picture-in-picture","Dominant Speaker":"Dominant Speaker","Poor connection quality":"Poor connection quality. Please check your internet connection.",Participants:XT,Anonymous:ZT,"No participants found":"No participants found","Participants ({{ numberOfParticipants }})":"Participants ({{ numberOfParticipants }})","{{ userName }} is sharing their screen":"{{ userName }} is sharing their screen","{{ userName }} is requesting to speak":"{{ userName }} is requesting to speak","{{ userName }} is requesting to share their camera":"{{ userName }} is requesting to share their camera","{{ userName }} is requesting to present their screen":"{{ userName }} is requesting to present their screen","{{ userName }} is requesting permission: {{ permission }}":"{{ userName }} is requesting permission: {{ permission }}"};const ew={en:QT},ad=t=>b.jsx(Fv,{translationsOverrides:ew,...t});ad.displayName="StreamVideo";function js(t,e){return"$and"in e?e.$and.every(n=>js(t,n)):"$or"in e?e.$or.some(n=>js(t,n)):"$not"in e?!js(t,e.$not):tw(t,e)}function tw(t,e){let n=!0;for(const s of Object.keys(e)){const i=e[s],r=i&&typeof i=="object",o=t[s];if(r&&"$eq"in i)n&&(n=i.$eq===o);else if(r&&"$neq"in i)n&&(n=i.$neq!==o);else if(r&&"$in"in i)n&&(n=i.$in.includes(o));else if(r&&"$contains"in i)if(Array.isArray(o)){const a=i;n&&(n=o.includes(a.$contains))}else n=!1;else n&&(n=i===o);if(!n)return!1}return!0}const nw=({excludeLocalParticipant:t=!1,filterParticipants:e})=>{const{useParticipants:n,useRemoteParticipants:s}=rt(),i=n(),r=s();return y.useMemo(()=>{const o=t?r:i;return e?sw(o,e):o},[i,r,t,e])},sw=(t,e)=>{const n=typeof e=="function"?e:s=>js({userId:s.userId,isSpeaking:s.isSpeaking,isDominantSpeaker:s.isDominantSpeaker,name:s.name,roles:s.roles,isPinned:kg(s),hasVideo:pt(s),hasAudio:Nt(s)},e);return t.filter(n)},iw=(t,e)=>{y.useEffect(()=>{if(t)return e?t.setSortParticipantsBy(Mt(lo,ow)):t.setSortParticipantsBy(Ig),()=>{rw(t)}},[t,e])},rw=t=>{const e=Ql.get(t.type);t.setSortParticipantsBy(e.options.sortParticipantsBy||Yn)},ow=(t,e)=>t.isLocalParticipant?1:e.isLocalParticipant?-1:0,aw=(t,e,n)=>{const[s,i]=y.useState({vertical:typeof n=="number"?n:null,horizontal:typeof n=="number"?n:null});return y.useEffect(()=>{if(!e||!t||typeof n=="number"||typeof n>"u")return;let r=null,o=null;const a=new ResizeObserver((l,u)=>{if(l.length>1){const c=e.firstChild;c&&(o=c.clientHeight,r=c.clientWidth,u.unobserve(e))}if(o===null||r===null)return;const d=Math.floor(t.clientHeight/o),f=Math.floor(t.clientWidth/r);i(c=>c.vertical!==d||c.horizontal!==f?{vertical:d,horizontal:f}:c)});return a.observe(t),a.observe(e),()=>{a.disconnect()}},[e,n,t]),s},cw=()=>b.jsx(Mo,{menuPlacement:"top-end"}),cd=({ParticipantViewUIBar:t=cw,ParticipantViewUISpotlight:e=Mo,VideoPlaceholder:n,PictureInPicturePlaceholder:s,participantsBarPosition:i="bottom",participantsBarLimit:r,mirrorLocalParticipantVideo:o=!0,excludeLocalParticipant:a=!1,filterParticipants:l,pageArrowsVisible:u=!0,muted:d})=>{const f=Ne(),{useParticipants:c,useRemoteParticipants:h}=rt(),m=c(),p=h(),[g,...v]=nw({excludeLocalParticipant:a,filterParticipants:l}),[C,S]=y.useState(null),[T,w]=y.useState(null),[E,_]=y.useState(null),A=g&&mt(g),q=aw(E,T,r),N=i==="left"||i==="right",U=i==="top"||i==="bottom";y.useEffect(()=>{if(!C||!f)return;const j=f.setViewport(C);return()=>j()},[C,f]);const L=m.length===2;iw(f,L);let D=v;const R=N?q.vertical:q.horizontal;typeof r<"u"&&R!==null&&(D=v.slice(0,R-(A?1:0)));const x=o?void 0:!1;if(!f)return null;const $=i&&(D.length>0||A);return b.jsxs("div",{className:"str-video__speaker-layout__wrapper",children:[!d&&b.jsx(Ku,{participants:p}),b.jsxs("div",{className:Oe("str-video__speaker-layout",i&&`str-video__speaker-layout--variant-${i}`),children:[b.jsx("div",{className:"str-video__speaker-layout__spotlight",children:g&&b.jsx(Ms,{participant:g,muteAudio:!0,mirror:x,trackType:A?"screenShareTrack":"videoTrack",ParticipantViewUI:e,VideoPlaceholder:n,PictureInPicturePlaceholder:s})}),$&&b.jsxs("div",{ref:_,className:"str-video__speaker-layout__participants-bar-buttons-wrapper",children:[b.jsx("div",{className:"str-video__speaker-layout__participants-bar-wrapper",ref:S,children:b.jsxs("div",{ref:w,className:"str-video__speaker-layout__participants-bar",children:[A&&b.jsx("div",{className:"str-video__speaker-layout__participant-tile",children:b.jsx(Ms,{participant:g,ParticipantViewUI:t,VideoPlaceholder:n,PictureInPicturePlaceholder:s,mirror:x,muteAudio:!0})},g.sessionId),D.map(j=>b.jsx("div",{className:"str-video__speaker-layout__participant-tile",children:b.jsx(Ms,{participant:j,ParticipantViewUI:t,VideoPlaceholder:n,PictureInPicturePlaceholder:s,mirror:x,muteAudio:!0})},j.sessionId))]})}),u&&N&&b.jsx(uw,{scrollWrapper:C}),u&&U&&b.jsx(lw,{scrollWrapper:C})]})]})]})};cd.displayName="SpeakerLayout";const lw=({scrollWrapper:t})=>{const e=HC(t),n=()=>{t==null||t.scrollBy({left:-150,behavior:"smooth"})},s=()=>{t==null||t.scrollBy({left:150,behavior:"smooth"})};return b.jsxs(b.Fragment,{children:[e&&e!=="start"&&b.jsx(gt,{onClick:n,icon:"caret-left",className:"str-video__speaker-layout__participants-bar--button-left"}),e&&e!=="end"&&b.jsx(gt,{onClick:s,icon:"caret-right",className:"str-video__speaker-layout__participants-bar--button-right"})]})},uw=({scrollWrapper:t})=>{const e=BC(t),n=()=>{t==null||t.scrollBy({top:-150,behavior:"smooth"})},s=()=>{t==null||t.scrollBy({top:150,behavior:"smooth"})};return b.jsxs(b.Fragment,{children:[e&&e!=="top"&&b.jsx(gt,{onClick:n,icon:"caret-up",className:"str-video__speaker-layout__participants-bar--button-top"}),e&&e!=="bottom"&&b.jsx(gt,{onClick:s,icon:"caret-down",className:"str-video__speaker-layout__participants-bar--button-bottom"})]})},[dw,hw,fw]="1.14.4".split(".");Fg({type:Pr.SdkType.REACT,major:dw,minor:hw,patch:fw});const pw="8wdwgns6ss3h",Sw=()=>{const{id:t}=fd(),[e,n]=y.useState(null),[s,i]=y.useState(null),[r,o]=y.useState(!0),{authUser:a,isLoading:l}=pd(),{data:u}=md({queryKey:["streamToken"],queryFn:yd,enabled:!!a});return y.useEffect(()=>{(async()=>{if(!(!u.token||!a||!t))try{console.log("Initializing Stream video client...");const f={id:a._id,name:a.fullName,image:a.profilePic},c=new Vt({apiKey:pw,user:f,token:u.token}),h=c.call("default",t);await h.join({create:!0}),console.log("Joined call successfully"),n(c),i(h)}catch(f){console.error("Error joining call:",f),bd.error("Could not join the call. Please try again.")}finally{o(!1)}})()},[u,a,t]),l||r?b.jsx(gd,{}):b.jsx("div",{className:"h-screen flex flex-col items-center justify-center",children:b.jsx("div",{className:"relative",children:e&&s?b.jsx(ad,{client:e,children:b.jsx(od,{call:s,children:b.jsx(mw,{})})}):b.jsx("div",{className:"flex items-center justify-center h-full",children:b.jsx("p",{children:"Could not initialize call. Please refresh or try again later."})})})})},mw=()=>{const{useCallCallingState:t}=rt(),e=t(),n=vd();return e===M.LEFT?n("/"):b.jsxs(wT,{children:[b.jsx(cd,{}),b.jsx(CT,{})]})};export{Sw as default};
